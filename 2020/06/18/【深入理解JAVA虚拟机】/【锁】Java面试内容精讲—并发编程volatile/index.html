<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
<script data-ad-client="ca-pub-3892229323208960" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script data-ad-client="ca-pub-8318014576592877" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<script>
	(function(){
		if(''){
			if (prompt('请输入文章密码','') !== ''){
				alert('密码错误！');
				history.back();
			}
		}
	})();
</script>









<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #A0A0A0; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #A0A0A0, 0 0 5px     #A0A0A0; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #A0A0A0;    /*上边框颜色*/
        border-left-color: #A0A0A0;    /*左边框颜色*/
    }
</style>

<meta name="theme-color" content="#222">










<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
    
  
  <link href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/fsn-16x16.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/fsn-32x32.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/fsn-16x16.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/fsn-16x16.ico?v=5.1.4" color="#222">





  <meta name="keywords" content="面试,锁,volatile," />





  <link rel="alternate" href="/atom.xml" title="✨Fsn✨" type="application/atom+xml" />






<meta name="description" content="前言观看链接：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1RC4y1h7YU。 课程总体说明介绍的是有关于并发编程下的volatile关键字的使用；并发编程一直是java实际开发当中一个非常重要的内容，同时也是一个难以理解的内容；在实际开发中或者是在面试中经常被面试官问到关于并发编程的知识点；volatile就是其中一个比较热门的知识点，也是相对于来说比较难以理解的知识点；">
<meta property="og:type" content="article">
<meta property="og:title" content="Java面试内容精讲—并发编程volatile">
<meta property="og:url" content="https://fengshana.github.io/2020/06/18/%E3%80%90%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA%E3%80%91/%E3%80%90%E9%94%81%E3%80%91Java%E9%9D%A2%E8%AF%95%E5%86%85%E5%AE%B9%E7%B2%BE%E8%AE%B2%E2%80%94%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8Bvolatile/index.html">
<meta property="og:site_name" content="✨Fsn✨">
<meta property="og:description" content="前言观看链接：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1RC4y1h7YU。 课程总体说明介绍的是有关于并发编程下的volatile关键字的使用；并发编程一直是java实际开发当中一个非常重要的内容，同时也是一个难以理解的内容；在实际开发中或者是在面试中经常被面试官问到关于并发编程的知识点；volatile就是其中一个比较热门的知识点，也是相对于来说比较难以理解的知识点；">
<meta property="og:image" content="http://r.photo.store.qq.com/psc?/V13IdniL3IuSOB/TCfiP1YaPeRT4Jil9RANX54M31ChmwM*Z9.W0KJwL.L.WJM3g0w6sfpvOiBhargPt17*v81qaLtn8mkWDbZUn*BOXh64BPfdg2227SLq0i0!/r">
<meta property="article:published_time" content="2020-06-17T20:20:50.000Z">
<meta property="article:modified_time" content="2020-07-03T13:37:25.939Z">
<meta property="article:author" content="✨🧙‍♀️✨">
<meta property="article:tag" content="面试">
<meta property="article:tag" content="锁">
<meta property="article:tag" content="volatile">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://r.photo.store.qq.com/psc?/V13IdniL3IuSOB/TCfiP1YaPeRT4Jil9RANX54M31ChmwM*Z9.W0KJwL.L.WJM3g0w6sfpvOiBhargPt17*v81qaLtn8mkWDbZUn*BOXh64BPfdg2227SLq0i0!/r">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://fengshana.github.io/2020/06/18/【深入理解JAVA虚拟机】/【锁】Java面试内容精讲—并发编程volatile/"/>









  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "07d52b28"
    });
  daovoice('update');
  </script>

  <title>Java面试内容精讲—并发编程volatile | ✨Fsn✨</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2a839053bb6194637483460a0f428730";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  
  <!-- Google AdSense start -->
  <script data-ad-client="ca-pub-3892229323208960" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- Google AdSense end -->

<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.js"></script>
<script src="https://unpkg.com/minigrid@3.1.1/dist/minigrid.min.js"></script>
<link rel="stylesheet" href="/photos/photos.css">
<script type="text/javascript" src="/photos/photo.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/mermaid/0.2.4/mermaid.full.min.js"></script>


<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">✨Fsn✨</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sentence">
          <a href="/shuoshuo" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-commenting"></i> <br />
            
            小心情
          </a>
        </li>
      

      
    </ul>
  

  
</nav>


<!-- Fsn -->
<script type="text/javascript">
WIDGET = {FID: 'o6km9Rzhmn'}
</script>
<script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>




 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="poem-wrap">
  <div class="poem-border poem-left"></div>
  <div class="poem-border poem-right"></div>
    <h1>[🌿诗酒年华🌻]</h1>
    <p id="poem">挑选中🌺...🍃🍂</p>
    <p id="info">

  <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
  <script type="text/javascript">
    jinrishici.load(function(result) {
      poem.innerHTML = result.data.content
      info.innerHTML = '【' + result.data.origin.dynasty + '】' + result.data.origin.author + '🍃《' + result.data.origin.title + '》🍂'
      document.getElementById("poem").value(poem);
      document.getElementById("info").value(info);  
  });
  </script>
</div>

        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fengshana.github.io/2020/06/18/%E3%80%90%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA%E3%80%91/%E3%80%90%E9%94%81%E3%80%91Java%E9%9D%A2%E8%AF%95%E5%86%85%E5%AE%B9%E7%B2%BE%E8%AE%B2%E2%80%94%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8Bvolatile/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="✨🧙‍♀️✨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/fsn.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="✨Fsn✨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Java面试内容精讲—并发编程volatile</h1>
        

        <div class="post-meta">
		

          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text"></span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-18T04:20:50+08:00">
                2020-06-18
              </time>
            

            
              
            

            
              <span class="post-meta-item-icon">
                
              </span>
              
                <span class="post-meta-item-text"></span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-07-03T21:37:25+08:00">
                
              </time>
            
          </span>

          
            <span class="post-category" >
            
              
              
              
                <span class="post-meta-item-text"></span>
              
              
                

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="http://r.photo.store.qq.com/psc?/V13IdniL3IuSOB/TCfiP1YaPeRT4Jil9RANX54M31ChmwM*Z9.W0KJwL.L.WJM3g0w6sfpvOiBhargPt17*v81qaLtn8mkWDbZUn*BOXh64BPfdg2227SLq0i0!/r " rel="gallery_ckcgavpug00bttcumbyys3l1c"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="http://r.photo.store.qq.com/psc?/V13IdniL3IuSOB/TCfiP1YaPeRT4Jil9RANX54M31ChmwM*Z9.W0KJwL.L.WJM3g0w6sfpvOiBhargPt17*v81qaLtn8mkWDbZUn*BOXh64BPfdg2227SLq0i0!/r " itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>观看链接：<code>https://www.bilibili.com/video/BV1RC4y1h7YU</code>。</p>
<h2 id="课程总体说明"><a href="#课程总体说明" class="headerlink" title="课程总体说明"></a>课程总体说明</h2><p>介绍的是有关于并发编程下的<code>volatile</code>关键字的使用；<br>并发编程一直是java实际开发当中一个非常重要的内容，同时也是一个难以理解的内容；<br>在实际开发中或者是在面试中经常被面试官问到关于并发编程的知识点；<code>volatile</code>就是其中一个比较热门的知识点，也是相对于来说比较难以理解的知识点；</p>
<p>在介绍<code>volatile</code>关键字之前，先来了解一下并发编程的背景；<br>并发编程是在互联网的背景下，当我们的系统开发出来以后，肯定会涉及到非常多的并发量；<br>那么在这么大的并发量的情况下，我们的业务以及共享数据都会出现一个并发安全性的问题。<br>所以并发编程会衍生出非常多的技术；<br>在介绍<code>volatile</code>模块之前，介绍下本次课程的总体介绍。</p>
<p><strong>并发编程-volatile使用精讲</strong></p>
<ul>
<li>第一章 volatile关键字概览（介绍<code>volatile</code>是干嘛用的）<ul>
<li>多线程下变量的不可见性<ul>
<li>概述<ul>
<li>在多线程并发执行下，多个线程修改共享的成员变量，会出现一个线程修改了共享变量的值后，另一个线程不能直接看到该线程修改后的变量的最新值。而通过<code>volatile</code>关键字就可以让共享变量值可见。</li>
</ul>
</li>
<li>案例演示</li>
<li>执行结果</li>
<li>小结</li>
</ul>
</li>
<li>变量不可见性内存语义<ul>
<li>概述</li>
<li>问题分析</li>
<li>小结</li>
</ul>
</li>
<li>变量不可见性解决方案<ul>
<li>概述</li>
<li>解决方案</li>
<li>小结</li>
</ul>
</li>
</ul>
</li>
<li>第二章 volatile的其他特性<ul>
<li>volatile特性概述<ul>
<li>volatile总体概述</li>
</ul>
</li>
<li>volatile不保证原子性<ul>
<li>问题案例演示</li>
<li>问题原理说明</li>
<li>volatile原子性测试</li>
<li>小结</li>
<li>问题解决<ul>
<li>使用锁机制</li>
<li>原子类<ul>
<li>AtomicInteger</li>
<li>案例改造</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>禁止指令重排序<ul>
<li>概述</li>
<li>重排序的好处</li>
<li>重排序案例演示</li>
<li>volatile禁止重排序</li>
<li>小结</li>
</ul>
</li>
</ul>
</li>
<li>第三章 volatile内存语义<ul>
<li>volatile写读建立的happens-before关系<ul>
<li>概述</li>
<li>happens-before规则</li>
<li>volatile写读建立的happens-before关系</li>
<li>volatile重排序规则小结</li>
</ul>
</li>
</ul>
</li>
<li>第四章 volatile高频面试与总结<ul>
<li>long和double的原子性<ul>
<li>概述</li>
<li>案例演示</li>
<li>测试结果</li>
<li>小结</li>
</ul>
</li>
<li>volatile在双重检查加锁的单例中的应用<ul>
<li>单例概述</li>
<li>单例模式有8中</li>
<li>饿汉单例的2种写法<ul>
<li>饿汉式（静态常量）</li>
<li>饿汉式（静态代码块）</li>
</ul>
</li>
<li>懒汉式单例4中写法<ul>
<li>懒汉式（线程不安全）</li>
<li>懒汉式（线程安全）</li>
<li>懒汉式（线程不安全）</li>
<li>懒汉式（volatile双重检查模式 推荐）</li>
</ul>
</li>
<li>静态内部类单例模式</li>
<li>枚举实现单例</li>
</ul>
</li>
<li>volatile的使用场景<ul>
<li>纯赋值操作<ul>
<li>概述</li>
<li>案例代码</li>
<li>小结</li>
</ul>
</li>
<li>触发器</li>
</ul>
</li>
<li>volatile与synchronized<ul>
<li>区别</li>
</ul>
</li>
<li>volatile的总结<ul>
<li>总体总结</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="多线程下变量的不可见性现象"><a href="#多线程下变量的不可见性现象" class="headerlink" title="多线程下变量的不可见性现象"></a>多线程下变量的不可见性现象</h2><p>多线程下变量的不可见性</p>
<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>在多线程并发执行下（多条线程执行的情况下），多个线程修改共享的成员变量（共享的成员变量：比如说实例成员变量、一个类中的静态成员变量，那么这些都是可以被多个线程所共享的成员变量），会出现一个线程修改了共享变量的值后，另一个线程不能直接看到该线程修改后的变量的最新值。</p>
<p>当使用多条线程来访问一个类当中的成员变量的时候，如果其中有一个线程将该成员变量的值给进行修改了则那么另外一个线程可能不能够马上看到这个变量的最新值。<br>这样就可能在并发编程的情况下，可能出现一个变量数据不同步的问题。</p>
<h3 id="案例演示"><a href="#案例演示" class="headerlink" title="案例演示"></a>案例演示</h3><p>当有一个成员变量的情况下，如果开了多条线程，其中某一个线程A修改了这个变量的取值以后，其他的线程B、C、D可能是无法观看得到线程A所针对这个变量所做的操作；<br>那么通过volatile关键字，就可以使得这个变量的取值在线程之间可见；</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">MyThread</span> <span class="symbol">extends</span> <span class="symbol">Thread</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义成员变量</span></span><br><span class="line">  <span class="keyword">private</span> <span class="built_in">bool</span>ean flag = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">bool</span>ean isFlag()&#123; <span class="keyword">return</span> flag; &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">void</span> run()&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将flag的值更改为false</span></span><br><span class="line">    <span class="keyword">this</span>.flag = <span class="literal">true</span>;</span><br><span class="line">    System.<span class="keyword">out</span>.println(<span class="string">"flag = "</span> + flag)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">VolatileThreadDemo</span>&#123;</span><br><span class="line">  <span class="comment">//测试类</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xxx.concurrent;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">      目标：研究一下多线程下变量访问的不可见性现象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      准备内容：</span></span><br><span class="line"><span class="comment">        1. 准备两个线程</span></span><br><span class="line"><span class="comment">        2. 定义一个成员变量</span></span><br><span class="line"><span class="comment">        3. 开启两个线程，其中一个线程负责修改，另外一个负责读取</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VisibilityDemo01</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// main()方法本身就是一个主线程，作为一个主线程</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// a. 开启一个子线程</span></span><br><span class="line">    MyThread t = <span class="keyword">new</span> MyThread();</span><br><span class="line">    <span class="comment">// 启动子线程；在子线程当中将成员变量flag修改为true</span></span><br><span class="line">    t.start();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// b. 主线程执行；定义成一个死循环；</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">        调用isFla取出MyThread类当中flag成员变量的值。</span></span><br><span class="line"><span class="comment">        创建好一个子线程t，MyThread当中的flag成员变量属于线程对象t；</span></span><br><span class="line"><span class="comment">        触发启动子线程之后，子线程执行完其run()方法之后，将flag的取值修改为了true；</span></span><br><span class="line"><span class="comment">        从而接着主线程执行判断t.isFlag()时应该取到的值为true；</span></span><br><span class="line"><span class="comment">        取到正确的值之后进入到if判断中来进行打印输出；</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        将子线程启动的时候，应该要将flag变量修改为true；</span></span><br><span class="line"><span class="comment">        那么当主线程在执行的时候就会发现flag变量已经为true，</span></span><br><span class="line"><span class="comment">        那么就会进入到if块当中的代码进行打印输出</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="keyword">if</span>(t.isFlag())&#123;</span><br><span class="line">        System.out.println(<span class="string">"主线程进入循环执行~~~~~~"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//单独定义一个类，子线程</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">  <span class="comment">//成员变量</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//重写run方法</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 触发修改共享成员变量</span></span><br><span class="line">    flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//此时已经在子线程当中将共享变量flag的取值修改为true；</span></span><br><span class="line">    System.out.println(<span class="string">"flag = "</span> + flag);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFlag</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> flag;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFlag</span><span class="params">(<span class="keyword">boolean</span> flag)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.flag=flag;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------</span><br><span class="line">运行成功；将主线程当中打印内容<span class="keyword">while</span>(<span class="keyword">true</span>)循环输出；</span><br><span class="line">flag = <span class="keyword">true</span></span><br><span class="line">主线程进入循环执行~~~~~~</span><br><span class="line">主线程进入循环执行~~~~~~</span><br><span class="line">主线程进入循环执行~~~~~~</span><br><span class="line">主线程进入循环执行~~~~~~</span><br><span class="line">主线程进入循环执行~~~~~~</span><br><span class="line">主线程进入循环执行~~~~~~</span><br><span class="line">....</span><br><span class="line">------------------------------------------</span><br><span class="line">原因：</span><br><span class="line">原因在于子线程B很快的将线程MyThread当中的flag修改成了<span class="keyword">true</span>；</span><br><span class="line">所以当主线程再来进行执行的时候，flag的取值已经为<span class="keyword">true</span>了，所以主线程会进入到<span class="keyword">if</span>判断中执行代码块中的打印输出；</span><br><span class="line">------------------------------------------</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义成员变量（实例成员变量）</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFlag</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> flag; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将flag的值更改为false</span></span><br><span class="line">    <span class="keyword">this</span>.flag = <span class="keyword">true</span>;</span><br><span class="line">    System.out.println(<span class="string">"flag = "</span> + flag)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VolatileThreadDemo</span></span>&#123;</span><br><span class="line">  <span class="comment">//测试类</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">      目标：研究一下多线程下变量访问的不可见性现象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      准备内容：</span></span><br><span class="line"><span class="comment">        1. 准备两个线程</span></span><br><span class="line"><span class="comment">        2. 定义一个成员变量</span></span><br><span class="line"><span class="comment">        3. 开启两个线程，其中一个线程负责修改，另外一个负责读取</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VisibilityDemo01</span>&#123;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// main()方法本身就是一个线,程</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// a. 开启一个子线程</span></span><br><span class="line">    MyThread t = <span class="keyword">new</span> MyThread();</span><br><span class="line">    t.start();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// b. 主线程执行</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span>(t.isFlag())&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"主线程进入循环执行~~~~~~"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="title">extends</span> <span class="title">Thread</span>&#123;</span></span><br><span class="line">  <span class="comment">//成员变量</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    在实际开发过程中，假设更改flag变量取值为true修改得慢一点；</span></span><br><span class="line"><span class="comment">    即让子线程休眠一秒钟；</span></span><br><span class="line"><span class="comment">    而当中子线程在进行休眠的该过程当中主线程其实也是有机会优先执行while(true)循环体中的if判断层的；</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 触发修改共享成员变量</span></span><br><span class="line">    flag = <span class="literal">true</span>;</span><br><span class="line">    System.out.<span class="built_in">println</span>(<span class="string">"flag = "</span> + flag);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFlag</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> flag;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFlag</span><span class="params">(<span class="keyword">boolean</span> flag)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.flag=flag;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------</span><br><span class="line">运行成功；将主线程当中打印内容<span class="keyword">while</span>(<span class="literal">true</span>)并没有进行循环输出；</span><br><span class="line">flag = <span class="literal">true</span></span><br><span class="line">------------------------------------------</span><br><span class="line">原因：当子线程执行<span class="built_in">run</span>()方法的时候，已经将flag变为了<span class="literal">true</span>；</span><br><span class="line">也就是说子线程已经修改了这个变量的取值；</span><br><span class="line">但是在主线程当中是没有访问得到这个变量的最新取值的；</span><br><span class="line">这样也就出现了多线程下变量访问的不可见性现象。</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<h3 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h3><p>此时可以看到，子线程中已经将flag设置为true，<br>但是main()方法当中始终没有读取到修改后的最新值，<br>从而循环没有能进入到if语句中执行，所以没有任何打印。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>多线程下修改共享变量会出现变量修改值后的不可见性。</p>
<p>（当其中一个变量修改了，而其他线程是可能无法看到修改后的变量的新的取值的）</p>
<h2 id="多线程下变量不可见性内存语义"><a href="#多线程下变量不可见性内存语义" class="headerlink" title="多线程下变量不可见性内存语义"></a>多线程下变量不可见性内存语义</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>JMM内存模型不同于java基础当中学到的栈、堆，它是属于并发编程下的一个独有的内存模型。通过了解内存模型可以深入理解并发编程当中的底层运转机制。同时也可以更加深入理解volatile关键字，在并发编程当中的作用，以及它可以帮助我们在实际开发当中解决问题。</p>
<p>在连接多线程并发修改变量不可见现象前，我们需要了解回顾一下Java内存模型（和Java并发编程有关的模型）：JMM。</p>
<p>JMM（Java Memory Model）：Java内存模型是Java虚拟机规范中所定义的一种内存模型，Java内存模型是标准化的，屏蔽掉了底层不同计算机的区别。</p>
<p>Java内存模型（Java Memory Model）描述了Java程序中各种变量（线程共享变量）的访问规则，以及在JVM中将变量存储到内存和从内存中读取变量这样的底层细节。</p>
<p>JMM有以下规定：</p>
<ul>
<li>所有的共享变量都存储于主内存。这里所说的变量指的是实例变量和类变量。不包含局部变量，因为局部变量是线程私有的，因此不存在竞争问题。</li>
<li>每一个线程还存在自己的工作内存，线程的工作内存，保留了被线程使用的变量的工作副本。</li>
<li>线程对变量的所有操作（读、取）都必须在工作内存中完成，而不能直接读写主内存中的变量。</li>
<li>不同线程之间也不能直接访问对方工作内存中的变量，线程间变量的值的传递需要通过主内存</li>
</ul>
<p>本地内存和主内存的关系：</p>
<h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><h2 id="多线程下变量不可见性解决方案-加锁，volatile修饰"><a href="#多线程下变量不可见性解决方案-加锁，volatile修饰" class="headerlink" title="多线程下变量不可见性解决方案-加锁，volatile修饰"></a>多线程下变量不可见性解决方案-加锁，volatile修饰</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><p>如何实现在多线程下访问共享变量，实现一个线程修改变量后，对其他线程可见呢。<br>接下来为大家介绍两种方案：</p>
<p>第一种加锁；<br>第二种是使用volatile关键字；</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>加锁</strong></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main方法</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">  synchronized(t)&#123;</span><br><span class="line">    <span class="keyword">if</span>(t.is<span class="constructor">Flag()</span>)&#123;</span><br><span class="line">      <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">"执行了=============="</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>某一个线程进入synchronized代码块前后，执行过程如下：</p>
<p>a. 线程获得锁<br>b. 清空工作内存<br>c. 从主内存拷贝共享变量最新的值到工作内存成为副本</p>
<h3 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h3><h2 id="volatile不保证原子性"><a href="#volatile不保证原子性" class="headerlink" title="volatile不保证原子性"></a>volatile不保证原子性</h2><p>第二章 volatile的其他特性</p>
<h3 id="volatile特性概述"><a href="#volatile特性概述" class="headerlink" title="volatile特性概述"></a>volatile特性概述</h3><p>在上节中，已经研究完了 volatile可以实现并发下共享变量的可见性；<br>除了volatile可以保证可见性外，<br>volatile还具备如下一些突出的特性：<br>volatile的原子性问题：volatile不能保证原子性操作；<br>禁止指令重排序：volatile可以防止指令重排序操作；</p>
<h3 id="volatile不保证原子性2"><a href="#volatile不保证原子性2" class="headerlink" title="volatile不保证原子性2"></a>volatile不保证原子性2</h3><p>在保证线程安全的情况下，volatile是否可以做到保证原子性？<br>在之前是使用synchronized关键字进行加锁机制来进行保证变量修改的安全性；<br>而volatile无法保证线程安全性；</p>
<p>所谓的原子性是指在一次操作或者多次操作中，要么所有的操作全部都得到了执行并且不会受到任何因素的干扰而中断，要么所有的操作都不执行。</p>
<h4 id="问题案例演示"><a href="#问题案例演示" class="headerlink" title="问题案例演示"></a>问题案例演示</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">VolatileAtomicThread</span> <span class="symbol">implements</span> <span class="symbol">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//定义一个int类型的遍历</span></span><br><span class="line">  <span class="keyword">private</span> <span class="built_in">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">void</span> run()&#123;</span><br><span class="line">    <span class="comment">// 对该变量进行++操作，100次</span></span><br><span class="line">    <span class="keyword">for</span>( <span class="built_in">int</span> i = x; x&lt;<span class="number">100</span>; x++)&#123;</span><br><span class="line">      count++;</span><br><span class="line">      System.<span class="keyword">out</span>.println(<span class="string">"count ==========&gt;&gt;&gt;&gt;&gt;&gt;&gt; "</span>+count);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">VolatileAtomicThreadDemo</span>&#123;</span><br><span class="line">  <span class="keyword">public</span> static <span class="built_in">void</span> main(String[] args)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建VolatileAtomicThread对象</span></span><br><span class="line">    VolatileAtomicThread volatileAtomicThread = new VolatileAtomicThread();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开启100个线程对count进行++操作</span></span><br><span class="line">    <span class="keyword">for</span>( <span class="built_in">int</span> i = <span class="number">0</span>; x&lt;<span class="number">100</span>; x++)&#123;</span><br><span class="line">      new Thread(volatileAtomicThread).start();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：不保证一定是10000</p>
<h4 id="问题原理说明"><a href="#问题原理说明" class="headerlink" title="问题原理说明"></a>问题原理说明</h4><h4 id="volatile原子性测试"><a href="#volatile原子性测试" class="headerlink" title="volatile原子性测试"></a>volatile原子性测试</h4><p>代码测试</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 定义一个<span class="built_in">int</span> 类型的变量</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="built_in">int</span> <span class="built_in">count</span> = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h4 id="小结-3"><a href="#小结-3" class="headerlink" title="小结"></a>小结</h4><p>在多线程环境下，<code>volatile</code>关键字可以保证共享数据的可见性，但是并不能保证对数据操作的原子性（在多线程环境下<code>volatile</code>修饰的变量也是线程不安全的）。</p>
<p>在多线程环境下，要保证数据的安全性，还需要使用锁机制。</p>
<h4 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h4><h5 id="使用锁机制"><a href="#使用锁机制" class="headerlink" title="使用锁机制"></a>使用锁机制</h5><p>可以给<code>count++</code>操作添加锁，<br>那么<code>count++</code>操作就是临界区的代码，<br>临界区只能有一个线程去执行，<br>所以<code>count++</code>就变成了原子操作。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> VolatileAtomicThread <span class="keyword">implements</span> Runnable&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//定义一个int类型的变量</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> <span class="keyword">count</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object obj = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> run ()&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对该变量进行++操作，100次</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> x = <span class="number">0</span>; x&lt;<span class="number">100</span>; x++)&#123;</span><br><span class="line">      <span class="keyword">synchronized</span>(obj)&#123;</span><br><span class="line">        <span class="keyword">count</span>++;</span><br><span class="line">        System.out.<span class="keyword">println</span>(<span class="string">"count ============&gt;&gt;&gt;&gt;&gt;&gt;&gt; "</span>+<span class="keyword">count</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="原子类"><a href="#原子类" class="headerlink" title="原子类"></a>原子类</h5><p>概述：java从JDK1.5开始提供了java.util.concurrent.atomic包（简称Atomic包），这个包中的原子操作类提供了一种用法简单，性能高效，线程安全地更新一个变量的方式。</p>
<h6 id="AtomicInteger"><a href="#AtomicInteger" class="headerlink" title="AtomicInteger"></a>AtomicInteger</h6><p>原子性Integer，可以实现原子更新操作</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public <span class="constructor">AtomicInteger()</span>:                   初始化一个默认值为<span class="number">0</span>的Integer</span><br><span class="line">public <span class="constructor">AtomicInteger(<span class="params">int</span> <span class="params">initialValue</span>)</span>：  初始化一个指定值的原子性Integer</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> get<span class="literal">()</span>:                                获取值</span><br><span class="line"><span class="built_in">int</span> get<span class="constructor">AndIncrement()</span>:                    以原子方式将当前值加<span class="number">1</span>，注意，这里返回的是自增前的值。</span><br><span class="line"><span class="built_in">int</span> increment<span class="constructor">AndGet()</span>:                    以原子方式将当前值加<span class="number">1</span>，注意，这里返回的是自增后的值。</span><br><span class="line"><span class="built_in">int</span> add<span class="constructor">AndGet(<span class="params">int</span> <span class="params">data</span>)</span>:                  以原子方式将输入的数值与实例中的值（AtomicInteger里的value）相加，并返回结果。</span><br><span class="line"><span class="built_in">int</span> get<span class="constructor">AndSet(<span class="params">int</span> <span class="params">value</span>)</span>:                 以原子方式设置为newValue的值，并返回旧值。</span><br></pre></td></tr></table></figure>

<p>演示基本使用</p>
<h6 id="案例改造"><a href="#案例改造" class="headerlink" title="案例改造"></a>案例改造</h6><p>使用AtomicInteger对案例进行改造</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">VolatileAtomicThread</span> <span class="symbol">implements</span> <span class="symbol">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="volatile原子性操作保障：加锁机制"><a href="#volatile原子性操作保障：加锁机制" class="headerlink" title="volatile原子性操作保障：加锁机制"></a>volatile原子性操作保障：加锁机制</h2><h2 id="volatile原子性操作保障：使用原子类"><a href="#volatile原子性操作保障：使用原子类" class="headerlink" title="volatile原子性操作保障：使用原子类"></a>volatile原子性操作保障：使用原子类</h2><h2 id="重排序的概述和好处"><a href="#重排序的概述和好处" class="headerlink" title="重排序的概述和好处"></a>重排序的概述和好处</h2><h3 id="概述-3"><a href="#概述-3" class="headerlink" title="概述"></a>概述</h3><p><strong>什么是重排序</strong>：为了提高性能，编译器和处理器常常会对既定的代码执行顺序进行指令重排序。</p>
<p>一个好的内存模型 实际上会 放松对处理器和编译器规则的束缚，<br>也就是说 软件技术和硬件技术都为同一个目标而进行奋斗：<br>  在不改变程序执行结果的前提下，尽可能提高执行效率。</p>
<p>JMM对底层尽量减少约束，使其能够发挥自身优势。<br>因此，在执行程序时，为了提高性能，编译器和处理器常常会对指令重排序，一般重排序可以分为如下三种：</p>
<ol>
<li><p>编译器优化的重排序，编译器在不改变单线程程序语义的前提下，可以重新安排语句的执行顺序；</p>
</li>
<li><p>指令集并行的重排序。现代处理器采用了指令集并行技术来将多条指令重叠执行。如果不存在数据依赖性，处理器可以改变语句对应机器指令的执行顺序。</p>
</li>
<li><p>内存系统的重排序，由于处理器使用缓存和读/写缓冲区，这使得加载和存储操作看上去可能是在乱序执行的。</p>
</li>
</ol>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>     --<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>      --<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>     --<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>     --<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span></span><br><span class="line"><span class="comment">|</span> <span class="comment">源代码</span> <span class="comment">|</span> --<span class="literal">-</span><span class="comment">→</span> <span class="comment">|</span> <span class="comment">1：编译器优化重排序</span> <span class="comment">|</span>  --<span class="literal">-</span><span class="comment">→</span> <span class="comment">|</span> <span class="comment">2：指令集并行重排序</span> <span class="comment">|</span> --<span class="literal">-</span><span class="comment">→</span> <span class="comment">|</span> <span class="comment">3：内存系统重排序</span> <span class="comment">|</span> --<span class="literal">-</span><span class="comment">→</span> <span class="comment">|</span> <span class="comment">最终执行的指令序列</span> <span class="comment">|</span></span><br><span class="line"><span class="comment"></span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>     --<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>      --<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>     --<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>     --<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span></span><br></pre></td></tr></table></figure>

<h3 id="重排序的好处"><a href="#重排序的好处" class="headerlink" title="重排序的好处"></a>重排序的好处</h3><p>重排序可以提高处理的速度</p>
<h2 id="重排序带来的问题演示"><a href="#重排序带来的问题演示" class="headerlink" title="重排序带来的问题演示"></a>重排序带来的问题演示</h2><h3 id="重排序案例演示"><a href="#重排序案例演示" class="headerlink" title="重排序案例演示"></a>重排序案例演示</h3><p><strong>引入</strong>：重排序虽然可以提高执行的效率，但是在并发执行下，JVM虚拟机底层并不能保证重排序下带来的安全性等问题，请看如下案例：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">OutOfOrderExecution</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> static <span class="built_in">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> static <span class="built_in">int</span> a = <span class="number">0</span>, b = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> static <span class="built_in">void</span> main(String[] args) throws InterruptedException&#123;</span><br><span class="line">    <span class="built_in">int</span> count = <span class="number">0</span>;<span class="comment">// 计数</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">      count++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="volatile禁止指令重排序"><a href="#volatile禁止指令重排序" class="headerlink" title="volatile禁止指令重排序"></a>volatile禁止指令重排序</h2><p>volatile修饰变量后可以实现禁止指令重排序！<br>volatile禁止重排序案例演示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OutOfOrderException</span></span>&#123;</span><br><span class="line">  <span class="comment">//使用volatile修饰变量</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> <span class="keyword">int</span>  i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> <span class="keyword">int</span>  a = <span class="number">0</span>, b = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;<span class="comment">// 计数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">      count++;</span><br><span class="line">      i = <span class="number">0</span>;</span><br><span class="line">      j = <span class="number">0</span>;</span><br><span class="line">      a = <span class="number">0</span>;</span><br><span class="line">      b = <span class="number">0</span>;</span><br><span class="line">      Thread one  = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">          a = <span class="number">1</span>;</span><br><span class="line">          i = b;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      Thread two =  <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="小结-4"><a href="#小结-4" class="headerlink" title="小结"></a>小结</h3><ul>
<li>使用volatile可以禁止指令重排序，从而修正重排序可能带来的并发安全问题。</li>
</ul>
<h2 id="happens-before的概述和常见规则"><a href="#happens-before的概述和常见规则" class="headerlink" title="happens-before的概述和常见规则"></a>happens-before的概述和常见规则</h2><p>第三章 volatile内存语义</p>
<h3 id="volatile写读建立的happens-before关系"><a href="#volatile写读建立的happens-before关系" class="headerlink" title="volatile写读建立的happens-before关系"></a>volatile写读建立的happens-before关系</h3><h4 id="概述-4"><a href="#概述-4" class="headerlink" title="概述"></a>概述</h4><p>上面的内容讲述了重排序原则，为了提高处理速度，JVM会对代码进行编译优化，也就是指令重排序优化，并发编程下指令重排序会带来一些安全隐患：<br>如指令重排序导致的多个线程操作之间的不可见性。<br>如果让程序员再去了解这些底层的实现以及具体规则，那么程序员的负担就太重了，严重影响了并发编程的效率。</p>
<p>从JDK5开始，提出了happens-before的概念，通过这个概念来阐述操作之间的内存可见性。<br>如果一个操作执行的结果需要对另一个操作可见，那么这两个操作之间必须存在happens-before关系。<br>这里提到的两个操作既可以是在一个线程之内，也可以是在不同线程之间。</p>
<p>所以为了解决多线程的可见性问题，就提出了happens-before原则，让线程之间遵守这些原则，优化我们的语句，所以等于是给编译器优化的约束，不能让它优化的不知道东南西北了！</p>
<p>简单来说: happens-before应该翻译成：前一个操作的结果可以被后续的操作获取，讲白点就是：前面一个操作变量a赋值为1，那后面一个操作肯定能知道a已经变成了1。</p>
<h4 id="happens-before规则"><a href="#happens-before规则" class="headerlink" title="happens-before规则"></a>happens-before规则</h4><p>具体的一共有六项规则：</p>
<ol>
<li>程序顺序规则（单线程规则）<ul>
<li>解释：一个线程中的每个操作，happens-before于该线程中的任意后续操作</li>
<li>同一个线程中前面的所有写操作对后面的操作可见</li>
</ul>
</li>
<li>锁规则（Synchronized，Lock等）<ul>
<li>解释：对一个锁的解锁，happens-before于随后对这个锁的加锁；</li>
<li>如果线程1解锁了monitor a，接着线程2锁定了a，那么线程1解锁a之前的写操作都对线程线程2可见（线程1和线程2可以是同一个线程）</li>
</ul>
</li>
<li>volatile变量规则：<ul>
<li>解释：对一个volatile域的写，happens-before于任意后序对这个volatile域的读</li>
<li>如果线程1写入了volatile变量v(临界资源)，接着线程2读取了v，那么，线程1写入v及对线程2可见（线程1和线程2可以是同一个线程）</li>
</ul>
</li>
<li>传递性:<ul>
<li>解释： 如果A happens-before B，且B happens-before C，那么A happens-before C。</li>
<li>A happens-before B， B happens-before C ，那么可以得到 A happens-before C</li>
</ul>
</li>
<li>start()规则：<ul>
<li>解释：如果线程A执行操作ThreadB.start()（启动线程B），那么A线程的ThreadB.start()操作happens-before于线程B中的任意操作。</li>
<li>假定线程A在执行过程中，通过执行ThreadB.start()来启动线程B，那么线程A对共享变量的修改在接下来线程B开始执行前对线程B可见。注意：线程B启动之后，线程A对变量修改线程B未必可见。</li>
</ul>
</li>
</ol>
<h2 id="volatile写读建立的happens-before规则演示"><a href="#volatile写读建立的happens-before规则演示" class="headerlink" title="volatile写读建立的happens-before规则演示"></a>volatile写读建立的happens-before规则演示</h2><h2 id="long和double的原子性问题解决方案"><a href="#long和double的原子性问题解决方案" class="headerlink" title="long和double的原子性问题解决方案"></a>long和double的原子性问题解决方案</h2><p>第四章 volatile高频面试与总结</p>
<h3 id="long和double的原子性"><a href="#long和double的原子性" class="headerlink" title="long和double的原子性"></a>long和double的原子性</h3><h4 id="概述-5"><a href="#概述-5" class="headerlink" title="概述"></a>概述</h4><p>在java中，long和double都是8个字节共64位（一个字节=8bit）<br>那么如果是一个32位的系统，读写long或double的变量时会涉及到原子性问题，<br>因为32位的系统要读完64位的变量，需要分两步执行，每次读取32位，这样对double和long变量的赋值就会出现问题：</p>
<p>如果两个线程同时写一个变量内存，一个进程写低32位，而另一个写高32位，这样将导致获取的64位数据是失效的数据。</p>
<h4 id="案例演示-1"><a href="#案例演示-1" class="headerlink" title="案例演示"></a>案例演示</h4><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LongTest</span> <span class="title">implements</span> <span class="title">Runnable</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> aLong = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">long</span> <span class="keyword">value</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">LongTest</span>(<span class="params"><span class="keyword">long</span> <span class="keyword">value</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.setValue(<span class="keyword">value</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>( i &lt; <span class="number">100000</span>)&#123;</span><br><span class="line">      LongTest along = <span class="keyword">this</span>.getValue();</span><br><span class="line">      i++;</span><br><span class="line">      <span class="keyword">long</span> temp = LongTest.aLong;</span><br><span class="line">      <span class="keyword">if</span>(temp != <span class="number">1L</span> &amp;&amp; temp != <span class="number">-1L</span>)&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"出现错误结果"</span>+ temp);</span><br><span class="line">        System.exit(<span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.<span class="keyword">out</span>.println(<span class="string">"运行正确"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>)throws InterruptedException</span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="单例、懒汉、饿汉单例的概念"><a href="#单例、懒汉、饿汉单例的概念" class="headerlink" title="单例、懒汉、饿汉单例的概念"></a>单例、懒汉、饿汉单例的概念</h2><p>volatile在双重检查加锁的单例中的应用</p>
<h3 id="单例模式有八种"><a href="#单例模式有八种" class="headerlink" title="单例模式有八种"></a>单例模式有八种</h3><p>单例模式可以提供出8中写法，有很多时候存在饿汉式单例的概念，以及懒汉式单例的概念。</p>
<p>饿汉式单例的含义是：在获取单例对象之前对象已经创建完成了。<br>懒汉式单例是指：在真正需要单例的时候才创建出该对象。</p>
<h2 id="饿汉式单例的2种写法"><a href="#饿汉式单例的2种写法" class="headerlink" title="饿汉式单例的2种写法"></a>饿汉式单例的2种写法</h2><h3 id="饿汉单例的两种写法"><a href="#饿汉单例的两种写法" class="headerlink" title="饿汉单例的两种写法"></a>饿汉单例的两种写法</h3><h4 id="饿汉式（静态常量）"><a href="#饿汉式（静态常量）" class="headerlink" title="饿汉式（静态常量）"></a>饿汉式（静态常量）</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 饿汉式（静态常量）</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton1</span>&#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Singleton1 INSTANCE = <span class="keyword">new</span> Singleton1();</span><br><span class="line">    <span class="keyword">private</span> Singleton1&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton1 <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="饿汉式（静态代码块）"><a href="#饿汉式（静态代码块）" class="headerlink" title="饿汉式（静态代码块）"></a>饿汉式（静态代码块）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="懒汉式单例的2种写法与线程安全分析"><a href="#懒汉式单例的2种写法与线程安全分析" class="headerlink" title="懒汉式单例的2种写法与线程安全分析"></a>懒汉式单例的2种写法与线程安全分析</h2><h3 id="懒汉式单例四种写法"><a href="#懒汉式单例四种写法" class="headerlink" title="懒汉式单例四种写法"></a>懒汉式单例四种写法</h3><h4 id="懒汉式（线程不安全）"><a href="#懒汉式（线程不安全）" class="headerlink" title="懒汉式（线程不安全）"></a>懒汉式（线程不安全）</h4><h4 id="懒汉式（线程安全）"><a href="#懒汉式（线程安全）" class="headerlink" title="懒汉式（线程安全）"></a>懒汉式（线程安全）</h4><h4 id="懒汉式（线程不安全）-1"><a href="#懒汉式（线程不安全）-1" class="headerlink" title="懒汉式（线程不安全）"></a>懒汉式（线程不安全）</h4><h4 id="懒汉式（volatile双重检查模式-推荐）"><a href="#懒汉式（volatile双重检查模式-推荐）" class="headerlink" title="懒汉式（volatile双重检查模式 推荐）"></a>懒汉式（volatile双重检查模式 推荐）</h4><h5 id="案例代码"><a href="#案例代码" class="headerlink" title="案例代码"></a>案例代码</h5><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 描述： 双重检查，推荐面试中进行使用。</span><br><span class="line"> */</span><br><span class="line"><span class="keyword"> public</span> class Singleton6&#123;</span><br><span class="line">   // 静态属性，volatile保证可见性和禁止指令重排序</span><br><span class="line">  <span class="keyword"> private</span> volatile<span class="keyword"> static</span> Singleton6<span class="built_in"> instance </span>= null;</span><br><span class="line"></span><br><span class="line">   // 私有化构造器</span><br><span class="line">  <span class="keyword"> private</span> Singleton6()&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword"> public</span><span class="keyword"> static</span> Singleton6 getInstance()&#123;</span><br><span class="line"></span><br><span class="line">     //第一重检查锁定</span><br><span class="line">     if(instance == null)&#123;</span><br><span class="line"></span><br><span class="line">       // 同步锁定代码块</span><br><span class="line">       synchronized(Singleton6.class)&#123;</span><br><span class="line"></span><br><span class="line">         //第二重检查锁定</span><br><span class="line">          if(instance == null)&#123;</span><br><span class="line"></span><br><span class="line">            //注意：非原子操作</span><br><span class="line">           <span class="built_in"> instance </span>=<span class="built_in"> new </span>Singleton6();</span><br><span class="line">          &#125;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="built_in"> return </span>instance;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h5 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h5><p>双重检查的优点：线程安全，延迟加载，效率较高！</p>
<p>为何要使用volatile保证安全？</p>
<p>1、禁止指令重排序</p>
<ul>
<li>对象实际上创建对象要经过如下几个步骤：</li>
</ul>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a. 看<span class="built_in">class</span>对象是否加载，如果没有就先加载<span class="built_in">class</span>对象</span><br><span class="line">b. 分配内存空间，初始化示例。</span><br><span class="line">c. 调用构造函数</span><br><span class="line">d. 返回地址给引用</span><br></pre></td></tr></table></figure>


<h4 id="静态内部类单例方式"><a href="#静态内部类单例方式" class="headerlink" title="静态内部类单例方式"></a>静态内部类单例方式</h4><h4 id="枚举实现单例"><a href="#枚举实现单例" class="headerlink" title="枚举实现单例"></a>枚举实现单例</h4><h2 id="懒汉式单例性能优化后的进阶写法"><a href="#懒汉式单例性能优化后的进阶写法" class="headerlink" title="懒汉式单例性能优化后的进阶写法"></a>懒汉式单例性能优化后的进阶写法</h2><h2 id="懒汉式双重检查模式与volatile修饰"><a href="#懒汉式双重检查模式与volatile修饰" class="headerlink" title="懒汉式双重检查模式与volatile修饰"></a>懒汉式双重检查模式与volatile修饰</h2><h2 id="懒汉式静态内部类单例方式"><a href="#懒汉式静态内部类单例方式" class="headerlink" title="懒汉式静态内部类单例方式"></a>懒汉式静态内部类单例方式</h2><h2 id="枚举实现单例思想介绍"><a href="#枚举实现单例思想介绍" class="headerlink" title="枚举实现单例思想介绍"></a>枚举实现单例思想介绍</h2><h2 id="volatile的使用场景之一：纯赋值操作"><a href="#volatile的使用场景之一：纯赋值操作" class="headerlink" title="volatile的使用场景之一：纯赋值操作"></a>volatile的使用场景之一：纯赋值操作</h2><p>volatile的使用场景</p>
<h3 id="纯赋值操作"><a href="#纯赋值操作" class="headerlink" title="纯赋值操作"></a>纯赋值操作</h3><h4 id="概述-6"><a href="#概述-6" class="headerlink" title="概述"></a>概述</h4><p>volatile不适合做a++。<br>适合做纯赋值操作：如<code>boolean flag = false/true;</code>。</p>
<h4 id="案例代码-1"><a href="#案例代码-1" class="headerlink" title="案例代码"></a>案例代码</h4><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UseVolatile1</span> <span class="title">implements</span> <span class="title">Runnable</span>&#123;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="literal">false</span>;</span><br><span class="line">  AtomicInteger realA = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span>throws InterruptedException</span>&#123;</span><br><span class="line">    UseVolatile1 r  = <span class="keyword">new</span> UseVolatile1();</span><br><span class="line">    Thread thread1 = <span class="keyword">new</span> Thread(r);</span><br><span class="line">    Thread thread2 = <span class="keyword">new</span> Thread(r);</span><br><span class="line">    thread1.start();</span><br><span class="line">    thread2.start();</span><br><span class="line">    thread1.join();</span><br><span class="line">    thread2.join();</span><br><span class="line">    System.out.<span class="built_in">println</span>(r.flag);</span><br><span class="line">    System.out.<span class="built_in">println</span>(r.realA.<span class="built_in">get</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++)&#123;</span><br><span class="line">      setDone();</span><br><span class="line">      realA.incrementAndGet();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setDone</span><span class="params">()</span></span>&#123;</span><br><span class="line">    flag = <span class="literal">true</span>; <span class="comment">// 纯赋值操作符合预期</span></span><br><span class="line">    <span class="comment">// flag = !flag; // 这样做不符合预期</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="小结-5"><a href="#小结-5" class="headerlink" title="小结"></a>小结</h4><p>volatile 可以适合做多线程中的纯赋值操作；<br>如果一个共享变量自始至终只被各个线程赋值，而没有其他的操作，<br>那么就可以用volatile来代替synchronized或者代替原子变量。<br>因为赋值自身是有原子性的，而volatile又保证了可见性，所以就足以保证线程安全。</p>
<h2 id="volatile的第二种使用场景：触发器"><a href="#volatile的第二种使用场景：触发器" class="headerlink" title="volatile的第二种使用场景：触发器"></a>volatile的第二种使用场景：触发器</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>按照volatile的可见性和禁止重排序以及happens-before规则。<br>volatile可以作为刷新之前变量的触发器。<br>可以将某个变量设置为volatile修饰，其他线程一旦发现该变量修改的值后，<br>触发获取到该变量之前的操作都将是最新的且可见。</p>
<h3 id="案例演示-2"><a href="#案例演示-2" class="headerlink" title="案例演示"></a>案例演示</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VisibilityHP</span>&#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> c = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">()</span></span>&#123;</span><br><span class="line">      a = <span class="number">3</span>;</span><br><span class="line">      b = <span class="number">4</span>;</span><br><span class="line">      c = a;</span><br><span class="line">      flag = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="comment">// flag被volatile修饰，充当了触发器，一旦值为true，此处立即对变量之前的操作可见。</span></span><br><span class="line">      <span class="keyword">while</span>(flag)&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"a = "</span>+ a + <span class="string">"; b = "</span>+ b + <span class="string">"; c = "</span>+ c);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">        VisibilityHP test = <span class="keyword">new</span> VisibilityHP();</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable()&#123;</span><br><span class="line">          <span class="keyword">try</span>&#123;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">          &#125;<span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="volatile与synchronized的区别说明"><a href="#volatile与synchronized的区别说明" class="headerlink" title="volatile与synchronized的区别说明"></a>volatile与synchronized的区别说明</h2><h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><ul>
<li>volatile只能修饰实例变量和类变量，而synchronized可以修饰方法以及代码块。</li>
<li>volatile保证数据的可见性，但是不保证原子性（多线程进行写操作，不保证线程安全）；而synchronized是一种排他（互斥）的机制。</li>
<li>volatile用于禁止指令重排序：可以解决单例双重检查乱序问题。</li>
<li>volatile可看作是轻量版的synchronized，volatile不保证原子性；但是如果对一个共享变量进行多个线程的赋值，而没有其他的操作，那么就可以用volatile来代替synchronized，因为赋值本身是有原子性的，而volatile又保证了一致性，所以就可以保证线程安全了；</li>
</ul>
<h2 id="volatile总体总结说明"><a href="#volatile总体总结说明" class="headerlink" title="volatile总体总结说明"></a>volatile总体总结说明</h2><h3 id="总体总结"><a href="#总体总结" class="headerlink" title="总体总结"></a>总体总结</h3><ol>
<li>volatile 修饰符 用于以下场景：某个属性被多个线程共享，其中有一个线程修改了此属性，其他线程可以立即得到修改后的值，比如<code>boolean flag;</code>或者作为触发器实现轻量级同步。</li>
<li>volatile属性的读写操作都是无锁的，它不能替代synchronized，因为它没有提供原子性和互斥性。因为无锁，不需要花费时间在获取锁和释放锁上，所以说它是低成本的。</li>
<li>volatile只能作用域属性，我们用volatile修饰属性，这样compilers就不会对这个属性做指令重排序。</li>
<li>volatile提供了可见性，任何一个线程对其的修改将立马对其他线程可见。volatile属性不会被线程缓存，始终从主内存中读取。</li>
<li>volatile提供了happens-before保证对volatile变量的写入，happens-before所有其他线程后续对V的操作。</li>
<li>volatile可以使得long和double的赋值时原子的。</li>
<li>volatile可以在单例双重检查中实现可见性和禁止指令重排序，从而保证安全性。</li>
</ol>

      
    </div>
    
    
    



<div>
    
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script>
  <script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css">

  <p><span>本文标题:</span>Java面试内容精讲—并发编程volatile📝</a></p>
  <p><span>文章作者:</span>✨🧙‍♀️✨</a></p>
  <p><span>发布时间:</span>2020年06月18日 - 04:20:50🌞</p>
  <p><span>最后更新:</span>2020年07月03日 - 21:37:25🌜</p>
  <p><span>原始链接:</span><a href="/2020/06/18/%E3%80%90%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA%E3%80%91/%E3%80%90%E9%94%81%E3%80%91Java%E9%9D%A2%E8%AF%95%E5%86%85%E5%AE%B9%E7%B2%BE%E8%AE%B2%E2%80%94%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8Bvolatile/" title="Java面试内容精讲—并发编程volatile">https://fengshana.github.io/2020/06/18/%E3%80%90%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA%E3%80%91/%E3%80%90%E9%94%81%E3%80%91Java%E9%9D%A2%E8%AF%95%E5%86%85%E5%AE%B9%E7%B2%BE%E8%AE%B2%E2%80%94%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8Bvolatile/</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://fengshana.github.io/2020/06/18/%E3%80%90%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA%E3%80%91/%E3%80%90%E9%94%81%E3%80%91Java%E9%9D%A2%E8%AF%95%E5%86%85%E5%AE%B9%E7%B2%BE%E8%AE%B2%E2%80%94%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8Bvolatile/"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。🎄	</p>  
</div>
<style>
</style>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    clipboard.on('success', $(function(){
      $(".fa-clipboard").click(function(){
        //swal({   
          //title: "",   
         // text: '<div style="width:300px;height:100px;font-size:14px;">道友，复制成功了哟(＾Ｕ＾)ノ~</div>',   
          //html: true,
          //timer: 500,   
        //showConfirmButton: false
        //});
      });
      new ClipboardJS('.fa-clipboard', {
          target: function(trigger) {
              $('<div>').appendTo('body').addClass('alert alert-success').html('🤠道友ᕦ(･ㅂ･)ᕤ，🥭复制成功了哟(^_−)☆').show().delay(1500).fadeOut();
              return trigger.nextElementSibling;
            }
      });
    }));  
</script>


    
</div>



    








<div>
  
    <div>
    
        <br/>
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------🍓🍇本文结束🤞感谢道友的阅读🍍🍒-------------</div>
    
</div>
  
</div>












    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>🥕🍆坚持原创技术分享🐳，🌽🥬您的支持将鼓励我继续创作！🐬</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatreward.png" alt="✨🧙‍♀️✨ 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipayreward.png" alt="✨🧙‍♀️✨ 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    










    <footer class="post-footer">
      
        <div class="post-tags" style="text-align:center">
          
            <a href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">🌟面试</i></a>
          
            <a href="/tags/%E9%94%81/" rel="tag">🌟锁</i></a>
          
            <a href="/tags/volatile/" rel="tag">🌟volatile</i></a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/06/16/%E3%80%90Gradle%E3%80%91/Gradle%E5%85%A5%E9%97%A8/" rel="next" title="Gradle入门">
                👈 Gradle入门
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/06/19/%E3%80%90RabbitMQ%E3%80%91/MQ%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6RabbitMQ%20%E5%85%A5%E9%97%A8%E5%88%B0%E8%BF%9B%E9%98%B6/" rel="prev" title="MQ消息中间件RabbitMQ 入门到进阶+(牧码人/老王/)+(架构师系列)">
                MQ消息中间件RabbitMQ 入门到进阶+(牧码人/老王/)+(架构师系列) 👉
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80ODk3My8yNTQ2Nw=="></div>
    </div>

  
  
  

  
  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/fsn.jpg"
                alt="✨🧙‍♀️✨" />
            
              <p class="site-author-name" itemprop="name">✨🧙‍♀️✨</p>
              <p class="site-description motion-element" itemprop="description">🌈勿忘初心💫 🌞，🌜方得始终⭐</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <!--<a href="/archives/%7C%7Carchive">-->
                <a href="/archives/">
              
                  <span class="site-state-item-count">155</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">84</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/fengshana" target="_blank" title="GitHub">
                      
                        <i 
                          
                          class="fa fa-fw fa-github">
                           
                        </i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://space.bilibili.com/475144966" target="_blank" title="Bilibili">
                      
                        <i 
                          
                            class="">💜
                           
                        </i>Bilibili</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://user.qzone.qq.com/2915324940" target="_blank" title="QQ">
                      
                        <i 
                          
                            class="">🧡
                           
                        </i>QQ</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://user.qzone.qq.com/198866436" target="_blank" title="QQ2">
                      
                        <i 
                          
                            class="">💙
                           
                        </i>QQ2</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://gracg.com/user/user15472vJMQiV" target="_blank" title="Gracg">
                      
                        <i 
                          
                            class="">💚
                           
                        </i>Gracg</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://gongzifengyue.gitee.io/fengshana.io" target="_blank" title="Gitee">
                      
                        <i 
                          
                            class="">💛
                           
                        </i>Gitee</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title" style="color:white;">
                <i class="fa  fa-fw fa-link"></i>
                友情链接💦
              </div>
			  
			  
			  
			  
			  
			  
			  
			  
                

				  <span class="links-of-blogroll-item">
                    <a href="http://ruiyeclub.cn" title="chenrui" target="_blank">chenrui</a>
					 </span>
                

                
				
				
			  
			  
			  
			  
			  
			  
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#课程总体说明"><span class="nav-number">2.</span> <span class="nav-text">课程总体说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多线程下变量的不可见性现象"><span class="nav-number">3.</span> <span class="nav-text">多线程下变量的不可见性现象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#概述"><span class="nav-number">3.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#案例演示"><span class="nav-number">3.2.</span> <span class="nav-text">案例演示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行结果"><span class="nav-number">3.3.</span> <span class="nav-text">执行结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结"><span class="nav-number">3.4.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多线程下变量不可见性内存语义"><span class="nav-number">4.</span> <span class="nav-text">多线程下变量不可见性内存语义</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#概述-1"><span class="nav-number">4.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#问题分析"><span class="nav-number">4.2.</span> <span class="nav-text">问题分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结-1"><span class="nav-number">4.3.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多线程下变量不可见性解决方案-加锁，volatile修饰"><span class="nav-number">5.</span> <span class="nav-text">多线程下变量不可见性解决方案-加锁，volatile修饰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#概述-2"><span class="nav-number">5.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解决方案"><span class="nav-number">5.2.</span> <span class="nav-text">解决方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结-2"><span class="nav-number">5.3.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#volatile不保证原子性"><span class="nav-number">6.</span> <span class="nav-text">volatile不保证原子性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#volatile特性概述"><span class="nav-number">6.1.</span> <span class="nav-text">volatile特性概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#volatile不保证原子性2"><span class="nav-number">6.2.</span> <span class="nav-text">volatile不保证原子性2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#问题案例演示"><span class="nav-number">6.2.1.</span> <span class="nav-text">问题案例演示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#问题原理说明"><span class="nav-number">6.2.2.</span> <span class="nav-text">问题原理说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#volatile原子性测试"><span class="nav-number">6.2.3.</span> <span class="nav-text">volatile原子性测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#小结-3"><span class="nav-number">6.2.4.</span> <span class="nav-text">小结</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#问题解决"><span class="nav-number">6.2.5.</span> <span class="nav-text">问题解决</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#使用锁机制"><span class="nav-number">6.2.5.1.</span> <span class="nav-text">使用锁机制</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#原子类"><span class="nav-number">6.2.5.2.</span> <span class="nav-text">原子类</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#AtomicInteger"><span class="nav-number">6.2.5.2.1.</span> <span class="nav-text">AtomicInteger</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#案例改造"><span class="nav-number">6.2.5.2.2.</span> <span class="nav-text">案例改造</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#volatile原子性操作保障：加锁机制"><span class="nav-number">7.</span> <span class="nav-text">volatile原子性操作保障：加锁机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#volatile原子性操作保障：使用原子类"><span class="nav-number">8.</span> <span class="nav-text">volatile原子性操作保障：使用原子类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重排序的概述和好处"><span class="nav-number">9.</span> <span class="nav-text">重排序的概述和好处</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#概述-3"><span class="nav-number">9.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重排序的好处"><span class="nav-number">9.2.</span> <span class="nav-text">重排序的好处</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重排序带来的问题演示"><span class="nav-number">10.</span> <span class="nav-text">重排序带来的问题演示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#重排序案例演示"><span class="nav-number">10.1.</span> <span class="nav-text">重排序案例演示</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#volatile禁止指令重排序"><span class="nav-number">11.</span> <span class="nav-text">volatile禁止指令重排序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#小结-4"><span class="nav-number">11.1.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#happens-before的概述和常见规则"><span class="nav-number">12.</span> <span class="nav-text">happens-before的概述和常见规则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#volatile写读建立的happens-before关系"><span class="nav-number">12.1.</span> <span class="nav-text">volatile写读建立的happens-before关系</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#概述-4"><span class="nav-number">12.1.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#happens-before规则"><span class="nav-number">12.1.2.</span> <span class="nav-text">happens-before规则</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#volatile写读建立的happens-before规则演示"><span class="nav-number">13.</span> <span class="nav-text">volatile写读建立的happens-before规则演示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#long和double的原子性问题解决方案"><span class="nav-number">14.</span> <span class="nav-text">long和double的原子性问题解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#long和double的原子性"><span class="nav-number">14.1.</span> <span class="nav-text">long和double的原子性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#概述-5"><span class="nav-number">14.1.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#案例演示-1"><span class="nav-number">14.1.2.</span> <span class="nav-text">案例演示</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#单例、懒汉、饿汉单例的概念"><span class="nav-number">15.</span> <span class="nav-text">单例、懒汉、饿汉单例的概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#单例模式有八种"><span class="nav-number">15.1.</span> <span class="nav-text">单例模式有八种</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#饿汉式单例的2种写法"><span class="nav-number">16.</span> <span class="nav-text">饿汉式单例的2种写法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#饿汉单例的两种写法"><span class="nav-number">16.1.</span> <span class="nav-text">饿汉单例的两种写法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#饿汉式（静态常量）"><span class="nav-number">16.1.1.</span> <span class="nav-text">饿汉式（静态常量）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#饿汉式（静态代码块）"><span class="nav-number">16.1.2.</span> <span class="nav-text">饿汉式（静态代码块）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#懒汉式单例的2种写法与线程安全分析"><span class="nav-number">17.</span> <span class="nav-text">懒汉式单例的2种写法与线程安全分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#懒汉式单例四种写法"><span class="nav-number">17.1.</span> <span class="nav-text">懒汉式单例四种写法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#懒汉式（线程不安全）"><span class="nav-number">17.1.1.</span> <span class="nav-text">懒汉式（线程不安全）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#懒汉式（线程安全）"><span class="nav-number">17.1.2.</span> <span class="nav-text">懒汉式（线程安全）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#懒汉式（线程不安全）-1"><span class="nav-number">17.1.3.</span> <span class="nav-text">懒汉式（线程不安全）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#懒汉式（volatile双重检查模式-推荐）"><span class="nav-number">17.1.4.</span> <span class="nav-text">懒汉式（volatile双重检查模式 推荐）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#案例代码"><span class="nav-number">17.1.4.1.</span> <span class="nav-text">案例代码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#分析"><span class="nav-number">17.1.4.2.</span> <span class="nav-text">分析</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#静态内部类单例方式"><span class="nav-number">17.1.5.</span> <span class="nav-text">静态内部类单例方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#枚举实现单例"><span class="nav-number">17.1.6.</span> <span class="nav-text">枚举实现单例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#懒汉式单例性能优化后的进阶写法"><span class="nav-number">18.</span> <span class="nav-text">懒汉式单例性能优化后的进阶写法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#懒汉式双重检查模式与volatile修饰"><span class="nav-number">19.</span> <span class="nav-text">懒汉式双重检查模式与volatile修饰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#懒汉式静态内部类单例方式"><span class="nav-number">20.</span> <span class="nav-text">懒汉式静态内部类单例方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#枚举实现单例思想介绍"><span class="nav-number">21.</span> <span class="nav-text">枚举实现单例思想介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#volatile的使用场景之一：纯赋值操作"><span class="nav-number">22.</span> <span class="nav-text">volatile的使用场景之一：纯赋值操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#纯赋值操作"><span class="nav-number">22.1.</span> <span class="nav-text">纯赋值操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#概述-6"><span class="nav-number">22.1.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#案例代码-1"><span class="nav-number">22.1.2.</span> <span class="nav-text">案例代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#小结-5"><span class="nav-number">22.1.3.</span> <span class="nav-text">小结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#volatile的第二种使用场景：触发器"><span class="nav-number">23.</span> <span class="nav-text">volatile的第二种使用场景：触发器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#概念"><span class="nav-number">23.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#案例演示-2"><span class="nav-number">23.2.</span> <span class="nav-text">案例演示</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#volatile与synchronized的区别说明"><span class="nav-number">24.</span> <span class="nav-text">volatile与synchronized的区别说明</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#区别"><span class="nav-number">24.1.</span> <span class="nav-text">区别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#volatile总体总结说明"><span class="nav-number">25.</span> <span class="nav-text">volatile总体总结说明</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#总体总结"><span class="nav-number">25.1.</span> <span class="nav-text">总体总结</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      


      


    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">🌱2019 🍄 🌳

<span itemprop="copyrightYear">2020</span>
  <span class="with-love">
  <!--user-->
    🍉
  </span>
 
 <span class="author" itemprop="copyrightHolder">Fsn✨🧙‍♀️✨</span>

  





  <script async src="http://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
 
     🏃‍♂️ 
    <span class="post-meta-item-icon">
      📈
    </span>
    
      <span class="post-meta-item-text">小屋💒总字数：</span>
    
	<span title="Site words total count">
     606.2k🌟 </span>
    <!--<span title="symbols_count_time.count_total">1.2m</span>-->
  
</div>



  <!-- <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>-->






<!--



 -->
 






        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazyload@2.0.0-beta.2/lazyload.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  













  





  

  

  

  
  

  

  

  
  <script type="text/javascript" src="/js/src/exturl.js?v=5.1.4"></script>


  
  
  
  <!-- 
  
  -->
  <link rel="stylesheet" href="/dist/APlayer.min.css">
<div id="aplayer"></div>
<script type="text/javascript" src="/dist/APlayer.min.js"></script>
<script type="text/javascript" src="/dist/music.js"></script>

  <!-- 代码块复制功能    <script src="dist/clipboard.min.js"></script>-->
  <script type="text/javascript" src="/js/src/clipboard.min.js"></script>
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
  


</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>

<!--崩溃欺骗 <script type="text/javascript" src="/js/src/crash_cheat.js"></script> -->





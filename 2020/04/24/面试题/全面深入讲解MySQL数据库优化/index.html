<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<script>
	(function(){
		if(''){
			if (prompt('请输入文章密码','') !== ''){
				alert('密码错误！');
				history.back();
			}
		}
	})();
</script>









<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #A0A0A0; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #A0A0A0, 0 0 5px     #A0A0A0; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #A0A0A0;    /*上边框颜色*/
        border-left-color: #A0A0A0;    /*左边框颜色*/
    }
</style>

<meta name="theme-color" content="#222">










<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
    
  
  <link href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/fsn-16x16.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/fsn-32x32.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/fsn-16x16.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/fsn-16x16.ico?v=5.1.4" color="#222">





  <meta name="keywords" content="笔记,MySQL,数据库优化," />





  <link rel="alternate" href="/atom.xml" title="Fsn" type="application/atom+xml" />






<meta name="description" content="前言观看笔记：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1fJ41127Rj?from&#x3D;search&amp;seid&#x3D;13531213796559959972   本课程作为MySQL高级课程，主要讲解了：    MySQL中的视图&#x2F;存储过程&#x2F;触发器&#x2F;索引等对象的使用 常见的SQL语句优化的技巧 应用优化 数据库优化 数据库日志  等方面的知识，并通过综合案例，对课程中的">
<meta property="og:type" content="article">
<meta property="og:title" content="全面深入讲解MySQL数据库优化">
<meta property="og:url" content="https://fengshana.github.io/2020/04/24/%E9%9D%A2%E8%AF%95%E9%A2%98/%E5%85%A8%E9%9D%A2%E6%B7%B1%E5%85%A5%E8%AE%B2%E8%A7%A3MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/index.html">
<meta property="og:site_name" content="Fsn">
<meta property="og:description" content="前言观看笔记：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1fJ41127Rj?from&#x3D;search&amp;seid&#x3D;13531213796559959972   本课程作为MySQL高级课程，主要讲解了：    MySQL中的视图&#x2F;存储过程&#x2F;触发器&#x2F;索引等对象的使用 常见的SQL语句优化的技巧 应用优化 数据库优化 数据库日志  等方面的知识，并通过综合案例，对课程中的">
<meta property="og:image" content="http://r.photo.store.qq.com/psb?/V11rBmNJ1CgWNF/GXpIx6xVrrx71*TqsSAOVAhVsm4z2Sy6OQ6FnfnoV80!/r/dLYAAAAAAAAA">
<meta property="article:published_time" content="2020-04-24T02:40:04.420Z">
<meta property="article:modified_time" content="2020-04-28T03:15:55.023Z">
<meta property="article:author" content="Fsn">
<meta property="article:tag" content="笔记">
<meta property="article:tag" content="MySQL">
<meta property="article:tag" content="数据库优化">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://r.photo.store.qq.com/psb?/V11rBmNJ1CgWNF/GXpIx6xVrrx71*TqsSAOVAhVsm4z2Sy6OQ6FnfnoV80!/r/dLYAAAAAAAAA">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://fengshana.github.io/2020/04/24/面试题/全面深入讲解MySQL数据库优化/"/>









  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "07d52b28"
    });
  daovoice('update');
  </script>

  <title>全面深入讲解MySQL数据库优化 | Fsn</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2a839053bb6194637483460a0f428730";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.js"></script>
<script src="https://unpkg.com/minigrid@3.1.1/dist/minigrid.min.js"></script>
<link rel="stylesheet" href="/photos/photos.css">
<script type="text/javascript" src="/photos/photo.js"></script>


<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Fsn</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-相册">
          <a href="/photos/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-camera"></i> <br />
            
            相册
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>







 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fengshana.github.io/2020/04/24/%E9%9D%A2%E8%AF%95%E9%A2%98/%E5%85%A8%E9%9D%A2%E6%B7%B1%E5%85%A5%E8%AE%B2%E8%A7%A3MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fsn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/fsn.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fsn">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">全面深入讲解MySQL数据库优化</h1>
        

        <div class="post-meta">
		

          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-24T10:40:04+08:00">
                2020-04-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index">
                    <span itemprop="name">笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  16.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  63
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="http://r.photo.store.qq.com/psb?/V11rBmNJ1CgWNF/GXpIx6xVrrx71*TqsSAOVAhVsm4z2Sy6OQ6FnfnoV80!/r/dLYAAAAAAAAA" rel="gallery_ck9jcaj1000deg0um163d3thl"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="http://r.photo.store.qq.com/psb?/V11rBmNJ1CgWNF/GXpIx6xVrrx71*TqsSAOVAhVsm4z2Sy6OQ6FnfnoV80!/r/dLYAAAAAAAAA" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>观看笔记：<a href="https://www.bilibili.com/video/BV1fJ41127Rj?from=search&amp;seid=13531213796559959972" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1fJ41127Rj?from=search&amp;seid=13531213796559959972</a>  </p>
<p>本课程作为MySQL高级课程，主要讲解了：  </p>
<ul>
<li>MySQL中的视图/存储过程/触发器/索引等对象的使用</li>
<li>常见的SQL语句优化的技巧</li>
<li>应用优化</li>
<li>数据库优化</li>
<li>数据库日志</li>
</ul>
<p>等方面的知识，并通过综合案例，对课程中的知识进行一个整合应用。  </p>
<p>本课程旨在通过MySQl高级部分内容，可以在满足现有业务需求基础上，对MySQL底层的体系结构，及底层的优化有一个深入的理解，对系统的整体性能进行提升。  </p>
<h2 id="课程内容介绍"><a href="#课程内容介绍" class="headerlink" title="课程内容介绍"></a>课程内容介绍</h2><blockquote>
<p>Mysql高级-day01</p>
</blockquote>
<p>MySQL高级课程简介</p>
<ol>
<li>Linux系统安装MySQL</li>
<li>索引</li>
<li>视图</li>
<li>存储过程和函数</li>
<li>触发器</li>
</ol>
<h3 id="MySQL高级课程简介"><a href="#MySQL高级课程简介" class="headerlink" title="MySQL高级课程简介"></a>MySQL高级课程简介</h3><table>
    <tr>
      <th>序号</th>
      <th>Day01</th>
      <th>Day02</th>
      <th>Day03</th>
      <th>Day04</th>
    </tr>
    <tr>
      <td>1</td>
      <td>Linux系统安装MySQL</td>
      <td>体系结构</td>
      <td>应用优化</td>
      <td>MySQL常用工具</td>
    </tr>
    <tr>
      <td>2</td>
      <td>索引</td>
      <td>存储引擎</td>
      <td>查询缓存优化</td>
      <td>MySQL日志</td>
    </tr>
    <tr>
      <td>3</td>
      <td>视图</td>
      <td>优化SQL步骤</td>
      <td>内存管理及优化</td>
      <td>MySQl主从复制</td>
    </tr>
    <tr>
      <td>4</td>
      <td>存储过程和函数</td>
      <td>索引使用</td>
      <td>MySQL锁问题</td>
      <td>综合案例</td>
    </tr>
    <tr>
      <td>5</td>
      <td>触发器</td>
      <td>SQL优化</td>
      <td>常用SQL技巧</td>
      <td></td>
    </tr>
</table>

<h2 id="Linux上安装MySQL"><a href="#Linux上安装MySQL" class="headerlink" title="Linux上安装MySQL"></a>Linux上安装MySQL</h2><h3 id="下载Linux安装包"><a href="#下载Linux安装包" class="headerlink" title="下载Linux安装包"></a>下载Linux安装包</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span>/<span class="regexp">/dev.mysql.com/downloads</span><span class="regexp">/mysql/</span><span class="number">5.7</span>.html<span class="comment">#downloads</span></span><br></pre></td></tr></table></figure>

<h3 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h3><ol>
<li>卸载centos中预安装的mysql</li>
</ol>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep -i mysql # 查询服务器当中mysql的安装包是否存在，存在则显示出存在安装包的名称</span><br><span class="line"></span><br><span class="line">rpm -e mysql-libs<span class="number">-5.1</span><span class="number">.71</span><span class="number">-1.e16</span>.x86_64 --nodeps # 对已存在的安装包(mysql-libs<span class="number">-5.1</span><span class="number">.71</span><span class="number">-1.e16</span>.x86_64)进行卸载</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>上传mysql的安装包</li>
</ol>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alt + p -------&gt;put E:/tset/MySQL<span class="number">-5.6</span><span class="number">.22</span><span class="number">-1.e16</span>.i686.rpm-bundle.tar（MySQL安装包的目录）</span><br><span class="line"></span><br><span class="line"># 使用SecureCRT远程连接服务器工具，alt+p命令进入sftp模式；再执行put （MySQL安装包的目录）[ 上传 ]</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>解压mysql的安装包</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir mysql</span><br><span class="line"></span><br><span class="line">tar -xvf MySQL-<span class="number">5.6</span>.<span class="number">22</span>-<span class="number">1</span><span class="selector-class">.e16</span><span class="selector-class">.i686</span><span class="selector-class">.rpm-bundle</span><span class="selector-class">.tar</span> -c /root/mysql</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>安装依赖包</li>
</ol>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 安装第三方的依赖库；yum -y 在线安装需连接网络</span><br><span class="line">yum -y install libaio.so<span class="number">.1</span> libgc_s.so<span class="number">.1</span> libstdc++.so<span class="number">.6</span> libncurses.so<span class="number">.5</span> --setopt=protected_multilib=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line">yum update listdc++<span class="number">-4.4</span><span class="number">.7</span><span class="number">-4.e16</span>.x86_64 # 更新第三方类包</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>安装mysql-client</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">rpm</span> <span class="selector-tag">-ivh</span> <span class="selector-tag">MySQL-client-5</span><span class="selector-class">.6</span><span class="selector-class">.22-1</span><span class="selector-class">.e16</span><span class="selector-class">.i686</span><span class="selector-class">.rpm</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>安装mysql-server</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">rpm</span> <span class="selector-tag">-ivh</span> <span class="selector-tag">MySQL-server-5</span><span class="selector-class">.6</span><span class="selector-class">.22-1</span><span class="selector-class">.e16</span><span class="selector-class">.i686</span><span class="selector-class">.rpm</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Linux</p>
</blockquote>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ipconfig</span> <span class="comment"># 查看本机ip地址，内网地址</span></span><br></pre></td></tr></table></figure>

<h2 id="启动及登录MySQL"><a href="#启动及登录MySQL" class="headerlink" title="启动及登录MySQL"></a>启动及登录MySQL</h2><blockquote>
<p>启动mysql命令</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service mysql status # 查看mysql服务状态</span><br><span class="line">service mysql start # 启动mysql服务</span><br><span class="line">service mysql stop # 停止mysql服务</span><br></pre></td></tr></table></figure>

<blockquote>
<p>登录mysql</p>
</blockquote>
<p>mysql 安装完成之后，会自动生成一个随机密码，并且保存在一个密码文件中：/root/.mysql_secret；  </p>
<blockquote>
<p>查看随机密码</p>
</blockquote>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="regexp">/root/</span>.mysql_secret</span><br></pre></td></tr></table></figure>

<blockquote>
<p>登录命令</p>
</blockquote>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line"><span class="meta"># -u 指的是用户</span></span><br><span class="line"><span class="meta"># -p 指的是该用户所对应的密码</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>登录之后，修改密码命令</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">password</span> = <span class="keyword">password</span>(<span class="string">'itcast'</span>);</span><br><span class="line"><span class="comment"># itcast即明文密码</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>授权远程访问</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> <span class="string">'root'</span>@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'itcast'</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>防火墙</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service iptables status # 查看防火墙状态</span><br><span class="line">service iptables stop # 关闭防火墙</span><br></pre></td></tr></table></figure>

<h2 id="索引-概述"><a href="#索引-概述" class="headerlink" title="索引 - 概述"></a>索引 - 概述</h2><p>MySQL官方对索引的定义为：  </p>
<p>索引（index）是帮助MySQL高效获取数据的数据结构（有序）。<br>在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。<br>如下面的示意图所示：  </p>
<p>左边是数据库，一共有两列七条记录，最左边的是数据记录的物理地址（注意逻辑上相邻的记录在磁盘上也不是一定物理相邻的）。  </p>
<p>为了加快Col2的查找，可以维护右边所示的二叉查找树，每个结点分别包含索引键值和一个指向对应数据记录物理地址的指针，这样就可以运用二叉查找快速后去到相应数据。  </p>
<p>一般来说索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式存储在磁盘上，索引是数据库中用来提供性能的最常用的工具。  </p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mspaint</span> <span class="comment"># windows打开画板</span></span><br></pre></td></tr></table></figure>

<table>
  <tr>
    <td>物理地址</td>
    <td>Col1</td>
    <td>Col2</td>
  </tr>
  <tr>
    <td>0x07</td>
    <td>1</td>
    <td>34</td>
  </tr>
  <tr>
    <td>0x56</td>
    <td>2</td>
    <td>77</td>
  </tr>
  <tr>
    <td>0x6A</td>
    <td>3</td>
    <td>5</td>
  </tr>
  <tr>
    <td>0xF3</td>
    <td>4</td>
    <td>91</td>
  </tr>
  <tr>
    <td>0x90</td>
    <td>5</td>
    <td>22</td>
  </tr>
  <tr>
    <td>0x77</td>
    <td>6</td>
    <td>59</td>
  </tr>
  <tr>
    <td>0xD1</td>
    <td>7</td>
    <td>3</td>
  </tr>
</table>

<p>当前该为一张数据库表；在数据库表的左侧展示的是每一条记录的一个物理地址；右侧则是两列；一列字段Col1是序号；Col2字段数据可以认为就是主键数据；数据库表结构有了，接下来查询数据；  </p>
<p>（1）第一种情况：查询主键Col2为34的数据；因为这个时候只存在表，没有设置索引这些方便查询的数据结构；所以这个时候就会在表当中自上而下的进行遍历；这个时候就会去遍历到第一个，发现第一个的主键id，Col2的值就是34；此时即拿到数据；这样的话只需要查询一条记录；而且查询第一条记录就是，那么这样的话查询速度是很快的；这只是第一种情况；  </p>
<p>（2）第二种情况：查询主键Col2 id为91的记录行数据；那么还是需要自上而下从id为34的记录行数据开始遍历；那么第一条记录不是；第二条记录不是；第三条记录也不是；直到第四条记录的时候发现数据行id是91；那么这个时候也就是需要去遍历列表4次，查询4次才能够得到结果；  </p>
<p>（3）第三种情况：查询主键Col2 id为3的记录行数据；这个时候再来看，如果说遍历查询的元素id是3；那么这个时候依然是从上往下进行遍历，一直遍历到列表的最底部；才能将3查找出来；那么这个时候就相当于需要进行一个全表扫描的这样一个操作；对于当前该表当中只有6、7条数据；但是如果在实际开发当中数据量比较大；一张表当中存储了几百万上千万的记录；那么这个时候如果只有表中的记录，而没有索引的话；这个时候就会造成一种现象，在查找的时候从上往下进行整表扫描，所以这种查询效率是非常慢的；  </p>
<p>以上就是第一种情况，即没有建立索引的情况；查询效率很慢；  </p>
<p>下面分析有了索引之后，又是如何进行查找的；<br>此时有了表结构还需要对表结构当中的字段进行建立索引；索引就是一种数据结构；那么此时就可以使用数据结构来表示这种表当中的索引；这里使用一种数据结构二叉树；  </p>
<p>既然是二叉树；那么二叉树当中的第一个结点，也就是34；即根节点；34即作为当前该树状结构的根结点；<br>接下来第二行记录是77；对于二叉树来说，二叉树有一个特点；即当根结点已经存在的时候，再插入下一个结点；则需要将下一个结点的数值与根结点的数值进行比较大小；如果比根结点小则放在左边，称之为生成一个左子树；如果比根结点大则放在右边，称之为生成一个右子树，作为右子树存在；这个时候77是比34要大的，所以放在34的右边，即77为34根结点的一个子节点；<br>接下来第三行是5，需要对5也要进行插入到二叉树该数据结构当中，那么此时也是需要进行与34根结点进行比较的；此时5比34要小；那么则放在根结点34的左边，所以此时34根结点又有一个子节点5；<br>当5插入到二叉树结构当中之后，接着下一行记录91；则首先将91与34根结点进行比较大小；显然91比34要大，则处于根结点34的右边；当前使用的是二叉树的这种数据结构，也就意味着每一个结点最多都只能有2个分支；所以称之为二叉树；所以当此时34根结点已经有了两个分支之后，那么此时91比34大，但是34的右边已经有元素77了，所以这个时候91就需要去和77去进行比较；77与91进行比较，91显然要大，所以放在77的右侧，作为77的一个右子节点存在；<br>接下来是第5行记录数据集22；22比34小，显然要放在根结点的左侧；但是根结点的左侧已经有左子节点也就是5；那么此时22就去与5进行比较，显然22比5大；也就放在5的右边；称为5的右子结点；<br>最后还剩下最后两条记录，一个是59一个是3；快速过一下；59首先和34这个元素进行比较；显然59比34大需要放在34的右侧；然34已经有右子结点77了，那么这个时候59和77进行比较；显然77大于59，那么这个时候就将59放置在77的左侧，叶子结点91的左边，成为77的左子节点；同理最后一个元素，3也是同样的方式；3与34进行比较；显然3比34要小；然此时34是存在有左子节点5的；那么这个时候就将3与5进行比较；显然3比5要小；那么这个时候；就把3放在5的左侧；成为5的左子节点，叶子结点22的左侧；<br>此时到此为止二叉树已经构建完毕；二叉树构建完毕之后再来进行分析；构建了一棵二叉树之后就能够提高查询效率吗？<br>（我认为；在二叉树一定的深度下，二叉树依然会存在查询效率慢的情况；）<br>二叉树构建好了之后，再来进行搜索；如果按照刚才的查询情况；先进行搜索34这一数值；搜索二叉树；那么就需要到索引的结构二叉树的数据结构当中来进行搜索；在进行二叉树搜索的时候，是从根结点处开始进行查询匹配数值；即树状结构当中最顶层的这一节点即为根结点；最底层的结点，即3、22、59、91这四个结点称之为叶子结点；那么二叉树的搜索是从根节点开始进行搜索的；走根结点34；这个时候就已经将34查询到了，那么这个时候就可以直接进行返回即可；但是如果这一块当中查询的并不是34而是3；那么此时仍然先会去搜索根结点34，将要查询搜索的值3去与根节点34进行比较；发现3比根结点要小；所以此时就会去根结点的左侧，即左子树当中去进行查找3；二叉树当中根结点的左边的称之为左子树；右边则称之为右子树；那么在左子树当中通过3去跟根结点的左子节点5进行比较，那么此时5比3要大；所以紧接着，让3去跟结点5的左子节点3去进行比较；所以在这个时候就找到了3这个元素；<br>而找到了3之后，二叉树的这种数据结构是如何关联到表当中具体行数当中的具体数据的呢？<br>这个时候就需要看笔记当中提到的一句话：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</span><br></pre></td></tr></table></figure>

<p>那也就意味着，二叉树这种数据结构当中的每一个结点都是需要指向具体表当中具体行数的具体数据；<br>那么从刚才的查询规律当中从上而下进行查找3，则从根结点34到左子节点5，再从5到5的左子节点3查找到了3这一元素的指向/引用即可找到在具体某表当中的具体某一行的数据；那么这样的话就查找到了数据；  </p>
<table>
  <tr>
    <td>物理地址</td>
    <td>Col1</td>
    <td>Col2</td>
  </tr>
  <tr>
    <td>0x07</td>
    <td>1</td>
    <td>34</td>
  </tr>
  <tr>
    <td>0x56</td>
    <td>2</td>
    <td>77</td>
  </tr>
  <tr>
    <td>0x6A</td>
    <td>3</td>
    <td>5</td>
  </tr>
  <tr>
    <td>0xF3</td>
    <td>4</td>
    <td>91</td>
  </tr>
  <tr>
    <td>0x90</td>
    <td>5</td>
    <td>22</td>
  </tr>
  <tr>
    <td>0x77</td>
    <td>6</td>
    <td>59</td>
  </tr>
  <tr>
    <td>0xD1</td>
    <td>7</td>
    <td>3</td>
  </tr>
</table>

<blockquote>
<p>分析：没有建立索引的表与建立了索引的表当中，建立了索引之后性能的一个提升；</p>
</blockquote>
<ul>
<li><p>没有建立索引的表：在没有建立索引的情况下，如果是要进行查询数据元素3；那么则需要把整张表当中所有的数据都需要进行遍历一遍即全表扫描，直到找到3这个id数据；  </p>
</li>
<li><p>建立了索引的表：如果是在建立了索引的这种情况之下；那么同样还是查找元素3；只需要查找第一次34；第二次5；第三次3即可；三次即可；那么这样的话这个时候通过索引由二叉树这种数据结构实现的话就不再需要去遍历整张表的数据了；通过二叉树这种数据结构就可以快速的定位到3这个查询的数据元素；那么这就是索引；索引的目的即在于快速的来查找数据；  </p>
</li>
</ul>
<h2 id="索引-优势和劣势"><a href="#索引-优势和劣势" class="headerlink" title="索引 - 优势和劣势"></a>索引 - 优势和劣势</h2><blockquote>
<p>优势<br>1） 类似于书籍的目录索引，提高数据检索的效率，降低数据库的IO成本；<br>2） 通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗；  </p>
</blockquote>
<blockquote>
<p>劣势<br>1）实际上索引也是一张表，该表中保存了主键与索引字段，并指向实体类的记录，索引列也是要占用空间的；（并不放在内存当中而是放在磁盘当中，索引占用磁盘空间）<br>2）虽然索引大大提高了查询效率，同时却也降低了更新表的速度，如对表进行INSERT、UPDATE、DELETE（都需要对索引进行维护，也就是相关实现该索引的数据结构当中存储的数据也要进行变动）。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件每次更新添加了索引列的字段，都会因为更新所带来的的键值变化后的索引信息。（所以索引的字段并不是越多越好也会影响到性能）  </p>
</blockquote>
<h2 id="索引-索引结构"><a href="#索引-索引结构" class="headerlink" title="索引 - 索引结构"></a>索引 - 索引结构</h2><p>索引是在MySQL的存储引擎层中实现的，而不是在服务器层实现的。  </p>
<p>所以每种存储引擎的索引都不一定完全相同；也不是所有的存储引擎都支持所有的索引类型。  </p>
<p>MySQL目前提供了以下4中索引：  </p>
<ul>
<li>BTREE索引：最常见的索引类型，大部分索引都支持B树索引；</li>
<li>HASH索引：只有Memory引擎支持，使用场景简单（刚刚看了下我当前MySQL数据库现在InnoDB也支持HASH哦）；</li>
<li>R-tree索引（空间索引）：空间索引是MyISAM引擎的一个特殊索引类型，主要用于地理空间数据类型，通常使用较少，不做特别介绍；</li>
<li>Full-text（全文索引）：全文索引也是MyISAM的一个特殊索引类型，主要用于全文索引，InnoDB从MySQL5.6版本开始支持全文索引；  </li>
</ul>
<p>这个统计应该也有些时候了；不是一定正确的哦；需要结合当前不同版本的MySQL来说明；我还是贴一下吧；  </p>
<h3 id="MyISAM、InnoDB、Memory三种存储引擎对各种索引类型的支持"><a href="#MyISAM、InnoDB、Memory三种存储引擎对各种索引类型的支持" class="headerlink" title="MyISAM、InnoDB、Memory三种存储引擎对各种索引类型的支持"></a>MyISAM、InnoDB、Memory三种存储引擎对各种索引类型的支持</h3><table>
  <tr>
    <th>索引</th>
    <th>InnoDB引擎</th>
    <th>MyISAM引擎</th>
    <th>Memory引擎</th>
  </tr>
  <tr>
    <td>BTREE索引</td>
    <td>支持</td>
    <td>支持</td>
    <td>支持</td>
  </tr>
  <tr>
    <td>HASH索引</td>
    <td>不支持</td>
    <td>不支持</td>
    <td>支持</td>
  </tr>
  <tr>
    <td>R-tree索引</td>
    <td>不支持</td>
    <td>支持</td>
    <td>不支持</td>
  </tr>
  <tr>
    <td>Full-text索引</td>
    <td>5.6版本之后支持</td>
    <td>支持</td>
    <td>不支持</td>
  </tr>
</table>

<p>平常所说的索引，如果没有特别指明，都是指B+树（多路搜索树，并不一定是二叉的）结构组织的索引。<br>其中聚集索引、复合索引、前缀索引、唯一索引默认都是使用B+tree树索引，统称为索引。  </p>
<h2 id="索引-索引结构-BTREE"><a href="#索引-索引结构-BTREE" class="headerlink" title="索引 - 索引结构 - BTREE"></a>索引 - 索引结构 - BTREE</h2><p>BTree又叫做多路平衡搜索树，一棵 m 叉的 BTree 特性如下：  </p>
<ul>
<li>树中每个结点最多包含 m 个孩子；</li>
<li>除根结点与叶子结点外，每个结点至少有[ cell ( m / 2 ) ]（cell向上取整）个孩子；</li>
<li>若根结点不是叶子结点，则至少有两个孩子；</li>
<li>所有的叶子结点都在同一层；</li>
<li>每个非叶子结点由 n 个 key 与 n + 1 个指针组成，其中[ cell ( m / 2 ) -1 ] &lt; = n &lt; =  m - 1</li>
</ul>
<p>（对于二叉树来说，树中的每个结点最多有2个分支）  </p>
<p>以5叉BTree为例（当前根结点下最多有5个分支，即每个结点下最多包含5个孩子），key的数量：公式推导[ cell ( m / 2 ) - 1 ] &lt; = n &lt; = m-1 ；所以 2 &lt; = n &lt; = 4。<br>当n&gt;4时，中间节点分裂到父节点，两边结点分裂。<br>插入 C N G A H E K Q M F W L T Z D P R X Y S 数据为例；<br>1）插入前4个字母C N G A；  </p>
<table border="1">
  <tr>
    <td>A</td>
    <td>C</td>
    <td>G</td>
    <td>N</td>
  </tr>
</table>

<p>（按照26个字母排队顺序，字母A在C前，C排在G前，G排在N前的顺序进行排列）  </p>
<p>2）插入H ，n &gt; 4，中间元素G字母向上分裂到新的结点；  </p>
<table border="1">
  <tr>
    <td>A</td>
    <td>C</td>
    <td>G</td>
    <td>H</td>
    <td>N</td>
  </tr>
</table>

<p>所以演变成中间元素G字母向上分裂到新的结点，即G分裂到父节点；</p>
<table border="1">
<tr>
     <td colspan="5" style="text-align:center">G</td>
  </tr>
  <tr>
    <td>A</td>
    <td>C</td>
    <td></td>
    <td>H</td>
    <td>N</td>
  </tr>
</table>

<br>

<table border="1">
  <tr>
     <td></td>
    <td></td>
      <td></td>
     <td colspan="2" style="text-align:center;background-color:lightblue;color:black;">G</td>
     <td></td>
     <td></td>
    <td></td>
  </tr>
  <tr>
     <td></td>
    <td></td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
     <td></td>
    <td></td>
  </tr>
  <tr>
    <td colspan="8"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C</td>
    <td></td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span> N</td>
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>新插入的H结点会在元素G之后，那么排序也就是 A C G H N 这个样子的一个排序；那么此时的中间的结点就是G元素了；那么按照规则，当n&gt;4时，中间节点分裂到父节点；此时的G元素结点就将会进行一次分裂；分裂至父节点（H插入至BTree则G分裂至父节点）；而此时两边结点进行一次分裂；也就是原本的中间元素中间节点G左边的A、C以及右边的（新插入的）H、N就将会被分裂成父节点G的两边结点；左边的A、C分裂至父节点G的左子节点；右边的H、N分裂至父节点G的右子结点；  </p>
<p>接下来继续进行插入操作；插入元素E；<br>插入的E首先进行跟根结点G进行比较前后顺序；比较完成之后，E应该是在根结点G的排位在前的；所以应该被放在根结点G的左侧；也就是结点A、C该侧，A、C、E这三个元素也是需要进行排出一个顺序来的，那么也就是A、C、E这样的一个顺序排列放置；插入的是左边；由于左边元素未构成5个，所以不做任何的（分裂）变化等；  </p>
<p>接下来再继续插入元素K；<br>在K插入元素的时候就需要拿G与K元素的前后排位顺序进行比较，K的排位顺序比G大，所以插入到根结点G的右侧，也就是H、N所在该侧；插入的是右边，即插入时也需要与H、N这两个元素相进行比较排位顺序，也就是K元素插入到H、N这两个元素的中间；那么此时右侧的元素未构成5个所以不作任何变化；  </p>
<p>接下来继续插入Q；<br>插入Q也是需要与根节点G相进行比较排位顺序的；得出Q是在G之后，那么就将Q放在G根节点的右侧，然后将Q进行与节点元素H、K、N相进行比较；得到排列顺序H、K、N、Q这样一个排列顺序，当然此时仍然不需要做出（分裂）变化；因为此时n并没有超过4；只有当n超过4的时候才会发生分裂的变化；分叉小于等于4的情况下并不做任何的分裂改变只进行结点元素间的大小排位；  </p>
<p>在此之前一直在说分裂；当前已经分裂过一次；也就是A、C、G、H、N的时候进行将G分裂至父节点；A、C结点与H、N结点进行两边结点的分裂；并且插入了三个新的元素E、K、Q；  </p>
<p>此时需要说明的是：  </p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">每个非叶子结点由 n 个 <span class="type">key</span> 与 n + <span class="number">1</span> 个指针组成，其中[ cell( m / <span class="number">2</span>) <span class="number">-1</span> ] &lt; = n &lt; = m<span class="number">-1</span></span><br></pre></td></tr></table></figure>

<p>n+1个指针值的就是每个结点下都有两个方块，这两个方块都是指针存储区域；<br>指针的含义：当进行插入一个元素的时候，比如说插入元素E；当插入E元素的时候会进行与根节点G进行一个前后顺序排位的一个对比；如果E比G要小；那么E元素就需要放在G的左侧，指向左侧；成为根结点当中的左子节点当中的一个；那么这个时候就由G结点的左指针指向左子节点的方向；通过左边的这个指针指向左边的这个数据块；小于G那么这个指针就指向的是小于G的这个数据块（也就是左侧的左子结点）；大于G那么指向的就是大于G的这个数据块（也就是右侧的右子结点）；  </p>
<p>即</p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="2" style="text-align:center;background-color:lightblue;color:black;">G</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
  </tr>
  <tr>
    <td colspan="11"></td>
  </tr>
  <tr>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C<span style="margin-left:5px;margin-right:5px;"></span> E</td>
    <td></td>
    <td></td>
    <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> N <span style="margin-left:5px;margin-right:5px;"></span> Q</td>
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>接下来继续插入M元素；M与G根结点相进行比较，应该是属于在G的后面的；所以应该排放在G的右侧；通过G的右指针指向右边的数据块；M插入进来之后，应该要介于K和N之间；也就是说此时G的右子结点当中的排列顺序为H、K、M、N、Q这样一个排列顺序；这个时候就需要将M插入到K和N之间；但是当M插入到K和N之间之后，此时右子结点当中的元素已经超过了4个，即5个了；超过4个元素那么此时就要发生分裂变化，M结点刚好是中间节点；即会要发生中间节点（新插入的元素）M结点元素最终需要向上分裂到G父节点当中去，以及同时左右两边的元素H、K以及H、Q需要分裂变化成两块；  </p>
<p>问题：明白没有？小朋友？<br>答：明白了！(ಥ_ಥ)  </p>
<p>经过分裂之后再来看其指针；那么根结点当中的三个指针分别指的是；第一个指针指的是小于根节点当中的G元素则指针指向左侧第一个数据元素块A、C、E；第二个指针，则因为根节点当中存在两个元素；所以中间这个第二个指针用于大于根节点当中的G元素而小于根节点当中的M元素则指向中间的H、K的这个数据块；最后根节点当中的第三个指针用于大于根节点当中M元素的指向第三个数据元素块即N、Q；  </p>
<p>问题：明白？小朋友？<br>答：明白了！o(ﾟДﾟ)っ！  </p>
<p>当前为插入M的数据结构；  </p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">G<span style="margin-left:5px;margin-right:5px;"></span> M</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="14"></td>
  </tr>
  <tr>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C<span style="margin-left:5px;margin-right:5px;"></span> E</td>
    <td></td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    N <span style="margin-left:5px;margin-right:5px;"></span> Q</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>当前M插入完成之后，继续插入F、W、L、T这四个数据元素；<br>那么此时插入F、W、L、T这四个数据元素时是不需要进行分裂变化的；因为当这四个元素插入进来之后，各个数据块当中的key 结点都没有超过4；所以是不需要进行分裂变化处理的；  </p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">G<span style="margin-left:5px;margin-right:5px;"></span> M</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="18"></td>
  </tr>
  <tr>
    <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C<span style="margin-left:5px;margin-right:5px;"></span> E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    N <span style="margin-left:5px;margin-right:5px;"></span> Q<span style="margin-left:5px;margin-right:5px;"></span> T<span style="margin-left:5px;margin-right:5px;"></span> W</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>上述F、W、L、T这四个元素插入完成之后，接着插入元素Z；<br>插入Z的时候，首先会进行与根节点的G和M相进行比较；Z元素比G、M都要大；所以就由根结点的第三个指针指向第三个数据块，也就是N、Q、T、W；走向第三个数据块时又会与第三个数据块当中的元素相进行比较得到其元素排列顺序N、Q、T、W、Z这样一个排列摆放位置；所以此时将Z插入第三个数据块当中的最后一个位置，当Z元素出现在W元素之后的时候，此时观察第三个数据库块当中的元素个数已经超过了4，即已经成为5个了，那么此时这5个元素当中中间元素需要进行向上分裂，分裂至父节点，然后其左右两边需要分裂成两个数据块；该第三个数据块当中的中间元素为T；T元素此时应当符合条件需要分裂至上一节点父节点当中去；以及T元素在分裂至父节点之前原来两边的结点需要进行分裂成两块也就是N、Q结点以及W、Z结点这两大块进行分裂开来称为单独的结点；</p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">G<span style="margin-left:5px;margin-right:5px;"></span> M<span style="margin-left:5px;margin-right:5px;"></span> T</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="20"></td>
  </tr>
  <tr>
    <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C<span style="margin-left:5px;margin-right:5px;"></span> E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    N <span style="margin-left:5px;margin-right:5px;"></span> Q<span style="margin-left:5px;margin-right:5px;"></span> 
    </td>
    <td></td>
<td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>当元素Z插入完成之后，接下来进行插入元素D；<br>元素D和根结点当中的G、M、T相比，显然是都小于这三者的；所以由根结点当中的第一个指针进行指向第一个数据块，也就是A、C、E、F这个数据块当中来；并且D元素需要进行与数据块元素当中的A、C、E、F这四个元素需要进行比较排序顺序大小；即通过排序顺序可得A、C、D、E、F；插入进来之后，此时该数据块当中的key元素大于4个了，即出现了5个；那么此时就需要将该数据块元素当中的那个中间元素（D作为该数据块当中的中间元素存在），也就是刚刚新插入的元素D进行向上分裂至父节点G、M、T当中去，且分裂至父节点的元素D也需要与G、M、T进行一个排序，排序得到D、G、M、T这样一个排列顺序；那么此时分裂至父节点的元素D的两边的元素同样也需要进行分裂成两个结点；即A、C与E、F进行分裂开来；<br>最终出现的数据结构：  </p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">D<span style="margin-left:5px;margin-right:5px;"></span> G<span style="margin-left:5px;margin-right:5px;"></span> M<span style="margin-left:5px;margin-right:5px;"></span> T</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="22"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C
    </td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    N <span style="margin-left:5px;margin-right:5px;"></span> Q<span style="margin-left:5px;margin-right:5px;"></span> 
    </td>
    <td></td>
<td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>当元素D插入完成之后，接着进行插入元素P、R、X、Y；<br>插入P、R、X、Y时并不需要进行相应的变化分裂；因为插入到数据块当中元素key并没有满足 &gt; 4 的这样一个条件；所以并不需要做出分裂；  </p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">D<span style="margin-left:5px;margin-right:5px;"></span> G<span style="margin-left:5px;margin-right:5px;"></span> M<span style="margin-left:5px;margin-right:5px;"></span> T</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="26"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C
    </td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    N<span style="margin-left:5px;margin-right:5px;"></span> P<span style="margin-left:5px;margin-right:5px;"></span> Q<span style="margin-left:5px;margin-right:5px;"></span> R</td>
    <td></td>
<td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> X<span style="margin-left:5px;margin-right:5px;"></span> Y<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>当插入元素P、R、X、Y这四个元素之后，接下来进行插入最后一个元素S；<br>S首先和根结点当中的是个元素D、G、M、T进行比较；显然介于M与T之间；即大于M而小于T这样一个范围；从而使得根结点的第四个指针指向第四个数据块，即N、P、Q、R这一个数据块当中；而当S插入到第四个数据块当中首先也是需要进行比较排序顺序大小的；有顺序可得；得到顺序为N、P、Q、R、S这样一个顺序排列；将S插入到该数据块当中来；此时第四个数据块当中的元素个数已经达到了5个，也就是超过了4个就需要进行分裂了；那么此时；该数据块当中的中间元素为Q；也就是Q元素需要进行向上分裂至父节点D、G、M、T该数据块当中去；以及Q元素两边的元素需要进行分裂，也就是N、P与R、S这两块分裂开来；<br>但是Q如果此时向上进行分裂，而此时父节点当中的元素对向上分裂来的Q元素进行排序得到D、G、M、Q、T；父节点插入元素Q；父节点当中的元素也达到了了5个；也需要进行分裂；其父节点当中的中间元素为M元素，则此时M元素继续向上进行分裂，则M更新称为该BTree的根节点；而M两边的元素，即D、G两元素与Q、T两元素则这两块进行分裂开来，D、G块称为根结点M的左子节点，Q、T块称为M根结点的右子结点；这就是所提到的五叉BTree结构的一个演变过程；</p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="2" style="text-align:center;background-color:lightblue;color:black;">M</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">D<span style="margin-left:5px;margin-right:5px;"></span>  G
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    Q <span style="margin-left:5px;margin-right:5px;"></span> T</td>
    
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C
    </td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    N<span style="margin-left:5px;margin-right:5px;"></span> P</td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">R<span style="margin-left:5px;margin-right:5px;"></span> S</td>
    <td></td>
<td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> X<span style="margin-left:5px;margin-right:5px;"></span> Y<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>了解了五叉BTree数据结构的一个演变过程之后回过头来再看；一棵m叉的BTree特性；<br>如果是一个五叉的BTree；<br>则：  </p>
<ul>
<li>树中每个结点最多包含m个孩子；即树中每个结点最多包含5个孩子；不能多于5个，即不能多于m个；  </li>
</ul>
<blockquote>
<p>举例</p>
</blockquote>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">D<span style="margin-left:5px;margin-right:5px;"></span> G<span style="margin-left:5px;margin-right:5px;"></span> M<span style="margin-left:5px;margin-right:5px;"></span> T</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="26"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C
    </td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    N<span style="margin-left:5px;margin-right:5px;"></span> P<span style="margin-left:5px;margin-right:5px;"></span> Q<span style="margin-left:5px;margin-right:5px;"></span> R</td>
    <td></td>
<td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> X<span style="margin-left:5px;margin-right:5px;"></span> Y<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>


<ul>
<li>除根结点与叶子结点外，每个结点至少有 [ cell( m / 2 )]个孩子；即每个结点至少有5/2=3（向上取整）个孩子；M为根节点；AC块、EF块、HKL块、NP块、RS块、WXYZ块为叶子结点；所以仅剩DG块与QT块非叶子结点也非根节点；这两块分别有三个字节点，DG块的孩子即AC块、EF块、HKL块；QT块的孩子即NP块、RS块、WXYZ块；  </li>
</ul>
<blockquote>
<p>举例</p>
</blockquote>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="2" style="text-align:center;background-color:lightblue;color:black;">M</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">D<span style="margin-left:5px;margin-right:5px;"></span>  G
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    Q <span style="margin-left:5px;margin-right:5px;"></span> T</td>
    
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C
    </td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    N<span style="margin-left:5px;margin-right:5px;"></span> P</td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">R<span style="margin-left:5px;margin-right:5px;"></span> S</td>
    <td></td>
<td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> X<span style="margin-left:5px;margin-right:5px;"></span> Y<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>


<ul>
<li>若根结点不是叶子结点，则至少有两个孩子；</li>
</ul>
<blockquote>
<p>举例</p>
</blockquote>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="2" style="text-align:center;background-color:lightblue;color:black;">M</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">D<span style="margin-left:5px;margin-right:5px;"></span>  G
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    Q <span style="margin-left:5px;margin-right:5px;"></span> T</td>
    
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C
    </td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    N<span style="margin-left:5px;margin-right:5px;"></span> P</td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">R<span style="margin-left:5px;margin-right:5px;"></span> S</td>
    <td></td>
<td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> X<span style="margin-left:5px;margin-right:5px;"></span> Y<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<ul>
<li>所有的叶子结点都在同一层；</li>
</ul>
<blockquote>
<p>举例</p>
</blockquote>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="2" style="text-align:center;background-color:lightblue;color:black;">M</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">D<span style="margin-left:5px;margin-right:5px;"></span>  G
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    Q <span style="margin-left:5px;margin-right:5px;"></span> T</td>
    
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C
    </td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    N<span style="margin-left:5px;margin-right:5px;"></span> P</td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">R<span style="margin-left:5px;margin-right:5px;"></span> S</td>
    <td></td>
<td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> X<span style="margin-left:5px;margin-right:5px;"></span> Y<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>


<ul>
<li>每个非叶子结点由n个key与n+1个指针组成；其中[ cell( m / 2)-1] &lt; = n &lt; = m - 1；即</li>
</ul>
<p>key即指的每一个结点当中的元素；指针即用来指向数据块</p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">G<span style="margin-left:5px;margin-right:5px;"></span> M</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="18"></td>
  </tr>
  <tr>
    <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C<span style="margin-left:5px;margin-right:5px;"></span> E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    N <span style="margin-left:5px;margin-right:5px;"></span> Q<span style="margin-left:5px;margin-right:5px;"></span> T<span style="margin-left:5px;margin-right:5px;"></span> W</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>到此已经提到了两种数据结构，一种是二叉树；一种是BTree；这两个数据结构可以拿过来相互比较一下优劣；  </p>
<p>BTree数据结构相对于二叉树相比；存在有多个分支；而二叉树一个结点仅仅只存在有两个结点；那么对于相同数据量来说，二叉树的数据层次，也就是二叉树的深度要更高一些；一旦层次更深也就意味着查找数据的时候；磁盘的IO的次数也就更多；从而导致查询的效率也就比较低；<br>到此，该BTree树就已经构建完成了，BTREE树和二叉树相比，查询数据的效率更高，因为对于相同的数据量来说，BTREE的层次结构相比二叉树小，因此搜索速度更快；  </p>
<h2 id="索引-索引结构-B-TREE"><a href="#索引-索引结构-B-TREE" class="headerlink" title="索引 - 索引结构 - B+TREE"></a>索引 - 索引结构 - B+TREE</h2><p>B+Tree为BTree的变种，B+Tree与BTree的区别为：<br>1） n叉B+Tree最多含有n个key，而BTree最多含有n-1个key；<br>2） B+Tree的叶子结点保存所有的key信息，依照key大小顺序排列；<br>3） 所有的非叶子结点都可以看做是key的索引部分；  </p>
<p>没有子节点的结点称之为叶子结点；叶子结点当中包含了所有key的信息；叶子结点当中的key才是完整的包含了所有的key的信息；包含了所有的数据信息；根结点当中以及非叶子结点当中的key起到的是一个索引的作用；索引就是为了查找到叶子结点当中的key；而且对于B+树来说所有的数据都是存储在叶子结点上面了；非叶子结点是不存在数据信息的；B树当中的所有数据是跟结点挂钩的；B+树当中所有的key存储在叶子结点所有的数据也都存储在叶子结点上了；<br>这也是B+树与B树的一个区别；  </p>
<p>B+Tree相对于BTree的一个优势：<br>由于B+Tree只有叶子结点保存key信息，查询任何key都要从root走到叶子（非叶子结点上的key都是起到一个索引的作用并没有数据，叶子结点上的key才关联着相关的数据信息），所以B+Tree的查询效率更加稳定；  </p>
<h2 id="索引-索引结构-MySQL中的B-Tree"><a href="#索引-索引结构-MySQL中的B-Tree" class="headerlink" title="索引 - 索引结构 - MySQL中的B+Tree"></a>索引 - 索引结构 - MySQL中的B+Tree</h2><p>MySQL索引数据结构对经典的B+Tree进行了优化。<br>在原B+Tree的基础上，增加一个指向相邻叶子结点的链表指针，就形成了带有顺序指针的B+Tree，提高区间访问的性能；<br>问题：为什么要增加这样一个指针？<br>答：方便进行查询；  </p>
<blockquote>
<p>增加该指针的原因在于：方便进行范围搜索；  </p>
</blockquote>
<p>举例：如果想要进行搜索id为9~15的数据；由于有该指针相连所以从9一直查询链表下一结点到15即可；<br>所以该链表指针的作用主要是用来提高区间访问的性能；  </p>
<h2 id="索引-索引分类"><a href="#索引-索引分类" class="headerlink" title="索引 - 索引分类"></a>索引 - 索引分类</h2><p>1） 单值索引：即一个索引值包含单个列，一个表可以有多个单列索引(一个索引当中只包含一个列；比如现在需要对某一张表当中建立索引；该表当中有多个字段name、gender、age、help_category_id等字段，但是只针对name该字段该列进行建立索引；help_category_id也可以建立个索引；则当前存在两个索引，但是每个索引只对应了相对应的一列；这个叫做单列索引或者是单值索引；一个表当中可以包含有多个单列索引)<br>2） 唯一索引：索引列的值必须唯一，但允许有空值；（当前表当中某一个字段或者是某一列当中其值都是唯一的；也就是说如果存在有列当中的值都是唯一的；那么必要情况下就可以针对该列建立一个唯一索引，在唯一索引的该列当中允许包括有多个NULL值；）<br>3） 复合索引：即一个索引包含多个列（比如：经常在查询当中需要对name字段以及parent_category_id或者是说age字段进行联合查询，那么此时可以将name字段以及age字段组合起来建立一个复合索引，即一个索引当中包含了两个列或者说多个列；那么这种索引称之为复合索引）；  </p>
<h2 id="索引-索引语法"><a href="#索引-索引语法" class="headerlink" title="索引 - 索引语法"></a>索引 - 索引语法</h2><p>索引在创建表的时候，可以同时创建，也可以随时增加新的索引；<br>准备环境：  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> demo_01 <span class="keyword">default</span> charset=utf8mb4;</span><br><span class="line"></span><br><span class="line">use demo_01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">'city'</span>(</span><br><span class="line">    <span class="string">'city_id'</span> <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT;</span><br><span class="line">    <span class="string">'city_name'</span> <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line">    <span class="string">'country_id'</span> <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (<span class="string">'city_id'</span>)</span><br><span class="line">)ENGINE=InnoDB <span class="keyword">DEFAULT</span> CHARSET=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">'country'</span>(</span><br><span class="line">    <span class="string">'country_id'</span> <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT;</span><br><span class="line">    <span class="string">'country_name'</span> <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (<span class="string">'country_id'</span>)</span><br><span class="line">)ENGINE=InnoDB <span class="keyword">DEFAULT</span> CHARSET=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'city'</span>(<span class="string">'city_id'</span>,<span class="string">'city_name'</span>,<span class="string">'country_id'</span>) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">'西安'</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'city'</span>(<span class="string">'city_id'</span>,<span class="string">'city_name'</span>,<span class="string">'country_id'</span>) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">'NewYork'</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'city'</span>(<span class="string">'city_id'</span>,<span class="string">'city_name'</span>,<span class="string">'country_id'</span>) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">'北京'</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'city'</span>(<span class="string">'city_id'</span>,<span class="string">'city_name'</span>,<span class="string">'country_id'</span>) <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">'上海'</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'country'</span>(<span class="string">'country_id'</span>,<span class="string">'country_name'</span>) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">'China'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'country'</span>(<span class="string">'country_id'</span>,<span class="string">'country_name'</span>) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">'America'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'country'</span>(<span class="string">'country_id'</span>,<span class="string">'country_name'</span>) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">'Japan'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'country'</span>(<span class="string">'country_id'</span>,<span class="string">'country_name'</span>) <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">'UK'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><p>语法：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [ <span class="keyword">UNIQUE</span> | <span class="keyword">FULL</span> <span class="built_in">TEXT</span> |SPATIAL] <span class="keyword">INDEX</span> index_name</span><br><span class="line">[ <span class="keyword">using</span> index_type ]</span><br><span class="line"><span class="keyword">ON</span> tb1_name(index_col_name, .... )</span><br><span class="line"></span><br><span class="line">index_col_name : column_name[ ( <span class="keyword">length</span> ) ] [ <span class="keyword">ASC</span> | <span class="keyword">DESC</span> ]</span><br></pre></td></tr></table></figure>

<p>索引的类型：UNIQUE唯一索引、FULLTEXT全文索引、SPATIAL；索引类型可选；可以不进行指定；<br>index_name：索引的名称；<br>using index_type：索引所使用的哪一个类型；如果不指定；则使用，默认的索引类型即B+树索引类型；<br>ON tb1_name(index_col_name, ….)：进行指定对哪一张表的哪几个字段创建索引；  </p>
<p>在MySQL当中，如果当前该字段是主键的话；则默认该字段默认有一个索引叫做主键索引；  </p>
<p>所以此时在city表当中对city_id字段的索引不必再进行创建；可以在city_name字段上创建索引；  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> index_city_name <span class="keyword">on</span> city(city_name);<span class="comment">#此时在city_name字段上创建的该索引为普通索引；</span></span><br></pre></td></tr></table></figure>

<p>示例：为city表中的city_name 字段创建索引：  </p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> idx_city_name <span class="keyword">on</span> city(city_name);</span><br></pre></td></tr></table></figure>

<h3 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h3><p>语法：  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> <span class="built_in">table_name</span>; #<span class="built_in">table_name</span>，索引所建立在该字段，该字段所处的表的名称</span><br></pre></td></tr></table></figure>

<p>示例：查看city表中的索引信息：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> city\G; <span class="comment">#\G格式化</span></span><br></pre></td></tr></table></figure>

<p>在MySQL当中会默认对主键city_id字段创建一个索引就称作是主键索引key_name：primary；<br>而刚刚对city_name创建的索引则为key_name：idx_city_name；<br>主键索引primary以及刚刚没有指定索引类型的idx_city_name的索引类型都是BTREE类型；即B+Tree索引，BTree索引；</p>
<h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><p>语法：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> tb1_name;</span><br><span class="line"><span class="comment"># index_name索引的名称</span></span><br><span class="line"><span class="comment"># 该index_name索引所具体在的表的名称</span></span><br></pre></td></tr></table></figure>

<p>示例：想要删除city表上的索引[ idx_city_name ]，可以操作如下：  </p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">index</span> idx_city_name <span class="keyword">on</span> city;</span><br></pre></td></tr></table></figure>

<p>删除之后可以通过以下命令来进行查看删除的索引是否仍然存在；</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> <span class="built_in">table_name</span>\G;</span><br></pre></td></tr></table></figure>

<h3 id="ALTER指令"><a href="#ALTER指令" class="headerlink" title="ALTER指令"></a>ALTER指令</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># alter 修改</span></span><br><span class="line"><span class="comment"># 该语句添加一个主键，这意味着索引值必须唯一，且不能为NULL；</span></span><br><span class="line">1. <span class="keyword">alter</span> <span class="keyword">table</span> tb_name <span class="keyword">add</span> primary <span class="keyword">key</span>(column_list);</span><br><span class="line"></span><br><span class="line"><span class="comment"># unique 唯一的</span></span><br><span class="line"><span class="comment"># 这条语句创建索引的值必须是唯一的（除了NULL意外，NULL可能会出现多次）</span></span><br><span class="line"><span class="comment"># Non_unique:0 #Non不，unique唯一；0：否定；双重否定等于肯定；即唯一</span></span><br><span class="line"><span class="comment"># 当创建普通索引时其Non_unique:1；即不唯一；  </span></span><br><span class="line">2. <span class="keyword">alter</span> <span class="keyword">table</span> tb_name <span class="keyword">add</span> <span class="keyword">unique</span> index_name(column_list);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加普通索引，索引值可以出现多次</span></span><br><span class="line">3. <span class="keyword">alter</span> <span class="keyword">table</span> tb_name <span class="keyword">add</span> <span class="keyword">index</span> index_name(column_list);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 该语句指定了索引为FULLTEXT，用于全文索引</span></span><br><span class="line">4. <span class="keyword">alter</span> <span class="keyword">table</span> tb_name <span class="keyword">add</span> fulltext index_name(column_list);</span><br></pre></td></tr></table></figure>

<p>示例：添加唯一索引  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> city <span class="keyword">add</span>  <span class="keyword">unique</span>  idx_city_name(city_name);</span><br></pre></td></tr></table></figure>

<h2 id="索引-索引设计原则"><a href="#索引-索引设计原则" class="headerlink" title="索引 - 索引设计原则"></a>索引 - 索引设计原则</h2><p>索引的设计可以遵循一些已有的原则，创建索引的时候请尽量考虑符合这些原则，便于提升索引的使用效率，更高效的使用索引；  </p>
<ul>
<li>对查询频次较高，且数据量比较大的表建立索引；</li>
<li>索引字段的选择，最佳候选列应当从where子句的条件中提取（即查询条件当中的字段），如果where子句中的组合比较多，那么应当挑选最常用、过滤效果最好的列的组合。</li>
<li>使用唯一索引，区分度越高，使用索引的效率越高；</li>
<li>索引可以有效的提升查询数据的效率，但是索引数量不是多多益善；索引越多，维护索引的代价自然也就水涨船高。对于插入、更新、删除等DML操作比较频繁的表来说，索引过多，会引入相当高的维护代价（维护索引的数据结构），降低DML操作的效率，增加响应操作的时间消耗；另外索引过多的话，MySQL也会犯选择困难病，虽然最终仍然会找到一个可用的索引，但是无疑提高了选择的代价；</li>
<li>使用短索引，索引创建之后也是使用硬盘来存储的，因此提升索引访问的I/O效率，也可以提升总体的访问效率。假如构成索引的字段总长度比较短，那么在给定大小的存储块内可以存储更多的索引值，乡音的可以有效地提升MySQL访问索引的I/O效率。</li>
<li>利用最左前缀，N个列组合而成的组合索引，那么相当于是创建了N个索引，如果查询时where子句中使用了组成该索引的前几个字段，那么这条查询SQL可以利用组合索引来提升性能；  </li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">创建复合索引：</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> idx_name_email_status <span class="keyword">ON</span> tb_seller(<span class="type">NAME</span>,email,STATUS);</span><br><span class="line"></span><br><span class="line">就相当于</span><br><span class="line">      对<span class="type">name</span> 创建了索引；</span><br><span class="line">      对<span class="type">name</span> , email 创建了索引；</span><br><span class="line">      对<span class="type">name</span> , email , status 创建了索引；</span><br><span class="line">只需要创建这么一个索引，在查询<span class="type">name</span>单个字段的时候就将会走索引；在查询<span class="type">name</span>，email这两个字段的时候也会走索引；在查询<span class="type">name</span>,email,status这三个字段的时候也会走索引；  </span><br><span class="line">最左索引：最左指的是复合索引当中的第一个字段，只要查询的时候包含第一个字段，那么这个时候就会走索引；</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">## 视图 - 创建及修改视图</span><br><span class="line"></span><br><span class="line">视图（<span class="keyword">View</span>）是一种虚拟存在的表。  </span><br><span class="line">视图并不在数据库中实际存在，行和列数据来自定义视图的查询中使用的表，并且是在使用视图时动态生成的。  </span><br><span class="line">通俗的讲，视图就是一条<span class="keyword">SELECT</span>语句执行后返回的结果集。  </span><br><span class="line">所以在创建视图的时候，主要的工作就落在创建这条<span class="keyword">SQL</span>查询语句上。  </span><br><span class="line"></span><br><span class="line">视图相对于普通表的又是主要包括以下几项：  </span><br><span class="line"></span><br><span class="line">* 简单：使用视图的用户完全不需要关心后面对应表的结构、关联条件和筛选条件，对用户来说已经是过滤好的符合条件的结果集。  </span><br><span class="line">* 安全：使用视图的用户只能访问他们被允许查询的结果喜，对表的权限管理并不能先知道某个行某个列，但是通过视图就可以简单的实现；</span><br><span class="line">* 数据独立：一旦视图的结构确定了，可以屏蔽表结构变化对用户的影响，源表增加列对视图没有影响；源表修改列名，则可以通过修改视图来解决，不会造成对访问者的影响；</span><br><span class="line"></span><br><span class="line">### 创建或者修改视图</span><br><span class="line"></span><br><span class="line">&gt; 创建视图的语法为</span><br></pre></td></tr></table></figure>
<p>CREATE [ OR REPLACE] [ ALGORITHM = { UNDEFINED | MERGE | TEMPTABLE } ]</p>
<p>VIEW view_name [ (column_list) ]</p>
<p>AS select_statement</p>
<p>[ WITH [CASCADED | LOCAL ] CHECK OPTION ]</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="quote">&gt; 修改视图的语法</span></span><br></pre></td></tr></table></figure>
<p>ALTER [ ALGORITHM = { UNDEFINED | MERGE | TEMPTABLE } ]</p>
<p>VIEW view_name [ (column_list) ]</p>
<p>AS select_statement</p>
<p>[ WITE [ CASCADED | LOCAL ] CHECK OPTION ]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>选项：<br>    WITH [ CASCADED | LOCAL] CHECK OPTION 决定了是否允许更新数据使记录不在满足视图的条件；<br>    LOCAL 只要满足本视图的条件就可以更新<br>    CASCADED 必须满足所有针对该视图的所有视图的条件才可以更新（默认值）</p>
<pre><code>CREATE [ OR REPLACE] 创建或者是替换
AS select_statement select_statement即select语句</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：在视图当中展示国家以及其相关城市的信息</span><br></pre></td></tr></table></figure>
<p>show tables; # 显示在该数据库下所有的表<br>desc table_name; # 显示该table_name当中的表结构<br>desc city;<br>select * from city c,country t where c.country_id=t.country_id;<br>select c.*,t.country_name from city c,country t where c.country_id=t.country_id;</p>
<p>create view view_city_country as select c.*,t.country_name from city c,country t where c.country_id=t.country_id;</p>
<p>select * from view_city_country;# 查询视图与表操作一致<br>update view_city_country set city_name=’西安市’ where city_id=1;#修改视图与表操作一致</p>
<p>select * from city; # 这个时候基础表当中的数据也会被更新掉；也就是说此时的视图修改操作是会影响到基础表当中的数据；<br>虽然视图能够做到更新，但是并不建议去更新数据；因为视图就是用来简化查询操作的，不建议更新视图；</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 视图 - 查看及删除视图</span><br><span class="line"></span><br><span class="line">### 查看视图</span><br><span class="line"></span><br><span class="line">从MySQL5<span class="number">.1</span>版本开始，使用SHOW TABLES命令的时候不仅会显示表的名字，同时也会显示视图的名字，而不存在单独显示视图的SHOW VIEWS命令。</span><br></pre></td></tr></table></figure>
<p>show tables;# 显示表以及视图的名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">同样，在使用<span class="keyword">SHOW</span> <span class="keyword">TABLE</span> <span class="keyword">STATUS</span>命令的时候，不但可以显示表的信息，同时也可以显示视图的信息；</span><br></pre></td></tr></table></figure>
<p>show table status; # 显示表以及视图的信息<br>show table status like ‘city_country_view’\G; # 示例查看视图city_country_view</p>
<p>show create view view_city_country; # 查看创建视图时所使用的的SQL语句是什么</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 删除视图</span><br><span class="line"></span><br><span class="line">语法：</span><br></pre></td></tr></table></figure>
<p>DROP VIEW [ IF EXISTS ] view_name [, view_name ] … [ RESTRICT | CASCADE ]</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例，删除视图<span class="string">city_country_view:</span></span><br></pre></td></tr></table></figure>
<p>DROP VIEW city_country_view;# or DROP VIEW if exists city_country_view;</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 存储过程 - 概述</span><br><span class="line"></span><br><span class="line">存储过程和函数是实现经过编译并存储在数据库中的一段SQL语句的集合，调用存储过程和函数可以简化应用开发人员的很多工作，减少数据在数据库和应用服务器之间的传输，对于提高数据处理的效率时有好处的。  </span><br><span class="line">存储过程和函数的区别在于函数必须有返回值，而存储过程没有；</span><br><span class="line">函数：是一个有返回值的过程；  </span><br><span class="line">存储过程：是一个没有返回值的函数；</span><br><span class="line"></span><br><span class="line">## 存储过程 - 创建调用查询删除语法</span><br><span class="line"></span><br><span class="line">### 创建存储过程</span><br></pre></td></tr></table></figure>
<p>CREATE PROCEDURE procedure_name ( [proc_parameter[,…..]])<br>begin<br>    – SQL语句<br>end;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：</span><br></pre></td></tr></table></figure>
<p>delimiter $</p>
<p>create procedure pro_test()<br>begin<br>    select ‘Hello MySQL’;<br>end$</p>
<p>delimiter ;</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 知识小贴士</span><br><span class="line"></span><br><span class="line">DELEMITER  </span><br><span class="line">    该关键字用来声明SQL语句的分隔符，告诉MySQL解释器，改短命令是否已经结束了，mysql是否可以执行了，默认情况下，delimiter是分号;  </span><br><span class="line">    在命令行客户端中，如果一行命令以分号结束，那么回车后，mysql将会执行该命令；</span><br><span class="line"></span><br><span class="line">### 调用存储过程</span><br></pre></td></tr></table></figure>
<p>call procedure_name();</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 查看存储过程</span><br></pre></td></tr></table></figure>
<p>– 查询db_name 数据库中的所有的存储过程<br>select name from mysql.proc where db=’db_name’;<br>select name from mysql.proc where db=’demo_01’$ #示例</p>
<p>– 查询存储过程的状态信息<br>show procedure status;<br>show procedure status$ # 示例</p>
<p>– 查询某个存储过程的定义<br>show create procedure test.pro_test1 \G;<br>show create procedure pro_test\G$ #示例</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 删除存储过程</span><br></pre></td></tr></table></figure>
<p>DROP PROCEDURE [ IF EXISTS ] sp_name;</p>
<p>drop procedure pro_test1$ # 示例</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 存储过程 - 语法 - 变量</span><br><span class="line"></span><br><span class="line">存储过程是可以编程的，意味着可以使用变量，表达式，控制结构，来完成比较复杂的功能。(使得SQL具有过程化语言的处理能力)  </span><br><span class="line"></span><br><span class="line">### 变量</span><br><span class="line"></span><br><span class="line">* DECLARE</span><br><span class="line"></span><br><span class="line">通过DECLARE可以定义一个局部变量，该变量的作用返回只能在BEGIN...END块中。</span><br></pre></td></tr></table></figure>
<p>DECLARE var_name[ … ] type [DEFAULT value]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：</span><br></pre></td></tr></table></figure>
<p>delimiter $</p>
<p>create procedure pro_test2()<br>begin<br>    declare num int default 5;<br>    select num+ 10;<br>end$</p>
<p>create procedure pro_test1()<br>begin<br>    declare num int default 10;<br>    select concat(‘num的值为’,num);<br>end$</p>
<p>call pro_test1()$<br>call pro_test2()$</p>
<p>delimiter $</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* <span class="keyword">SET</span></span><br><span class="line"></span><br><span class="line">直接赋值使用<span class="keyword">SET</span>，可以赋常量或者赋表达式，具体语法如下：</span><br></pre></td></tr></table></figure>
<p>SET var_name = expr [ , var_name=expr ] ….</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：</span><br></pre></td></tr></table></figure>
<p>DELIMITER $</p>
<p>CREATE PROCEDURE pro_test3()<br>BEGIN<br>    DECLARE NAME VARCHAR(20);<br>    SET NAME = ‘MYSQL’;<br>    SELECT NAME ;<br>END$</p>
<p>CREATE PROCEDURE pro_demo()<br>begin<br>    declare num int default 0;<br>    set num = num +10;<br>    select num;<br>end$</p>
<p>call pro_test3()$<br>call pro_demo()$</p>
<p>DELIMITER ;</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">也可以通过 <span class="keyword">select</span><span class="params">...</span>.<span class="keyword">into</span> 方式进行赋值操作；</span><br></pre></td></tr></table></figure>
<p>DELIMITER $</p>
<p>CREATE PROCEDURE pro_test5()<br>BEGIN<br>    DECLARE countnum int;<br>    select count(*) into countnum from city;<br>    select countnum;<br>END$</p>
<p>CREATE PPROCEDURE pro_demo()<br>begin<br>    declare num int;<br>    select count(*) into num from city;<br>    select concat(‘city表中的记录数为’,num);<br>end$</p>
<p>call pro_test5()$<br>call pro_demo()$</p>
<p>DELIMITER $</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 存储过程 - 语法 - <span class="keyword">if</span>判断</span><br><span class="line"></span><br><span class="line">### <span class="keyword">if</span>条件判断</span><br><span class="line"></span><br><span class="line">语法结构：</span><br></pre></td></tr></table></figure>
<p>if search_condition then statement_list<br>      [ elseif search_condition then statement_list ] …<br>      [ else statementlist ]<br>end if;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">需求：</span><br></pre></td></tr></table></figure>
<p>根据定义的身高变量，判定当前身高的所属的身材类型</p>
<p>180及以上———-》身材高挑<br>170 ~ 180———-》标准身材<br>170一下————》一般身材</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：</span><br></pre></td></tr></table></figure>
<p>delimiter &amp;<br>create procedure pro_test4()<br>begin<br>    declare height int default 175;<br>    declare description varchar(50) default ‘’;<br>    if hegith &gt;= 180 then<br>      set description=’身材高挑’;<br>    elseif height &gt;=170 and height &lt; 180 then<br>      set description=’标准身材’;<br>    else<br>      set description=’一般身材’;<br>    end if;<br>    select concat(‘身高’,height,’对应的身材类型为’,description);<br>end$</p>
<p>call pro_test()$</p>
<p>delimiter ;</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 存储过程 - 语法 - 输入参数</span><br><span class="line"></span><br><span class="line">**传递参数**</span><br><span class="line"></span><br><span class="line">语法格式：</span><br></pre></td></tr></table></figure>
<p>create procedure procedure_name([ in / out / inout ]参数名称 参数类型)<br>…</p>
<h1 id="IN-该参数可以作为输入，也就是需要调用方传入值，默认"><a href="#IN-该参数可以作为输入，也就是需要调用方传入值，默认" class="headerlink" title="IN 该参数可以作为输入，也就是需要调用方传入值，默认"></a>IN 该参数可以作为输入，也就是需要调用方传入值，默认</h1><h1 id="OUT-该参数作为输出，也就是该参数可以作为返回值"><a href="#OUT-该参数作为输出，也就是该参数可以作为返回值" class="headerlink" title="OUT 该参数作为输出，也就是该参数可以作为返回值"></a>OUT 该参数作为输出，也就是该参数可以作为返回值</h1><h1 id="INOUT-既可以作为输入参数，也可以作为输出参数"><a href="#INOUT-既可以作为输入参数，也可以作为输出参数" class="headerlink" title="INOUT 既可以作为输入参数，也可以作为输出参数"></a>INOUT 既可以作为输入参数，也可以作为输出参数</h1><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*<span class="strong">*IN - 输入*</span><span class="strong">*</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">需求：</span></span><br></pre></td></tr></table></figure>
<p>根据定义的身高变量，判定当前身高的所属的身材类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：</span><br></pre></td></tr></table></figure>
<p>delimiter $</p>
<p>create procedure pro_test5(in height int)<br>begin<br>    declare description varchar(50) default ‘’;<br>    if hegith &gt;= 180 then<br>      set description=’身材高挑’;<br>    elseif height &gt;=170 and height &lt; 180 then<br>      set description=’标准身材’;<br>    else<br>      set description=’一般身材’;<br>    end if;<br>    select concat(‘身高’,height,’对应的身材类型为’,description);<br>end$</p>
<p>call pro_test5(198)$<br>call pro_test5(178)$<br>call pro_test5(158)$</p>
<p>delimiter ;</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 存储过程 - 语法 - 输出参数</span><br><span class="line"></span><br><span class="line">需求：</span><br></pre></td></tr></table></figure>
<p>根据传入的身高变量，获取当前身高的所属的身材类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：</span><br></pre></td></tr></table></figure>
<p>create procedure pro_test5(in height int ,out description varchar(10))<br>begin<br>    if height &gt;=180 then<br>        set description=’身材高挑’;<br>    elseif height &gt;= 170 and height &lt; 180 then<br>        set description=’身材标准’;<br>    else<br>        set description=’一般身材’;<br>    end if;<br>end$</p>
<p>call pro_test5(188,@description)$</p>
<h1 id="description-代表用户的变量；用户的会话变量"><a href="#description-代表用户的变量；用户的会话变量" class="headerlink" title="@description 代表用户的变量；用户的会话变量"></a>@description 代表用户的变量；用户的会话变量</h1><p>select @description$ # 查询用户会话变量取值</p>
<p>delimiter ;</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**小知识**</span><br><span class="line"><span class="variable">@description</span>：这种变量要在变量名称前面加上“@”符号，叫做用户会话变量，代表整个会话过程它都是有作用的，这个类似于全局变量一样。  </span><br><span class="line"><span class="variable">@@global</span>.<span class="attribute">sort_buffer_size</span>:这种在变量前加上“@@”，叫做系统变量；</span><br></pre></td></tr></table></figure>
<p>set @name=’itcast’$</p>
<p>select @name$</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 存储过程 - 语法 - <span class="keyword">case</span>结构</span><br><span class="line"></span><br><span class="line">语法结构：</span><br></pre></td></tr></table></figure>
<p>方式一：<br>CASE case_value # case_value 条件<br>    WHEN when_value THEN statement_list # statement_list SQL语句<br>    [ WHEN when_value THEN statement_list ] …<br>    [ ELSE statement_list ]<br>END CASE;</p>
<p>方拾二：<br>CASE<br>    WHEN search_condition THEN statement_list # search_condition 条件表达式；如果该表达式为真只执行THEN后的statement_list SQL语句<br>    [ WHEN search_condition THEN statement_list ] …<br>    [ ELSE statement_list ]<br>END CASE;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">需求：</span><br></pre></td></tr></table></figure>
<p>给定一个月份，然后计算出所在的季度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：</span><br></pre></td></tr></table></figure>
<p>delimiter $</p>
<p>create procedure pro_test7( mon int)<br>begin<br>    declare result varchar(10);<br>    case<br>      when mou&gt;=1 and mon &lt;=2 then<br>        set result=’第一季度’;<br>      when mou&gt;=4 and mon &lt;=6 then<br>        set result=’第二季度’;<br>      when mou&gt;=7 and mon &lt;=9 then<br>        set result=’第三季度’;<br>      else<br>        set result=’第四季度’;<br>    end case;<br>    select concat(‘传递的月份为’,mon,’， 计算出的结果为：’,result) as content;<br>end$</p>
<p>call pro_test7(7)$<br>call pro_test7(2)$<br>call pro_test7(11)$<br>call pro_test7(9)$</p>
<p>delimiter ;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">## 存储过程 - 语法 - while循环</span><br><span class="line"></span><br><span class="line">语法结构：</span><br></pre></td></tr></table></figure>
<p>while search_condition do # search_condition 条件成立执行循环；条件不成立则跳出循环<br>    statement_list<br>end while;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">需求：</span><br></pre></td></tr></table></figure>
<p>计算从1加到n的值</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section">示例:</span></span><br></pre></td></tr></table></figure>
<p>delimiter $</p>
<p>create procedure pro_test8(n int)<br>begin<br>    declare total int default 0;<br>    declare start int default 0;</p>
<pre><code>while start &lt;= n do
    set total=total+start;
    start=start+1;
end while;
select total;</code></pre><p>end$</p>
<p>call pro_test8(3)$<br>call pro_test8(6)$<br>call pro_test8(100)$</p>
<p>delimiter ;</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">## 存储过程 - 语法 - repeat循环</span></span><br><span class="line"></span><br><span class="line">有条件的循环控制语句，当满足条件的时候退出循环。  </span><br><span class="line"><span class="keyword">while</span>是满足条件才执行，<span class="keyword">repeat</span>是满足条件就退出循环。  </span><br><span class="line"></span><br><span class="line">语法结构：</span><br></pre></td></tr></table></figure>
<p>REPEAT<br>    statement_list</p>
<pre><code>UNTIL search_condition</code></pre><p>END REPEAT;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">需求：</span><br></pre></td></tr></table></figure>
<p>计算从1加到n的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：</span><br></pre></td></tr></table></figure>
<p>delimiter $</p>
<p>create procedure pro_test9(n int)<br>begin<br>    declare total int default 0;</p>
<pre><code>repeat
    set total=total+n;
    set n=n-1;
    until n=0 # 此处不加分号；加分号报错；满足当前条件则跳出循环
end repeat;
select total;</code></pre><p>end$</p>
<p>call pro_test10(50)$</p>
<p>delimiter ;</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 存储过程 - 语法 - loop循环</span><br><span class="line"></span><br><span class="line">### loop语句</span><br><span class="line">LOOP实现简单的循环，退出循环的条件需要使用其他的语句定义，通常可以使用LEAVE语句实现，具体语法如下：</span><br></pre></td></tr></table></figure>
<p>[ begin_label: ] LOOP<br>    statement_list<br>END LOOP [ end_label ]<br>]</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如果不在 statement_list 中增加退出循环的语句，那么<span class="keyword">LOOP</span>语句可以用来实现简单的死循环</span><br><span class="line"></span><br><span class="line">### leave语句</span><br><span class="line"></span><br><span class="line">用来从标注的流程构造中退出，通常和<span class="keyword">BEGIN</span>....<span class="keyword">END</span>或者循环一起使用。  </span><br><span class="line">下面是一个使用<span class="keyword">LOOP</span>和LEAVE的简单例子，退出循环；</span><br></pre></td></tr></table></figure>
<p>delimiter $</p>
<p>CREATE PROCEDURE pro_test10(n int)<br>BEGIN<br>    declare total int default 0;</p>
<pre><code>ins:LOOP
    IF n &lt;= 0 then
      leave ins;
    ELSE
      SET total=total+n;
      SET n=n-1;
    END IF;
END LOOP ins;
select total;</code></pre><p>END$</p>
<p>create procedure pro_test10(n int)<br>begin<br>    declare total int default 0;</p>
<pre><code>c:loop
    set total=total+n;
    set n=n-1;
    if n&lt;0 then
        leave c; # 满足条件跳出循环
    end if;
end loop c;
select total;</code></pre><p>end$</p>
<p>call pro_test10(100)$<br>call pro_test10(99)$<br>call pro_test10(3)$</p>
<p>delimiter ;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 存储过程 - 语法 - 游标介绍</span><br><span class="line"></span><br><span class="line">游标是用来存储查询结果集的数据类型，唉存储过程和函数中可以使用光标对结果集进行循环的处理。  </span><br><span class="line">光标的使用包括光标的声明、OPEN、FETCH和CLOSE。  </span><br><span class="line"></span><br><span class="line">## 存储过程 - 语法 - 游标基本操作</span><br><span class="line"></span><br><span class="line">其语法分别如下：  </span><br><span class="line"></span><br><span class="line">声明光标：</span><br></pre></td></tr></table></figure>
<p>DECLARE cursor_name CURSOR for select_statement;</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">OPEN</span>光标：</span><br></pre></td></tr></table></figure>
<p>OPEN cursor_name;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">FETCH</span>光标：</span><br></pre></td></tr></table></figure>
<p>FETCH cursor_name INTO var_name [ , var_name ] … # 每抓取一次，即获取结果集当中每一行数据；调用一次指针往下指向一次；调用一次指针往下指向一次；当指针指到最后没有数据的那一行时，即此时就应该退出游标了；</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">CLOSE</span>光标：</span><br></pre></td></tr></table></figure>
<p>CLOSE cursor_name;</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：  </span><br><span class="line"><span class="section">初始化脚本:</span></span><br></pre></td></tr></table></figure>
<p>create table emp(<br>  id int(11) not null auto_increment,<br>  name varchar(50) not null comment ‘姓名’,<br>  age int(11) comment ‘年龄’,<br>  salary int(11) comment ‘薪水’,<br>  primary key(‘id’)<br>)engine=innodb default charset=utf8;</p>
<p>insert into emp(id,name,age,salary) values (null,’金毛狮王’,55,3800),(null,’白眉鹰王’,60,4400),(null,’青翼蝠王’,38,2800),(null,’素衫龙王’,42,1800);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">需求：</span><br></pre></td></tr></table></figure>
<p>– 查询emp表中数据，并逐行获取进行显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：</span><br></pre></td></tr></table></figure>
<p>delimiter $<br>create procedure pro_test11()<br>begin<br>    declare e_id int(11);<br>    declare e_name varchar(50);<br>    decalre e_age int(11);<br>    declare e_salary int(11);<br>    declare emp_result cursor fro select * from emp;</p>
<pre><code>open emp_result;

fetch emp_result into e_id,e_naem,e_age,e_salary;
select concat(&apos;id为：&apos; , e_id,&apos;, 名字为: &apos; , e_name , &apos;, 年龄为：&apos; , e_age , &apos;, 薪资为：&apos; , e_salary);

fetch emp_result into e_id,e_naem,e_age,e_salary;
select concat(&apos;id为：&apos; , e_id,&apos;, 名字为: &apos; , e_name , &apos;, 年龄为：&apos; , e_age , &apos;, 薪资为：&apos; , e_salary);

fetch emp_result into e_id,e_naem,e_age,e_salary;
select concat(&apos;id为：&apos; , e_id,&apos;, 名字为: &apos; , e_name , &apos;, 年龄为：&apos; , e_age , &apos;, 薪资为：&apos; , e_salary);

fetch emp_result into e_id,e_naem,e_age,e_salary;
select concat(&apos;id为：&apos; , e_id,&apos;, 名字为: &apos; , e_name , &apos;, 年龄为：&apos; , e_age , &apos;, 薪资为：&apos; , e_salary);

fetch emp_result into e_id,e_naem,e_age,e_salary;
select concat(&apos;id为：&apos; , e_id,&apos;, 名字为: &apos; , e_name , &apos;, 年龄为：&apos; , e_age , &apos;, 薪资为：&apos; , e_salary);

close emp_result;</code></pre><p>end$</p>
<h1 id="emp表当中只有四条数据，如果fetch的次数大于表当中的数据，那么fetch表中总行数依然可以打印出来，一旦fetch大于表中的总行数则进行报错；"><a href="#emp表当中只有四条数据，如果fetch的次数大于表当中的数据，那么fetch表中总行数依然可以打印出来，一旦fetch大于表中的总行数则进行报错；" class="headerlink" title="emp表当中只有四条数据，如果fetch的次数大于表当中的数据，那么fetch表中总行数依然可以打印出来，一旦fetch大于表中的总行数则进行报错；"></a>emp表当中只有四条数据，如果fetch的次数大于表当中的数据，那么fetch表中总行数依然可以打印出来，一旦fetch大于表中的总行数则进行报错；</h1><h1 id="通过fetch一行一行进行抓取记录编写的效率十分低；"><a href="#通过fetch一行一行进行抓取记录编写的效率十分低；" class="headerlink" title="通过fetch一行一行进行抓取记录编写的效率十分低；"></a>通过fetch一行一行进行抓取记录编写的效率十分低；</h1><p>call pro_test11();<br>delimiter ;</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">## 存储过程 - 语法 - 循环获取游标</span></span><br><span class="line"></span><br><span class="line">&gt; 循环当中，游标的fetch退出判断</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>） count(*) <span class="keyword">into</span> <span class="built_in">num</span>;  <span class="built_in">num</span> <span class="comment">--  </span></span><br><span class="line"><span class="number">2</span>） mysql存在机制，变量，通过改变该变量取值状态及退出fetch  </span><br><span class="line"></span><br><span class="line">示例：</span><br></pre></td></tr></table></figure>
<p>delimiter $</p>
<p>create procedure pro_test12()<br>begin<br>    declare e_id int(11);<br>    decalre e_name varchar(50);<br>    decalre e_age int(11);<br>    decalre e_salary int(11);<br>    declare has_data int default 1;#当has_data为1时表示还有数据；当has_data为0时表示没有数据</p>
<pre><code>declare emp_result cursor for select * from emp;
DECLARE EXIT HANDLER FOR NOT FOUND set has_data=0;#退出当前游标指向程序并设置has_data为0；此为mysql提供的一种机制；同时该句话需要声明在声明游标的下方；当游标进行fetch获取不到数据的时候，此时会进行触发；

open emp_reuslt;

repeat
    fetch emp_result into e_id,e_name,e_age,e_salary;
    select concat(&apos;id为：&apos; , e_id,&apos;, 名字为: &apos; , e_name , &apos;, 年龄为：&apos; , e_age , &apos;, 薪资为：&apos; , e_salary);
    until has_data=0;
end repeat;
close emp_result;</code></pre><p>end</p>
<p>call pro_test12()$</p>
<p>delimiter ;</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 存储函数</span><br><span class="line"></span><br><span class="line">语法结构：</span><br></pre></td></tr></table></figure>
<p>CREATE FUNCTION function_name([ param type … ])<br>RETURNS type<br>BEGIN<br>    …..<br>END;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">案例：  </span><br><span class="line">定义一个存储过程，请求满足条件的总记录数：</span><br></pre></td></tr></table></figure>
<p>delimiter $</p>
<p>create function count_city(countryId int)<br>returns int # 此处不需要分号<br>begin<br>    declare cnum int;</p>
<pre><code>select count(*) into cnum from city where country_id = countryId;

return cnum;</code></pre><p>end$</p>
<p>delimiter ;</p>
<h1 id="存储过程虽然没有返回值；但是依然可以返回结果；因为其参数列表当中有in、out（返回值）、inout；存储函数能做的事情；存储过程也可以做；"><a href="#存储过程虽然没有返回值；但是依然可以返回结果；因为其参数列表当中有in、out（返回值）、inout；存储函数能做的事情；存储过程也可以做；" class="headerlink" title="存储过程虽然没有返回值；但是依然可以返回结果；因为其参数列表当中有in、out（返回值）、inout；存储函数能做的事情；存储过程也可以做；"></a>存储过程虽然没有返回值；但是依然可以返回结果；因为其参数列表当中有in、out（返回值）、inout；存储函数能做的事情；存储过程也可以做；</h1><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="quote">&gt; 调用存储函数命令</span></span><br></pre></td></tr></table></figure>
<p>select count_city(1)$<br>select count_city(2)$</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="quote">&gt; 删除存储函数命令</span></span><br></pre></td></tr></table></figure>
<p>drop function count_city$</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">## 触发器 - 介绍</span></span><br><span class="line"></span><br><span class="line">触发器是与表有关的数据库对象，指的是在insert、update、delete之前或者之后，触发并执行触发器中定义的SQL语句集合，触发器的这种特性可以协助应用在数据库端确保数据的完整性，日志记录，数据校验等操作；  </span><br><span class="line"></span><br><span class="line">使用别名OLD和NEW来引用触发器中发生变化的记录内容，这与其他的数据库是相似的。  </span><br><span class="line">现在触发器还只支持行级触发，不支持语句级触发。  </span><br><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>触发器类型<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>NEW和OLD的使用<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>INSERT型触发器<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NEW表示将要或者已经新增的数据<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>UPDATE型触发器<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>OLD表示修改之前的数据，NEW表示将要或者已经修改后的数据<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>DELETE型触发器<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>OLD表示将要或者已经删除的数据<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">## 触发器 - 创建及应用</span></span><br><span class="line"></span><br><span class="line"><span class="meta">### 创建触发器</span></span><br><span class="line"></span><br><span class="line">语法结构：</span><br></pre></td></tr></table></figure>
<p>create trigger trigger_name</p>
<p>before/after insert/update/delete</p>
<h1 id="before-在…之前-after-在…之后"><a href="#before-在…之前-after-在…之后" class="headerlink" title="before 在…之前/after 在…之后"></a>before 在…之前/after 在…之后</h1><p>on tb1_name</p>
<p>[ for each row ] – 当前操作的是一个行级触发器;oracle数据库当中既有行级触发器也有语句级的触发器；而mysql数据库当中只支持行级触发器现还不支持语句级触发器</p>
<p>begin<br>  trigger_stmt;–触发的内容<br>end;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">需求：</span><br></pre></td></tr></table></figure>
<p>通过触发器记录 emp表的数据变更日志，包含新增、修改、删除；</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：  </span><br><span class="line"></span><br><span class="line"><span class="section">首先创建一张日志表:</span></span><br></pre></td></tr></table></figure>
<p>create table emp_logs(<br>    id int(11) not null auto_increment,<br>    operation varchar(20) not null comment ‘操作类型，insert/update/delete’,<br>    operate_time datatime not null comment ‘操作时间’,<br>    operate_id int(11) not null comment ‘操作表的id’,<br>    operate_params varchar(500) comment ‘操作参数’,<br>    primary key(‘id’)<br>)engine=innodb default charset=utf8;</p>
<p>show tables$</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">创建<span class="built_in">insert</span>性触发器，完成插入数据时的日志记录；</span><br></pre></td></tr></table></figure>
<p>DELIMITER $</p>
<p>CREATE trigger emp_logs_insert_trigger<br>after insert<br>on emp<br>for each row<br>begin<br>    insert into emp_logs(id,operation,operate_time,operate_id,operate_params) values(<br>      null,’insert’,now(),new.id,concat( ‘插入后 ( id：’, new.id , ‘, name: ‘ , new.name , ‘ ,  age: ‘ ,  new.age , ‘ , salary: ‘ , new.salary , ‘)’)<br>    );<br>    # 此处的new.id即新插入emp表中数据的记录的id，即emp当中的id字段；<br>end$</p>
<p>insert into emp(id,name,age,salary) values(null,’光明左使’,30,3500);</p>
<p>select * from emp$<br>select * from emp_logs$</p>
<p>insert into emp(id,name,age,salary) values(null,’光明右使’,35,3800);</p>
<p>CREATE trigger emp_logs_update_trigger<br>after update<br>on emp<br>for each row<br>begin<br>    insert into emp_logs(id,operation,operate_time,operate_id,operate_params) values(<br>      null,’update’,now(),new.id,<br>      concat(<br>        ‘修改前 ( id：’, old.id ,<br>        ‘,name: ‘ , old.name ,<br>        ‘,age: ‘ ,  old.age ,<br>        ‘,salary: ‘ , old.salary ,<br>        ‘) 修改后( id：’, new.id ,<br>        ‘,name: ‘ , new.name ,<br>        ‘,age: ‘ ,  new.age ,<br>        ‘,salary: ‘ , new.salary ,<br>        ‘)’<br>        )<br>    );<br>    # 此处的new.id即新插入emp表中数据的记录的id，即emp当中的id字段；<br>end$</p>
<p>update emp set age=39 where id=3;</p>
<p>select * from emp$<br>select * from emp_logs$</p>
<p>CREATE trigger emp_logs_delete_trigger<br>after delete<br>on emp<br>for each row<br>begin<br>    insert into emp_logs(id,operation,operate_time,operate_id,operate_params) values(<br>      null,’delete’,now(),old.id,<br>      concat(<br>        ‘删除前( id：’, old.id ,<br>        ‘,name: ‘ , old.name ,<br>        ‘,age: ‘ ,  old.age ,<br>        ‘,salary: ‘ , old.salary ,<br>        ‘)’<br>        )<br>    );<br>end$</p>
<p>delete from emp where id=5;</p>
<p>select * from emp$<br>select * from emp_logs$</p>
<p>delete from emp where id=5;<br>select * from emp$<br>select * from emp_logs$</p>
<p>DELIMITER ;</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 触发器 - 查看及删除</span><br><span class="line"></span><br><span class="line">### 删除触发器</span><br><span class="line"></span><br><span class="line">语法结构：</span><br></pre></td></tr></table></figure>
<p>drop trigger [ schema_name.] trigger_name</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">如果没有指定schema_name，默认为当前数据库。</span><br><span class="line"></span><br><span class="line">### 查看触发器</span><br><span class="line"></span><br><span class="line">可以通过执行SHOW TRIGGERS 命令查看触发器的状态、语法等信息。  </span><br><span class="line">语法结构：</span><br></pre></td></tr></table></figure>
<p>show triggers;</p>
<h1 id="Event-触发器监听的事件-INSERT-UPDATE-DELETE"><a href="#Event-触发器监听的事件-INSERT-UPDATE-DELETE" class="headerlink" title="Event 触发器监听的事件 INSERT/UPDATE/DELETE"></a>Event 触发器监听的事件 INSERT/UPDATE/DELETE</h1><h1 id="Table-对于哪一张表监听的触发器"><a href="#Table-对于哪一张表监听的触发器" class="headerlink" title="Table 对于哪一张表监听的触发器"></a>Table 对于哪一张表监听的触发器</h1><h1 id="Timing-触发器是前置触发BEFORE还是后置触发AFTER"><a href="#Timing-触发器是前置触发BEFORE还是后置触发AFTER" class="headerlink" title="Timing 触发器是前置触发BEFORE还是后置触发AFTER"></a>Timing 触发器是前置触发BEFORE还是后置触发AFTER</h1><h1 id="Statement-触发器定义"><a href="#Statement-触发器定义" class="headerlink" title="Statement 触发器定义"></a>Statement 触发器定义</h1><pre><code>
## 今日内容

## 体系结构

## 存储引擎 - 概述

## 存储引擎 - 特性

## 存储引擎 - InnoDB特性

## 存储引擎 - MyISAM特性

## 存储引擎 - Memory与Merge特性

## 存储引擎 - 选择原则

## 优化SQL步骤 - SQL执行频率

## 优化SQL步骤 - 定位低效SQL

## 优化SQL步骤 - explain指令介绍

## 优化SQL步骤 - explain之id

## 优化SQL步骤 - explain之select_type

## 优化SQL步骤 - explain之table type

## 优化SQL步骤 - explain之key rows extra

## 优化SQL步骤 - show profile

## 优化SQL步骤 - trace工具

## 索引的使用 - 验证索引提升查询效率

## 索引的使用 - 全值匹配

## 索引的使用 - 最左前缀法则

## 索引的使用 - 索引失效情况（范围查询、字段运算）

## 索引的使用 - 覆盖索引

## 索引的使用 - or索引失效情况

## 索引的使用 - like模糊匹配

## 索引的使用 - 全表扫描更快

## 索引的使用 - NULL值的判定

## 索引的使用 - in和not in

## 索引的使用 - 单列索引与复合索引选择

## 索引的使用 - 查看索引使用情况

## SQL优化 - 大批量插入数据

## SQL优化 - insert优化

## SQL优化 - orderby优化

## SQL优化 - group by优化

## SQL优化 - 子查询优化

## SQL优化 - or优化

## SQL优化 - limit优化

## SQL优化 - 索引提示

## 今日内容2

## 应用优化

## 查询缓存 - 概述及流程

## 查询缓存 - 配置参数

## 查询缓存 - 开启查询缓存

## 查询缓存 - SELECT选项

## 查询缓存 - 失效场景

## 内存优化 - 优化原则

## 内存优化 - MyISAM内存优化

## 内存优化 - InnoDB内存优化

## 并发参数调整

## 锁 - 锁的概述及分类

## 锁 - MySQL对锁的支持

## 锁 - MyISAM表锁 - 读锁

## 锁 - MyISAM表锁 - 写锁

## 锁 - MyISAM表锁 - 小结

## 锁 - MyISAM表锁 - 查看锁争用情况

## 锁 - InnoDB行锁 - 介绍及背景知识

## 锁 - InnoDB行锁 - 类型

## 锁 - InnoDB行锁 - 行锁升级为表锁

## 锁 - InnoDB行锁 - 间隙锁危害

## 锁 - InnoDB行锁 - 争用情况查看

## 锁 - InnoDB行锁 - 总结

## SQL技巧 - SQL执行顺序及正则表达式

## SQL技巧 - 数字函数与字符串函数

## SQL技巧 - 日期函数与聚合函数

## 课程内容

## 常用工具 - mysql

## 常用工具 - mysqladmin

## 常用工具 - mysqlbinlog与mysqldump

## 常用工具 - mysqlimport与source

## 常用工具 - mysqlshow

## 日志 - 错误日志

## 日志 - 二进制日志（statement）

## 日志 - 二进制日志（row及日志删除）

## 日志 - 查询日志

## 日志 - 慢查询日志

## 复制 - 原理

## 案例 - 需求及环境准备

## 案例 - 基本工程导入

## 案例 - AOP记录日志

## 案例 - 日志查询后端 - mapper接口

## 案例 - 日志查询后端 - Service&amp;Controller

## 案例 - 日志查询 - 前端

## 案例 - 系统性能优化分析

## 案例 - 系统性能优化 - 分页优化

## 案例 - 系统性能优化 - 索引优化

## 案例 - 系统性能优化 - 读写分离概述

## 案例 - 系统性能优化 - 数据源配置

## 案例 - 系统性能优化 - AOP切换数据源

## 案例 - 系统性能优化 - AOP切换数据源 - 测试

## 案例 - 系统性能优化 - AOP切换数据源 - 原理解析

## 案例 - 系统性能优化 - 应用优化</code></pre>
      
    </div>
    
    
    



<div>
    
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script>
  <script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css">

  <p><span>本文标题:</span>全面深入讲解MySQL数据库优化</a></p>
  <p><span>文章作者:</span>Fsn</a></p>
  <p><span>发布时间:</span>2020年04月24日 - 10:40:04</p>
  <p><span>最后更新:</span>2020年04月28日 - 11:15:55</p>
  <p><span>原始链接:</span><a href="/2020/04/24/%E9%9D%A2%E8%AF%95%E9%A2%98/%E5%85%A8%E9%9D%A2%E6%B7%B1%E5%85%A5%E8%AE%B2%E8%A7%A3MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/" title="全面深入讲解MySQL数据库优化">https://fengshana.github.io/2020/04/24/%E9%9D%A2%E8%AF%95%E9%A2%98/%E5%85%A8%E9%9D%A2%E6%B7%B1%E5%85%A5%E8%AE%B2%E8%A7%A3MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://fengshana.github.io/2020/04/24/%E9%9D%A2%E8%AF%95%E9%A2%98/%E5%85%A8%E9%9D%A2%E6%B7%B1%E5%85%A5%E8%AE%B2%E8%A7%A3MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    clipboard.on('success', $(function(){
      $(".fa-clipboard").click(function(){
        swal({   
          title: "",   
          text: '复制成功',   
          html: false,
          timer: 500,   
          showConfirmButton: false
        });
      });
    }));  
</script>


    
</div>



    








<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
  
</div>












    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatreward.png" alt="Fsn 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipayreward.png" alt="Fsn 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    










    <footer class="post-footer">
      
        <div class="post-tags" style="text-align:center">
          
            <a href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag"><i class="fa fa-tag">笔记</i></a>
          
            <a href="/tags/MySQL/" rel="tag"><i class="fa fa-tag">MySQL</i></a>
          
            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/" rel="tag"><i class="fa fa-tag">数据库优化</i></a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/04/24/%E9%9D%A2%E8%AF%95%E9%A2%98/Mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" rel="next" title="Mybatis源码分析">
                <i class="fa fa-chevron-left"></i> Mybatis源码分析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/04/24/%E9%9D%A2%E8%AF%95%E9%A2%98/Redis%E7%9B%B8%E5%85%B3/" rel="prev" title="2020年redis面试全套视频教程笔记">
                2020年redis面试全套视频教程笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80ODk3My8yNTQ2Nw=="></div>
    </div>

  
  
  

  
  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/fsn.jpg"
                alt="Fsn" />
            
              <p class="site-author-name" itemprop="name">Fsn</p>
              <p class="site-description motion-element" itemprop="description">勿忘初心，方得始终</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <!--<a href="/archives/%7C%7Carchive">-->
                <a href="/archives/">
              
                  <span class="site-state-item-count">136</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">68</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/fengshana" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#课程内容介绍"><span class="nav-number">2.</span> <span class="nav-text">课程内容介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL高级课程简介"><span class="nav-number">2.1.</span> <span class="nav-text">MySQL高级课程简介</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Linux上安装MySQL"><span class="nav-number">3.</span> <span class="nav-text">Linux上安装MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#下载Linux安装包"><span class="nav-number">3.1.</span> <span class="nav-text">下载Linux安装包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装MySQL"><span class="nav-number">3.2.</span> <span class="nav-text">安装MySQL</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动及登录MySQL"><span class="nav-number">4.</span> <span class="nav-text">启动及登录MySQL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-概述"><span class="nav-number">5.</span> <span class="nav-text">索引 - 概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-优势和劣势"><span class="nav-number">6.</span> <span class="nav-text">索引 - 优势和劣势</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-索引结构"><span class="nav-number">7.</span> <span class="nav-text">索引 - 索引结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MyISAM、InnoDB、Memory三种存储引擎对各种索引类型的支持"><span class="nav-number">7.1.</span> <span class="nav-text">MyISAM、InnoDB、Memory三种存储引擎对各种索引类型的支持</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-索引结构-BTREE"><span class="nav-number">8.</span> <span class="nav-text">索引 - 索引结构 - BTREE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-索引结构-B-TREE"><span class="nav-number">9.</span> <span class="nav-text">索引 - 索引结构 - B+TREE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-索引结构-MySQL中的B-Tree"><span class="nav-number">10.</span> <span class="nav-text">索引 - 索引结构 - MySQL中的B+Tree</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-索引分类"><span class="nav-number">11.</span> <span class="nav-text">索引 - 索引分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-索引语法"><span class="nav-number">12.</span> <span class="nav-text">索引 - 索引语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建索引"><span class="nav-number">12.1.</span> <span class="nav-text">创建索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看索引"><span class="nav-number">12.2.</span> <span class="nav-text">查看索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除索引"><span class="nav-number">12.3.</span> <span class="nav-text">删除索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ALTER指令"><span class="nav-number">12.4.</span> <span class="nav-text">ALTER指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-索引设计原则"><span class="nav-number">13.</span> <span class="nav-text">索引 - 索引设计原则</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IN-该参数可以作为输入，也就是需要调用方传入值，默认"><span class="nav-number"></span> <span class="nav-text">IN 该参数可以作为输入，也就是需要调用方传入值，默认</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OUT-该参数作为输出，也就是该参数可以作为返回值"><span class="nav-number"></span> <span class="nav-text">OUT 该参数作为输出，也就是该参数可以作为返回值</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#INOUT-既可以作为输入参数，也可以作为输出参数"><span class="nav-number"></span> <span class="nav-text">INOUT 既可以作为输入参数，也可以作为输出参数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#description-代表用户的变量；用户的会话变量"><span class="nav-number"></span> <span class="nav-text">@description 代表用户的变量；用户的会话变量</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#emp表当中只有四条数据，如果fetch的次数大于表当中的数据，那么fetch表中总行数依然可以打印出来，一旦fetch大于表中的总行数则进行报错；"><span class="nav-number"></span> <span class="nav-text">emp表当中只有四条数据，如果fetch的次数大于表当中的数据，那么fetch表中总行数依然可以打印出来，一旦fetch大于表中的总行数则进行报错；</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#通过fetch一行一行进行抓取记录编写的效率十分低；"><span class="nav-number"></span> <span class="nav-text">通过fetch一行一行进行抓取记录编写的效率十分低；</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#存储过程虽然没有返回值；但是依然可以返回结果；因为其参数列表当中有in、out（返回值）、inout；存储函数能做的事情；存储过程也可以做；"><span class="nav-number"></span> <span class="nav-text">存储过程虽然没有返回值；但是依然可以返回结果；因为其参数列表当中有in、out（返回值）、inout；存储函数能做的事情；存储过程也可以做；</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#before-在…之前-after-在…之后"><span class="nav-number"></span> <span class="nav-text">before 在…之前&#x2F;after 在…之后</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Event-触发器监听的事件-INSERT-UPDATE-DELETE"><span class="nav-number"></span> <span class="nav-text">Event 触发器监听的事件 INSERT&#x2F;UPDATE&#x2F;DELETE</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Table-对于哪一张表监听的触发器"><span class="nav-number"></span> <span class="nav-text">Table 对于哪一张表监听的触发器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Timing-触发器是前置触发BEFORE还是后置触发AFTER"><span class="nav-number"></span> <span class="nav-text">Timing 触发器是前置触发BEFORE还是后置触发AFTER</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Statement-触发器定义"><span class="nav-number"></span> <span class="nav-text">Statement 触发器定义</span></a></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; 

<span itemprop="copyrightYear">2020</span>
  <span class="with-love">
  <!--user-->
    <i class="fa fa-heart"></i>
  </span>
 
 <span class="author" itemprop="copyrightHolder">Fsn</span>

  





  <script async src="http://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
 
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
	<span title="Site words total count">
     417.5k字 </span>
    <!--<span title="symbols_count_time.count_total">779k</span>-->
  
</div>



  <!-- <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>-->






<!--



 -->
 
 
 






        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazyload@2.0.0-beta.2/lazyload.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  













  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  
  <script type="text/javascript" src="/js/src/exturl.js?v=5.1.4"></script>


  
  
  
  <!-- 
  
  -->
  <link rel="stylesheet" href="/dist/APlayer.min.css">
<div id="aplayer"></div>
<script type="text/javascript" src="/dist/APlayer.min.js"></script>
<script type="text/javascript" src="/dist/music.js"></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":100,"vOffset":-10},"mobile":{"show":false},"log":false,"tagMode":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>

<!--崩溃欺骗 <script type="text/javascript" src="/js/src/crash_cheat.js"></script> -->





<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<script>
	(function(){
		if(''){
			if (prompt('请输入文章密码','') !== ''){
				alert('密码错误！');
				history.back();
			}
		}
	})();
</script>









<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #A0A0A0; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #A0A0A0, 0 0 5px     #A0A0A0; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #A0A0A0;    /*上边框颜色*/
        border-left-color: #A0A0A0;    /*左边框颜色*/
    }
</style>

<meta name="theme-color" content="#222">










<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
    
  
  <link href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/fsn-16x16.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/fsn-32x32.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/fsn-16x16.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/fsn-16x16.ico?v=5.1.4" color="#222">





  <meta name="keywords" content="笔记,MySQL,数据库优化," />





  <link rel="alternate" href="/atom.xml" title="Fsn" type="application/atom+xml" />






<meta name="description" content="前言观看笔记：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1fJ41127Rj?from&#x3D;search&amp;seid&#x3D;13531213796559959972   本课程作为MySQL高级课程，主要讲解了：    MySQL中的视图&#x2F;存储过程&#x2F;触发器&#x2F;索引等对象的使用 常见的SQL语句优化的技巧 应用优化 数据库优化 数据库日志  等方面的知识，并通过综合案例，对课程中的">
<meta property="og:type" content="article">
<meta property="og:title" content="全面深入讲解MySQL数据库优化">
<meta property="og:url" content="https://fengshana.github.io/2020/04/24/%E9%9D%A2%E8%AF%95/%E5%85%A8%E9%9D%A2%E6%B7%B1%E5%85%A5%E8%AE%B2%E8%A7%A3MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/index.html">
<meta property="og:site_name" content="Fsn">
<meta property="og:description" content="前言观看笔记：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1fJ41127Rj?from&#x3D;search&amp;seid&#x3D;13531213796559959972   本课程作为MySQL高级课程，主要讲解了：    MySQL中的视图&#x2F;存储过程&#x2F;触发器&#x2F;索引等对象的使用 常见的SQL语句优化的技巧 应用优化 数据库优化 数据库日志  等方面的知识，并通过综合案例，对课程中的">
<meta property="og:image" content="http://r.photo.store.qq.com/psb?/V11rBmNJ1CgWNF/GXpIx6xVrrx71*TqsSAOVAhVsm4z2Sy6OQ6FnfnoV80!/r/dLYAAAAAAAAA">
<meta property="article:published_time" content="2020-04-24T02:40:04.420Z">
<meta property="article:modified_time" content="2020-05-06T10:09:37.953Z">
<meta property="article:author" content="Fsn">
<meta property="article:tag" content="笔记">
<meta property="article:tag" content="MySQL">
<meta property="article:tag" content="数据库优化">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://r.photo.store.qq.com/psb?/V11rBmNJ1CgWNF/GXpIx6xVrrx71*TqsSAOVAhVsm4z2Sy6OQ6FnfnoV80!/r/dLYAAAAAAAAA">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://fengshana.github.io/2020/04/24/面试/全面深入讲解MySQL数据库优化/"/>









  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "07d52b28"
    });
  daovoice('update');
  </script>

  <title>全面深入讲解MySQL数据库优化 | Fsn</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2a839053bb6194637483460a0f428730";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.js"></script>
<script src="https://unpkg.com/minigrid@3.1.1/dist/minigrid.min.js"></script>
<link rel="stylesheet" href="/photos/photos.css">
<script type="text/javascript" src="/photos/photo.js"></script>


<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Fsn</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-camera">
          <a href="/photos/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-camera"></i> <br />
            
            相册
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sentence">
          <a href="/shuoshuo" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-commenting"></i> <br />
            
            小心情
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>







 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="poem-wrap">
  <div class="poem-border poem-left"></div>
  <div class="poem-border poem-right"></div>
    <h1>[诗酒年华]</h1>
    <p id="poem">挑选中...</p>
    <p id="info">

  <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
  <script type="text/javascript">
    jinrishici.load(function(result) {
      poem.innerHTML = result.data.content
      info.innerHTML = '【' + result.data.origin.dynasty + '】' + result.data.origin.author + '《' + result.data.origin.title + '》'
      document.getElementById("poem").value(poem);
      document.getElementById("info").value(info);  
  });
  </script>
</div>

        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fengshana.github.io/2020/04/24/%E9%9D%A2%E8%AF%95/%E5%85%A8%E9%9D%A2%E6%B7%B1%E5%85%A5%E8%AE%B2%E8%A7%A3MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fsn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/fsn.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fsn">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">全面深入讲解MySQL数据库优化</h1>
        

        <div class="post-meta">
		

          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-24T10:40:04+08:00">
                2020-04-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index">
                    <span itemprop="name">笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  54.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  235
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="http://r.photo.store.qq.com/psb?/V11rBmNJ1CgWNF/GXpIx6xVrrx71*TqsSAOVAhVsm4z2Sy6OQ6FnfnoV80!/r/dLYAAAAAAAAA" rel="gallery_ck9v6kro700d5u8um8vss2q82"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="http://r.photo.store.qq.com/psb?/V11rBmNJ1CgWNF/GXpIx6xVrrx71*TqsSAOVAhVsm4z2Sy6OQ6FnfnoV80!/r/dLYAAAAAAAAA" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>观看笔记：<a href="https://www.bilibili.com/video/BV1fJ41127Rj?from=search&amp;seid=13531213796559959972" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1fJ41127Rj?from=search&amp;seid=13531213796559959972</a>  </p>
<p>本课程作为MySQL高级课程，主要讲解了：  </p>
<ul>
<li>MySQL中的视图/存储过程/触发器/索引等对象的使用</li>
<li>常见的SQL语句优化的技巧</li>
<li>应用优化</li>
<li>数据库优化</li>
<li>数据库日志</li>
</ul>
<p>等方面的知识，并通过综合案例，对课程中的知识进行一个整合应用。  </p>
<p>本课程旨在通过MySQl高级部分内容，可以在满足现有业务需求基础上，对MySQL底层的体系结构，及底层的优化有一个深入的理解，对系统的整体性能进行提升。  </p>
<h2 id="课程内容介绍"><a href="#课程内容介绍" class="headerlink" title="课程内容介绍"></a>课程内容介绍</h2><blockquote>
<p>Mysql高级-day01</p>
</blockquote>
<p>MySQL高级课程简介</p>
<ol>
<li>Linux系统安装MySQL</li>
<li>索引</li>
<li>视图</li>
<li>存储过程和函数</li>
<li>触发器</li>
</ol>
<h3 id="MySQL高级课程简介"><a href="#MySQL高级课程简介" class="headerlink" title="MySQL高级课程简介"></a>MySQL高级课程简介</h3><table>
    <tr>
      <th>序号</th>
      <th>Day01</th>
      <th>Day02</th>
      <th>Day03</th>
      <th>Day04</th>
    </tr>
    <tr>
      <td>1</td>
      <td>Linux系统安装MySQL</td>
      <td>体系结构</td>
      <td>应用优化</td>
      <td>MySQL常用工具</td>
    </tr>
    <tr>
      <td>2</td>
      <td>索引</td>
      <td>存储引擎</td>
      <td>查询缓存优化</td>
      <td>MySQL日志</td>
    </tr>
    <tr>
      <td>3</td>
      <td>视图</td>
      <td>优化SQL步骤</td>
      <td>内存管理及优化</td>
      <td>MySQl主从复制</td>
    </tr>
    <tr>
      <td>4</td>
      <td>存储过程和函数</td>
      <td>索引使用</td>
      <td>MySQL锁问题</td>
      <td>综合案例</td>
    </tr>
    <tr>
      <td>5</td>
      <td>触发器</td>
      <td>SQL优化</td>
      <td>常用SQL技巧</td>
      <td></td>
    </tr>
</table>

<h2 id="Linux上安装MySQL"><a href="#Linux上安装MySQL" class="headerlink" title="Linux上安装MySQL"></a>Linux上安装MySQL</h2><h3 id="下载Linux安装包"><a href="#下载Linux安装包" class="headerlink" title="下载Linux安装包"></a>下载Linux安装包</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span>/<span class="regexp">/dev.mysql.com/downloads</span><span class="regexp">/mysql/</span><span class="number">5.7</span>.html<span class="comment">#downloads</span></span><br></pre></td></tr></table></figure>

<h3 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h3><ol>
<li>卸载centos中预安装的mysql</li>
</ol>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep -i mysql # 查询服务器当中mysql的安装包是否存在，存在则显示出存在安装包的名称</span><br><span class="line"></span><br><span class="line">rpm -e mysql-libs<span class="number">-5.1</span><span class="number">.71</span><span class="number">-1.e16</span>.x86_64 --nodeps # 对已存在的安装包(mysql-libs<span class="number">-5.1</span><span class="number">.71</span><span class="number">-1.e16</span>.x86_64)进行卸载</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>上传mysql的安装包</li>
</ol>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alt + p -------&gt;put E:/tset/MySQL<span class="number">-5.6</span><span class="number">.22</span><span class="number">-1.e16</span>.i686.rpm-bundle.tar（MySQL安装包的目录）</span><br><span class="line"></span><br><span class="line"># 使用SecureCRT远程连接服务器工具，alt+p命令进入sftp模式；再执行put （MySQL安装包的目录）[ 上传 ]</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>解压mysql的安装包</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir mysql</span><br><span class="line"></span><br><span class="line">tar -xvf MySQL-<span class="number">5.6</span>.<span class="number">22</span>-<span class="number">1</span><span class="selector-class">.e16</span><span class="selector-class">.i686</span><span class="selector-class">.rpm-bundle</span><span class="selector-class">.tar</span> -c /root/mysql</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>安装依赖包</li>
</ol>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 安装第三方的依赖库；yum -y 在线安装需连接网络</span><br><span class="line">yum -y install libaio.so<span class="number">.1</span> libgc_s.so<span class="number">.1</span> libstdc++.so<span class="number">.6</span> libncurses.so<span class="number">.5</span> --setopt=protected_multilib=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line">yum update listdc++<span class="number">-4.4</span><span class="number">.7</span><span class="number">-4.e16</span>.x86_64 # 更新第三方类包</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>安装mysql-client</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">rpm</span> <span class="selector-tag">-ivh</span> <span class="selector-tag">MySQL-client-5</span><span class="selector-class">.6</span><span class="selector-class">.22-1</span><span class="selector-class">.e16</span><span class="selector-class">.i686</span><span class="selector-class">.rpm</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>安装mysql-server</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">rpm</span> <span class="selector-tag">-ivh</span> <span class="selector-tag">MySQL-server-5</span><span class="selector-class">.6</span><span class="selector-class">.22-1</span><span class="selector-class">.e16</span><span class="selector-class">.i686</span><span class="selector-class">.rpm</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Linux</p>
</blockquote>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ipconfig</span> <span class="comment"># 查看本机ip地址，内网地址</span></span><br></pre></td></tr></table></figure>

<h2 id="启动及登录MySQL"><a href="#启动及登录MySQL" class="headerlink" title="启动及登录MySQL"></a>启动及登录MySQL</h2><blockquote>
<p>启动mysql命令</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service mysql status # 查看mysql服务状态</span><br><span class="line">service mysql start # 启动mysql服务</span><br><span class="line">service mysql stop # 停止mysql服务</span><br></pre></td></tr></table></figure>

<blockquote>
<p>登录mysql</p>
</blockquote>
<p>mysql 安装完成之后，会自动生成一个随机密码，并且保存在一个密码文件中：/root/.mysql_secret；  </p>
<blockquote>
<p>查看随机密码</p>
</blockquote>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="regexp">/root/</span>.mysql_secret</span><br></pre></td></tr></table></figure>

<blockquote>
<p>登录命令</p>
</blockquote>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line"><span class="meta"># -u 指的是用户</span></span><br><span class="line"><span class="meta"># -p 指的是该用户所对应的密码</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>登录之后，修改密码命令</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">password</span> = <span class="keyword">password</span>(<span class="string">'itcast'</span>);</span><br><span class="line"><span class="comment"># itcast即明文密码</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>授权远程访问</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> <span class="string">'root'</span>@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'itcast'</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>防火墙</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service iptables status # 查看防火墙状态</span><br><span class="line">service iptables stop # 关闭防火墙</span><br></pre></td></tr></table></figure>

<h2 id="索引-概述"><a href="#索引-概述" class="headerlink" title="索引 - 概述"></a>索引 - 概述</h2><p>MySQL官方对索引的定义为：  </p>
<p>索引（index）是帮助MySQL高效获取数据的数据结构（有序）。<br>在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。<br>如下面的示意图所示：  </p>
<p>左边是数据库，一共有两列七条记录，最左边的是数据记录的物理地址（注意逻辑上相邻的记录在磁盘上也不是一定物理相邻的）。  </p>
<p>为了加快Col2的查找，可以维护右边所示的二叉查找树，每个结点分别包含索引键值和一个指向对应数据记录物理地址的指针，这样就可以运用二叉查找快速后去到相应数据。  </p>
<p>一般来说索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式存储在磁盘上，索引是数据库中用来提供性能的最常用的工具。  </p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mspaint</span> <span class="comment"># windows打开画板</span></span><br></pre></td></tr></table></figure>

<table>
  <tr>
    <td>物理地址</td>
    <td>Col1</td>
    <td>Col2</td>
  </tr>
  <tr>
    <td>0x07</td>
    <td>1</td>
    <td>34</td>
  </tr>
  <tr>
    <td>0x56</td>
    <td>2</td>
    <td>77</td>
  </tr>
  <tr>
    <td>0x6A</td>
    <td>3</td>
    <td>5</td>
  </tr>
  <tr>
    <td>0xF3</td>
    <td>4</td>
    <td>91</td>
  </tr>
  <tr>
    <td>0x90</td>
    <td>5</td>
    <td>22</td>
  </tr>
  <tr>
    <td>0x77</td>
    <td>6</td>
    <td>59</td>
  </tr>
  <tr>
    <td>0xD1</td>
    <td>7</td>
    <td>3</td>
  </tr>
</table>

<p>当前该为一张数据库表；在数据库表的左侧展示的是每一条记录的一个物理地址；右侧则是两列；一列字段Col1是序号；Col2字段数据可以认为就是主键数据；数据库表结构有了，接下来查询数据；  </p>
<p>（1）第一种情况：查询主键Col2为34的数据；因为这个时候只存在表，没有设置索引这些方便查询的数据结构；所以这个时候就会在表当中自上而下的进行遍历；这个时候就会去遍历到第一个，发现第一个的主键id，Col2的值就是34；此时即拿到数据；这样的话只需要查询一条记录；而且查询第一条记录就是，那么这样的话查询速度是很快的；这只是第一种情况；  </p>
<p>（2）第二种情况：查询主键Col2 id为91的记录行数据；那么还是需要自上而下从id为34的记录行数据开始遍历；那么第一条记录不是；第二条记录不是；第三条记录也不是；直到第四条记录的时候发现数据行id是91；那么这个时候也就是需要去遍历列表4次，查询4次才能够得到结果；  </p>
<p>（3）第三种情况：查询主键Col2 id为3的记录行数据；这个时候再来看，如果说遍历查询的元素id是3；那么这个时候依然是从上往下进行遍历，一直遍历到列表的最底部；才能将3查找出来；那么这个时候就相当于需要进行一个全表扫描的这样一个操作；对于当前该表当中只有6、7条数据；但是如果在实际开发当中数据量比较大；一张表当中存储了几百万上千万的记录；那么这个时候如果只有表中的记录，而没有索引的话；这个时候就会造成一种现象，在查找的时候从上往下进行整表扫描，所以这种查询效率是非常慢的；  </p>
<p>以上就是第一种情况，即没有建立索引的情况；查询效率很慢；  </p>
<p>下面分析有了索引之后，又是如何进行查找的；<br>此时有了表结构还需要对表结构当中的字段进行建立索引；索引就是一种数据结构；那么此时就可以使用数据结构来表示这种表当中的索引；这里使用一种数据结构二叉树；  </p>
<p>既然是二叉树；那么二叉树当中的第一个结点，也就是34；即根节点；34即作为当前该树状结构的根结点；<br>接下来第二行记录是77；对于二叉树来说，二叉树有一个特点；即当根结点已经存在的时候，再插入下一个结点；则需要将下一个结点的数值与根结点的数值进行比较大小；如果比根结点小则放在左边，称之为生成一个左子树；如果比根结点大则放在右边，称之为生成一个右子树，作为右子树存在；这个时候77是比34要大的，所以放在34的右边，即77为34根结点的一个子节点；<br>接下来第三行是5，需要对5也要进行插入到二叉树该数据结构当中，那么此时也是需要进行与34根结点进行比较的；此时5比34要小；那么则放在根结点34的左边，所以此时34根结点又有一个子节点5；<br>当5插入到二叉树结构当中之后，接着下一行记录91；则首先将91与34根结点进行比较大小；显然91比34要大，则处于根结点34的右边；当前使用的是二叉树的这种数据结构，也就意味着每一个结点最多都只能有2个分支；所以称之为二叉树；所以当此时34根结点已经有了两个分支之后，那么此时91比34大，但是34的右边已经有元素77了，所以这个时候91就需要去和77去进行比较；77与91进行比较，91显然要大，所以放在77的右侧，作为77的一个右子节点存在；<br>接下来是第5行记录数据集22；22比34小，显然要放在根结点的左侧；但是根结点的左侧已经有左子节点也就是5；那么此时22就去与5进行比较，显然22比5大；也就放在5的右边；称为5的右子结点；<br>最后还剩下最后两条记录，一个是59一个是3；快速过一下；59首先和34这个元素进行比较；显然59比34大需要放在34的右侧；然34已经有右子结点77了，那么这个时候59和77进行比较；显然77大于59，那么这个时候就将59放置在77的左侧，叶子结点91的左边，成为77的左子节点；同理最后一个元素，3也是同样的方式；3与34进行比较；显然3比34要小；然此时34是存在有左子节点5的；那么这个时候就将3与5进行比较；显然3比5要小；那么这个时候；就把3放在5的左侧；成为5的左子节点，叶子结点22的左侧；<br>此时到此为止二叉树已经构建完毕；二叉树构建完毕之后再来进行分析；构建了一棵二叉树之后就能够提高查询效率吗？<br>（我认为；在二叉树一定的深度下，二叉树依然会存在查询效率慢的情况；）<br>二叉树构建好了之后，再来进行搜索；如果按照刚才的查询情况；先进行搜索34这一数值；搜索二叉树；那么就需要到索引的结构二叉树的数据结构当中来进行搜索；在进行二叉树搜索的时候，是从根结点处开始进行查询匹配数值；即树状结构当中最顶层的这一节点即为根结点；最底层的结点，即3、22、59、91这四个结点称之为叶子结点；那么二叉树的搜索是从根节点开始进行搜索的；走根结点34；这个时候就已经将34查询到了，那么这个时候就可以直接进行返回即可；但是如果这一块当中查询的并不是34而是3；那么此时仍然先会去搜索根结点34，将要查询搜索的值3去与根节点34进行比较；发现3比根结点要小；所以此时就会去根结点的左侧，即左子树当中去进行查找3；二叉树当中根结点的左边的称之为左子树；右边则称之为右子树；那么在左子树当中通过3去跟根结点的左子节点5进行比较，那么此时5比3要大；所以紧接着，让3去跟结点5的左子节点3去进行比较；所以在这个时候就找到了3这个元素；<br>而找到了3之后，二叉树的这种数据结构是如何关联到表当中具体行数当中的具体数据的呢？<br>这个时候就需要看笔记当中提到的一句话：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</span><br></pre></td></tr></table></figure>

<p>那也就意味着，二叉树这种数据结构当中的每一个结点都是需要指向具体表当中具体行数的具体数据；<br>那么从刚才的查询规律当中从上而下进行查找3，则从根结点34到左子节点5，再从5到5的左子节点3查找到了3这一元素的指向/引用即可找到在具体某表当中的具体某一行的数据；那么这样的话就查找到了数据；  </p>
<table>
  <tr>
    <td>物理地址</td>
    <td>Col1</td>
    <td>Col2</td>
  </tr>
  <tr>
    <td>0x07</td>
    <td>1</td>
    <td>34</td>
  </tr>
  <tr>
    <td>0x56</td>
    <td>2</td>
    <td>77</td>
  </tr>
  <tr>
    <td>0x6A</td>
    <td>3</td>
    <td>5</td>
  </tr>
  <tr>
    <td>0xF3</td>
    <td>4</td>
    <td>91</td>
  </tr>
  <tr>
    <td>0x90</td>
    <td>5</td>
    <td>22</td>
  </tr>
  <tr>
    <td>0x77</td>
    <td>6</td>
    <td>59</td>
  </tr>
  <tr>
    <td>0xD1</td>
    <td>7</td>
    <td>3</td>
  </tr>
</table>

<blockquote>
<p>分析：没有建立索引的表与建立了索引的表当中，建立了索引之后性能的一个提升；</p>
</blockquote>
<ul>
<li><p>没有建立索引的表：在没有建立索引的情况下，如果是要进行查询数据元素3；那么则需要把整张表当中所有的数据都需要进行遍历一遍即全表扫描，直到找到3这个id数据；  </p>
</li>
<li><p>建立了索引的表：如果是在建立了索引的这种情况之下；那么同样还是查找元素3；只需要查找第一次34；第二次5；第三次3即可；三次即可；那么这样的话这个时候通过索引由二叉树这种数据结构实现的话就不再需要去遍历整张表的数据了；通过二叉树这种数据结构就可以快速的定位到3这个查询的数据元素；那么这就是索引；索引的目的即在于快速的来查找数据；  </p>
</li>
</ul>
<h2 id="索引-优势和劣势"><a href="#索引-优势和劣势" class="headerlink" title="索引 - 优势和劣势"></a>索引 - 优势和劣势</h2><blockquote>
<p>优势<br>1） 类似于书籍的目录索引，提高数据检索的效率，降低数据库的IO成本；<br>2） 通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗；  </p>
</blockquote>
<blockquote>
<p>劣势<br>1）实际上索引也是一张表，该表中保存了主键与索引字段，并指向实体类的记录，索引列也是要占用空间的；（并不放在内存当中而是放在磁盘当中，索引占用磁盘空间）<br>2）虽然索引大大提高了查询效率，同时却也降低了更新表的速度，如对表进行INSERT、UPDATE、DELETE（都需要对索引进行维护，也就是相关实现该索引的数据结构当中存储的数据也要进行变动）。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件每次更新添加了索引列的字段，都会因为更新所带来的的键值变化后的索引信息。（所以索引的字段并不是越多越好也会影响到性能）  </p>
</blockquote>
<h2 id="索引-索引结构"><a href="#索引-索引结构" class="headerlink" title="索引 - 索引结构"></a>索引 - 索引结构</h2><p>索引是在MySQL的存储引擎层中实现的，而不是在服务器层实现的。  </p>
<p>所以每种存储引擎的索引都不一定完全相同；也不是所有的存储引擎都支持所有的索引类型。  </p>
<p>MySQL目前提供了以下4中索引：  </p>
<ul>
<li>BTREE索引：最常见的索引类型，大部分索引都支持B树索引；</li>
<li>HASH索引：只有Memory引擎支持，使用场景简单（刚刚看了下我当前MySQL数据库现在InnoDB也支持HASH哦）；</li>
<li>R-tree索引（空间索引）：空间索引是MyISAM引擎的一个特殊索引类型，主要用于地理空间数据类型，通常使用较少，不做特别介绍；</li>
<li>Full-text（全文索引）：全文索引也是MyISAM的一个特殊索引类型，主要用于全文索引，InnoDB从MySQL5.6版本开始支持全文索引；  </li>
</ul>
<p>这个统计应该也有些时候了；不是一定正确的哦；需要结合当前不同版本的MySQL来说明；我还是贴一下吧；  </p>
<h3 id="MyISAM、InnoDB、Memory三种存储引擎对各种索引类型的支持"><a href="#MyISAM、InnoDB、Memory三种存储引擎对各种索引类型的支持" class="headerlink" title="MyISAM、InnoDB、Memory三种存储引擎对各种索引类型的支持"></a>MyISAM、InnoDB、Memory三种存储引擎对各种索引类型的支持</h3><table>
  <tr>
    <th>索引</th>
    <th>InnoDB引擎</th>
    <th>MyISAM引擎</th>
    <th>Memory引擎</th>
  </tr>
  <tr>
    <td>BTREE索引</td>
    <td>支持</td>
    <td>支持</td>
    <td>支持</td>
  </tr>
  <tr>
    <td>HASH索引</td>
    <td>不支持</td>
    <td>不支持</td>
    <td>支持</td>
  </tr>
  <tr>
    <td>R-tree索引</td>
    <td>不支持</td>
    <td>支持</td>
    <td>不支持</td>
  </tr>
  <tr>
    <td>Full-text索引</td>
    <td>5.6版本之后支持</td>
    <td>支持</td>
    <td>不支持</td>
  </tr>
</table>

<p>平常所说的索引，如果没有特别指明，都是指B+树（多路搜索树，并不一定是二叉的）结构组织的索引。<br>其中聚集索引、复合索引、前缀索引、唯一索引默认都是使用B+tree树索引，统称为索引。  </p>
<h2 id="索引-索引结构-BTREE"><a href="#索引-索引结构-BTREE" class="headerlink" title="索引 - 索引结构 - BTREE"></a>索引 - 索引结构 - BTREE</h2><p>BTree又叫做多路平衡搜索树，一棵 m 叉的 BTree 特性如下：  </p>
<ul>
<li>树中每个结点最多包含 m 个孩子；</li>
<li>除根结点与叶子结点外，每个结点至少有[ cell ( m / 2 ) ]（cell向上取整）个孩子；</li>
<li>若根结点不是叶子结点，则至少有两个孩子；</li>
<li>所有的叶子结点都在同一层；</li>
<li>每个非叶子结点由 n 个 key 与 n + 1 个指针组成，其中[ cell ( m / 2 ) -1 ] &lt; = n &lt; =  m - 1</li>
</ul>
<p>（对于二叉树来说，树中的每个结点最多有2个分支）  </p>
<p>以5叉BTree为例（当前根结点下最多有5个分支，即每个结点下最多包含5个孩子），key的数量：公式推导[ cell ( m / 2 ) - 1 ] &lt; = n &lt; = m-1 ；所以 2 &lt; = n &lt; = 4。<br>当n&gt;4时，中间节点分裂到父节点，两边结点分裂。<br>插入 C N G A H E K Q M F W L T Z D P R X Y S 数据为例；<br>1）插入前4个字母C N G A；  </p>
<table border="1">
  <tr>
    <td>A</td>
    <td>C</td>
    <td>G</td>
    <td>N</td>
  </tr>
</table>

<p>（按照26个字母排队顺序，字母A在C前，C排在G前，G排在N前的顺序进行排列）  </p>
<p>2）插入H ，n &gt; 4，中间元素G字母向上分裂到新的结点；  </p>
<table border="1">
  <tr>
    <td>A</td>
    <td>C</td>
    <td>G</td>
    <td>H</td>
    <td>N</td>
  </tr>
</table>

<p>所以演变成中间元素G字母向上分裂到新的结点，即G分裂到父节点；</p>
<table border="1">
<tr>
     <td colspan="5" style="text-align:center">G</td>
  </tr>
  <tr>
    <td>A</td>
    <td>C</td>
    <td></td>
    <td>H</td>
    <td>N</td>
  </tr>
</table>

<br>

<table border="1">
  <tr>
     <td></td>
    <td></td>
      <td></td>
     <td colspan="2" style="text-align:center;background-color:lightblue;color:black;">G</td>
     <td></td>
     <td></td>
    <td></td>
  </tr>
  <tr>
     <td></td>
    <td></td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
     <td></td>
    <td></td>
  </tr>
  <tr>
    <td colspan="8"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C</td>
    <td></td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span> N</td>
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>新插入的H结点会在元素G之后，那么排序也就是 A C G H N 这个样子的一个排序；那么此时的中间的结点就是G元素了；那么按照规则，当n&gt;4时，中间节点分裂到父节点；此时的G元素结点就将会进行一次分裂；分裂至父节点（H插入至BTree则G分裂至父节点）；而此时两边结点进行一次分裂；也就是原本的中间元素中间节点G左边的A、C以及右边的（新插入的）H、N就将会被分裂成父节点G的两边结点；左边的A、C分裂至父节点G的左子节点；右边的H、N分裂至父节点G的右子结点；  </p>
<p>接下来继续进行插入操作；插入元素E；<br>插入的E首先进行跟根结点G进行比较前后顺序；比较完成之后，E应该是在根结点G的排位在前的；所以应该被放在根结点G的左侧；也就是结点A、C该侧，A、C、E这三个元素也是需要进行排出一个顺序来的，那么也就是A、C、E这样的一个顺序排列放置；插入的是左边；由于左边元素未构成5个，所以不做任何的（分裂）变化等；  </p>
<p>接下来再继续插入元素K；<br>在K插入元素的时候就需要拿G与K元素的前后排位顺序进行比较，K的排位顺序比G大，所以插入到根结点G的右侧，也就是H、N所在该侧；插入的是右边，即插入时也需要与H、N这两个元素相进行比较排位顺序，也就是K元素插入到H、N这两个元素的中间；那么此时右侧的元素未构成5个所以不作任何变化；  </p>
<p>接下来继续插入Q；<br>插入Q也是需要与根节点G相进行比较排位顺序的；得出Q是在G之后，那么就将Q放在G根节点的右侧，然后将Q进行与节点元素H、K、N相进行比较；得到排列顺序H、K、N、Q这样一个排列顺序，当然此时仍然不需要做出（分裂）变化；因为此时n并没有超过4；只有当n超过4的时候才会发生分裂的变化；分叉小于等于4的情况下并不做任何的分裂改变只进行结点元素间的大小排位；  </p>
<p>在此之前一直在说分裂；当前已经分裂过一次；也就是A、C、G、H、N的时候进行将G分裂至父节点；A、C结点与H、N结点进行两边结点的分裂；并且插入了三个新的元素E、K、Q；  </p>
<p>此时需要说明的是：  </p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">每个非叶子结点由 n 个 <span class="type">key</span> 与 n + <span class="number">1</span> 个指针组成，其中[ cell( m / <span class="number">2</span>) <span class="number">-1</span> ] &lt; = n &lt; = m<span class="number">-1</span></span><br></pre></td></tr></table></figure>

<p>n+1个指针值的就是每个结点下都有两个方块，这两个方块都是指针存储区域；<br>指针的含义：当进行插入一个元素的时候，比如说插入元素E；当插入E元素的时候会进行与根节点G进行一个前后顺序排位的一个对比；如果E比G要小；那么E元素就需要放在G的左侧，指向左侧；成为根结点当中的左子节点当中的一个；那么这个时候就由G结点的左指针指向左子节点的方向；通过左边的这个指针指向左边的这个数据块；小于G那么这个指针就指向的是小于G的这个数据块（也就是左侧的左子结点）；大于G那么指向的就是大于G的这个数据块（也就是右侧的右子结点）；  </p>
<p>即</p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="2" style="text-align:center;background-color:lightblue;color:black;">G</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
  </tr>
  <tr>
    <td colspan="11"></td>
  </tr>
  <tr>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C<span style="margin-left:5px;margin-right:5px;"></span> E</td>
    <td></td>
    <td></td>
    <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> N <span style="margin-left:5px;margin-right:5px;"></span> Q</td>
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>接下来继续插入M元素；M与G根结点相进行比较，应该是属于在G的后面的；所以应该排放在G的右侧；通过G的右指针指向右边的数据块；M插入进来之后，应该要介于K和N之间；也就是说此时G的右子结点当中的排列顺序为H、K、M、N、Q这样一个排列顺序；这个时候就需要将M插入到K和N之间；但是当M插入到K和N之间之后，此时右子结点当中的元素已经超过了4个，即5个了；超过4个元素那么此时就要发生分裂变化，M结点刚好是中间节点；即会要发生中间节点（新插入的元素）M结点元素最终需要向上分裂到G父节点当中去，以及同时左右两边的元素H、K以及H、Q需要分裂变化成两块；  </p>
<p>问题：明白没有？小朋友？<br>答：明白了！(ಥ_ಥ)  </p>
<p>经过分裂之后再来看其指针；那么根结点当中的三个指针分别指的是；第一个指针指的是小于根节点当中的G元素则指针指向左侧第一个数据元素块A、C、E；第二个指针，则因为根节点当中存在两个元素；所以中间这个第二个指针用于大于根节点当中的G元素而小于根节点当中的M元素则指向中间的H、K的这个数据块；最后根节点当中的第三个指针用于大于根节点当中M元素的指向第三个数据元素块即N、Q；  </p>
<p>问题：明白？小朋友？<br>答：明白了！o(ﾟДﾟ)っ！  </p>
<p>当前为插入M的数据结构；  </p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">G<span style="margin-left:5px;margin-right:5px;"></span> M</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="14"></td>
  </tr>
  <tr>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C<span style="margin-left:5px;margin-right:5px;"></span> E</td>
    <td></td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    N <span style="margin-left:5px;margin-right:5px;"></span> Q</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>当前M插入完成之后，继续插入F、W、L、T这四个数据元素；<br>那么此时插入F、W、L、T这四个数据元素时是不需要进行分裂变化的；因为当这四个元素插入进来之后，各个数据块当中的key 结点都没有超过4；所以是不需要进行分裂变化处理的；  </p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">G<span style="margin-left:5px;margin-right:5px;"></span> M</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="18"></td>
  </tr>
  <tr>
    <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C<span style="margin-left:5px;margin-right:5px;"></span> E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    N <span style="margin-left:5px;margin-right:5px;"></span> Q<span style="margin-left:5px;margin-right:5px;"></span> T<span style="margin-left:5px;margin-right:5px;"></span> W</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>上述F、W、L、T这四个元素插入完成之后，接着插入元素Z；<br>插入Z的时候，首先会进行与根节点的G和M相进行比较；Z元素比G、M都要大；所以就由根结点的第三个指针指向第三个数据块，也就是N、Q、T、W；走向第三个数据块时又会与第三个数据块当中的元素相进行比较得到其元素排列顺序N、Q、T、W、Z这样一个排列摆放位置；所以此时将Z插入第三个数据块当中的最后一个位置，当Z元素出现在W元素之后的时候，此时观察第三个数据库块当中的元素个数已经超过了4，即已经成为5个了，那么此时这5个元素当中中间元素需要进行向上分裂，分裂至父节点，然后其左右两边需要分裂成两个数据块；该第三个数据块当中的中间元素为T；T元素此时应当符合条件需要分裂至上一节点父节点当中去；以及T元素在分裂至父节点之前原来两边的结点需要进行分裂成两块也就是N、Q结点以及W、Z结点这两大块进行分裂开来称为单独的结点；</p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">G<span style="margin-left:5px;margin-right:5px;"></span> M<span style="margin-left:5px;margin-right:5px;"></span> T</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="20"></td>
  </tr>
  <tr>
    <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C<span style="margin-left:5px;margin-right:5px;"></span> E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    N <span style="margin-left:5px;margin-right:5px;"></span> Q<span style="margin-left:5px;margin-right:5px;"></span> 
    </td>
    <td></td>
<td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>当元素Z插入完成之后，接下来进行插入元素D；<br>元素D和根结点当中的G、M、T相比，显然是都小于这三者的；所以由根结点当中的第一个指针进行指向第一个数据块，也就是A、C、E、F这个数据块当中来；并且D元素需要进行与数据块元素当中的A、C、E、F这四个元素需要进行比较排序顺序大小；即通过排序顺序可得A、C、D、E、F；插入进来之后，此时该数据块当中的key元素大于4个了，即出现了5个；那么此时就需要将该数据块元素当中的那个中间元素（D作为该数据块当中的中间元素存在），也就是刚刚新插入的元素D进行向上分裂至父节点G、M、T当中去，且分裂至父节点的元素D也需要与G、M、T进行一个排序，排序得到D、G、M、T这样一个排列顺序；那么此时分裂至父节点的元素D的两边的元素同样也需要进行分裂成两个结点；即A、C与E、F进行分裂开来；<br>最终出现的数据结构：  </p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">D<span style="margin-left:5px;margin-right:5px;"></span> G<span style="margin-left:5px;margin-right:5px;"></span> M<span style="margin-left:5px;margin-right:5px;"></span> T</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="22"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C
    </td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    N <span style="margin-left:5px;margin-right:5px;"></span> Q<span style="margin-left:5px;margin-right:5px;"></span> 
    </td>
    <td></td>
<td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>当元素D插入完成之后，接着进行插入元素P、R、X、Y；<br>插入P、R、X、Y时并不需要进行相应的变化分裂；因为插入到数据块当中元素key并没有满足 &gt; 4 的这样一个条件；所以并不需要做出分裂；  </p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">D<span style="margin-left:5px;margin-right:5px;"></span> G<span style="margin-left:5px;margin-right:5px;"></span> M<span style="margin-left:5px;margin-right:5px;"></span> T</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="26"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C
    </td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    N<span style="margin-left:5px;margin-right:5px;"></span> P<span style="margin-left:5px;margin-right:5px;"></span> Q<span style="margin-left:5px;margin-right:5px;"></span> R</td>
    <td></td>
<td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> X<span style="margin-left:5px;margin-right:5px;"></span> Y<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>当插入元素P、R、X、Y这四个元素之后，接下来进行插入最后一个元素S；<br>S首先和根结点当中的是个元素D、G、M、T进行比较；显然介于M与T之间；即大于M而小于T这样一个范围；从而使得根结点的第四个指针指向第四个数据块，即N、P、Q、R这一个数据块当中；而当S插入到第四个数据块当中首先也是需要进行比较排序顺序大小的；有顺序可得；得到顺序为N、P、Q、R、S这样一个顺序排列；将S插入到该数据块当中来；此时第四个数据块当中的元素个数已经达到了5个，也就是超过了4个就需要进行分裂了；那么此时；该数据块当中的中间元素为Q；也就是Q元素需要进行向上分裂至父节点D、G、M、T该数据块当中去；以及Q元素两边的元素需要进行分裂，也就是N、P与R、S这两块分裂开来；<br>但是Q如果此时向上进行分裂，而此时父节点当中的元素对向上分裂来的Q元素进行排序得到D、G、M、Q、T；父节点插入元素Q；父节点当中的元素也达到了了5个；也需要进行分裂；其父节点当中的中间元素为M元素，则此时M元素继续向上进行分裂，则M更新称为该BTree的根节点；而M两边的元素，即D、G两元素与Q、T两元素则这两块进行分裂开来，D、G块称为根结点M的左子节点，Q、T块称为M根结点的右子结点；这就是所提到的五叉BTree结构的一个演变过程；</p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="2" style="text-align:center;background-color:lightblue;color:black;">M</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">D<span style="margin-left:5px;margin-right:5px;"></span>  G
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    Q <span style="margin-left:5px;margin-right:5px;"></span> T</td>
    
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C
    </td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    N<span style="margin-left:5px;margin-right:5px;"></span> P</td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">R<span style="margin-left:5px;margin-right:5px;"></span> S</td>
    <td></td>
<td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> X<span style="margin-left:5px;margin-right:5px;"></span> Y<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>了解了五叉BTree数据结构的一个演变过程之后回过头来再看；一棵m叉的BTree特性；<br>如果是一个五叉的BTree；<br>则：  </p>
<ul>
<li>树中每个结点最多包含m个孩子；即树中每个结点最多包含5个孩子；不能多于5个，即不能多于m个；  </li>
</ul>
<blockquote>
<p>举例</p>
</blockquote>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">D<span style="margin-left:5px;margin-right:5px;"></span> G<span style="margin-left:5px;margin-right:5px;"></span> M<span style="margin-left:5px;margin-right:5px;"></span> T</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="26"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C
    </td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    N<span style="margin-left:5px;margin-right:5px;"></span> P<span style="margin-left:5px;margin-right:5px;"></span> Q<span style="margin-left:5px;margin-right:5px;"></span> R</td>
    <td></td>
<td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> X<span style="margin-left:5px;margin-right:5px;"></span> Y<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>


<ul>
<li>除根结点与叶子结点外，每个结点至少有 [ cell( m / 2 )]个孩子；即每个结点至少有5/2=3（向上取整）个孩子；M为根节点；AC块、EF块、HKL块、NP块、RS块、WXYZ块为叶子结点；所以仅剩DG块与QT块非叶子结点也非根节点；这两块分别有三个字节点，DG块的孩子即AC块、EF块、HKL块；QT块的孩子即NP块、RS块、WXYZ块；  </li>
</ul>
<blockquote>
<p>举例</p>
</blockquote>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="2" style="text-align:center;background-color:lightblue;color:black;">M</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">D<span style="margin-left:5px;margin-right:5px;"></span>  G
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    Q <span style="margin-left:5px;margin-right:5px;"></span> T</td>
    
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C
    </td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    N<span style="margin-left:5px;margin-right:5px;"></span> P</td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">R<span style="margin-left:5px;margin-right:5px;"></span> S</td>
    <td></td>
<td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> X<span style="margin-left:5px;margin-right:5px;"></span> Y<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>


<ul>
<li>若根结点不是叶子结点，则至少有两个孩子；</li>
</ul>
<blockquote>
<p>举例</p>
</blockquote>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="2" style="text-align:center;background-color:lightblue;color:black;">M</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">D<span style="margin-left:5px;margin-right:5px;"></span>  G
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    Q <span style="margin-left:5px;margin-right:5px;"></span> T</td>
    
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C
    </td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    N<span style="margin-left:5px;margin-right:5px;"></span> P</td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">R<span style="margin-left:5px;margin-right:5px;"></span> S</td>
    <td></td>
<td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> X<span style="margin-left:5px;margin-right:5px;"></span> Y<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<ul>
<li>所有的叶子结点都在同一层；</li>
</ul>
<blockquote>
<p>举例</p>
</blockquote>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="2" style="text-align:center;background-color:lightblue;color:black;">M</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">D<span style="margin-left:5px;margin-right:5px;"></span>  G
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    Q <span style="margin-left:5px;margin-right:5px;"></span> T</td>
    
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td><td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td colspan="28"></td>
  </tr>
  <tr>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C
    </td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">
    N<span style="margin-left:5px;margin-right:5px;"></span> P</td>
    <td></td>
    <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">R<span style="margin-left:5px;margin-right:5px;"></span> S</td>
    <td></td>
<td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    W<span style="margin-left:5px;margin-right:5px;"></span> X<span style="margin-left:5px;margin-right:5px;"></span> Y<span style="margin-left:5px;margin-right:5px;"></span> Z</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
      <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>


<ul>
<li>每个非叶子结点由n个key与n+1个指针组成；其中[ cell( m / 2)-1] &lt; = n &lt; = m - 1；即</li>
</ul>
<p>key即指的每一个结点当中的元素；指针即用来指向数据块</p>
<table border="1">
  <tr>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td colspan="3" style="text-align:center;background-color:lightblue;color:black;">G<span style="margin-left:5px;margin-right:5px;"></span> M</td>
     <td></td>
    <td></td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td></td>
    <td></td>
     <td></td>
     <td></td>
     <td></td>
  </tr>
  <tr>
    <td colspan="18"></td>
  </tr>
  <tr>
    <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">A<span style="margin-left:5px;margin-right:5px;"></span> C<span style="margin-left:5px;margin-right:5px;"></span> E<span style="margin-left:5px;margin-right:5px;"></span> F</td>
    <td></td>
    <td></td>
    <td colspan="4" style="text-align:center;background-color:lightblue;color:black;">H<span style="margin-left:5px;margin-right:5px;"></span>  K<span style="margin-left:5px;margin-right:5px;"></span> L
    </td>
    <td></td>
    <td></td>
      <td colspan="5" style="text-align:center;background-color:lightblue;color:black;">
    N <span style="margin-left:5px;margin-right:5px;"></span> Q<span style="margin-left:5px;margin-right:5px;"></span> T<span style="margin-left:5px;margin-right:5px;"></span> W</td>
    
  </tr>
  <tr>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td></td>
    <td></td>
    <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
    <td></td>
    <td></td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
     <td style="background-color:lightgreen;color:black;">指针</td>
  </tr>
</table>

<p>到此已经提到了两种数据结构，一种是二叉树；一种是BTree；这两个数据结构可以拿过来相互比较一下优劣；  </p>
<p>BTree数据结构相对于二叉树相比；存在有多个分支；而二叉树一个结点仅仅只存在有两个结点；那么对于相同数据量来说，二叉树的数据层次，也就是二叉树的深度要更高一些；一旦层次更深也就意味着查找数据的时候；磁盘的IO的次数也就更多；从而导致查询的效率也就比较低；<br>到此，该BTree树就已经构建完成了，BTREE树和二叉树相比，查询数据的效率更高，因为对于相同的数据量来说，BTREE的层次结构相比二叉树小，因此搜索速度更快；  </p>
<h2 id="索引-索引结构-B-TREE"><a href="#索引-索引结构-B-TREE" class="headerlink" title="索引 - 索引结构 - B+TREE"></a>索引 - 索引结构 - B+TREE</h2><p>B+Tree为BTree的变种，B+Tree与BTree的区别为：<br>1） n叉B+Tree最多含有n个key，而BTree最多含有n-1个key；<br>2） B+Tree的叶子结点保存所有的key信息，依照key大小顺序排列；<br>3） 所有的非叶子结点都可以看做是key的索引部分；  </p>
<p>没有子节点的结点称之为叶子结点；叶子结点当中包含了所有key的信息；叶子结点当中的key才是完整的包含了所有的key的信息；包含了所有的数据信息；根结点当中以及非叶子结点当中的key起到的是一个索引的作用；索引就是为了查找到叶子结点当中的key；而且对于B+树来说所有的数据都是存储在叶子结点上面了；非叶子结点是不存在数据信息的；B树当中的所有数据是跟结点挂钩的；B+树当中所有的key存储在叶子结点所有的数据也都存储在叶子结点上了；<br>这也是B+树与B树的一个区别；  </p>
<p>B+Tree相对于BTree的一个优势：<br>由于B+Tree只有叶子结点保存key信息，查询任何key都要从root走到叶子（非叶子结点上的key都是起到一个索引的作用并没有数据，叶子结点上的key才关联着相关的数据信息），所以B+Tree的查询效率更加稳定；  </p>
<h2 id="索引-索引结构-MySQL中的B-Tree"><a href="#索引-索引结构-MySQL中的B-Tree" class="headerlink" title="索引 - 索引结构 - MySQL中的B+Tree"></a>索引 - 索引结构 - MySQL中的B+Tree</h2><p>MySQL索引数据结构对经典的B+Tree进行了优化。<br>在原B+Tree的基础上，增加一个指向相邻叶子结点的链表指针，就形成了带有顺序指针的B+Tree，提高区间访问的性能；<br>问题：为什么要增加这样一个指针？<br>答：方便进行查询；  </p>
<blockquote>
<p>增加该指针的原因在于：方便进行范围搜索；  </p>
</blockquote>
<p>举例：如果想要进行搜索id为9~15的数据；由于有该指针相连所以从9一直查询链表下一结点到15即可；<br>所以该链表指针的作用主要是用来提高区间访问的性能；  </p>
<h2 id="索引-索引分类"><a href="#索引-索引分类" class="headerlink" title="索引 - 索引分类"></a>索引 - 索引分类</h2><p>1） 单值索引：即一个索引值包含单个列，一个表可以有多个单列索引(一个索引当中只包含一个列；比如现在需要对某一张表当中建立索引；该表当中有多个字段name、gender、age、help_category_id等字段，但是只针对name该字段该列进行建立索引；help_category_id也可以建立个索引；则当前存在两个索引，但是每个索引只对应了相对应的一列；这个叫做单列索引或者是单值索引；一个表当中可以包含有多个单列索引)<br>2） 唯一索引：索引列的值必须唯一，但允许有空值；（当前表当中某一个字段或者是某一列当中其值都是唯一的；也就是说如果存在有列当中的值都是唯一的；那么必要情况下就可以针对该列建立一个唯一索引，在唯一索引的该列当中允许包括有多个NULL值；）<br>3） 复合索引：即一个索引包含多个列（比如：经常在查询当中需要对name字段以及parent_category_id或者是说age字段进行联合查询，那么此时可以将name字段以及age字段组合起来建立一个复合索引，即一个索引当中包含了两个列或者说多个列；那么这种索引称之为复合索引）；  </p>
<h2 id="索引-索引语法"><a href="#索引-索引语法" class="headerlink" title="索引 - 索引语法"></a>索引 - 索引语法</h2><p>索引在创建表的时候，可以同时创建，也可以随时增加新的索引；<br>准备环境：  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> demo_01 <span class="keyword">default</span> charset=utf8mb4;</span><br><span class="line"></span><br><span class="line">use demo_01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">'city'</span>(</span><br><span class="line">    <span class="string">'city_id'</span> <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT;</span><br><span class="line">    <span class="string">'city_name'</span> <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line">    <span class="string">'country_id'</span> <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (<span class="string">'city_id'</span>)</span><br><span class="line">)ENGINE=InnoDB <span class="keyword">DEFAULT</span> CHARSET=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">'country'</span>(</span><br><span class="line">    <span class="string">'country_id'</span> <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT;</span><br><span class="line">    <span class="string">'country_name'</span> <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (<span class="string">'country_id'</span>)</span><br><span class="line">)ENGINE=InnoDB <span class="keyword">DEFAULT</span> CHARSET=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'city'</span>(<span class="string">'city_id'</span>,<span class="string">'city_name'</span>,<span class="string">'country_id'</span>) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">'西安'</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'city'</span>(<span class="string">'city_id'</span>,<span class="string">'city_name'</span>,<span class="string">'country_id'</span>) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">'NewYork'</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'city'</span>(<span class="string">'city_id'</span>,<span class="string">'city_name'</span>,<span class="string">'country_id'</span>) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">'北京'</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'city'</span>(<span class="string">'city_id'</span>,<span class="string">'city_name'</span>,<span class="string">'country_id'</span>) <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">'上海'</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'country'</span>(<span class="string">'country_id'</span>,<span class="string">'country_name'</span>) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">'China'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'country'</span>(<span class="string">'country_id'</span>,<span class="string">'country_name'</span>) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">'America'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'country'</span>(<span class="string">'country_id'</span>,<span class="string">'country_name'</span>) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">'Japan'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">'country'</span>(<span class="string">'country_id'</span>,<span class="string">'country_name'</span>) <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">'UK'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><p>语法：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [ <span class="keyword">UNIQUE</span> | <span class="keyword">FULL</span> <span class="built_in">TEXT</span> |SPATIAL] <span class="keyword">INDEX</span> index_name</span><br><span class="line">[ <span class="keyword">using</span> index_type ]</span><br><span class="line"><span class="keyword">ON</span> tb1_name(index_col_name, .... )</span><br><span class="line"></span><br><span class="line">index_col_name : column_name[ ( <span class="keyword">length</span> ) ] [ <span class="keyword">ASC</span> | <span class="keyword">DESC</span> ]</span><br></pre></td></tr></table></figure>

<p>索引的类型：UNIQUE唯一索引、FULLTEXT全文索引、SPATIAL；索引类型可选；可以不进行指定；<br>index_name：索引的名称；<br>using index_type：索引所使用的哪一个类型；如果不指定；则使用，默认的索引类型即B+树索引类型；<br>ON tb1_name(index_col_name, ….)：进行指定对哪一张表的哪几个字段创建索引；  </p>
<p>在MySQL当中，如果当前该字段是主键的话；则默认该字段默认有一个索引叫做主键索引；  </p>
<p>所以此时在city表当中对city_id字段的索引不必再进行创建；可以在city_name字段上创建索引；  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> index_city_name <span class="keyword">on</span> city(city_name);<span class="comment">#此时在city_name字段上创建的该索引为普通索引；</span></span><br></pre></td></tr></table></figure>

<p>示例：为city表中的city_name 字段创建索引：  </p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> idx_city_name <span class="keyword">on</span> city(city_name);</span><br></pre></td></tr></table></figure>

<h3 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h3><p>语法：  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> <span class="built_in">table_name</span>; #<span class="built_in">table_name</span>，索引所建立在该字段，该字段所处的表的名称</span><br></pre></td></tr></table></figure>

<p>示例：查看city表中的索引信息：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> city\G; <span class="comment">#\G格式化</span></span><br></pre></td></tr></table></figure>

<p>在MySQL当中会默认对主键city_id字段创建一个索引就称作是主键索引key_name：primary；<br>而刚刚对city_name创建的索引则为key_name：idx_city_name；<br>主键索引primary以及刚刚没有指定索引类型的idx_city_name的索引类型都是BTREE类型；即B+Tree索引，BTree索引；</p>
<h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><p>语法：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> tb1_name;</span><br><span class="line"><span class="comment"># index_name索引的名称</span></span><br><span class="line"><span class="comment"># 该index_name索引所具体在的表的名称</span></span><br></pre></td></tr></table></figure>

<p>示例：想要删除city表上的索引[ idx_city_name ]，可以操作如下：  </p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">index</span> idx_city_name <span class="keyword">on</span> city;</span><br></pre></td></tr></table></figure>

<p>删除之后可以通过以下命令来进行查看删除的索引是否仍然存在；</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> <span class="built_in">table_name</span>\G;</span><br></pre></td></tr></table></figure>

<h3 id="ALTER指令"><a href="#ALTER指令" class="headerlink" title="ALTER指令"></a>ALTER指令</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># alter 修改</span></span><br><span class="line"><span class="comment"># 该语句添加一个主键，这意味着索引值必须唯一，且不能为NULL；</span></span><br><span class="line">1. <span class="keyword">alter</span> <span class="keyword">table</span> tb_name <span class="keyword">add</span> primary <span class="keyword">key</span>(column_list);</span><br><span class="line"></span><br><span class="line"><span class="comment"># unique 唯一的</span></span><br><span class="line"><span class="comment"># 这条语句创建索引的值必须是唯一的（除了NULL意外，NULL可能会出现多次）</span></span><br><span class="line"><span class="comment"># Non_unique:0 #Non不，unique唯一；0：否定；双重否定等于肯定；即唯一</span></span><br><span class="line"><span class="comment"># 当创建普通索引时其Non_unique:1；即不唯一；  </span></span><br><span class="line">2. <span class="keyword">alter</span> <span class="keyword">table</span> tb_name <span class="keyword">add</span> <span class="keyword">unique</span> index_name(column_list);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加普通索引，索引值可以出现多次</span></span><br><span class="line">3. <span class="keyword">alter</span> <span class="keyword">table</span> tb_name <span class="keyword">add</span> <span class="keyword">index</span> index_name(column_list);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 该语句指定了索引为FULLTEXT，用于全文索引</span></span><br><span class="line">4. <span class="keyword">alter</span> <span class="keyword">table</span> tb_name <span class="keyword">add</span> fulltext index_name(column_list);</span><br></pre></td></tr></table></figure>

<p>示例：添加唯一索引  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> city <span class="keyword">add</span>  <span class="keyword">unique</span>  idx_city_name(city_name);</span><br></pre></td></tr></table></figure>

<h2 id="索引-索引设计原则"><a href="#索引-索引设计原则" class="headerlink" title="索引 - 索引设计原则"></a>索引 - 索引设计原则</h2><p>索引的设计可以遵循一些已有的原则，创建索引的时候请尽量考虑符合这些原则，便于提升索引的使用效率，更高效的使用索引；  </p>
<ul>
<li>对查询频次较高，且数据量比较大的表建立索引；</li>
<li>索引字段的选择，最佳候选列应当从where子句的条件中提取（即查询条件当中的字段），如果where子句中的组合比较多，那么应当挑选最常用、过滤效果最好的列的组合。</li>
<li>使用唯一索引，区分度越高，使用索引的效率越高；</li>
<li>索引可以有效的提升查询数据的效率，但是索引数量不是多多益善；索引越多，维护索引的代价自然也就水涨船高。对于插入、更新、删除等DML操作比较频繁的表来说，索引过多，会引入相当高的维护代价（维护索引的数据结构），降低DML操作的效率，增加响应操作的时间消耗；另外索引过多的话，MySQL也会犯选择困难病，虽然最终仍然会找到一个可用的索引，但是无疑提高了选择的代价；</li>
<li>使用短索引，索引创建之后也是使用硬盘来存储的，因此提升索引访问的I/O效率，也可以提升总体的访问效率。假如构成索引的字段总长度比较短，那么在给定大小的存储块内可以存储更多的索引值，乡音的可以有效地提升MySQL访问索引的I/O效率。</li>
<li>利用最左前缀，N个列组合而成的组合索引，那么相当于是创建了N个索引，如果查询时where子句中使用了组成该索引的前几个字段，那么这条查询SQL可以利用组合索引来提升性能；  </li>
</ul>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">创建复合索引：</span><br><span class="line"></span><br><span class="line">CREATE <span class="built_in">INDEX</span> idx_name_email_status ON tb_seller(<span class="keyword">NAME</span>,email,<span class="keyword">STATUS</span>);</span><br><span class="line"></span><br><span class="line">就相当于</span><br><span class="line">      对<span class="keyword">name</span> 创建了索引；</span><br><span class="line">      对<span class="keyword">name</span> , email 创建了索引；</span><br><span class="line">      对<span class="keyword">name</span> , email , <span class="keyword">status</span> 创建了索引；</span><br><span class="line">只需要创建这么一个索引，在查询<span class="keyword">name</span>单个字段的时候就将会走索引；在查询<span class="keyword">name</span>，email这两个字段的时候也会走索引；在查询<span class="keyword">name</span>,email,<span class="keyword">status</span>这三个字段的时候也会走索引；  </span><br><span class="line">最左索引：最左指的是复合索引当中的第一个字段，只要查询的时候包含第一个字段，那么这个时候就会走索引；</span><br></pre></td></tr></table></figure>

<h2 id="视图-创建及修改视图"><a href="#视图-创建及修改视图" class="headerlink" title="视图 - 创建及修改视图"></a>视图 - 创建及修改视图</h2><p>视图（View）是一种虚拟存在的表。<br>视图并不在数据库中实际存在，行和列数据来自定义视图的查询中使用的表，并且是在使用视图时动态生成的。<br>通俗的讲，视图就是一条SELECT语句执行后返回的结果集。<br>所以在创建视图的时候，主要的工作就落在创建这条SQL查询语句上。  </p>
<p>视图相对于普通表的又是主要包括以下几项：  </p>
<ul>
<li>简单：使用视图的用户完全不需要关心后面对应表的结构、关联条件和筛选条件，对用户来说已经是过滤好的符合条件的结果集。  </li>
<li>安全：使用视图的用户只能访问他们被允许查询的结果喜，对表的权限管理并不能先知道某个行某个列，但是通过视图就可以简单的实现；</li>
<li>数据独立：一旦视图的结构确定了，可以屏蔽表结构变化对用户的影响，源表增加列对视图没有影响；源表修改列名，则可以通过修改视图来解决，不会造成对访问者的影响；</li>
</ul>
<h3 id="创建或者修改视图"><a href="#创建或者修改视图" class="headerlink" title="创建或者修改视图"></a>创建或者修改视图</h3><blockquote>
<p>创建视图的语法为</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [ <span class="keyword">OR</span> <span class="keyword">REPLACE</span>] [ ALGORITHM = &#123; UNDEFINED | <span class="keyword">MERGE</span> | TEMPTABLE &#125; ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">VIEW</span> view_name [ (column_list) ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">AS</span> select_statement</span><br><span class="line"></span><br><span class="line">[ <span class="keyword">WITH</span> [<span class="keyword">CASCADED</span> | <span class="keyword">LOCAL</span> ] <span class="keyword">CHECK</span> <span class="keyword">OPTION</span> ]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>修改视图的语法</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> [ ALGORITHM = &#123; UNDEFINED | <span class="keyword">MERGE</span> | TEMPTABLE &#125; ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">VIEW</span> view_name [ (column_list) ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">AS</span> select_statement</span><br><span class="line"></span><br><span class="line">[ WITE [ <span class="keyword">CASCADED</span> | <span class="keyword">LOCAL</span> ] <span class="keyword">CHECK</span> <span class="keyword">OPTION</span> ]</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">选项：</span><br><span class="line">    <span class="keyword">WITH</span> [ <span class="keyword">CASCADED</span> | <span class="keyword">LOCAL</span>] <span class="keyword">CHECK</span> <span class="keyword">OPTION</span> 决定了是否允许更新数据使记录不在满足视图的条件；</span><br><span class="line">    <span class="keyword">LOCAL</span> 只要满足本视图的条件就可以更新</span><br><span class="line">    <span class="keyword">CASCADED</span> 必须满足所有针对该视图的所有视图的条件才可以更新（默认值）</span><br><span class="line"></span><br><span class="line">    <span class="keyword">CREATE</span> [ <span class="keyword">OR</span> <span class="keyword">REPLACE</span>] 创建或者是替换</span><br><span class="line">    <span class="keyword">AS</span> select_statement select_statement即<span class="keyword">select</span>语句</span><br></pre></td></tr></table></figure>

<p>示例：在视图当中展示国家以及其相关城市的信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>; <span class="comment"># 显示在该数据库下所有的表</span></span><br><span class="line">desc table_name; <span class="comment"># 显示该table_name当中的表结构</span></span><br><span class="line">desc city;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> city c,country t <span class="keyword">where</span> c.country_id=t.country_id;</span><br><span class="line"><span class="keyword">select</span> c.*,t.country_name <span class="keyword">from</span> city c,country t <span class="keyword">where</span> c.country_id=t.country_id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> view_city_country <span class="keyword">as</span> <span class="keyword">select</span> c.*,t.country_name <span class="keyword">from</span> city c,country t <span class="keyword">where</span> c.country_id=t.country_id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> view_city_country;<span class="comment"># 查询视图与表操作一致</span></span><br><span class="line"><span class="keyword">update</span> view_city_country <span class="keyword">set</span> city_name=<span class="string">'西安市'</span> <span class="keyword">where</span> city_id=<span class="number">1</span>;<span class="comment">#修改视图与表操作一致</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> city; <span class="comment"># 这个时候基础表当中的数据也会被更新掉；也就是说此时的视图修改操作是会影响到基础表当中的数据；  </span></span><br><span class="line">虽然视图能够做到更新，但是并不建议去更新数据；因为视图就是用来简化查询操作的，不建议更新视图；</span><br></pre></td></tr></table></figure>

<h2 id="视图-查看及删除视图"><a href="#视图-查看及删除视图" class="headerlink" title="视图 - 查看及删除视图"></a>视图 - 查看及删除视图</h2><h3 id="查看视图"><a href="#查看视图" class="headerlink" title="查看视图"></a>查看视图</h3><p>从MySQL5.1版本开始，使用SHOW TABLES命令的时候不仅会显示表的名字，同时也会显示视图的名字，而不存在单独显示视图的SHOW VIEWS命令。  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;<span class="comment"># 显示表以及视图的名称</span></span><br></pre></td></tr></table></figure>

<p>同样，在使用SHOW TABLE STATUS命令的时候，不但可以显示表的信息，同时也可以显示视图的信息；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">table</span> <span class="keyword">status</span>; <span class="comment"># 显示表以及视图的信息</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">table</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'city_country_view'</span>\G; <span class="comment"># 示例查看视图city_country_view</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">view</span> view_city_country; <span class="comment"># 查看创建视图时所使用的的SQL语句是什么</span></span><br></pre></td></tr></table></figure>

<h3 id="删除视图"><a href="#删除视图" class="headerlink" title="删除视图"></a>删除视图</h3><p>语法：  </p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">DROP</span> <span class="meta">VIEW</span> [ <span class="meta">IF</span> EXISTS ] view_name [, view_name ] ... [ <span class="meta">RESTRICT</span> | <span class="meta">CASCADE</span> ]</span><br></pre></td></tr></table></figure>

<p>示例，删除视图city_country_view:  </p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> city_country_view;# or <span class="keyword">DROP</span> <span class="keyword">VIEW</span> <span class="keyword">if</span> <span class="keyword">exists</span> city_country_view;</span><br></pre></td></tr></table></figure>

<h2 id="存储过程-概述"><a href="#存储过程-概述" class="headerlink" title="存储过程 - 概述"></a>存储过程 - 概述</h2><p>存储过程和函数是实现经过编译并存储在数据库中的一段SQL语句的集合，调用存储过程和函数可以简化应用开发人员的很多工作，减少数据在数据库和应用服务器之间的传输，对于提高数据处理的效率时有好处的。<br>存储过程和函数的区别在于函数必须有返回值，而存储过程没有；<br>函数：是一个有返回值的过程；<br>存储过程：是一个没有返回值的函数；</p>
<h2 id="存储过程-创建调用查询删除语法"><a href="#存储过程-创建调用查询删除语法" class="headerlink" title="存储过程 - 创建调用查询删除语法"></a>存储过程 - 创建调用查询删除语法</h2><h3 id="创建存储过程"><a href="#创建存储过程" class="headerlink" title="创建存储过程"></a>创建存储过程</h3><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">procedure_name</span> <span class="params">( [proc_parameter[,.....]])</span></span></span><br><span class="line"><span class="function"><span class="title">begin</span></span></span><br><span class="line"><span class="function">    -- <span class="title">SQL</span>语句</span></span><br><span class="line"><span class="function"><span class="title">end</span>;</span></span><br></pre></td></tr></table></figure>

<p>示例：  </p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="function"><span class="keyword">procedure</span> <span class="title">pro_test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">begin</span></span></span><br><span class="line"><span class="function">    <span class="title">select</span> '<span class="title">Hello</span> <span class="title">MySQL</span>';</span></span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>

<h4 id="知识小贴士"><a href="#知识小贴士" class="headerlink" title="知识小贴士"></a>知识小贴士</h4><p>DELEMITER<br>    该关键字用来声明SQL语句的分隔符，告诉MySQL解释器，改短命令是否已经结束了，mysql是否可以执行了，默认情况下，delimiter是分号;<br>    在命令行客户端中，如果一行命令以分号结束，那么回车后，mysql将会执行该命令；</p>
<h3 id="调用存储过程"><a href="#调用存储过程" class="headerlink" title="调用存储过程"></a>调用存储过程</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> procedure_name();</span><br></pre></td></tr></table></figure>

<h3 id="查看存储过程"><a href="#查看存储过程" class="headerlink" title="查看存储过程"></a>查看存储过程</h3><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- 查询db_name 数据库中的所有的存储过程</span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> mysql.proc <span class="keyword">where</span> db=<span class="string">'db_name'</span>;</span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> mysql.proc <span class="keyword">where</span> db=<span class="string">'demo_01'</span>$ #示例</span><br><span class="line"></span><br><span class="line">-- 查询存储过程的状态信息</span><br><span class="line">show <span class="function"><span class="keyword">procedure</span> <span class="title">status</span>;</span></span><br><span class="line">show <span class="function"><span class="keyword">procedure</span> <span class="title">status</span>$ # 示例</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">-- 查询某个存储过程的定义</span></span><br><span class="line"><span class="function"><span class="title">show</span> <span class="title">create</span> <span class="title">procedure</span> <span class="title">test</span>.<span class="title">pro_test1</span> \<span class="title">G</span>;</span></span><br><span class="line">show <span class="keyword">create</span> <span class="function"><span class="keyword">procedure</span> <span class="title">pro_test</span>\<span class="title">G</span>$ #示例</span></span><br></pre></td></tr></table></figure>

<h3 id="删除存储过程"><a href="#删除存储过程" class="headerlink" title="删除存储过程"></a>删除存储过程</h3><figure class="highlight cal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DROP <span class="function"><span class="keyword">PROCEDURE</span> [ <span class="title">IF</span> <span class="title">EXISTS</span> ] <span class="title">sp_name</span>;</span></span><br><span class="line"></span><br><span class="line">drop <span class="function"><span class="keyword">procedure</span> <span class="title">pro_test1</span>$ # 示例</span></span><br></pre></td></tr></table></figure>

<h2 id="存储过程-语法-变量"><a href="#存储过程-语法-变量" class="headerlink" title="存储过程 - 语法 - 变量"></a>存储过程 - 语法 - 变量</h2><p>存储过程是可以编程的，意味着可以使用变量，表达式，控制结构，来完成比较复杂的功能。(使得SQL具有过程化语言的处理能力)  </p>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><ul>
<li>DECLARE</li>
</ul>
<p>通过DECLARE可以定义一个局部变量，该变量的作用返回只能在BEGIN…END块中。  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DECLARE var_name[ <span class="built_in">..</span>. ]<span class="built_in"> type </span>[DEFAULT value]</span><br></pre></td></tr></table></figure>

<p>示例：  </p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="function"><span class="keyword">procedure</span> <span class="title">pro_test2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">begin</span></span></span><br><span class="line"><span class="function">    <span class="title">declare</span> <span class="title">num</span> <span class="title">int</span> <span class="title">default</span> 5;</span></span><br><span class="line">    <span class="keyword">select</span> num+ <span class="number">10</span>;</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="function"><span class="keyword">procedure</span> <span class="title">pro_test1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">begin</span></span></span><br><span class="line"><span class="function">    <span class="title">declare</span> <span class="title">num</span> <span class="title">int</span> <span class="title">default</span> 10;</span></span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">concat</span>(<span class="string">'num的值为'</span>,num);</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line">call pro_test1()$</span><br><span class="line">call pro_test2()$</span><br><span class="line"></span><br><span class="line">delimiter $</span><br></pre></td></tr></table></figure>

<ul>
<li>SET</li>
</ul>
<p>直接赋值使用SET，可以赋常量或者赋表达式，具体语法如下：  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">SET</span> var_name = expr [ , <span class="attribute">var_name</span>=expr ] <span class="built_in">..</span><span class="built_in">..</span></span><br></pre></td></tr></table></figure>

<p>示例：  </p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">pro_test3</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">BEGIN</span></span></span><br><span class="line"><span class="function">    <span class="title">DECLARE</span> <span class="title">NAME</span> <span class="title">VARCHAR</span><span class="params">(20)</span>;</span></span><br><span class="line">    <span class="keyword">SET</span> NAME = <span class="string">'MYSQL'</span>;</span><br><span class="line">    <span class="keyword">SELECT</span> NAME ;</span><br><span class="line"><span class="keyword">END</span>$</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">pro_demo</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">begin</span></span></span><br><span class="line"><span class="function">    <span class="title">declare</span> <span class="title">num</span> <span class="title">int</span> <span class="title">default</span> 0;</span></span><br><span class="line">    <span class="keyword">set</span> num = num +<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">select</span> num;</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line">call pro_test3()$</span><br><span class="line">call pro_demo()$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<p>也可以通过 select….into 方式进行赋值操作；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> pro_test5()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> countnum <span class="built_in">int</span>;</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">into</span> countnum <span class="keyword">from</span> city;</span><br><span class="line">    <span class="keyword">select</span> countnum;</span><br><span class="line"><span class="keyword">END</span>$</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> PPROCEDURE pro_demo()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> <span class="keyword">num</span> <span class="built_in">int</span>;</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">into</span> <span class="keyword">num</span> <span class="keyword">from</span> city;</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">concat</span>(<span class="string">'city表中的记录数为'</span>,<span class="keyword">num</span>);</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> pro_test5()$</span><br><span class="line"><span class="keyword">call</span> pro_demo()$</span><br><span class="line"></span><br><span class="line">DELIMITER $</span><br></pre></td></tr></table></figure>

<h2 id="存储过程-语法-if判断"><a href="#存储过程-语法-if判断" class="headerlink" title="存储过程 - 语法 - if判断"></a>存储过程 - 语法 - if判断</h2><h3 id="if条件判断"><a href="#if条件判断" class="headerlink" title="if条件判断"></a>if条件判断</h3><p>语法结构：  </p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> search_condition then statement_list</span><br><span class="line">      [ <span class="keyword">elseif</span> search_condition then statement_list ] ...</span><br><span class="line">      [ <span class="keyword">else</span> statementlist ]</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">if</span>;</span><br></pre></td></tr></table></figure>

<p>需求：  </p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">根据定义的身高变量，判定当前身高的所属的身材类型</span><br><span class="line"></span><br><span class="line"><span class="number">180</span>及以上----------》身材高挑</span><br><span class="line"><span class="number">170</span> ~ <span class="number">180</span>----------》标准身材</span><br><span class="line"><span class="number">170</span>一下------------》一般身材</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">delimiter &amp;</span><br><span class="line">create procedure pro_test4()</span><br><span class="line">begin</span><br><span class="line">    declare height int<span class="built_in"> default </span>175;</span><br><span class="line">    declare description varchar(50)<span class="built_in"> default </span><span class="string">''</span>;</span><br><span class="line">    <span class="keyword">if</span> hegith &gt;= 180 then</span><br><span class="line">      <span class="builtin-name">set</span> <span class="attribute">description</span>=<span class="string">'身材高挑'</span>;</span><br><span class="line">    elseif height &gt;=170 <span class="keyword">and</span> height &lt; 180 then</span><br><span class="line">      <span class="builtin-name">set</span> <span class="attribute">description</span>=<span class="string">'标准身材'</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="builtin-name">set</span> <span class="attribute">description</span>=<span class="string">'一般身材'</span>;</span><br><span class="line">    end <span class="keyword">if</span>;</span><br><span class="line">    select concat(<span class="string">'身高'</span>,height,<span class="string">'对应的身材类型为'</span>,description);</span><br><span class="line">end$</span><br><span class="line"></span><br><span class="line">call pro_test()$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>

<h2 id="存储过程-语法-输入参数"><a href="#存储过程-语法-输入参数" class="headerlink" title="存储过程 - 语法 - 输入参数"></a>存储过程 - 语法 - 输入参数</h2><p><strong>传递参数</strong></p>
<p>语法格式：  </p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="function"><span class="keyword">procedure</span> <span class="title">procedure_name</span><span class="params">([ <span class="keyword">in</span> / <span class="keyword">out</span> / inout ]参数名称 参数类型)</span></span></span><br><span class="line"><span class="function">...</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># <span class="title">IN</span> 该参数可以作为输入，也就是需要调用方传入值，默认</span></span><br><span class="line"><span class="function"># <span class="title">OUT</span> 该参数作为输出，也就是该参数可以作为返回值</span></span><br><span class="line"><span class="function"># <span class="title">INOUT</span> 既可以作为输入参数，也可以作为输出参数</span></span><br></pre></td></tr></table></figure>

<p><strong>IN - 输入</strong></p>
<p>需求：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">根据定义的身高变量，判定当前身高的所属的身材类型</span><br></pre></td></tr></table></figure>

<p>示例：  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line"></span><br><span class="line">create procedure pro_test5(<span class="keyword">in</span> height int)</span><br><span class="line">begin</span><br><span class="line">    declare description varchar(50)<span class="built_in"> default </span><span class="string">''</span>;</span><br><span class="line">    <span class="keyword">if</span> hegith &gt;= 180 then</span><br><span class="line">      <span class="builtin-name">set</span> <span class="attribute">description</span>=<span class="string">'身材高挑'</span>;</span><br><span class="line">    elseif height &gt;=170 <span class="keyword">and</span> height &lt; 180 then</span><br><span class="line">      <span class="builtin-name">set</span> <span class="attribute">description</span>=<span class="string">'标准身材'</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="builtin-name">set</span> <span class="attribute">description</span>=<span class="string">'一般身材'</span>;</span><br><span class="line">    end <span class="keyword">if</span>;</span><br><span class="line">    select concat(<span class="string">'身高'</span>,height,<span class="string">'对应的身材类型为'</span>,description);</span><br><span class="line">end$</span><br><span class="line"></span><br><span class="line">call pro_test5(198)$</span><br><span class="line">call pro_test5(178)$</span><br><span class="line">call pro_test5(158)$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>

<h2 id="存储过程-语法-输出参数"><a href="#存储过程-语法-输出参数" class="headerlink" title="存储过程 - 语法 - 输出参数"></a>存储过程 - 语法 - 输出参数</h2><p>需求：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">根据传入的身高变量，获取当前身高的所属的身材类型</span><br></pre></td></tr></table></figure>

<p>示例：  </p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="function"><span class="keyword">procedure</span> <span class="title">pro_test5</span><span class="params">(<span class="keyword">in</span> height int ,<span class="keyword">out</span> description varchar(10)</span>)</span></span><br><span class="line"><span class="function"><span class="title">begin</span></span></span><br><span class="line"><span class="function">    <span class="title">if</span> <span class="title">height</span> &gt;=180 <span class="title">then</span></span></span><br><span class="line"><span class="function">        <span class="title">set</span> <span class="title">description</span>='身材高挑';</span></span><br><span class="line">    elseif height &gt;= <span class="number">170</span> <span class="keyword">and</span> height &lt; <span class="number">180</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">set</span> description=<span class="string">'身材标准'</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">set</span> description=<span class="string">'一般身材'</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line">call pro_test5(<span class="number">188</span>,@description)$</span><br><span class="line"># @description 代表用户的变量；用户的会话变量</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> @description$ # 查询用户会话变量取值</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>

<p><strong>小知识</strong><br>@description：这种变量要在变量名称前面加上“@”符号，叫做用户会话变量，代表整个会话过程它都是有作用的，这个类似于全局变量一样。<br>@@global.sort_buffer_size:这种在变量前加上“@@”，叫做系统变量；  </p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">set</span> <span class="variable">@name</span>=<span class="string">'itcast'</span>$</span><br><span class="line"></span><br><span class="line"><span class="literal">select</span> <span class="variable">@name</span>$</span><br></pre></td></tr></table></figure>

<h2 id="存储过程-语法-case结构"><a href="#存储过程-语法-case结构" class="headerlink" title="存储过程 - 语法 - case结构"></a>存储过程 - 语法 - case结构</h2><p>语法结构：  </p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">方式一：  </span><br><span class="line"><span class="keyword">CASE</span> case_value <span class="meta"># case_value 条件</span></span><br><span class="line">    <span class="keyword">WHEN</span> when_value <span class="keyword">THEN</span> statement_list <span class="meta"># statement_list SQL语句</span></span><br><span class="line">    [ <span class="keyword">WHEN</span> when_value <span class="keyword">THEN</span> statement_list ] ...</span><br><span class="line">    [ <span class="keyword">ELSE</span> statement_list ]</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">方拾二：  </span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line">    <span class="keyword">WHEN</span> search_condition <span class="keyword">THEN</span> statement_list <span class="meta"># search_condition 条件表达式；如果该表达式为真只执行THEN后的statement_list SQL语句</span></span><br><span class="line">    [ <span class="keyword">WHEN</span> search_condition <span class="keyword">THEN</span> statement_list ] ...</span><br><span class="line">    [ <span class="keyword">ELSE</span> statement_list ]</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br></pre></td></tr></table></figure>

<p>需求：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">给定一个月份，然后计算出所在的季度</span><br></pre></td></tr></table></figure>

<p>示例：  </p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="function"><span class="keyword">procedure</span> <span class="title">pro_test7</span><span class="params">( mon int)</span></span></span><br><span class="line"><span class="function"><span class="title">begin</span></span></span><br><span class="line"><span class="function">    <span class="title">declare</span> <span class="title">result</span> <span class="title">varchar</span><span class="params">(10)</span>;</span></span><br><span class="line">    <span class="keyword">case</span></span><br><span class="line">      when mou&gt;=<span class="number">1</span> <span class="keyword">and</span> mon &lt;=<span class="number">2</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">set</span> <span class="keyword">result</span>=<span class="string">'第一季度'</span>;</span><br><span class="line">      when mou&gt;=<span class="number">4</span> <span class="keyword">and</span> mon &lt;=<span class="number">6</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">set</span> <span class="keyword">result</span>=<span class="string">'第二季度'</span>;</span><br><span class="line">      when mou&gt;=<span class="number">7</span> <span class="keyword">and</span> mon &lt;=<span class="number">9</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">set</span> <span class="keyword">result</span>=<span class="string">'第三季度'</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">set</span> <span class="keyword">result</span>=<span class="string">'第四季度'</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">case</span>;</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">concat</span>(<span class="string">'传递的月份为'</span>,mon,<span class="string">'， 计算出的结果为：'</span>,<span class="keyword">result</span>) <span class="keyword">as</span> content;</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line">call pro_test7(<span class="number">7</span>)$</span><br><span class="line">call pro_test7(<span class="number">2</span>)$</span><br><span class="line">call pro_test7(<span class="number">11</span>)$</span><br><span class="line">call pro_test7(<span class="number">9</span>)$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>

<h2 id="存储过程-语法-while循环"><a href="#存储过程-语法-while循环" class="headerlink" title="存储过程 - 语法 - while循环"></a>存储过程 - 语法 - while循环</h2><p>语法结构：  </p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> search_condition <span class="keyword">do</span> <span class="comment"># search_condition 条件成立执行循环；条件不成立则跳出循环</span></span><br><span class="line">    statement_list</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">while</span>;</span><br></pre></td></tr></table></figure>

<p>需求：  </p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">计算从<span class="number">1</span>加到n的值</span><br></pre></td></tr></table></figure>

<p>示例:  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> pro_test8(n <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> total <span class="built_in">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">declare</span> <span class="keyword">start</span> <span class="built_in">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    while <span class="keyword">start</span> &lt;= n <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">set</span> total=total+<span class="keyword">start</span>;</span><br><span class="line">        <span class="keyword">start</span>=<span class="keyword">start</span>+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">while</span>;</span><br><span class="line">    <span class="keyword">select</span> total;</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> pro_test8(<span class="number">3</span>)$</span><br><span class="line"><span class="keyword">call</span> pro_test8(<span class="number">6</span>)$</span><br><span class="line"><span class="keyword">call</span> pro_test8(<span class="number">100</span>)$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>

<h2 id="存储过程-语法-repeat循环"><a href="#存储过程-语法-repeat循环" class="headerlink" title="存储过程 - 语法 - repeat循环"></a>存储过程 - 语法 - repeat循环</h2><p>有条件的循环控制语句，当满足条件的时候退出循环。<br>while是满足条件才执行，repeat是满足条件就退出循环。  </p>
<p>语法结构：  </p>
<figure class="highlight cal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REPEAT</span></span><br><span class="line">    statement_list</span><br><span class="line"></span><br><span class="line">    <span class="keyword">UNTIL</span> search_condition</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">REPEAT</span>;</span><br></pre></td></tr></table></figure>

<p>需求：  </p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">计算从<span class="number">1</span>加到n的值</span><br></pre></td></tr></table></figure>

<p>示例：  </p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="function"><span class="keyword">procedure</span> <span class="title">pro_test9</span><span class="params">(n int)</span></span></span><br><span class="line"><span class="function"><span class="title">begin</span></span></span><br><span class="line"><span class="function">    <span class="title">declare</span> <span class="title">total</span> <span class="title">int</span> <span class="title">default</span> 0;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">repeat</span></span><br><span class="line">        <span class="keyword">set</span> total=total+n;</span><br><span class="line">        <span class="keyword">set</span> n=n-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">until</span> n=<span class="number">0</span> # 此处不加分号；加分号报错；满足当前条件则跳出循环</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">repeat</span>;</span><br><span class="line">    <span class="keyword">select</span> total;</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line">call pro_test10(<span class="number">50</span>)$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>

<h2 id="存储过程-语法-loop循环"><a href="#存储过程-语法-loop循环" class="headerlink" title="存储过程 - 语法 - loop循环"></a>存储过程 - 语法 - loop循环</h2><h3 id="loop语句"><a href="#loop语句" class="headerlink" title="loop语句"></a>loop语句</h3><p>LOOP实现简单的循环，退出循环的条件需要使用其他的语句定义，通常可以使用LEAVE语句实现，具体语法如下：  </p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ begin_label: ] <span class="keyword">LOOP</span></span><br><span class="line">    statement_list</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">LOOP</span> [ end_label ]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>如果不在 statement_list 中增加退出循环的语句，那么LOOP语句可以用来实现简单的死循环</p>
<h3 id="leave语句"><a href="#leave语句" class="headerlink" title="leave语句"></a>leave语句</h3><p>用来从标注的流程构造中退出，通常和BEGIN….END或者循环一起使用。<br>下面是一个使用LOOP和LEAVE的简单例子，退出循环；</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">pro_test10</span><span class="params">(n int)</span></span></span><br><span class="line"><span class="function"><span class="title">BEGIN</span></span></span><br><span class="line"><span class="function">    <span class="title">declare</span> <span class="title">total</span> <span class="title">int</span> <span class="title">default</span> 0;</span></span><br><span class="line"></span><br><span class="line">    ins:<span class="keyword">LOOP</span></span><br><span class="line">        <span class="keyword">IF</span> n &lt;= <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">          leave ins;</span><br><span class="line">        <span class="keyword">ELSE</span></span><br><span class="line">          <span class="keyword">SET</span> total=total+n;</span><br><span class="line">          <span class="keyword">SET</span> n=n-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">LOOP</span> ins;</span><br><span class="line">    <span class="keyword">select</span> total;</span><br><span class="line"><span class="keyword">END</span>$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="function"><span class="keyword">procedure</span> <span class="title">pro_test10</span><span class="params">(n int)</span></span></span><br><span class="line"><span class="function"><span class="title">begin</span></span></span><br><span class="line"><span class="function">    <span class="title">declare</span> <span class="title">total</span> <span class="title">int</span> <span class="title">default</span> 0;</span></span><br><span class="line"></span><br><span class="line">    c:<span class="keyword">loop</span></span><br><span class="line">        <span class="keyword">set</span> total=total+n;</span><br><span class="line">        <span class="keyword">set</span> n=n-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> n&lt;<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">            leave c; # 满足条件跳出循环</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">loop</span> c;</span><br><span class="line">    <span class="keyword">select</span> total;</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line">call pro_test10(<span class="number">100</span>)$</span><br><span class="line">call pro_test10(<span class="number">99</span>)$</span><br><span class="line">call pro_test10(<span class="number">3</span>)$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>

<h2 id="存储过程-语法-游标介绍"><a href="#存储过程-语法-游标介绍" class="headerlink" title="存储过程 - 语法 - 游标介绍"></a>存储过程 - 语法 - 游标介绍</h2><p>游标是用来存储查询结果集的数据类型，唉存储过程和函数中可以使用光标对结果集进行循环的处理。<br>光标的使用包括光标的声明、OPEN、FETCH和CLOSE。  </p>
<h2 id="存储过程-语法-游标基本操作"><a href="#存储过程-语法-游标基本操作" class="headerlink" title="存储过程 - 语法 - 游标基本操作"></a>存储过程 - 语法 - 游标基本操作</h2><p>其语法分别如下：  </p>
<p>声明光标：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> cursor_name <span class="keyword">CURSOR</span> <span class="keyword">for</span> select_statement;</span><br></pre></td></tr></table></figure>

<p>OPEN光标：  </p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPEN cursor_name<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>FETCH光标：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FETCH cursor_name INTO var_name [ , var_name ] <span class="string">...</span> <span class="comment"># 每抓取一次，即获取结果集当中每一行数据；调用一次指针往下指向一次；调用一次指针往下指向一次；当指针指到最后没有数据的那一行时，即此时就应该退出游标了；</span></span><br></pre></td></tr></table></figure>

<p>CLOSE光标：  </p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CLOSE cursor_name<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>示例：<br>初始化脚本:  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp(</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="literal">null</span> auto_increment,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'姓名'</span>,</span><br><span class="line">  age <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">comment</span> <span class="string">'年龄'</span>,</span><br><span class="line">  salary <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">comment</span> <span class="string">'薪水'</span>,</span><br><span class="line">  primary <span class="keyword">key</span>(<span class="string">'id'</span>)</span><br><span class="line">)<span class="keyword">engine</span>=<span class="keyword">innodb</span> <span class="keyword">default</span> <span class="keyword">charset</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp(<span class="keyword">id</span>,<span class="keyword">name</span>,age,salary) <span class="keyword">values</span> (<span class="literal">null</span>,<span class="string">'金毛狮王'</span>,<span class="number">55</span>,<span class="number">3800</span>),(<span class="literal">null</span>,<span class="string">'白眉鹰王'</span>,<span class="number">60</span>,<span class="number">4400</span>),(<span class="literal">null</span>,<span class="string">'青翼蝠王'</span>,<span class="number">38</span>,<span class="number">2800</span>),(<span class="literal">null</span>,<span class="string">'素衫龙王'</span>,<span class="number">42</span>,<span class="number">1800</span>);</span><br></pre></td></tr></table></figure>

<p>需求：  </p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询emp表中数据，并逐行获取进行显示</span></span><br></pre></td></tr></table></figure>

<p>示例：  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delimiter</span> $</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> pro_test11()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> e_id <span class="type">int</span>(<span class="number">11</span>);</span><br><span class="line">    <span class="keyword">declare</span> e_name <span class="type">varchar</span>(<span class="number">50</span>);</span><br><span class="line">    decalre e_age <span class="type">int</span>(<span class="number">11</span>);</span><br><span class="line">    <span class="keyword">declare</span> e_salary <span class="type">int</span>(<span class="number">11</span>);</span><br><span class="line">    <span class="keyword">declare</span> emp_result <span class="keyword">cursor</span> fro <span class="keyword">select</span> * <span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> emp_result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fetch</span> emp_result <span class="keyword">into</span> e_id,e_naem,e_age,e_salary;</span><br><span class="line">    <span class="keyword">select</span> concat(<span class="string">'id为：'</span> , e_id,<span class="string">', 名字为: '</span> , e_name , <span class="string">', 年龄为：'</span> , e_age , <span class="string">', 薪资为：'</span> , e_salary);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fetch</span> emp_result <span class="keyword">into</span> e_id,e_naem,e_age,e_salary;</span><br><span class="line">    <span class="keyword">select</span> concat(<span class="string">'id为：'</span> , e_id,<span class="string">', 名字为: '</span> , e_name , <span class="string">', 年龄为：'</span> , e_age , <span class="string">', 薪资为：'</span> , e_salary);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fetch</span> emp_result <span class="keyword">into</span> e_id,e_naem,e_age,e_salary;</span><br><span class="line">    <span class="keyword">select</span> concat(<span class="string">'id为：'</span> , e_id,<span class="string">', 名字为: '</span> , e_name , <span class="string">', 年龄为：'</span> , e_age , <span class="string">', 薪资为：'</span> , e_salary);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fetch</span> emp_result <span class="keyword">into</span> e_id,e_naem,e_age,e_salary;</span><br><span class="line">    <span class="keyword">select</span> concat(<span class="string">'id为：'</span> , e_id,<span class="string">', 名字为: '</span> , e_name , <span class="string">', 年龄为：'</span> , e_age , <span class="string">', 薪资为：'</span> , e_salary);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fetch</span> emp_result <span class="keyword">into</span> e_id,e_naem,e_age,e_salary;</span><br><span class="line">    <span class="keyword">select</span> concat(<span class="string">'id为：'</span> , e_id,<span class="string">', 名字为: '</span> , e_name , <span class="string">', 年龄为：'</span> , e_age , <span class="string">', 薪资为：'</span> , e_salary);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">close</span> emp_result;</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line"># emp表当中只有四条数据，如果<span class="keyword">fetch</span>的次数大于表当中的数据，那么<span class="keyword">fetch</span>表中总行数依然可以打印出来，一旦<span class="keyword">fetch</span>大于表中的总行数则进行报错；</span><br><span class="line"></span><br><span class="line"># 通过<span class="keyword">fetch</span>一行一行进行抓取记录编写的效率十分低；</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> pro_test11();</span><br><span class="line"><span class="keyword">delimiter</span> ;</span><br></pre></td></tr></table></figure>

<h2 id="存储过程-语法-循环获取游标"><a href="#存储过程-语法-循环获取游标" class="headerlink" title="存储过程 - 语法 - 循环获取游标"></a>存储过程 - 语法 - 循环获取游标</h2><blockquote>
<p>循环当中，游标的fetch退出判断</p>
</blockquote>
<p>1） count(*) into num;  num –<br>2） mysql存在机制，变量，通过改变该变量取值状态及退出fetch  </p>
<p>示例：  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delimiter</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> pro_test12()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> e_id <span class="type">int</span>(<span class="number">11</span>);</span><br><span class="line">    decalre e_name <span class="type">varchar</span>(<span class="number">50</span>);</span><br><span class="line">    decalre e_age <span class="type">int</span>(<span class="number">11</span>);</span><br><span class="line">    decalre e_salary <span class="type">int</span>(<span class="number">11</span>);</span><br><span class="line">    <span class="keyword">declare</span> has_data <span class="type">int</span> <span class="keyword">default</span> <span class="number">1</span>;#当has_data为<span class="number">1</span>时表示还有数据；当has_data为<span class="number">0</span>时表示没有数据</span><br><span class="line"></span><br><span class="line">    <span class="keyword">declare</span> emp_result <span class="keyword">cursor</span> <span class="keyword">for</span> <span class="keyword">select</span> * <span class="keyword">from</span> emp;</span><br><span class="line">    <span class="keyword">DECLARE</span> <span class="keyword">EXIT</span> <span class="keyword">HANDLER</span> <span class="keyword">FOR</span> <span class="keyword">NOT</span> <span class="built_in">FOUND</span> <span class="keyword">set</span> has_data=<span class="number">0</span>;#退出当前游标指向程序并设置has_data为<span class="number">0</span>；此为mysql提供的一种机制；同时该句话需要声明在声明游标的下方；当游标进行<span class="keyword">fetch</span>获取不到数据的时候，此时会进行触发；</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> emp_reuslt;</span><br><span class="line"></span><br><span class="line">    repeat</span><br><span class="line">        <span class="keyword">fetch</span> emp_result <span class="keyword">into</span> e_id,e_name,e_age,e_salary;</span><br><span class="line">        <span class="keyword">select</span> concat(<span class="string">'id为：'</span> , e_id,<span class="string">', 名字为: '</span> , e_name , <span class="string">', 年龄为：'</span> , e_age , <span class="string">', 薪资为：'</span> , e_salary);</span><br><span class="line">        <span class="keyword">until</span> has_data=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span> repeat;</span><br><span class="line">    <span class="keyword">close</span> emp_result;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> pro_test12()$</span><br><span class="line"></span><br><span class="line"><span class="keyword">delimiter</span> ;</span><br></pre></td></tr></table></figure>

<h2 id="存储函数"><a href="#存储函数" class="headerlink" title="存储函数"></a>存储函数</h2><p>语法结构：  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION function_name([ param<span class="built_in"> type </span><span class="built_in">..</span>. ])</span><br><span class="line">RETURNS type</span><br><span class="line">BEGIN</span><br><span class="line">    <span class="built_in">..</span><span class="built_in">..</span>.</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<p>案例：<br>定义一个存储过程，请求满足条件的总记录数：  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delimiter</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> count_city(countryId <span class="type">int</span>)</span><br><span class="line"><span class="keyword">returns</span> <span class="type">int</span> # 此处不需要分号</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> cnum <span class="type">int</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> count(*) <span class="keyword">into</span> cnum <span class="keyword">from</span> city <span class="keyword">where</span> country_id = countryId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cnum;</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line"><span class="keyword">delimiter</span> ;</span><br><span class="line"></span><br><span class="line"># 存储过程虽然没有返回值；但是依然可以返回结果；因为其参数列表当中有<span class="keyword">in</span>、<span class="keyword">out</span>（返回值）、<span class="keyword">inout</span>；存储函数能做的事情；存储过程也可以做；</span><br></pre></td></tr></table></figure>

<blockquote>
<p>调用存储函数命令</p>
</blockquote>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> count_city(<span class="number">1</span>)$</span><br><span class="line"><span class="keyword">select</span> count_city(<span class="number">2</span>)$</span><br></pre></td></tr></table></figure>

<blockquote>
<p>删除存储函数命令</p>
</blockquote>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop <span class="keyword">function</span> <span class="title">count_city$</span></span><br></pre></td></tr></table></figure>

<h2 id="触发器-介绍"><a href="#触发器-介绍" class="headerlink" title="触发器 - 介绍"></a>触发器 - 介绍</h2><p>触发器是与表有关的数据库对象，指的是在insert、update、delete之前或者之后，触发并执行触发器中定义的SQL语句集合，触发器的这种特性可以协助应用在数据库端确保数据的完整性，日志记录，数据校验等操作；  </p>
<p>使用别名OLD和NEW来引用触发器中发生变化的记录内容，这与其他的数据库是相似的。<br>现在触发器还只支持行级触发，不支持语句级触发。  </p>
<table>
  <tr>
    <th>触发器类型</th>
    <th>NEW和OLD的使用</th>
  </tr>
  <tr>
    <td>INSERT型触发器</td>
    <td>NEW表示将要或者已经新增的数据</td>
  </tr>
  <tr>
    <td>UPDATE型触发器</td>
    <td>OLD表示修改之前的数据，NEW表示将要或者已经修改后的数据</td>
  </tr>
  <tr>
    <td>DELETE型触发器</td>
    <td>OLD表示将要或者已经删除的数据</td>
  </tr>
</table>

<h2 id="触发器-创建及应用"><a href="#触发器-创建及应用" class="headerlink" title="触发器 - 创建及应用"></a>触发器 - 创建及应用</h2><h3 id="创建触发器"><a href="#创建触发器" class="headerlink" title="创建触发器"></a>创建触发器</h3><p>语法结构：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trigger_name</span><br><span class="line"></span><br><span class="line"><span class="keyword">before</span>/<span class="keyword">after</span> <span class="keyword">insert</span>/<span class="keyword">update</span>/<span class="keyword">delete</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># before 在...之前/after 在...之后</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">on</span> tb1_name</span><br><span class="line"></span><br><span class="line">[ <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span> ] <span class="comment">-- 当前操作的是一个行级触发器;oracle数据库当中既有行级触发器也有语句级的触发器；而mysql数据库当中只支持行级触发器现还不支持语句级触发器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  trigger_stmt;<span class="comment">--触发的内容</span></span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>需求：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过触发器记录 emp表的数据变更日志，包含新增、修改、删除；</span><br></pre></td></tr></table></figure>

<p>示例：  </p>
<p>首先创建一张日志表:  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp_logs(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="literal">null</span> auto_increment,</span><br><span class="line">    operation <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'操作类型，insert/update/delete'</span>,</span><br><span class="line">    operate_time datatime <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'操作时间'</span>,</span><br><span class="line">    operate_id <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'操作表的id'</span>,</span><br><span class="line">    operate_params <span class="built_in">varchar</span>(<span class="number">500</span>) <span class="keyword">comment</span> <span class="string">'操作参数'</span>,</span><br><span class="line">    primary <span class="keyword">key</span>(<span class="string">'id'</span>)</span><br><span class="line">)<span class="keyword">engine</span>=<span class="keyword">innodb</span> <span class="keyword">default</span> <span class="keyword">charset</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>$</span><br></pre></td></tr></table></figure>

<p>创建insert性触发器，完成插入数据时的日志记录；  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELIMITER</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">trigger</span> emp_logs_insert_trigger</span><br><span class="line"><span class="keyword">after</span> <span class="keyword">insert</span></span><br><span class="line"><span class="keyword">on</span> emp</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> emp_logs(id,operation,operate_time,operate_id,operate_params) <span class="keyword">values</span>(</span><br><span class="line">      <span class="keyword">null</span>,<span class="string">'insert'</span>,now(),<span class="built_in">new</span>.id,concat( <span class="string">'插入后 ( id：'</span>, <span class="built_in">new</span>.id , <span class="string">', name: '</span> , <span class="built_in">new</span>.name , <span class="string">' ,  age: '</span> ,  <span class="built_in">new</span>.age , <span class="string">' , salary: '</span> , <span class="built_in">new</span>.salary , <span class="string">')'</span>)</span><br><span class="line">    );</span><br><span class="line">    # 此处的<span class="built_in">new</span>.id即新插入emp表中数据的记录的id，即emp当中的id字段；</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp(id,<span class="type">name</span>,age,salary) <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">'光明左使'</span>,<span class="number">30</span>,<span class="number">3500</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp$</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp_logs$</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp(id,<span class="type">name</span>,age,salary) <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">'光明右使'</span>,<span class="number">35</span>,<span class="number">3800</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">trigger</span> emp_logs_update_trigger</span><br><span class="line"><span class="keyword">after</span> <span class="keyword">update</span></span><br><span class="line"><span class="keyword">on</span> emp</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> emp_logs(id,operation,operate_time,operate_id,operate_params) <span class="keyword">values</span>(</span><br><span class="line">      <span class="keyword">null</span>,<span class="string">'update'</span>,now(),<span class="built_in">new</span>.id,</span><br><span class="line">      concat( </span><br><span class="line">        <span class="string">'修改前 ( id：'</span>, <span class="built_in">old</span>.id ,</span><br><span class="line">        <span class="string">',name: '</span> , <span class="built_in">old</span>.name ,</span><br><span class="line">        <span class="string">',age: '</span> ,  <span class="built_in">old</span>.age ,</span><br><span class="line">        <span class="string">',salary: '</span> , <span class="built_in">old</span>.salary ,</span><br><span class="line">        <span class="string">') 修改后( id：'</span>, <span class="built_in">new</span>.id ,</span><br><span class="line">        <span class="string">',name: '</span> , <span class="built_in">new</span>.name ,</span><br><span class="line">        <span class="string">',age: '</span> ,  <span class="built_in">new</span>.age ,</span><br><span class="line">        <span class="string">',salary: '</span> , <span class="built_in">new</span>.salary ,</span><br><span class="line">        <span class="string">')'</span>  </span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">    # 此处的<span class="built_in">new</span>.id即新插入emp表中数据的记录的id，即emp当中的id字段；</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> emp <span class="keyword">set</span> age=<span class="number">39</span> <span class="keyword">where</span> id=<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp$</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp_logs$</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">trigger</span> emp_logs_delete_trigger</span><br><span class="line"><span class="keyword">after</span> <span class="keyword">delete</span></span><br><span class="line"><span class="keyword">on</span> emp</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> emp_logs(id,operation,operate_time,operate_id,operate_params) <span class="keyword">values</span>(</span><br><span class="line">      <span class="keyword">null</span>,<span class="string">'delete'</span>,now(),<span class="built_in">old</span>.id,</span><br><span class="line">      concat(</span><br><span class="line">        <span class="string">'删除前( id：'</span>, <span class="built_in">old</span>.id ,</span><br><span class="line">        <span class="string">',name: '</span> , <span class="built_in">old</span>.name ,</span><br><span class="line">        <span class="string">',age: '</span> ,  <span class="built_in">old</span>.age ,</span><br><span class="line">        <span class="string">',salary: '</span> , <span class="built_in">old</span>.salary ,</span><br><span class="line">        <span class="string">')'</span>  </span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line"><span class="keyword">end</span>$</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> emp <span class="keyword">where</span> id=<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp$</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp_logs$</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> emp <span class="keyword">where</span> id=<span class="number">5</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp$</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp_logs$</span><br><span class="line"></span><br><span class="line"><span class="keyword">DELIMITER</span> ;</span><br></pre></td></tr></table></figure>

<h2 id="触发器-查看及删除"><a href="#触发器-查看及删除" class="headerlink" title="触发器 - 查看及删除"></a>触发器 - 查看及删除</h2><h3 id="删除触发器"><a href="#删除触发器" class="headerlink" title="删除触发器"></a>删除触发器</h3><p>语法结构：  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> [ <span class="built_in">schema_name</span>.] trigger_name</span><br></pre></td></tr></table></figure>
<p>如果没有指定schema_name，默认为当前数据库。</p>
<h3 id="查看触发器"><a href="#查看触发器" class="headerlink" title="查看触发器"></a>查看触发器</h3><p>可以通过执行SHOW TRIGGERS 命令查看触发器的状态、语法等信息。<br>语法结构：  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> triggers;</span><br><span class="line"></span><br><span class="line"># Event 触发器监听的事件 <span class="keyword">INSERT</span>/<span class="keyword">UPDATE</span>/<span class="keyword">DELETE</span></span><br><span class="line"># <span class="keyword">Table</span> 对于哪一张表监听的触发器</span><br><span class="line"># <span class="keyword">Timing</span> 触发器是前置触发<span class="keyword">BEFORE</span>还是后置触发<span class="keyword">AFTER</span></span><br><span class="line"># <span class="keyword">Statement</span> 触发器定义</span><br></pre></td></tr></table></figure>

<h2 id="今日内容"><a href="#今日内容" class="headerlink" title="今日内容"></a>今日内容</h2><blockquote>
<p>Mysql高级-day02</p>
</blockquote>
<p>1） MySql的体系结构概览（MySQL内部原理，内部执行流程有一个认识）<br>2） 存储引擎（InnoDB以及MyISAM）<br>3） 优化SQL步骤（从哪些方面以及参考指标）<br>4） 索引的使用（在SQL优化中如何使用）<br>5） SQL优化  </p>
<h2 id="体系结构"><a href="#体系结构" class="headerlink" title="体系结构"></a>体系结构</h2><h3 id="MySQL的体系结构概览"><a href="#MySQL的体系结构概览" class="headerlink" title="MySQL的体系结构概览"></a>MySQL的体系结构概览</h3><p>MySQL的体系结构图和在进行Web开发的三层架构是相类似的；  </p>
<p>Web开发时的三层架构：<br>（1）前端发起请求先到达controller；<br>（2）controller调service；service调用dao;<br>（3）dao再去访问数据库；  </p>
<p>mysql的体系结构当中，首先最上面的部分Connectors实际上代表的就相当于是客户端；<br>在客户端连接当中Natice C API，JDBC，ODBC,.NET，PHP,Perl，Python，Ruby，Cobol这些个；<br>JDBC就很熟悉了；在Java程序当中可以通过JDBC来进行操作mysql；<br>所以最上面部分即mysql连接的客户端通过JDBC来进行操作；<br>然后紧接着中层即MySQL Server；  </p>
<p>MySQL Server当中最上面一层即Connection Pool连接池；在连接池当中有很多的组件模块Authentication、Thread Reuse、Connection Limits、Check Memory、Caches；<br>也就是客户端发起一个连接；<br>这个连接就会到MySQL Server的这个Connection Pool连接池当中来进行获取一个连接来执行对应的请求；<br>当然，在MySQL Server的Connection Pool进行获取连接的时候还需要进行认证、连接最大数、缓存等相关操作；<br>此为MySQL Server的第一层连接层；<br>连接层主要负责的就是客户端发起一个请求，<br>MySQL Server接收到这个请求之后，开启一段线程进行与客户端请求相关的操作；<br>这是连接层；  </p>
<p>MySQL Server当中的第二层即Management Services &amp; Utillties、SQL Interface、Parser、Optimizer、Caches &amp; Buffers 这一部分；<br>MySQL Server第二层当中有很多的组件；<br>其中第一个（第一个模块）即MySQL的管理服务以及一些工具；管理层Management Services当中可以进行数据的备份与恢复以及集群安全以及系统配置相关的内容（Backup &amp; Recovery，Security，Replication，Cluster，Administrator，Configuration，Migration &amp; Metadata）<br>第二层的第二个模块：SQL Interface即SQL的一个接口，在此当中可以去进行执行或者是去封装DML、DDL语句以及存储过程、存储函数、视图、触发器等等相关数据库对象（DML、DDL、Stored Procedures，Views ，Triggers ，etc.）</p>
<p>第二层的第三个模块即：Parser，Parser就是一个解析器，这个解析器解析的是客户端发起的一个请求，客户端发起的这个请求就是SQL语句，SQL语句需要经过这个解析器Parser的解析，解析之后并且在这一块进行相关的过滤（Query Translation,Object Privilege）  </p>
<p>解析完成之后，在MySQL的内部还需要几个过程；<br>第二层的第四个模块：Optimizer，这个过程实际上称作优化器；即在解析完成了前端请求过来的SQL语句并进行相关的过滤之后，MySQL内部还须要通过其内部的一个优化器，对前端请求来的SQL语句解析并过滤后进行一个优化处理；MySQL内部会按照其内部自己的一个优化体系来进行优化（Access Paths，Statistics）  </p>
<p>当优化完成之后，接下来还需要进行缓存的一个操作：<br>第二程的第五个模块：Caches &amp; Buffers，即查询在缓存当中有没有要查询的数据；如果存在有对应的树据信息，那么这个时候可能就直接返回给前端客户端了；（Global and Engine ，Specific Caches &amp; Buffers）  </p>
<p>所以第二层当中的这五个模块就是MySQL的服务层操作；即将前端请求的SQL语句进行封装起来并且进行解析以及相关过滤，以及对其进行优化，最终还需要操作MySQL当中的缓存区的信息；  </p>
<p>MySQL Server的第三层：Pluggable Storage Engines(Memory，Index &amp; Storage Management)，此处实际指的是存储引擎；<br>Pluggable插件式的存储引擎；<br>以下是MySQL当中的存储引擎:<br>（MyISAM、InnoDB、NDB、Archive、Federated、Memory、Merge、Partner、Community、Custom ….）<br>MySQL版本5.5之后默认的存储引擎即为InnoDB；<br>引擎：发动机；<br>存储引擎是什么？（与飞机上的引擎比较类似，比如客机则有客机的引擎，客机即运送乘客、旅客；但是还有对应的货机，那么货机即对应的即运输货物的；还有直升机等等；不同的飞机有不同的飞机引擎；不同的飞机引擎在相对应的机型当中都发挥着不同的作用；在操作的时候需要考虑到，用户是什么，然后去考虑更适合哪一种引擎，对应的发动机；同样对于mysql的存储引擎是一个道理；存储引擎则需要根据存储的数据不同或者是需求不同而选择不同的存储引擎来进行存储不同的数据；）<br>MySQL Server的第三层为存储引擎层；  </p>
<p>MySQL Server的第四层即存储层：File system（NTFS，ufs，ext2/3，NFS，SAN，NAS）<br>Files &amp; Logs（Redo，Undo，Data，Index，Binary，Error，Query and Slow）<br>在操作MySQL数据库中表当中的数据的时候，不管是插入还是查询或者修改删除等操作；实际上最终都是操作的File system即文件系统；最终操作的都是文件系统当中的文件；而这个文件系统即就处于磁盘当中；所以最下面一层就文件系统；最重要操作的也就是文件系统；除了在表结构当中的数据，还有对应的索引信息、二进制错误、查询、慢查询日志等；  </p>
<p>此为MySQL体系结构当中的四层；  </p>
<p>第一层连接层；负责接收客户端的发送的请求；然后MySQL Server开启一段线程进行相关的认证授权之后再来进行请求的处理；<br>第二层服务层：服务层在主要起到备份恢复、SQL封装、解析过滤、SQL语句优化、缓存查询等相关操作；<br>第三层存储引擎层，选择合适的存储引擎对相关数据进行相关的处理；<br>第四层文件系统：当第三层的数据进行相关的处理完成之后，则需要将数据最终写入文件系统当中，即实际的物理磁盘当中；</p>
<p>整个MySQL由以下组成：  </p>
<ul>
<li>Connection Pool：连接池组件</li>
<li>Management Service &amp; Utillties: 管理服务和工具组件</li>
<li>SQL Interface: SQL接口组件</li>
<li>Parser: 查询分析器组件</li>
<li>Optimizer: 优化器组件</li>
<li>Caches &amp; Buffers: 缓冲池组件</li>
<li>Pluggable Storage Engines: 存储引擎</li>
<li>File System: 文件系统</li>
</ul>
<ol>
<li>连接层<br>最上层是一些客户和连接服务，包含本地socket通信和大多数基于客户端/服务端工具实现的类似于TCP/IP的通信。<br>主要完成一些类似于连接处理、授权认证、以及相关的安全方案。<br>在该层上引入了线程池的概念，未通过认证安全接入的客户端提供线程。<br>同样在该层上可以实现基于SSL的安全连接，服务器也会为安全接入的每个客户端验证它所具有的的操作权限；  </li>
<li>服务层<br>第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化，部分内置函数的执行。<br>所有跨存储引擎的功能也在这一层实现，如过程、函数等。<br>在该层，服务器会解析查询并创建相应的内部解析树，并对其完成响应的优化如确定表的查询顺序，是否利用索引等，最后生成响应的执行操作。<br>如果是select语句，服务器还会查询内部的缓存，如果缓存空间足够大，这样在解决大量读操作的环境中能够很好的提升系统的性能。  </li>
<li>引擎层<br>存储引擎层，存储引擎真正的负责了MySQL中数据的存储和提取，服务器通过API和存储引擎进行通信。<br>不同的存储引擎具有不同的功能，这样可以根据自己的需要，来选取合适的存储引擎；  </li>
<li>存储层<br>数据存储层，主要是将数据存储在文件系统之上，并完成与存储引擎的交互；  </li>
</ol>
<p>和其它数据库相比，MySQL有点与众不同，它的架构可以在多种不同场景中应用并发挥良好作用。<br>主要体现在存储引擎上，插件式的存储引擎架构，将查询处理和其他的系统任务以及数据的存储提取分离。<br>这种架构可以根据业务的需求和实际需要选择合适的存储引擎；  </p>
<h2 id="存储引擎-概述"><a href="#存储引擎-概述" class="headerlink" title="存储引擎 - 概述"></a>存储引擎 - 概述</h2><p>和大多数的数据库不同，MySQL中有一个存储引擎的概念，针对不同的存储需求可以选择最优的存储引擎；<br>存储引擎就是存储数据，建立索引，更新查询数据等等技术的实现方式。<br>存储引擎是基于表的，而不是基于库的。<br>索引存储引擎也可被称为表类型。<br>Oracle、SQLServer等数据库只有一种存储引擎。<br>MySQL提供了插件式的存储引擎架构。<br>索引MySQl存在多种存储引擎，可以根据需要使用相应引擎，或者编写存储引擎。<br>MySQL5.0支持的存储引擎包含：InnoDB、MyISAM、BDB、MEMORY、MERGE、EXAMPLE、NDB Cluster、ARCHIVE、CSV、BLACKHOLE、FEDERATED等，其中InnoDB和BDB提供食物安全表，其他存储引擎是非事务安全表；<br>可以通过指定 show engines，来进行查询当前数据库支持的存储引擎；  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">engines</span>;</span><br></pre></td></tr></table></figure>

<p>创建新表时，如果不指定存储引擎，那么系统就会使用默认的存储引擎。<br>MySQL5.5之前的默认存储引擎是MyISAM，5.5之后就改为InnoDB；  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p <span class="comment">#连接mysql</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">engines</span>;</span><br><span class="line"><span class="comment"># Engine 存储引擎的名字</span></span><br><span class="line"><span class="comment"># Support 是否支持该存储引擎，YES/NO/DEFAULT，DEFAULT默认，默认支持的存储引擎InnoDB</span></span><br><span class="line"><span class="comment"># comment 注释</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Comment注释</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MyISAM : MyISAM <span class="keyword">storage</span> engines</span><br><span class="line">MRG_MYISAM : COLLECTION <span class="keyword">OF</span> IDENTICAL MyISAM <span class="keyword">tables</span></span><br><span class="line">MEMORY : Hash based,stored <span class="keyword">in</span> memory,useful <span class="keyword">for</span> <span class="keyword">temporary</span> <span class="keyword">tables</span></span><br><span class="line">BLACKHOLE : /dev/<span class="keyword">null</span> <span class="keyword">storage</span> engine (anything you wirte <span class="keyword">to</span> it disappears)</span><br><span class="line">CSV : CSV <span class="keyword">storage</span> engine</span><br><span class="line">PERFIRMANCE_SCHEMA : Performance <span class="keyword">Schema</span></span><br><span class="line">ARCHIVE : Archive <span class="keyword">storage</span> engine</span><br><span class="line">FEDERATED ： Federated MySQL <span class="keyword">storage</span> engine</span><br><span class="line">InnoDB ： Support <span class="keyword">transaction</span>,<span class="keyword">row</span>-<span class="keyword">level</span> locking, <span class="keyword">and</span> <span class="keyword">foreign</span> keys # 支持事务，支持行级锁并且支持外键</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看数据库当中的词汇？</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'%storage_engine%'</span>;</span><br><span class="line"></span><br><span class="line">default_storage_engine InnoDB</span><br><span class="line">default_tmp_storage_engine InnoDB</span><br><span class="line">storage_engine InnoDB</span><br></pre></td></tr></table></figure>

<h2 id="存储引擎-特性"><a href="#存储引擎-特性" class="headerlink" title="存储引擎 - 特性"></a>存储引擎 - 特性</h2><p>下面重点介绍几种常用的存储引擎，并对比各个存储引擎之间的区别，如下表所示：  </p>
<table>
    <tr>
      <th>特点</th>
      <th style="background-color:lightblue;color:red;font-weight:bolder;">InnoDB</th>
      <th style="background-color:lightblue;color:red;font-weight:bolder;">MyISAM</th>
      <th>MEMORY</th>
      <th>MERGE</th>
      <th>NDB</th>
    </tr>
    <tr>
      <td>存储限制</td>
      <td>64TB</td>
      <td>有</td>
      <td>有</td>
      <td>没有</td>
      <td>有</td>
    </tr>
    <tr>
      <td style="background-color:lightblue;color:red;font-weight:bolder;">事务安全</td>
      <td>支持</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td style="background-color:lightblue;color:red;font-weight:bolder;">锁机制</td>
      <td style="background-color:lightgreen;color:red;font-weight:bolder;">行锁（适合高并发）</td>
      <td style="background-color:lightgreen;color:red;font-weight:bolder;">表锁</td>
      <td>表锁</td>
      <td>表锁</td>
      <td>行锁</td>
    </tr>
    <tr>
      <td>B树索引</td>
      <td>支持</td>
      <td>支持</td>
      <td>支持</td>
      <td>支持</td>
      <td>支持</td>
    </tr>
    <tr>
      <td>哈希索引</td>
      <td>（当前我看到的是支持的）</td>
      <td></td>
      <td>支持</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>全文索引</td>
      <td>支持（5.6版本之后）</td>
      <td>支持</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>集群索引</td>
      <td>支持</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>数据索引</td>
      <td>支持</td>
      <td></td>
      <td>支持</td>
      <td></td>
      <td>支持</td>
    </tr>
     <tr>
      <td>索引缓存</td>
      <td>支持</td>
      <td>支持</td>
      <td>支持</td>
      <td>支持</td>
      <td>支持</td>
    </tr>
 <tr>
      <td>数据可压缩</td>
      <td></td>
      <td>支持</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
 <tr>
      <td>空间使用</td>
      <td>高</td>
      <td>低</td>
      <td>N/A</td>
      <td>低</td>
      <td>低</td>
    </tr>
 <tr>
      <td>内存使用</td>
      <td>高</td>
      <td>低</td>
      <td>中等</td>
      <td>低</td>
      <td>高</td>
    </tr>
     <tr>
      <td>批量插入速度</td>
      <td>低</td>
      <td>高</td>
      <td>高</td>
      <td>高</td>
      <td>高</td>
    </tr>
     <tr>
      <td style="background-color:lightblue;color:red;font-weight:bolder;">支持外键</td>
      <td style="background-color:lightgreen;color:red;font-weight:bolder;">支持</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
</table>

<p>下面将重点介绍最常使用的两种存储引擎：InnoDB、MyISAM，另外两种MEMORY、MERGE，了解即可；  </p>
<h2 id="存储引擎-InnoDB特性"><a href="#存储引擎-InnoDB特性" class="headerlink" title="存储引擎 - InnoDB特性"></a>存储引擎 - InnoDB特性</h2><p>InnoDB存储引擎是MySQL的默认存储引擎。<br>InnoDB存储引擎提供了具有提交、回滚、崩溃恢复能力的事务安全。<br>但是对比MyISAM的存储引擎，InnoDB写的处理效率差一些，并且会占用更多的磁盘空间以保留数据和索引；  </p>
<p>InnoDB存储引擎不同于其他存储引擎的特点：  </p>
<p><strong>事务控制</strong></p>
<p>MySQL 当中事务默认自动提交；  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create database demo_02<span class="built_in"> default </span><span class="attribute">charset</span>=utf8mb4;  </span><br><span class="line">use demo_01;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create table goods_innodb(</span><br><span class="line">  id int(11) <span class="keyword">not</span> <span class="literal">null</span> auto_increment,</span><br><span class="line">  name varchar(20) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  primary key(id)</span><br><span class="line">)<span class="attribute">ENGINE</span>=innodb<span class="built_in"> default </span><span class="attribute">charset</span>=utf8;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> goods_innodb(<span class="keyword">id</span>,<span class="keyword">name</span>) <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">'Meta20'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span>;<span class="comment"># 如不提交，则其他客户端无法查看得到插入的数据；</span></span><br><span class="line"><span class="comment"># MySQL默认的隔离级别为可重复读</span></span><br></pre></td></tr></table></figure>

<p><strong>外键约束</strong></p>
<p>MySQL支持外键的存储引擎只有InnoDB，在创建外键的时候，要求父表必须有对应的索引，子表在创建索引的时候，也会自动的创建对应的索引；<br>下面两张表中，<br>1） country_innodb是父表，country_id为主键索引；<br>2） city_innodb是子表，country_id字段为外键，对应于country_innodb表中的主键country_id；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> country_innodb(</span><br><span class="line">  country_id <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> auto_increment,</span><br><span class="line">  counry_name <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">not</span> <span class="literal">null</span> ,</span><br><span class="line">  primary <span class="keyword">key</span> (country_id)</span><br><span class="line">)<span class="keyword">engine</span>=<span class="keyword">innodb</span> <span class="keyword">default</span> <span class="keyword">charset</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> city_innodb(</span><br><span class="line">  city_id <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> auto_increment,</span><br><span class="line">  city_name <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  country_id <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  primary <span class="keyword">key</span> (city_id),</span><br><span class="line">  <span class="keyword">key</span> idx_fk_country_id(country_id),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">'fk_city_contry'</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(country_id) <span class="keyword">REFERENCES</span> country_innodb(country_id) <span class="keyword">ON</span> DFLETE RESTRICT <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CASCADE</span></span><br><span class="line">)<span class="keyword">engine</span>=<span class="keyword">innodb</span> <span class="keyword">default</span> <span class="keyword">charset</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ON DELETE RESTRICT 在删除主表数据时，如果有关联记录则不删除</span></span><br><span class="line"><span class="comment"># ON UPDATE CASCADE 更新主表时，如果子表有关联记录，则更新子表记录  </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> country_innodb <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">'China'</span>),(<span class="literal">null</span>,<span class="string">'America'</span>),(<span class="literal">null</span>,<span class="string">'Japan'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> city_innodb <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">'Xian'</span>,<span class="number">1</span>),(<span class="literal">null</span>,<span class="string">'NewYork'</span>,<span class="number">2</span>),(<span class="literal">null</span>,<span class="string">'BeiJing'</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>在创建索引时，可以指定在删除、更新父表时，对子表进行的相应操作，包括RESTRICT、CASCADE、SET NULL和NO ACTION。<br>RESTRICT和NO ACTION相同，是指限制在子表有关联记录的情况下，父表不能更新；<br>CASCADE表示父表在更新或者删除时，更新或者删除子表对应的记录；<br>SET NULL则表示父表在更新或者删除的时候，子表对应字段被SET NULL。<br>针对上面创建的两个表，子表在外键指定是ON DELETE RESTRICT ON UPDATE CASCADE方式的，那么在主表删除记录的时候，如果子表有对应记录，则不允许删除。主表在更新记录的时候，如果子表有对应记录，则子表也会对应更新；  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> country_innodb;<span class="comment">#主表</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> city_innodb;<span class="comment">#子表；子表当中的外键country_id指向主表country_innodb当中的主键country_id</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> country_innodb <span class="keyword">where</span> country_id=<span class="number">2</span>;</span><br><span class="line"><span class="comment">#此处由于外键关联，所以导致删除报错，无法更新；</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> country_innodb <span class="keyword">set</span> country_id=<span class="number">100</span> <span class="keyword">where</span> country_id=<span class="number">1</span>;</span><br><span class="line"><span class="comment">#此时子表当中关联有1；那么说则刚才的子表当中对应country_id也为1 的记录将会进行相应的更新；  </span></span><br><span class="line">查看主表以及子表：  </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> country_innodb;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> city_innodb;</span><br></pre></td></tr></table></figure>

<p><strong>存储方式</strong></p>
<p>存储方式实际上指的是InnoDB这个存储引擎对应的表在数据库当中以数据文件的存储方式；<br>InnoDB存储表和索引有以下两种方式：  </p>
<ol>
<li>使用共享表空间存储，这种方式创建的表的表结构保存在.frm文件中，数据和索引保存在 innodb_data_home_dir和innodb_data_file_path定义的表空间中，可以是多个文件；  </li>
<li>使用多表空间存储，这种方式存储的表的表结构仍然存在.frm文件中，但是每个表的数据和索引单独保存在.ibd中；</li>
</ol>
<h2 id="存储引擎-MyISAM特性"><a href="#存储引擎-MyISAM特性" class="headerlink" title="存储引擎 - MyISAM特性"></a>存储引擎 - MyISAM特性</h2><p>MyISAM不支持事务，也不支持外键，其优势是访问的速度快，对事务的完整性没有要求或者以SELECT、INSERT为主的应用基本上都可以使用这个引擎来创建表，有以下两个比较重要的特点：  </p>
<p><strong>不支持事务</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> goods_myisam(</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> auto_increment,</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  primary <span class="keyword">key</span>(<span class="keyword">id</span>)</span><br><span class="line">)<span class="keyword">engine</span>=myisam <span class="keyword">default</span> <span class="keyword">charset</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> goods_myisam <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">'电脑3'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">rollback</span>;</span><br></pre></td></tr></table></figure>
<p>通过测试可以发现，在MyISAM存储引擎中，是没有事务控制的；  </p>
<p><strong>文件存储方式</strong></p>
<p>每个MyISAM在磁盘上存储成3个文件，其文件名都和表明相同，但拓展名称分别是：</p>
<ul>
<li>.frm (存储表定义)</li>
<li>.MYD (MYData，存储数据)</li>
<li>.MYI (MYIndex，存储索引)</li>
</ul>
<h2 id="存储引擎-Memory与Merge特性"><a href="#存储引擎-Memory与Merge特性" class="headerlink" title="存储引擎 - Memory与Merge特性"></a>存储引擎 - Memory与Merge特性</h2><p>Memory（内存）存储引擎将表的数据放在内存中。<br>每个MEMORY表实际对应一个磁盘文件，格式是.frm，改文件中只存储表的数据结构，而其数据文件，都是存储在内存中，这样有利于数据的快速处理，提高整个表达效率。<br>MEMORY类型的表访问非常的快，因为他的数据是存放在内存中的，并且默认使用HASH索引，但是服务一旦关闭，表中的数据就会丢失；  </p>
<p>MERGE（合并）存储引擎是一组MyISAM表的组合，这些MyISAM表必须结构完全相同，MERGE表本身并没有存储数据，对MERGE类型的表可以进行查询、更新、删除操作，这些操作实际上是对内部的MyISAM表进行的；  </p>
<p>对于MERGE类型表的插入操作是通过INSERT_METHOD子句定义插入的表，可以有三个不同的值，使用FIRST或者LAST值使得插入操作被相应的作用在第一或者是最后一个表上，不定义这个子句或者定义为NO，表示不能对这个MERGE表执行插入操作；  </p>
<p>可以对MERGE表进行DROP操作，但是这个操作知识删除MERGE表的定义，对内部的表是没有任何影响的；  </p>
<p>MERGE存储引擎与view视图有些类似；  </p>
<p>下面是一个创建和使用MERGE表的示例：<br>1）创建三个测试表 payment_2006、payment_2007、payment_all，其中payment_all是前两个表的MERGE表；</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">create table order_1990(</span><br><span class="line">  order_id int,</span><br><span class="line">  order_money double(10,2),</span><br><span class="line">  order_address varchar(50),</span><br><span class="line">  primary key (order_id)</span><br><span class="line">)<span class="attribute">engine</span>=myisam<span class="built_in"> default </span><span class="attribute">charset</span>=utf8;</span><br><span class="line"></span><br><span class="line">create table order_1991(</span><br><span class="line">  order_id int,</span><br><span class="line">  order_money double(10,2),</span><br><span class="line">  order_address varchar(50),</span><br><span class="line">  primary key (order_id)</span><br><span class="line">)<span class="attribute">engine</span>=myisam<span class="built_in"> default </span><span class="attribute">charset</span>=utf8;</span><br><span class="line"></span><br><span class="line">create table order_all(</span><br><span class="line">  order_id int,</span><br><span class="line">  order_money double(10,2),</span><br><span class="line">  order_address varchar(50),</span><br><span class="line">  primary key (order_id)</span><br><span class="line">)<span class="attribute">engine</span>=merge  </span><br><span class="line">union = ( order_1990, order_1991 )  </span><br><span class="line"><span class="attribute">INSERT_METHOD</span>=LAST  </span><br><span class="line">default <span class="attribute">charset</span>=utf8;</span><br></pre></td></tr></table></figure>

<p>2） 分别向两张表中插入记录  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> order_1990 <span class="keyword">values</span>(<span class="number">1</span>,<span class="number">100.0</span>,<span class="string">'上海'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> order_1990 <span class="keyword">values</span>(<span class="number">2</span>,<span class="number">100.0</span>,<span class="string">'北京'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> order_1991 <span class="keyword">values</span>(<span class="number">10</span>,<span class="number">100.0</span>,<span class="string">'北京'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> order_1991 <span class="keyword">values</span>(<span class="number">11</span>,<span class="number">100.0</span>,<span class="string">'上海'</span>);</span><br></pre></td></tr></table></figure>

<p>3） 查询三张表当中的数据：<br>order_1990表中的数据：  </p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> order_1990;</span><br></pre></td></tr></table></figure>

<p>order_1991表中的数据：  </p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> order_1991;</span><br></pre></td></tr></table></figure>

<p>order_all表中的数据：  </p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> order_all;</span><br></pre></td></tr></table></figure>

<h2 id="存储引擎-选择原则"><a href="#存储引擎-选择原则" class="headerlink" title="存储引擎 - 选择原则"></a>存储引擎 - 选择原则</h2><p>在选择存储引擎时，应该选择根据应用系统的特点选择合适的存储引擎。<br>对于复杂的应用系统，还可以根据实际情况选择多种存储引擎进行组合；<br>以下是几种常用的存储引擎的使用环境：  </p>
<ul>
<li>InnoDB<ul>
<li>是MySQL的默认存储引擎，用于事务处理应用程序，支持外键。</li>
<li>如果应用对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询以外，还包含很多的更新、删除操作，那么InnoDB存储引擎是比较合适的选择。  </li>
<li>InnoDB存储引擎除了有效的降低由于删除和更新导致的锁定，还可以确保事务的完整提交和回滚，对于类似于计费系统或者是财务系统等对数据准确性要求比较高的系统，InnoDB是最合适的选择；  </li>
</ul>
</li>
<li>MyISAM<ul>
<li>如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常合适的；  </li>
</ul>
</li>
<li>MEMORY<ul>
<li>将所有的数据保存在内存当中RAM，在需要快速定位记录和其他类似数据环境下，可以提供几块的访问。</li>
<li>MEMORY的缺陷就是对表的大小有限制，太大的表无法缓存在内存中，其次是要确保表的数据可以恢复，数据库异常终止后表中的数据是可以恢复的。  </li>
<li>MEMORY表通常用于更新不太频繁的小表，用以快速得到访问结果。  </li>
</ul>
</li>
<li>MERGE<ul>
<li>用于将一些列等同的MyISAM表以逻辑方式组合在一起，并作为一个对象引用他们。</li>
<li>MERGE表的优点在于可以突破对单个MyISAM表的大小限制，并且通过将不同的表分布在多个磁盘上，可以有效的改善MERGE表的访问效率，这对于存储诸如数据仓库等VLDB环境十分合适。  </li>
</ul>
</li>
</ul>
<p>有一个点：就是有没有类似emm，MERGE然后内部基层的表的存储引擎是InnoDB这种的；如果是这种的话；不是有那个什么分库分表什么的？（我不太了解分库分表，乱说的）  </p>
<h2 id="优化SQL步骤-SQL执行频率"><a href="#优化SQL步骤-SQL执行频率" class="headerlink" title="优化SQL步骤 - SQL执行频率"></a>优化SQL步骤 - SQL执行频率</h2><p>在应用的开发过程中，由于初期数据量小，开发人员写SQL语句时更重视功能上的实现，但是当应用系统正式上线后，随着生产数据的急剧增长，很多SQL语句开始逐渐显露出性能问题，对生产的影响也越来越大，此时这些有问题的SQL语句就成为整个系统性能的瓶颈，因此必须要对它们进行优化，本章将详细介绍MySQL中优化SQL语句的方法。  </p>
<p>当面对一个有SQL性能问题的数据库时，应该从何处入手来进行系统的分析，使得能够尽快定位问题SQL并尽快解决问题。  </p>
<h3 id="查看SQL执行频率"><a href="#查看SQL执行频率" class="headerlink" title="查看SQL执行频率"></a>查看SQL执行频率</h3><p>MySQL客户端连接成功后，通过 show [ session | global ] status 命令可以提供服务器状态信息。<br>show [ session | global ]status 可以根据需要加上参数 “session”或者“global”来显示session级（当前连接）的统计结果和global级（自数据库上次启动至今）的统计结果。<br>如果不写，默认使用参数是“session”。  </p>
<p>下面的命令显示了当前session中所有统计参数的值：</p>
<blockquote>
<p>针对数据库</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Com_______'</span>; <span class="comment"># _ 占位字符，匹配的模糊字符 查询级别为session会话级别</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Com_______'</span>; <span class="comment"># _ 匹配的模糊字符 查询级别为global全局级别</span></span><br><span class="line"></span><br><span class="line">Com_binlog</span><br><span class="line">Com_commit</span><br><span class="line">Com_delete <span class="comment">#删除的次数</span></span><br><span class="line">Com_insert <span class="comment">#插入的次数</span></span><br><span class="line">Com_repair</span><br><span class="line">Com_select <span class="comment">#查询的次数</span></span><br><span class="line">Com_revoke</span><br><span class="line">Com_signal</span><br><span class="line">Com_update <span class="comment">#修改的次数</span></span><br><span class="line">Com_xa_end</span><br><span class="line"></span><br><span class="line"><span class="comment">#此时查询的为当前连接session的信息，并非为整个数据库全局的统计参数</span></span><br><span class="line"><span class="comment">#如果需要查询全局则：show global status like 'Com_______';</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#通过知道当前数据库当中是以查询为主还是增删改为主；为SQL优化提供借鉴性指标</span></span><br></pre></td></tr></table></figure>

<p>Com_xxx表示每个xxx语句执行的次数，通常比较关心的是以下几个统计参数</p>
<table>
  <tr>
    <th>参数</th>
    <th>含义</th>
  </tr>
  <tr>
    <td>Com_select</td>
    <td>执行select操作的次数，一次查询只累加1</td>
  </tr>
  <tr>
    <td>Com_insert</td>
    <td>执行INSERT操作的次数，对于批量插入的INSERT操作，只累加一次</td>
  </tr>
  <tr>
    <td>Com_update</td>
    <td>执行UPDATE操作的次数</td>
  </tr>
  <tr>
    <td>Com_delete</td>
    <td>执行DELETE操作的次数</td>
  </tr>
  <tr>
    <td>Innodb_rows_read</td>
    <td>select查询返回的行数</td>
  </tr>
  <tr>
    <td>Innodb_rows_inserted</td>
    <td>执行INSERT操作插入的行数</td>
  </tr>
  <tr>
    <td>Innodb_rows_updated</td>
    <td>执行UPDATE操作更新的行数</td>
  </tr>
  <tr>
    <td>Innodb_rows_deleted</td>
    <td>执行DELETE操作删除的行数</td>
  </tr>
  <tr>
    <td>Connections</td>
    <td>视图连接MySQL服务器的次数</td>
  </tr>
  <tr>
    <td>Uptime</td>
    <td>服务器工作时间</td>
  </tr>
  <tr>
    <td>Slow_queries</td>
    <td>慢查询的次数</td>
  </tr>
</table>

<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Com_*** : 这些参数对于所有存储引擎的表操作都会进行累计</span><br><span class="line">Innodb_** : 这几个参数只是针对<span class="type">Innodb</span>存储引擎的，累加的算法也略有不同。</span><br></pre></td></tr></table></figure>

<blockquote>
<p>针对InnoDB存储引擎</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">针对于InnoDB：  </span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Innodb_rows_%'</span>;<span class="comment"># 此时查询出来的为InnoDB的各个操作所影响的行，数量</span></span><br><span class="line"></span><br><span class="line">Innodb_rows_deleted 2 <span class="comment"># 该存储引擎中删去的行数</span></span><br><span class="line">Innodb_rows_inserted 49<span class="comment"># 该存储引擎中插入的行数</span></span><br><span class="line">Innodb_rows_read 380<span class="comment"># 该存储引擎中读取的行数</span></span><br><span class="line">Innodb_rows_updated 15<span class="comment"># 更新的行数</span></span><br><span class="line"></span><br><span class="line">mysql -u root -p</span><br><span class="line"><span class="keyword">use</span> demo_01l</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods_innodb; <span class="comment"># Innodb_rows_read此时会增加，查询出来的结果集有n条记录，则Innodb_rows_read增加n</span></span><br><span class="line"></span><br><span class="line">Innodb_rows_deleted 2 <span class="comment"># 该存储引擎中删去的行数</span></span><br><span class="line">Innodb_rows_inserted 49<span class="comment"># 该存储引擎中插入的行数</span></span><br><span class="line">Innodb_rows_read 382<span class="comment"># 该存储引擎中读取的行数</span></span><br><span class="line">Innodb_rows_updated 15<span class="comment"># 更新的行数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> goods_innodb <span class="keyword">set</span> <span class="keyword">name</span> =<span class="string">'Meta30'</span>; <span class="comment"># Innodb_rows_update此时会增加；修改影响n条记录，则Innodb_rows_update增加n;</span></span><br><span class="line"></span><br><span class="line">Innodb_rows_deleted 2 <span class="comment"># 该存储引擎中删去的行数</span></span><br><span class="line">Innodb_rows_inserted 49<span class="comment"># 该存储引擎中插入的行数</span></span><br><span class="line">Innodb_rows_read 382<span class="comment"># 该存储引擎中读取的行数</span></span><br><span class="line">Innodb_rows_updated 17<span class="comment"># 更新的行数</span></span><br></pre></td></tr></table></figure>

<h2 id="优化SQL步骤-定位低效SQL"><a href="#优化SQL步骤-定位低效SQL" class="headerlink" title="优化SQL步骤 - 定位低效SQL"></a>优化SQL步骤 - 定位低效SQL</h2><p>可以通过以下两种方式定位执行效率较低的SQL语句。  </p>
<ul>
<li>慢查询日志：通过慢查询日志定位那些执行效率较低的SQL语句，用–log-slow-queries[ =file_name ]选项启动时，mysqld写一个包含所有执行时间超过long_query_time秒的SQL语句的日志文件。</li>
<li>show processlist：慢查询日志在查询结束以后才记录，所以在应该用反映执行效率出现问题的时候查询慢日志并不能定位问题，可以使用show processlist命令查看当前MySQL在进行的线程，包括线程的状态、是否锁表等，可以实时地查看SQL的执行情况，同时对一些锁表操作进行优化。(实时)  </li>
</ul>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">show processlist;</span><br><span class="line"></span><br><span class="line"><span class="meta">#（1）id列：用户登录mysql时，系统分配的“connection_id”，可以使用函数connection_id()查看；</span></span><br><span class="line"><span class="meta">#（2）user列：显示当前用户，如果不是root，这个命令就只显示用户权限范围的sql语句；</span></span><br><span class="line"><span class="meta">#（3）host列：显示这个语句是从哪个ip的哪个端口上发的，可以用来跟踪出现问题语句的用户；</span></span><br><span class="line"><span class="meta">#（4）db列：显示这个进程目前连接的是哪个数据库；</span></span><br><span class="line"><span class="meta">#（5）command列：显示当前连接的执行命令，一般取值为休眠（sleep）、查询（query）、连接（connect）等；</span></span><br><span class="line"><span class="meta">#（6）time列，显示这个状态持续的时间，单位是秒；</span></span><br><span class="line"><span class="meta">#（7）state列，显示使用当前连接的sql语句的状态，很重要的列。state描述的是语句执行中的某个状态。一个sql语句，以查询为例，可能需要经过copying to tmp table， sorting result， sending data等状态才可以完成。  </span></span><br><span class="line"><span class="meta">#（8）info列，显示这个sql语句，是判断问题语句的一个重要依据。</span></span><br></pre></td></tr></table></figure>

<h2 id="优化SQL步骤-explain指令介绍"><a href="#优化SQL步骤-explain指令介绍" class="headerlink" title="优化SQL步骤 - explain指令介绍"></a>优化SQL步骤 - explain指令介绍</h2><p>通过以上步骤查询到效率低的SQL语句后，可以通过EXPLAIN或者DESC命令获取MySQL如何执行SELECT语句的信息，包括SELECT语句执行过程中表如何连接和连接的顺序。  </p>
<p>查询SQL语句的执行计划：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> tb_item <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<table>
  <tr>
    <th>id</th>
    <th>select_type</th>
    <th>table</th>
    <th>type</th>
    <th>possible_keys</th>
    <th>key</th>
    <th>key_len</th>
    <th>ref</th>
    <th>rows</th>
    <th>Extra</th>
  </tr>
  <tr>
    <td>1</td>
    <td>SIMPLE</td>
    <td>tb_item</td>
    <td>const</td>
    <td>PRIMARY</td>
    <td>PRIMARY</td>
    <td>4</td>
    <td>const</td>
    <td>1</td>
    <td>NULL</td>
  </tr>
</table>

<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> tb_item <span class="keyword">where</span> <span class="built_in">title</span>=<span class="string">'阿尔卡特（OT-979）冰川白 联通3G手机3'</span>;</span><br></pre></td></tr></table></figure>

<table>
  <tr>
    <th>id</th>
    <th>select_type</th>
    <th>table</th>
    <th>type</th>
    <th>possible_keys</th>
    <th>key</th>
    <th>key_len</th>
    <th>ref</th>
    <th>rows</th>
    <th>Extra</th>
  </tr>
  <tr>
    <td>1</td>
    <td>SIMPLE</td>
    <td>tb_item</td>
    <td>ALL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>9816098</td>
    <td>Using where</td>
  </tr>
</table>

<table>
  <tr>
    <th>字段</th>
    <th>含义</th>
  </tr>
  <tr>
    <td>id</td>
    <td>select查询的序列号，是一组数字，表示的是查询中select子句或者是操作表的顺序。（与表结构执行的顺序有关系）</td>
  </tr>
  <tr>
    <td>select_type</td>
    <td>表示SELECT的类型，常见的取值有SIMPLE（简单表，即不使用表连接或者是子查询）、PRIMARY（主查询，即外层的查询）、UNION（UNION中的第二个或者后面的查询语句）、SUBQUERY（子查询中的第一个SELECT）等</td>
  </tr>
  <tr>
    <td>table</td>
    <td>输出结果集的表（当前输出的数据与哪一张表有关）</td>
  </tr>
  <tr>
    <td>type</td>
    <td>表示表的连接类型，性能由好到差的连接类型为（system---->const---->eq_ref------>ref------->ref_or_null------>index_merge------>index_subquery------->range------>index------>all）</td>
  </tr>
  <tr>
    <td>possible_keys</td>
    <td>表示查询时，可能使用的索引。</td>
  </tr>
  <tr>
    <td>key</td>
    <td>表示实际使用的索引</td>
  </tr>
  <tr>
    <td>key_len</td>
    <td>索引字段的长度</td>
  </tr>
  <tr>
    <td>ref</td>
    <td>引用</td>
  </tr>
  <tr>
    <td>rows</td>
    <td>扫描行的数量</td>
  </tr>
  <tr>
    <td>extra</td>
    <td>执行情况的说明和描述，额外的内容，前面几个字段当中没有表述清楚的，在这个字段当中表述出来</td>
  </tr>
</table>

<blockquote>
<p>explain 用来查看SQL语句的执行计划。</p>
</blockquote>
<h2 id="优化SQL步骤-explain之id"><a href="#优化SQL步骤-explain之id" class="headerlink" title="优化SQL步骤 - explain之id"></a>优化SQL步骤 - explain之id</h2><p><strong>环境准备</strong></p>
<p>用户表、角色表、用户角色表（多对多关系）  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE <span class="string">'t_role'</span>(</span><br><span class="line">  <span class="string">'id'</span> varchar(32) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">'role_name'</span> varchar(255)<span class="built_in"> DEFAULT </span><span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">'role_code'</span> varchar(255)<span class="built_in"> DEFAULT </span><span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">'description'</span> varchar(255)<span class="built_in"> DEFAULT </span><span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY KEY (<span class="string">'id'</span>),</span><br><span class="line">  UNIQUE KEY <span class="string">'union_role_name'</span> (<span class="string">'role_name'</span>)</span><br><span class="line">)<span class="attribute">ENGINE</span>=InnoDB<span class="built_in"> DEFAULT </span><span class="attribute">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line">CREATE TABLE <span class="string">'t_user'</span>(</span><br><span class="line">  <span class="string">'id'</span> varchar(32) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">'username'</span> varchar(45)<span class="built_in"> DEFAULT </span><span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">'name'</span> varchar(45)<span class="built_in"> DEFAULT </span><span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">'password'</span> varchar(96)<span class="built_in"> DEFAULT </span><span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY KEY (<span class="string">'id'</span>),</span><br><span class="line">  UNIQUE KEY <span class="string">'union_user_username'</span> (<span class="string">'user_name'</span>)</span><br><span class="line">)<span class="attribute">ENGINE</span>=InnoDB<span class="built_in"> DEFAULT </span><span class="attribute">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE <span class="string">'user_role'</span>(</span><br><span class="line">  <span class="string">'id'</span> int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span> autoincrement,</span><br><span class="line">  <span class="string">'user_id'</span> varchar(32)<span class="built_in"> DEFAULT </span><span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">'role_id'</span> varchar(32)<span class="built_in"> DEFAULT </span><span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY KEY (<span class="string">'id'</span>),</span><br><span class="line">  KEY <span class="string">'fk_ur_user_id'</span>(<span class="string">'user_id'</span>),</span><br><span class="line">  KEY <span class="string">'fk_ur_role_id'</span>(<span class="string">'role_id'</span>),</span><br><span class="line">  CONSTRAINT <span class="string">'fk_ur_role_id'</span> FOREIGN KEY (<span class="string">'role_id'</span>) REFERENCES <span class="string">'t_role'</span> (<span class="string">'id'</span>) ON DELETE <span class="literal">NO</span> ACTION ON UPDATE <span class="literal">NO</span> ACTION,</span><br><span class="line">  CONSTRAINT <span class="string">'fk_ur_user_id'</span> FOREIGN KEY (<span class="string">'user_id'</span>) REFERENCES <span class="string">'t_user'</span> (<span class="string">'id'</span>) ON DELETE <span class="literal">NO</span> ACTION ON UPDATE <span class="literal">NO</span> ACTION</span><br><span class="line">)<span class="attribute">ENGINE</span>=InnoDB<span class="built_in"> DEFAULT </span><span class="attribute">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入用戶数据</span></span><br><span class="line">insert into <span class="string">'t_user'</span>(<span class="string">'id'</span>,<span class="string">'username'</span>,<span class="string">'password'</span>,<span class="string">'name'</span>) values(<span class="string">'1'</span>,<span class="string">'老王'</span>,<span class="string">'xxxxxyyyyyyy'</span>,<span class="string">'超级管理员'</span>);</span><br><span class="line">insert into <span class="string">'t_user'</span>(<span class="string">'id'</span>,<span class="string">'username'</span>,<span class="string">'password'</span>,<span class="string">'name'</span>) values(<span class="string">'2'</span>,<span class="string">'老李'</span>,<span class="string">'xxxxxyyyyyyyzzzzz'</span>,<span class="string">'系统管理员'</span>);</span><br><span class="line">insert into <span class="string">'t_user'</span>(<span class="string">'id'</span>,<span class="string">'username'</span>,<span class="string">'password'</span>,<span class="string">'name'</span>) values(<span class="string">'3'</span>,<span class="string">'老头子'</span>,<span class="string">'xxxxxyyyytyyyzzzzz'</span>,<span class="string">'学生1'</span>);</span><br><span class="line">insert into <span class="string">'t_user'</span>(<span class="string">'id'</span>,<span class="string">'username'</span>,<span class="string">'password'</span>,<span class="string">'name'</span>) values(<span class="string">'4'</span>,<span class="string">'老婆子'</span>,<span class="string">'xxxxxyywyyyyyzzzzz'</span>,<span class="string">'学生2'</span>);</span><br><span class="line">insert into <span class="string">'t_user'</span>(<span class="string">'id'</span>,<span class="string">'username'</span>,<span class="string">'password'</span>,<span class="string">'name'</span>) values(<span class="string">'5'</span>,<span class="string">'super'</span>,<span class="string">'xxxxxyyfyyyyyzzzzz'</span>,<span class="string">'学生3'</span>);</span><br><span class="line">insert into <span class="string">'t_user'</span>(<span class="string">'id'</span>,<span class="string">'username'</span>,<span class="string">'password'</span>,<span class="string">'name'</span>) values(<span class="string">'6'</span>,<span class="string">'admin'</span>,<span class="string">'xxxxxyyyyyyyzzzzze'</span>,<span class="string">'学生4'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入角色数据</span></span><br><span class="line"><span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line"><span class="comment"># 插入用户角色数据</span></span><br><span class="line"><span class="built_in">..</span><span class="built_in">..</span></span><br></pre></td></tr></table></figure>

<p><strong>explain当中的id字段</strong></p>
<p>id字段是select查询的序号(并不是自增，控制表结构的执行顺序)，是一组数字，表示是的是处查询中执行select子句或者是操作表的顺序，id情况有三种：<br>（1）<strong>id相同表示加载表的顺序是从上到下</strong>  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_role r,t_user u,user_role ur <span class="keyword">where</span> r.id=ur.role_id <span class="keyword">and</span> u.id=ur.user_id;<span class="comment"># 多表联查</span></span><br></pre></td></tr></table></figure>

<table>
  <tr>
    <th>id</th>
    <th>select_type</th>
    <th>table</th>
    <th>type</th>
    <th>possible_keys</th>
    <th>key</th>
    <th>key_len</th>
    <th>ref</th>
    <th>rows</th>
    <th>Extra</th>
  </tr>
  <tr>
    <td>1</td>
    <td>SIMPLE</td>
    <td>r</td>
    <td>PRIMARY</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>5</td>
    <td>NULL</td>
  </tr>
  <tr>
    <td>1</td>
    <td>SIMPLE</td>
    <td>ur</td>
    <td>ref</td>
    <td>fk_ur_user_id,fk_ur_role_id</td>
    <td>fk_ur_role_id</td>
    <td>99</td>
    <td>db03.r.id</td>
    <td>1</td>
    <td>Using where</td>
  </tr>
  <tr>
    <td>1</td>
    <td>SIMPLE</td>
    <td>u</td>
    <td>eq_ref</td>
    <td>PRIMARY</td>
    <td>PRIMARY</td>
    <td>98</td>
    <td>db.ur.user_id</td>
    <td>1</td>
    <td>NULL</td>
  </tr>
</table>

<p>（2）<strong>id不同id值越大，优先级越高，越先被执行</strong>  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_role <span class="keyword">WHERE</span> <span class="keyword">id</span>=</span><br><span class="line">(</span><br><span class="line">  <span class="keyword">SELECT</span> role_id <span class="keyword">FROM</span> user_role <span class="keyword">WHERE</span> user_id=</span><br><span class="line">  (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> username=<span class="string">'stu1'</span></span><br><span class="line">  )</span><br><span class="line">)<span class="comment"># 嵌套子查询</span></span><br></pre></td></tr></table></figure>

<table>
  <tr>
    <th>id</th>
    <th>select_type</th>
    <th>table</th>
    <th>type</th>
    <th>possible_keys</th>
    <th>key</th>
    <th>key_len</th>
    <th>ref</th>
    <th>rows</th>
    <th>Extra</th>
  </tr>
  <tr>
    <td>1</td>
    <td>PRIMARY</td>
    <td>t_role</td>
    <td>const</td>
    <td>PRIMARY</td>
    <td>PRIMARY</td>
    <td>98</td>
    <td>const</td>
    <td>1</td>
    <td>NULL</td>
  </tr>
  <tr>
    <td>2</td>
    <td>SUBQUERY</td>
    <td>user_role</td>
    <td>ref</td>
    <td>fk_ur_user_id</td>
    <td>fk_ur_user_id</td>
    <td>99</td>
    <td>const</td>
    <td>1</td>
    <td>Using where</td>
  </tr>
  <tr>
    <td>3</td>
    <td>SUBQUERY</td>
    <td>t_user</td>
    <td>const</td>
    <td>unique_user_username</td>
    <td>unique_user_username</td>
    <td>137</td>
    <td>const</td>
    <td>1</td>
    <td>Using index</td>
  </tr>
</table>

<p>（3）<strong>id有相同，也有不同，同时存在。id相同的可以认为是一组，从上往下顺序执行；在所有的组中，id的值越大，优先级越高，越先执行。</strong>  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_role r,</span><br><span class="line">(</span><br><span class="line">  <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> user_role ur <span class="keyword">WHERE</span> ur.<span class="string">'user_id'</span>=<span class="string">'2'</span></span><br><span class="line">) a  </span><br><span class="line"><span class="keyword">WHERE</span> r.id=a.role_id;  </span><br><span class="line"><span class="comment">#三表查询又连接了一个子查询</span></span><br></pre></td></tr></table></figure>

<table>
  <tr>
    <th>id</th>
    <th>select_type</th>
    <th>table</th>
    <th>type</th>
    <th>possible_keys</th>
    <th>key</th>
    <th>key_len</th>
    <th>ref</th>
    <th>rows</th>
    <th>Extra</th>
  </tr>
  <tr>
    <td>1</td>
    <td>PRIMARY</td>
    <td>< derived2></td>
    <td>ALL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>2</td>
    <td>Using where</td>
  </tr>
  <tr>
    <td>1</td>
    <td>PRIMARY</td>
    <td>r</td>
    <td>eq_ref</td>
    <td>PRIMARY</td>
    <td>PRIMARY</td>
    <td>98</td>
    <td>a.role_id</td>
    <td>1</td>
    <td>NULL</td>
  </tr>
  <tr>
    <td>2</td>
    <td>DERIVED</td>
    <td>ur</td>
    <td>ref</td>
    <td>fk_ur_user_id</td>
    <td>fk_ur_user_id</td>
    <td>99</td>
    <td>const</td>
    <td>1</td>
    <td>Using index condition</td>
  </tr>
</table>

<h2 id="优化SQL步骤-explain之select-type"><a href="#优化SQL步骤-explain之select-type" class="headerlink" title="优化SQL步骤 - explain之select_type"></a>优化SQL步骤 - explain之select_type</h2><p><strong>explain之select_type</strong><br>表示SELECT的类型，常见的取值，如下表所示（从上往下，效率越来越低）：  </p>
<table>
  <tr>
    <th>select_type</th>
    <th>含义</th>
  </tr>
  <tr>
    <td>SIMPLE</td>
    <td>简单的select查询，查询中不包含子查询或者UNION。</td>
  </tr>
  <tr>
    <td>PRIMARY</td>
    <td>查询中若包含任何复杂的子查询，最外层查询标记为该标识。</td>
  </tr>
  <tr>
    <td>SUBQUERY</td>
    <td>在SELECT或者WHERE列表中包含了子查询。</td>
  </tr>
  <tr>
    <td>DERIVED</td>
    <td>在FROM列表中包含的子查询，被标记为DERIVED（衍生）MYSQL或递归执行这些子查询，把结果放在临时表中。</td>
  </tr>
  <tr>
    <td>UNION</td>
    <td>若第二个SELECT出现在UNION之后，则标记为UNION；若UNION包含在FROM子句的子查询中，外层SELECT将标记为：DERIVED</td>
  </tr>
  <tr>
    <td>UNION RESULT</td>
    <td>从UNION表获取结果的SELECT</td>
  </tr>
</table>

<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> tb_item;</span><br><span class="line"># SIMPLE  </span><br><span class="line"></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> id=(<span class="keyword">select</span> id <span class="keyword">from</span> user_role <span class="keyword">where</span> role_id=<span class="string">'9'</span>);  </span><br><span class="line"># <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> id： <span class="keyword">PRIMARY</span> ；  </span><br><span class="line">#(<span class="keyword">select</span> id <span class="keyword">from</span> user_role <span class="keyword">where</span> role_id=<span class="string">'9'</span>)：SUBQUERY  </span><br><span class="line"></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> a.* <span class="keyword">from</span> (<span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> id <span class="keyword">in</span> (<span class="string">'1'</span>,<span class="string">'2'</span>)) a;</span><br><span class="line"># <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> id <span class="keyword">in</span> (<span class="string">'1'</span>,<span class="string">'2'</span>): <span class="keyword">DERIVED</span>；存储至衍生的临时表</span><br><span class="line"># <span class="keyword">select</span> a.* <span class="keyword">from</span> ： <span class="keyword">PRIMARY</span>  derived2指的是<span class="keyword">derived</span>指的是衍生的表a，<span class="number">2</span>则指的是id，执行操作表顺序字段；</span><br><span class="line"></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> id=<span class="string">'1'</span> <span class="keyword">union</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> id=<span class="string">'2'</span>;</span><br><span class="line">#<span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> id=<span class="string">'1'</span>: <span class="keyword">PRIMARY</span></span><br><span class="line">#<span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> id=<span class="string">'2'</span> ： <span class="keyword">UNION</span></span><br><span class="line"># <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> id=<span class="string">'1'</span>的结果  &amp;&amp;  <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> id=<span class="string">'2'</span>的结果联合起来： <span class="keyword">UNION</span> RESULT</span><br></pre></td></tr></table></figure>

<h2 id="优化SQL步骤-explain之table-、type"><a href="#优化SQL步骤-explain之table-、type" class="headerlink" title="优化SQL步骤 - explain之table 、type"></a>优化SQL步骤 - explain之table 、type</h2><p><strong>explain之table</strong><br>展示这一行的数据是关于哪一张表的；  </p>
<p><strong>explain之type</strong><br>type显示的是访问类型，是较为重要的一个指标，可取值为：  </p>
<table>
  <tr>
    <th>type</th>
    <th>含义</th>
  </tr>
  <tr>
    <td>NULL</td>
    <td>MySQL不访问任何表，索引，直接返回结果</td>
  </tr>
  <tr>
    <td>system</td>
    <td>表只有一行记录（等同于系统表），这是const类型的特例，一般不会出现</td>
  </tr>
  <tr>
    <td>const</td>
    <td>表示通过索引一次就找到了，const用于比较primary key或者unique索引。因为只匹配一行数据，索引很快。如将主键置于where列表中，MySQL就能将该查询转换成一个常量。(根据主键或者唯一索引进行查询)</td>
  </tr>
  <tr>
    <td>eq_ref</td>
    <td>类似ref，区别在于使用的是唯一索引，使用主键的关联查询，关联查询出的记录只有一条。常见于主键或唯一索引扫描</td>
  </tr>
  <tr>
    <td>ref</td>
    <td>非唯一性索引扫描，返回皮诶某个单独值的所有行。本质上也是野种索引访问，返回所有匹配某个单独值的所有行（多个）</td>
  </tr>
  <tr>
    <td>range</td>
    <td>只检索给定返回的行，使用一个索引来选择行。where之后出现between，<，>，in等操作</，></td>
  </tr>
  <tr>
    <td>index</td>
    <td>index与ALL的区别为index类型只是遍历了索引树，通常比ALL快，ALL是遍历数据文件。</td>
  </tr>
  <tr>
    <td>all</td>
    <td>将遍历全表以找到匹配的行</td>
  </tr>
</table>

<p><strong>type为NULL</strong></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> now(); # 查询当前时间(查询效率非常高) ： <span class="keyword">type</span>-&gt;<span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例：</p>
</blockquote>
<table>
  <tr>
    <th>id</th>
    <th>select_type</th>
    <th>table</th>
    <th>type</th>
    <th>possible_keys</th>
    <th>key</th>
    <th>key_len</th>
    <th>ref</th>
    <th>rows</th>
    <th>Extra</th>
  </tr>
  <tr>
    <td>1</td>
    <td>SIMPLE</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>No tables used</td>
  </tr>
</table>

<p><strong>type为system</strong></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> id=<span class="string">'1'</span>) a;： <span class="keyword">type</span>-&gt;<span class="keyword">system</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例：</p>
</blockquote>
<table>
  <tr>
    <th>id</th>
    <th>select_type</th>
    <th>table</th>
    <th>type</th>
    <th>possible_keys</th>
    <th>key</th>
    <th>key_len</th>
    <th>ref</th>
    <th>rows</th>
    <th>Extra</th>
  </tr>
  <tr>
    <td>1</td>
    <td>PRIMARY</td>
    <td>< derived2></td>
    <td>system</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>1</td>
    <td>NULL</td>
  </tr>
  <tr>
    <td>2</td>
    <td>DERIVED</td>
    <td>t_user</td>
    <td>const</td>
    <td>PRIMARY</td>
    <td>PRIMARY</td>
    <td>98</td>
    <td>const</td>
    <td>1</td>
    <td>NULL</td>
  </tr>
</table>

<p><strong>type为const</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> <span class="keyword">id</span>=<span class="string">'1'</span>;<span class="comment"># 根据主键查询返回一条记录：type-&gt;const</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例：</p>
</blockquote>
<table>
  <tr>
    <th>id</th>
    <th>select_type</th>
    <th>table</th>
    <th>type</th>
    <th>possible_keys</th>
    <th>key</th>
    <th>key_len</th>
    <th>ref</th>
    <th>rows</th>
    <th>Extra</th>
  </tr>
  <tr>
    <td>1</td>
    <td>SIMPLE</td>
    <td>t_user</td>
    <td>const</td>
    <td>PRIMARY</td>
    <td>PRIMARY</td>
    <td>98</td>
    <td>const</td>
    <td>1</td>
    <td>NULL</td>
  </tr>
</table>

<p><strong>type为const</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> username=<span class="string">'stu1'</span>;<span class="comment">#根据唯一索引查询返回一条记录：type-&gt;const</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例：</p>
</blockquote>
<table>
  <tr>
    <th>id</th>
    <th>select_type</th>
    <th>table</th>
    <th>type</th>
    <th>possible_keys</th>
    <th>key</th>
    <th>key_len</th>
    <th>ref</th>
    <th>rows</th>
    <th>Extra</th>
  </tr>
  <tr>
    <td>1</td>
    <td>SIMPLE</td>
    <td>t_user</td>
    <td>const</td>
    <td>unique_user_username</td>
    <td>unique_user_username</td>
    <td>137</td>
    <td>const</td>
    <td>1</td>
    <td>NULL</td>
  </tr>
</table>

<p><strong>type为eq_ref</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t_user;//id有1、2、3、4、5、6</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t_role;//id有10、5、7、8、9</span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_user u ,t_role r <span class="keyword">where</span> u.id=r.id;<span class="comment">#业务逻辑层面不符合，只是数据库硬性查询（强行关联）出一个type为eq_ref的示例而已</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例：</p>
</blockquote>
<table>
  <tr>
    <th>id</th>
    <th>select_type</th>
    <th>table</th>
    <th>type</th>
    <th>possible_keys</th>
    <th>key</th>
    <th>key_len</th>
    <th>ref</th>
    <th>rows</th>
    <th>Extra</th>
  </tr>
  <tr>
    <td>1</td>
    <td>SIMPLE</td>
    <td>r</td>
    <td>ALL</td>
    <td>PRIMARY</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>NULL</td>
    <td>5</td>
    <td>NULL</td>
  </tr>
  <tr>
    <td>1</td>
    <td>SIMPLE</td>
    <td>u</td>
    <td>eq_ref</td>
    <td>PRIMARY</td>
    <td>PRIMARY</td>
    <td>98</td>
    <td>demo_02.r.id</td>
    <td>1</td>
    <td>NULL</td>
  </tr>
</table>

<p><strong>type为ref</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> t_user;<span class="comment">#查询t_user表当中的索引</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> idx_user_name <span class="keyword">on</span> t_user(<span class="string">'name'</span>);</span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'a'</span>;<span class="comment">#根据非唯一性索引进行查询，返回的记录只有一条</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例：</p>
</blockquote>
<table>
  <tr>
    <th>id</th>
    <th>select_type</th>
    <th>table</th>
    <th>type</th>
    <th>possible_keys</th>
    <th>key</th>
    <th>key_len</th>
    <th>ref</th>
    <th>rows</th>
    <th>Extra</th>
  </tr>
  <tr>
    <td>1</td>
    <td>SIMPLE</td>
    <td>t_user</td>
    <td>ref</td>
    <td>idx_user_name</td>
    <td>idx_user_name</td>
    <td>137</td>
    <td>const</td>
    <td>1</td>
    <td>Using index condition</td>
  </tr>
</table>

<p><strong>type为range(范围查询)</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span>.（between <span class="keyword">and</span>）、（&gt;、&lt;、&gt;=、&lt;=）<span class="built_in">..</span>.</span><br></pre></td></tr></table></figure>

<p><strong>type为index(指的即索引)</strong></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_user;//查询所有数据，进行全表扫描，即到数据文件当中进行读取；<span class="keyword">type</span>为<span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> id <span class="keyword">from</span> t_user;//此时<span class="keyword">type</span>为<span class="keyword">index</span>；因为id为主键，主键则走主键索引；</span><br></pre></td></tr></table></figure>

<p>结果值从最好到最坏依次是：  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">NULL</span> &gt;<span class="built_in"> system </span>&gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; all</span><br></pre></td></tr></table></figure>

<h2 id="优化SQL步骤-explain之key-rows-extra"><a href="#优化SQL步骤-explain之key-rows-extra" class="headerlink" title="优化SQL步骤 - explain之key rows extra"></a>优化SQL步骤 - explain之key rows extra</h2><p><strong>explain之key</strong>  </p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">possible_keys:</span>显示可能应用在这张表的索引，一个或者多个；</span><br><span class="line"><span class="symbol">key:</span>实际使用的索引，如果为NULL，则没有使用索引；</span><br><span class="line">key_len：表示索引中使用的字节数，该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下，长度越短越好（越短执行效率越高）；</span><br></pre></td></tr></table></figure>

<p><strong>explain之rows</strong>  </p>
<p>扫描行的数量。  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> <span class="type">name</span> =<span class="string">'a'</span>;#<span class="type">name</span>建了索引，所以查询<span class="keyword">rows</span>为<span class="number">1</span>行</span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">where</span> <span class="keyword">password</span>=<span class="string">'aaa'</span>;# <span class="keyword">password</span>没有建立索引，整表扫描；<span class="keyword">rows</span>即<span class="keyword">SQL</span>语句查询时所查询的行数；</span><br></pre></td></tr></table></figure>

<p><strong>explain之extra</strong>  </p>
<p>其他的额外的执行计划信息，在该列展示。<br>（using_filesort以及using_temporary非常耗性能；需要优化using_filesort以及using_temporary；保持using_index）</p>
<table>
  <tr>
    <th>extra</th>
    <th>含义</th>
  </tr>
  <tr>
    <td>using_filesort</td>
    <td>说明mysql会对数据使用一个外部的索引排序，而不是按照表内的索引顺序进行读取，称为“文件排序”</td>
  </tr>
  <tr>
    <td>using_temporary</td>
    <td>使用了临时表保存中间结果，MySQL对查询结果排序时使用临时表。常见于order by 和group by</td>
  </tr>
  <tr>
    <td>using_index</td>
    <td>表示相应的select操作使用了覆盖索引，避免访问表的数据行，效率不错。</td>
  </tr>
</table>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">id</span>;<span class="comment">#按照id进行排序</span></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">password</span>;<span class="comment">#根据文件进行排序；即需要扫描文件当中的内容，然后再去进行排序；效率非常低；这个时候如果需要进行优化的话，可以在password字段上与name一样建立索引；</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">name</span>; <span class="comment">#此时依然是using_filesort根据文件排序</span></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> t_user <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">name</span>;<span class="comment">#此时则使用的是using_index根据索引排序</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">name</span>;<span class="comment">#此时extra为null，原因是根据name字段建立了索引</span></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> t_user <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">password</span>;<span class="comment">#此时password字段没有建立索引；extra为using temporary；using filesort效率低；</span></span><br></pre></td></tr></table></figure>

<h2 id="优化SQL步骤-show-profile"><a href="#优化SQL步骤-show-profile" class="headerlink" title="优化SQL步骤 - show profile"></a>优化SQL步骤 - show profile</h2><p>MySQL从5.0.37版本开始增加了对 show profiles 和show profile语句的支持。  </p>
<p>show profiles能够在做SQL优化时帮助了解事件都耗费到哪里去了；  </p>
<p>通过 have_profiling 参数，能够看到当前MySQL是否支持profile；  </p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">select</span> <span class="comment">@@</span>have_profiling;<span class="meta">#系统变量；YES/NO</span></span><br></pre></td></tr></table></figure>

<p>默认 profiling 是关闭的，可以通过set语句在Session级别开启profiling：  </p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @<span class="symbol">@profiling</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">set</span> <span class="attribute">profiling</span>=1;# 开启profiling开关；0:未开启；1：开启</span><br></pre></td></tr></table></figure>

<p>通过profile，能够更清楚的了解SQL执行的过程；<br>首先，可以执行一系列的操作，如下图所示：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> db01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t_user;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> tb_item;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_item <span class="keyword">where</span> title=<span class="string">'abc'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">profiles</span>;<span class="comment">#查看之前每一个操作的耗时情况 query_id(当前查询的id)、duration（执行的耗时时间）、query（查询的sql）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># use db01;其实底层即select database();</span></span><br></pre></td></tr></table></figure>

<p>执行完上述命令之后，再执行show profiles指令，来查看SQL语句执行的耗时：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">profiles</span>;<span class="comment"># query_id、duration、query</span></span><br></pre></td></tr></table></figure>

<p>通过 show profile for query query_id 语句可以查看到该SQL执行过程中每个线程的状态和消耗的时间；  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show<span class="built_in"> profile </span><span class="keyword">for</span> query 6;#6即通过show profiles查询出来的query_id;  status、duration</span><br></pre></td></tr></table></figure>

<table>
  <tr>
    <th>status（经历的每一个阶段）</th>
    <th>duration（每一个阶段的耗时情况）</th>
  </tr>
  <tr>
    <td>starting（开启）</td>
    <td>0.000046</td>
  </tr>
  <tr>
    <td>checking permissions（校验权限）</td>    <td>...</td>
  </tr>
  <tr>
    <td>opening tables（打开表）</td>    <td>...</td>
  </tr>
    <tr>
    <td>init（初始化）</td>    <td>...</td>
  </tr>
    <tr>
    <td>system lock（系统锁）</td>    <td>...</td>
  </tr>
    <tr>
    <td>optimizing（优化器）</td>    <td>...</td>
  </tr>
    <tr>
    <td>statistics（统计）</td>    <td>...</td>
  </tr>
    <tr>
    <td>perparing（准备）</td>    <td>...</td>
  </tr>
    <tr>
    <td>executing（执行）</td>    <td>...</td>
  </tr>
    <tr>
    <td>sending data（发送数据）</td>    <td>...</td>
  </tr>
    <tr>
    <td>end（结束）</td>    <td>...</td>
  </tr>
    <tr>
    <td>query end（查询结束）</td>    <td>...</td>
  </tr>
    <tr>
    <td>closing tabls（关闭表）</td>    <td>...</td>
  </tr>
    <tr>
    <td>freeing itmes（释放其他项）</td>    <td>...</td>
  </tr>
    <tr>
    <td>cleaning up（清除）</td>
    <td>...</td>
  </tr>
</table>

<p>（select count(*) from tb_item；该sql语句的时间都耗费在sending data上了；）  </p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">TIP:  </span></span><br><span class="line"><span class="code">    Sending data 状态表示MySQL线程开始访问数据行并把结果放回给客户端，而不仅仅是返回给客户端。  </span></span><br><span class="line"><span class="code">    由于Sending data 状态下，MySQL线程往往需要做大量的磁盘读取操作，所以经常是整个查询中耗时最长的状态。</span></span><br></pre></td></tr></table></figure>

<p>在获取到最耗时时间的线程状态后，MySQL支持进一步选择all、cpu、block io、context switch、page faults 等明细类型等查看MySQL在使用什么资源上耗费了过高的时间。<br>例如，选择查看CPU的耗费时间：  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select<span class="built_in"> profile </span>cpu <span class="keyword">for</span> query 6;# status、duration、CPU_user、CPU_System查询到的是id为6的该条sql语句在各个阶段当中cpu的耗费情况；</span><br><span class="line"></span><br><span class="line">select<span class="built_in"> profile </span>all <span class="keyword">for</span> query 6;# status、duration、CPU_user、CPU_system、context_voluntary、context_involuntary、block_ops_in、block_ops_out、<span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过show profile可以分析SQL语句各个阶段的耗时情况</p>
</blockquote>
<h2 id="优化SQL步骤-trace工具"><a href="#优化SQL步骤-trace工具" class="headerlink" title="优化SQL步骤 - trace工具"></a>优化SQL步骤 - trace工具</h2><p>mysql的服务端server有一个步骤就是optimizer，优化sql部分；按照mysql当中具体对应的规则对SQL进行优化处理；trace即分析优化器</p>
<p><strong>trace分析优化器执行计划</strong><br>MySQL5.6提供了对SQL的跟踪 trace，通过trace文件能够进一步了解为什么优化器选择A计划，而不是B计划。  </p>
<p>打开trace，设置格式为JSON，并设置trace最大能够使用的内存大小，避免解析过程中因为默认内存过小而不能够完整展示。  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">SET</span> optimizer_trace =<span class="string">'enabled=on'</span>, <span class="attribute">end_markers_in_json</span>=on;# optimizer_trace =<span class="string">'enabled=on'</span>进行开启；<span class="attribute">end_markers_in_json</span>=on 设置格式为JSON</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">set</span> <span class="attribute">optimizer_trace_max_mem_size</span>=1000000;# 日志文件占用内存大小</span><br></pre></td></tr></table></figure>

<p>执行SQL语句：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_item <span class="keyword">where</span> <span class="keyword">id</span> &lt; <span class="number">4</span>;</span><br></pre></td></tr></table></figure>

<p>最后，检查information_schema.optimizer_trace就可以知道MySQL是如何执行SQL的：  </p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> infomation_schema.optimizer_trace\G;# infomation_schema系统库；optimizer_trace系统库当中的日志表</span><br><span class="line"></span><br><span class="line"># QUERY 查询的SQL语句；<span class="keyword">select</span> * <span class="keyword">from</span> tb_item <span class="keyword">where</span> id&lt;<span class="number">4</span>;</span><br><span class="line"># TRACE 跟踪信息；在跟踪信息当中最终<span class="keyword">select</span> * 当中的* 最终解析为tb_item表当中的每一个具体的字段</span><br></pre></td></tr></table></figure>

<h2 id="索引的使用-验证索引提升查询效率"><a href="#索引的使用-验证索引提升查询效率" class="headerlink" title="索引的使用 - 验证索引提升查询效率"></a>索引的使用 - 验证索引提升查询效率</h2><p><strong>索引的使用</strong><br>索引时候数据库优化最常用也是最重要的手段之一，通过索引通常可以帮助用户解决大多数的MySQL的性能优化问题；  </p>
<p><strong>验证索引提升查询效率</strong><br>在准备的表结构tb_item中，一共存储了300万条记录；  </p>
<p><strong>A.</strong> 根据ID查询  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> tb_items;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_item <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1888</span>;<span class="comment">#id字段具有主键索引</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_item <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1999</span>\G;</span><br><span class="line"></span><br><span class="line"><span class="comment">#根据title进行精确查询</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_item <span class="keyword">where</span> title=<span class="string">'阿尔卡特'</span>;<span class="comment">#查询速度慢，因为title字段没有索引，查询效率低，创建主键即自动生成主键索引；</span></span><br><span class="line"><span class="comment">#查看SQL语句的执行计划：  </span></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> tb_item <span class="keyword">where</span> title=<span class="string">'阿尔卡特'</span>\G;</span><br></pre></td></tr></table></figure>

<p>处理方案，针对title字段，创建索引：  </p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> idx_item_title <span class="keyword">on</span> tb_item(<span class="built_in">title</span>);</span><br></pre></td></tr></table></figure>

<p>索引创建完成之后，再次查询：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_item <span class="keyword">where</span> title=<span class="string">'阿尔卡特'</span>\G;</span><br><span class="line"><span class="comment"># 创建索引的过程中，mysql在做什么？表tb_item中有300万条记录，那么在创建索引的时候就会对这300万条记录重建索引；所以此时即数据库底层在重建索引；创建完索引之后再进行查询效率则变快；索引是优化查询最有效的方式之一；</span></span><br></pre></td></tr></table></figure>

<p>查询速度很快，接近0s，主要的原因是因为id为主键，有索引；  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> tb_item <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1999</span>\G;</span><br></pre></td></tr></table></figure>

<p><strong>准备环境</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="string">'tb_seller'</span>(</span><br><span class="line">  <span class="string">'sellerid'</span> <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">  <span class="string">'name'</span> <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">  <span class="string">'nickname'</span> <span class="built_in">varchar</span>(<span class="number">50</span>),</span><br><span class="line">  <span class="string">'password'</span> <span class="built_in">varchar</span>(<span class="number">60</span>),</span><br><span class="line">  <span class="string">'status'</span> <span class="built_in">varchar</span>(<span class="number">1</span>),</span><br><span class="line">  <span class="string">'address'</span> <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">  <span class="string">'createtime'</span> datetime,</span><br><span class="line">  primary <span class="keyword">key</span>(<span class="string">'sellerid'</span>)</span><br><span class="line">)<span class="keyword">engine</span>=<span class="keyword">innodb</span> <span class="keyword">default</span> <span class="keyword">charset</span>=utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">#插入记录 导入基本数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_seller <span class="keyword">values</span> ......</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建联合索引</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> idx_seller_name_sta_addr <span class="keyword">on</span> tb_seller(<span class="keyword">name</span>,<span class="keyword">status</span>,address);</span><br></pre></td></tr></table></figure>

<p>创建了索引并不是一定会提高效率；创建了索引并且需要合理运用索引才能够提高查询效率；  </p>
<h2 id="索引的使用-全值匹配"><a href="#索引的使用-全值匹配" class="headerlink" title="索引的使用 - 全值匹配"></a>索引的使用 - 全值匹配</h2><p><strong>避免索引失效</strong>  </p>
<p>(1) 全值匹配，对索引中所有列都指定具体值。<br>该情况下，索引生效，执行效率提高。  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> tb_seller <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'小米科技'</span> <span class="keyword">and</span> <span class="keyword">status</span>=<span class="string">'1'</span> <span class="keyword">and</span> address=<span class="string">'北京市'</span>\G;</span><br></pre></td></tr></table></figure>

<h2 id="索引的使用-最左前缀法则"><a href="#索引的使用-最左前缀法则" class="headerlink" title="索引的使用 - 最左前缀法则"></a>索引的使用 - 最左前缀法则</h2><p><strong>避免索引失效</strong>  </p>
<p>(2)最左前缀法则<br>tb_seller创建了一个复合索引即name、status、address这三个字段；<br>如果索引了多列，要遵守最左前缀法则。<br>指的是查询从索引的最左前列开始，并且不跳过索引中的列。<br>匹配最左前缀法则，走索引：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> tb_seller <span class="keyword">where</span> <span class="keyword">name</span> =<span class="string">'小米科技'</span>;<span class="comment"># key:idx_name_sta_addr； key_len：403</span></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> tb_seller <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'小米科技'</span> <span class="keyword">and</span> <span class="keyword">status</span>=<span class="string">'1'</span>;<span class="comment"># key:idx_name_sta_addr； key_len：410</span></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> tb_seller <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'小米科技'</span> <span class="keyword">and</span> <span class="keyword">status</span>=<span class="string">'1'</span> <span class="keyword">and</span> address=<span class="string">'北京市'</span>;<span class="comment"># key:idx_name_sta_addr； key_len：813</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> tb_seller <span class="keyword">where</span> <span class="keyword">status</span>=<span class="string">'1'</span> <span class="keyword">and</span> address=<span class="string">'北京市'</span>;<span class="comment"># key:NULL key_len：NULL 此时则不再走索引；因为不再符合最左前缀法则，没有以最左边的列开始；  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> tb_seller <span class="keyword">where</span> <span class="keyword">status</span>=<span class="string">'1'</span> <span class="keyword">and</span> address=<span class="string">'北京市'</span> <span class="keyword">and</span> <span class="keyword">name</span>=<span class="string">'小米科技'</span>;<span class="comment"># key:idx_name_sta_addr； key_len：813 此时是走索引的；与where列表当中字段的先后顺序无关；会检查where条件列表中包不包含最左列；而是与复合索引当中的是否存在有复合索引当中的最左字段；</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> tb_seller <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'小米科技'</span> <span class="keyword">and</span> address=<span class="string">'北京市'</span> ;<span class="comment">#跳过索引列不走索引; key:idx_sellter_name_sta_addr；key_len: 403；此时索引的长度是403；也就是这是执行 explain select * from tb_seller where name ='小米科技'; 时所走的索引；即后面的 and address='北京市' 并未走索引；</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>违反最左前缀法则，索引失效；<br>需要包含复合索引当中的最左列，并且不能跳过复合索引当中的某一列进行查询否则复合索引失效；</p>
</blockquote>
<h2 id="索引的使用-索引失效情况（范围查询、字段运算）"><a href="#索引的使用-索引失效情况（范围查询、字段运算）" class="headerlink" title="索引的使用 - 索引失效情况（范围查询、字段运算）"></a>索引的使用 - 索引失效情况（范围查询、字段运算）</h2><p><strong>避免索引失效</strong>  </p>
<p>（3）范围查询右边的列，不能使用索引；<br>根据前面的两个字段name、status查询是走索引的，但是最后一个条件address没有用到索引。  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">explain select * <span class="keyword">from</span> tb_seller where <span class="attribute">name</span>=<span class="string">'小米科技'</span> <span class="keyword">and</span> <span class="attribute">status</span>=<span class="string">'1'</span> <span class="keyword">and</span> <span class="attribute">address</span>=<span class="string">'北京市'</span>;# key:idx_name_sta_addr； key_len：813；此时三个字段name、status、address三个字段都走了索引；  </span><br><span class="line"></span><br><span class="line">explain select * <span class="keyword">from</span> tb_seller where name =<span class="string">'小米科技'</span> <span class="keyword">and</span> status &gt;<span class="string">'1'</span> <span class="keyword">and</span><span class="built_in"> address </span>=<span class="string">'北京市'</span>;# key:idx_name_sta_addr； key_len：410;此时走的索引是name和status字段的索引；而范围查询status&gt;<span class="string">'1'</span>之后的address并没有走索引；  </span><br><span class="line"><span class="comment"># 范围查询之后的索引字段将失效</span></span><br></pre></td></tr></table></figure>

<p>（4）不要在索引列上进行运算操作，索引将失效；  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_seller;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_seller  <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'小米科技'</span>;<span class="comment">#此时走索引</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_seller <span class="keyword">where</span> <span class="keyword">substring</span>(<span class="keyword">name</span>,<span class="number">3</span>,<span class="number">2</span>)=<span class="string">'科技'</span>;</span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> tb_seller <span class="keyword">where</span> <span class="keyword">substring</span>(<span class="keyword">name</span>,<span class="number">3</span>,<span class="number">2</span>)=<span class="string">'科技'</span>;<span class="comment">#此时key为null以及key_len为null；而type为ALL则说明了进行了全表扫描；没有走索引</span></span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">（5）字符串不加单引号，会造成索引失效；</span><br></pre></td></tr></table></figure>
<p>explain select * from tb_seller where name=’科技’ and status=’0’;# 此时key:idx_name_sta_addr；key_len：410；</p>
<p>explain select * from tb_seller where name=’科技’ and status=0;# 此时key：idx_name_sta_addr；key_len：403；索引长度为403；则说明走的索引为name字段的索引；而status字段的索引并没有走；造成了status=0 该索引字段的失效；当status字段取值没有加单引号时，mysql底层检测到status字段为varchar类型所以会对其没有加单引号的取值进行隐式类型转换；隐式类型转换了之后该status索引字段就失效了；因为底层对该字段进行了运算操作；</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">## 索引的使用 - 覆盖索引</span></span><br><span class="line"></span><br><span class="line">**避免索引失效**  </span><br><span class="line"></span><br><span class="line">（<span class="number">6</span>）尽量使用覆盖索引，避免使用 <span class="keyword">select</span> *  </span><br><span class="line"></span><br><span class="line">尽量使用覆盖索引（只访问索引的查询（索引列完全包含查询列）），减少<span class="keyword">select</span> * ；  </span><br><span class="line"></span><br><span class="line">如果查询列，超出索引列，也会降低性能；</span><br></pre></td></tr></table></figure>
<p>explain select * from tb_seller where name =’小米科技’;# extra为using index condition指的是：在查询的时候确实用到了name这个字段的索引；但是用到了name这个字段的索引信息之后，在返回数据的时候还需要进行索引回调查询；  </p>
<p>explain select name , status ,address where name=’小米科技’; # 此时extra为using where ;using index；此时表示的是：可以通过索引进行查询；但是此时并不需要进行回调查询了；原因就在于查询的字段在索引结构当中已经被记录了；所以并不需要去进行回调查询；<br>explain select name , status  where name=’小米科技’;#同上<br>explain select name ,  address where name=’小米科技’;#同上</p>
<p>explain select name ,  address ,password where name=’小米科技’;#复合索引当中并未包括password字段则此时name索引字段以及address索引字段当中并没有包括password字段的信息，则此时需要去回调查询password字段的信息；即extra为using index_condition</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>TIP:<br>索引回调查询指的是：<br>    using index : 使用覆盖索引的时候就会出现<br>    using where : 在查找使用索引的情况下，需要回表去查询所需的数据<br>    using index condition ：查找使用了索引，但是需要回表查询数据（从索引当中拿到了数据，然后再到表结构当中去拿到该数据对应的一整行数据，因为该name索引字段并没有记录所有的数据，只是记录了那么字段的数据；所以需要回表查询数据；即用了索引还需要回调查询）<br>    using index ; using where : 查找使用了索引，但是需要的数据都在索引列中能找到，索引不需要回表查询数据</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">（<span class="number">7</span>） <span class="keyword">in</span>走索引，<span class="keyword">not</span> <span class="keyword">in</span> 索引失效</span><br><span class="line"></span><br><span class="line">## 索引的使用 - <span class="keyword">or</span>索引失效情况</span><br><span class="line"></span><br><span class="line">**避免索引失效**  </span><br><span class="line">（<span class="number">7</span>）用<span class="keyword">or</span>分隔开的条件，如果<span class="keyword">or</span>前的条件中的列有索引，而后面的列中没有索引，那么涉及的索引都不会被用到；  </span><br><span class="line"></span><br><span class="line">示例：name字段是索引列，而createtime不是索引列，中间是<span class="keyword">or</span>进行连接是不走索引的；</span><br></pre></td></tr></table></figure>
<p>select * from tb_seller;  </p>
<p>explain select * from tb_seller where name=’小米科技’ and createtime=’2088-01-01 12:00:00’\G;#key:idx_name_sta_addr； key_len: 403;此时走索引</p>
<p>explain select * from tb_seller where name=’小米科技’ or createtime=’2088-01-01 12:00:00’\G;#key:idx_name_sta_addr； key_len: NULL</p>
<p>explain select * from tb_seller where name=’小米科技’ and nickname=’小米官方旗舰店’;#此时走索引；key_len:403;走的是name字段的索引</p>
<p>explain select * from tb_seller where name=’小米科技’ or nickname=’小米官方旗舰店’;#换成or之后，nickname字段非索引字段；所以此时将全表扫描；不会走索引；key_len:NULL；以及type为ALL</p>
<h1 id="or之后的字段如果没有索引的话；那么整个where列表当中即便有索引字段也将都失效，不再走索引；"><a href="#or之后的字段如果没有索引的话；那么整个where列表当中即便有索引字段也将都失效，不再走索引；" class="headerlink" title="or之后的字段如果没有索引的话；那么整个where列表当中即便有索引字段也将都失效，不再走索引；"></a>or之后的字段如果没有索引的话；那么整个where列表当中即便有索引字段也将都失效，不再走索引；</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 索引的使用 - like模糊匹配</span></span></span><br><span class="line"></span><br><span class="line">**避免索引失效**  </span><br><span class="line"></span><br><span class="line">（8）以%开头的Like模糊查询，索引失效。  </span><br><span class="line"></span><br><span class="line">如果仅仅是尾部模糊查询，索引不会失效。  </span><br><span class="line">如果是头部模糊查询匹配，则索引失效。</span><br></pre></td></tr></table></figure>
<p>explain select * from tb_seller where name like ‘小米科技’;#key: idx_name_sta_addr； key_len: 403; 此时走索引；索引走的是name字段</p>
<p>explain select * from tb_seller where name like ‘%小米科技’;#key: NULL； key_len: NULL; 此时不走索引；且type为ALL；全表扫描</p>
<p>explain select * from tb_seller where name like ‘%小米科技%’;#key: NULL； key_len: NULL; 此时不走索引；且type为ALL；全表扫描</p>
<p>explain select * from tb_seller where name like ‘科技%’;#key: idx_name_sta_addr； key_len: 403; 此时走索引；索引走的是name字段</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">类似 “%科技%” 这种情况在业务逻辑处理当中还是比较多的；但是这样效率将十分低下；所以针对这种情况的处理方式为：  </span><br><span class="line">覆盖索引：覆盖索引指的是，尽量不要使用<span class="keyword">select</span> * 这种方式进行查询；而是使用复合索引当中的那些索引列，即索引字段；即复合索引为idx_name_sta_addr，当中包含的索引字段为name、status、address；所以<span class="keyword">select</span> 查询列名称的时候尽量查询的列名称为复合索引当中的索引列，或者是其他索引的字段（例如唯一索引的索引字段、主键索引的索引字段等）；  </span><br><span class="line">即通过覆盖索引就可以解决 “%科技%” like模糊查询效率低下的情况（条件是<span class="keyword">select</span> 查询的字段都需要是索引字段，如果出现了查询非索引字段则将不再走索引）；</span><br></pre></td></tr></table></figure>
<p>explain select sellerid from tb_seller where name like ‘%科技%’;# 则此时是走索引的；key:idx_seller_name_sta_addr；key_len：813；</p>
<p>explain select sellerid,name from tb_seller where name like ‘%科技%’;# 则此时是走索引的；key:idx_seller_name_sta_addr；key_len：813；</p>
<p>explain select sellerid,name,status,address from tb_seller where name like ‘%科技%’;# 则此时是走索引的；key:idx_seller_name_sta_addr；key_len：813；</p>
<p>explain select sellerid,name,status,address,password from tb_seller where name like ‘%科技%’;# 则此时是不走索引的，由于password字段并不是索引字段，所以将造成不会走索引的局面；key:NULL；key_len：NULL；</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 索引的使用 - 全表扫描更快</span><br><span class="line"></span><br><span class="line">**避免索引失效**  </span><br><span class="line"></span><br><span class="line">（<span class="number">9</span>）如果MySQL评估使用索引比全表更慢，则不使用索引；  </span><br><span class="line"></span><br><span class="line">如果发现走全表扫描比走索引要快，这个时候mysql就会走全表扫描；</span><br></pre></td></tr></table></figure>
<p>select * from tb_seller;</p>
<p>explain select * from tb_seller where address=’北京市’;#此时key:NULL 以及key_len: NULL；由于address是复合索引当中的索引字段但是又不满足最左前缀法则；所以不走索引；  </p>
<p>create index idx_seller_address on tb_seller(address);#在tb_seller表中的address字段上建立索引；单列索引</p>
<p>explain select * from tb_seller where address=’北京市’;# 但是此时仍然没有走索引；possible_key出现有idx_seller_address；但是key为NULL；以及key_len为NULL；type为ALL；即走的还是全表扫描</p>
<p>explain select * from tb_seller where address=’西安市’;#此时是走索引的，key为idx_address；key_len为403;索引走的是address字段；extra为using index condition</p>
<p>#同样一条SQL语句，只是传入的参数不同；也就导致了是否走索引的不同；一个是全表扫描没有走索引；而另外一个是走了索引idx_seller_address；  </p>
<p>#原因就在于：这个与数据库当中的数据是存在一定的关系的；</p>
<p>select * from tb_seller; #该表当中一共有12条记录；这12条记录当中出现有address为“北京市”的记录行数就有11条记录；只有一条是1条是“西安市”；<br>#如果数据量大，且精确查询的内容又在表中占比大；此时就极有可能走的是全表扫描而非走索引了；速度更快  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 索引的使用 - <span class="keyword">NULL</span>值的判定</span><br><span class="line"></span><br><span class="line">**避免索引失效**  </span><br><span class="line"></span><br><span class="line">（<span class="number">10</span>） <span class="keyword">is</span> <span class="keyword">NULL</span>，<span class="keyword">is</span>  <span class="keyword">NOT</span> <span class="keyword">NULL</span>  &lt;span style="color:red;"&gt;**有时**&lt;/span&gt; 索引失效；</span><br></pre></td></tr></table></figure>
<p>show index from tb_seller;</p>
<p>select * from tb_seller where address is null;<br>explain  select * from tb_seller where address is null;# 此时是走索引的；key：idx_seller_address ;key_len：403 走的索引字段为address</p>
<p>explain  select * from tb_seller where address is not null;# 此时是没有走索引的；key：null ;key_len:null;type:all 走的是全表扫描</p>
<p>select * from tb_seller;<br>#当前该表当中每一条记录都address字段记录取值都是 not null; 当前explain where address is null时走了索引，即address is null这样的记录在表当中占比较少此时则走索引；而explain where address is not null时没有走索引；而此时 address is not null则在表当中占比较多；所以就不会去走索引而是全表扫描；这个与前面所说的全表扫描更快是一个道理；全表扫描与走索引的这两种方式哪一种更快就选择哪一种方式；也就是说mysql底层会去自动的判断如果走全表扫描更快就走全表扫描；如果走索引更快就走索引的这种方式；  </p>
<p>explain select * from tb_seller where name is null;#此时走索引；key:idx_name_sta_addr；key_len：403</p>
<p>explain select * from tb_seller where name is not null; # 此时不走索引；key:null； key_len：null; type：ALL 走的是全表扫描</p>
<p>explain select * from t_user where name is null;# 此时不走索引；key：null；key_len: null ; type:all 走的是全表扫描</p>
<p>explain select * from t_user where name is not null; # 此时走了索引；key:idx_name; key_len:138;</p>
<p>select * from t_user;</p>
<p>update t_user set name =null where id &lt;&gt; 1;</p>
<p>select * from t_user;#则此时除了id为1的记录其余的记录的name字段就变成了null；所以如果此时查询t_user表当中name字段为is null则走全表扫描；而查询is not null则走索引；</p>
<p>show index from t_user;#此时在t_user表当中name字段是存在索引的；</p>
<p>explain select * from t_user where name is null;# key:null ; key_len:null;type:all 走的是全表扫描（原因就在于此时在表当中记录name字段为null占比大于name字段is not null；所以全表扫描与走索引的方式这两者相比较之下，全表扫描更快；）</p>
<p>explain select * from t_user where name is not null;#此时是走索引的；key:idx_user_name;key_len:138;  </p>
<h1 id="也就是说is-null与is-not-null；有时是会走索引的有时又不会走索引；这要分情况而定；这个根据数据库当中的数据量来决定的；如果查询的字段在数据量当中的null值占比较多-那么这个时候is-null将会走全表扫描而is-not-null则走索引；如果查询的字段在数据量当中绝大部分都是存在有值的也就是说is-not-null占据较多；则此时is-null就会走索引；而is-not-null则走全表扫描；"><a href="#也就是说is-null与is-not-null；有时是会走索引的有时又不会走索引；这要分情况而定；这个根据数据库当中的数据量来决定的；如果查询的字段在数据量当中的null值占比较多-那么这个时候is-null将会走全表扫描而is-not-null则走索引；如果查询的字段在数据量当中绝大部分都是存在有值的也就是说is-not-null占据较多；则此时is-null就会走索引；而is-not-null则走全表扫描；" class="headerlink" title="也就是说is null与is not null；有时是会走索引的有时又不会走索引；这要分情况而定；这个根据数据库当中的数据量来决定的；如果查询的字段在数据量当中的null值占比较多,那么这个时候is null将会走全表扫描而is not null则走索引；如果查询的字段在数据量当中绝大部分都是存在有值的也就是说is not null占据较多；则此时is null就会走索引；而is not null则走全表扫描；"></a>也就是说is null与is not null；有时是会走索引的有时又不会走索引；这要分情况而定；这个根据数据库当中的数据量来决定的；如果查询的字段在数据量当中的null值占比较多,那么这个时候is null将会走全表扫描而is not null则走索引；如果查询的字段在数据量当中绝大部分都是存在有值的也就是说is not null占据较多；则此时is null就会走索引；而is not null则走全表扫描；</h1><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 索引的使用 - <span class="keyword">in</span>和not <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">**避免索引失效**  </span><br><span class="line"></span><br><span class="line">（<span class="number">11</span>）<span class="keyword">in</span> 走索引； not <span class="keyword">in</span> 索引失效；</span><br></pre></td></tr></table></figure>
<p>explain select * from tb_seller where sellerid in (‘oppo’,’xiaomi’,’sina’);</p>
<p>explain select * from tb_seller where sellerid not in (‘oppo’,’xiaomi’,’sina’);</p>
<p>select * from tb_seller;</p>
<p>explain select * from tb_seller where sellerid in (‘oppo’,’xiaomi’,’sina’);#此时使用了索引；key:PRIMARY；key_len:402;  </p>
<p>explain select * from tb_seller where sellerid not in (‘oppo’,’xiaomi’,’sina’);#此时未走索引；索引失效；key:NULL；key_len:NULL；type:ALL 全表扫描</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 索引的使用 - 单列索引与复合索引选择</span><br><span class="line"></span><br><span class="line">**避免索引失效**  </span><br><span class="line"></span><br><span class="line">（<span class="number">12</span>）单列索引和复合索引  </span><br><span class="line"></span><br><span class="line">尽量使用复合索引，而少量使用单列索引；  </span><br><span class="line"></span><br><span class="line">创建复合索引：</span><br></pre></td></tr></table></figure>
<p>create index idx_name_sta_address on tb_seller(name,status,address);</p>
<p>就相当于创建了三个索引：  </p>
<ul>
<li>name</li>
<li>name + status</li>
<li>name + status + address<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">创建单列索引：</span><br></pre></td></tr></table></figure>
create index idx_seller_name on tb_seller(name);<br>create index idx_seller_status on tb_seller(status);<br>create index idx_seller_address on tb_seller(address);<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当对<span class="keyword">name</span>、<span class="keyword">status</span>、address字段进行搜索的时候，数据库只会选择一个索引；所以此时在这种情况下单列索引并不占优势；  </span><br><span class="line"></span><br><span class="line">数据库会选择一个最优的索引来使用，并不会使用全部索引；</span><br></pre></td></tr></table></figure>
show index from tb_seller;#查看tb_seller表当中的索引<h1 id="PRIMARY-主键索引"><a href="#PRIMARY-主键索引" class="headerlink" title="PRIMARY 主键索引"></a>PRIMARY 主键索引</h1><h1 id="idx-name-sta-address-name"><a href="#idx-name-sta-address-name" class="headerlink" title="idx_name_sta_address name"></a>idx_name_sta_address name</h1><h1 id="idx-name-sta-address-status"><a href="#idx-name-sta-address-status" class="headerlink" title="idx_name_sta_address status"></a>idx_name_sta_address status</h1><h1 id="idx-name-sta-address-address"><a href="#idx-name-sta-address-address" class="headerlink" title="idx_name_sta_address address"></a>idx_name_sta_address address</h1><h1 id="idx-seller-address-address"><a href="#idx-seller-address-address" class="headerlink" title="idx_seller_address address"></a>idx_seller_address address</h1></li>
</ul>
<p>#删除单列索引<br>drop index from idx_seller_address on tb_seller;</p>
<p>#查看tb_seller表的索引<br>show index from tb_seller;</p>
<p>explain select * from tb_seller where name=’小米科技’ and  status=’0’ and address=’西安市’;#此时使用复合索引；key:idx_name_sta_addr；key_len：813</p>
<p>#删除复合索引<br>drop index idx_name_sta_address on tb_seller;</p>
<p>#创建单列索引<br>create index idx_seller_name on tb_seller(name);<br>create index idx_seller_status on tb_seller(status);<br>create index idx_seller_address on tb_seller(address);</p>
<p>#查看单列索引<br>show index from tb_seller;<br>#PRIMARY 主键索引</p>
<h1 id="idx-seller-name-单列索引name字段"><a href="#idx-seller-name-单列索引name字段" class="headerlink" title="idx_seller_name 单列索引name字段"></a>idx_seller_name 单列索引name字段</h1><h1 id="idx-seller-status-单列索引status字段"><a href="#idx-seller-status-单列索引status字段" class="headerlink" title="idx_seller_status 单列索引status字段"></a>idx_seller_status 单列索引status字段</h1><h1 id="idx-seller-address-单列索引address字段"><a href="#idx-seller-address-单列索引address字段" class="headerlink" title="idx_seller_address 单列索引address字段"></a>idx_seller_address 单列索引address字段</h1><p>explain select * from tb_seller where name =’小米科技’ and status=’0’ and address=’西安市’;#此时走索引但是；key:idx_seller_name; key_len:403;只走了name字段的索引；而status字段以及address字段的索引未走；相当于白创建了status以及address字段的索引了；<br>#即此时possible_key：idx_seller_name、idx_seller_status、idx_seller_address；这三个索引可能都会用到；但是实际上只用到了idx_seller_name索引；即name字段的索引；<br>#为什么选择了name字段来作为该SQL的索引；原因在于：数据库会选择一个最优的索引来使用；并不会使用全部索引；也就意味着name该字段的索引在这三个索引当中最优；<br>#为什么name该字段的索引idx_seller_name最优，</p>
<p>select * from tb_seller;# 因为在此表当中，name查询的精确值为“小米科技”辨识度最高，记录行为1；而status字段取值为0的记录行超过1；address字段取值为“西安市”记录行也只有1；也应该是遵循了从左到右的一个判断；所以此时idx_seller_name索引最优；从而走了idx_seller_name索引；  </p>
<p>explain select * from tb_seller where status=’0’ and address=’西安市’;#此时没有name字段；而address在数据表当中辨识度最高；即记录行为1；所以此时走的索引自然即为idx_seller_address；<br>#key:idx_seller_address;key_len:403;possible_key:idx_seller_status,idx_seller_address;</p>
<p>explain select * from tb_seller where status=’0’ and address=’北京市’;# 如果此时address取精确值为“北京市”；而在数据库当中address取值为“北京市”的记录行辨识度并不高；也就是取值为“北京市”的address字段其记录行有很多超过1，即总共12条记录，有11条记录当中的address都是“北京市”，从而其辨识度并不高；<br>#而此时status字段相比较之下，取值为0的记录行数，总行数12行，而status取值为0的记录行数为3行，那么此时较之address的辨识度自然是要高一些；所以将走status字段的索引，即idx_seller_status索引；</p>
<h1 id="possible-key-idx-seller-status-idx-seller-address；key-idx-seller-status-key-len-7；"><a href="#possible-key-idx-seller-status-idx-seller-address；key-idx-seller-status-key-len-7；" class="headerlink" title="possible_key:idx_seller_status,idx_seller_address；key:idx_seller_status;key_len:7；"></a>possible_key:idx_seller_status,idx_seller_address；key:idx_seller_status;key_len:7；</h1><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">也就是说：数据库会选择一个最优的索引（辨识度最高索引）来使用，并不会使用全部的索引；  </span><br><span class="line"></span><br><span class="line">## 索引的使用 - 查看索引使用情况</span><br><span class="line"></span><br><span class="line">**查看索引使用情况**</span><br></pre></td></tr></table></figure>
<p>show status like ‘Handler_read%’;#查看的是当前会话中索引的使用情况<br>#Variable_name  Value</p>
<p>show global status like ‘Handler_read%’;#查看的是全局中索引的使用情况</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Handler_read_first<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Handler_read_key<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Handler_read_last<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Handler_read_next<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Handler_read_prev<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Handler_read_rnd<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Handler_read_rnd_next<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>22<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Handler_read_first: 索引中第一条被读的次数。如果较高，表示服务器正在自行大量全索引扫描（这个值越低越好）；</p>
<p>Handler_read_key: 如果索引正在工作，这个值代表一个行被索引值读取的次数；如果值越低，表示索引得到的性能改善不高，因为索引不经常使用（这个值越高越好）；</p>
<p>Handler_read_next: 按照键顺序读下一行的请求数。如果用范围约束或者如果执行索引扫描来查询索引列，该值增加；  </p>
<p>Handler_read_prev: 按照键顺序读前一行的请求数，该读方法主要用于优化ORDER BY…..DESC；</p>
<p>Handler_read_rnd: 根据固定位置读一行的请求数。如果正执行大量查询并需要对结果进行排序该值较高。可能使用了大量需要MySQL扫描整个表的查询或者连接没有正确使用键。这个值较高，意味着运行效率低，应该建立索引来补救；  </p>
<p>Handler_read_rnd_next: 在数据文件中读下一行的请求数。如果正进行大量的表扫描，该值要求较高。通常说明表索引不正确或者是写入的查询没有利用索引； </p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## SQL优化 - 大批量插入数据</span><br><span class="line"></span><br><span class="line">**大批量插入数据**  </span><br><span class="line"></span><br><span class="line">环境准备：</span><br></pre></td></tr></table></figure>
<p>CREATE TABLE ‘tb_user_1’(<br>  ‘id’ int(11) NOT NULL AUTO_INCREMENT,<br>  ‘username’ varchar(45) NOT NULL,<br>  ‘password’ varchar(96) NOT NULL,<br>  ‘name’ varchar(45) NOT NULL,<br>  ‘birthday’ datetime DEFAULT NULL,<br>  ‘sex’ char(1) DEFAULT NULL,<br>  ‘email’ varchar(45) DEFAULT NULL,<br>  ‘phone’ varchar(45) DEFAULT NULL,<br>  ‘qq’ varchar(32) DEFAULT NULL,<br>  ‘status’  varchar(32) DEFAULT NULL comment ‘用户状态’,<br>  ‘create_time’  datetime NOT NULL,<br>  ‘update_time’ datetime DEFAULT NULL,<br>  PRIMARY KEY(‘id’),<br>  UNIQUE KEY ‘unique_user_username’(‘username’)<br>)ENGINE=InnoDB DEFAULT CHARSET=utf8;</p>
<p>CREATE TABLE ‘tb_user_2’(<br>  ‘id’ int(11) NOT NULL AUTO_INCREMENT,<br>  ‘username’ varchar(45) NOT NULL,<br>  ‘password’ varchar(96) NOT NULL,<br>  ‘name’ varchar(45) NOT NULL,<br>  ‘birthday’ datetime DEFAULT NULL,<br>  ‘sex’ char(1) DEFAULT NULL,<br>  ‘email’ varchar(45) DEFAULT NULL,<br>  ‘phone’ varchar(45) DEFAULT NULL,<br>  ‘qq’ varchar(32) DEFAULT NULL,<br>  ‘status’  varchar(32) DEFAULT NULL comment ‘用户状态’,<br>  ‘create_time’  datetime NOT NULL,<br>  ‘update_time’ datetime DEFAULT NULL,<br>  PRIMARY KEY(‘id’),<br>  UNIQUE KEY ‘unique_user_username’(‘username’)<br>)ENGINE=InnoDB DEFAULT CHARSET=utf8;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">当使用<span class="keyword">load</span>命令导入数据的时候，适当的设置可以提高导入的效率。  </span><br><span class="line"></span><br><span class="line">引擎使用的是<span class="keyword">Innodb</span>，<span class="keyword">Innodb</span>底层使用的索引是B+树索引；而B+树索引当中的数据有顺序的；  </span><br><span class="line"></span><br><span class="line">对于<span class="keyword">Innodb</span>类型的表，有以下集中方式可以提高导入的效率：  </span><br><span class="line"></span><br><span class="line">（<span class="number">1</span>）**主键顺序插入**  </span><br><span class="line"></span><br><span class="line">因为<span class="keyword">InnoDB</span>类型的表是按照主键的顺序保存的，所以将导入的数据按照主键的顺序排列，可以有效的提高导入数据的效率。  </span><br><span class="line"></span><br><span class="line">如果<span class="keyword">InnoDB</span>表没有主键，那么系统会自动默认创建一个内部列作为主键，所以如果可以给表创建一个主键，将可以利用这点，来提高导入数据的效率。</span><br></pre></td></tr></table></figure>
<p>脚本文件介绍：<br>  sql1.log —–&gt; 主键有序<br>  sql2.log —–&gt; 主键无序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">插入ID顺序排列数据：</span><br></pre></td></tr></table></figure>
<p>load data local infile ‘/root/sql1.log’ into table ‘tb_user_1’ fields terminated by ‘,’ lines terminated by ‘\n’;</p>
<h1 id="耗费时长：20-58-second"><a href="#耗费时长：20-58-second" class="headerlink" title="耗费时长：20.58 second"></a>耗费时长：20.58 second</h1><p>select count(*) from tb_user_1;</p>
<p>load data local infile ‘/root/sql2.log’ into table ‘tb_user_2’ fields terminated by ‘,’ lines terminated by ‘\n’;<br>#耗费时长：1min 59.29 second</p>
<p>select count(*) from tb_user_2;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>#sql1.log当中数据有序进行排列；sql2.log当中数据无序进行排列；<br>#而sql1.log当中的数据将插入到tb_user_1表；sql2.log当中的数据将插入到tb_user_2表当中；<br>#sql1.log与sql2.log当中数据量完全一致；只数据排列分布顺序不一致；</p>
<p>head sql1.log #linux 查看sql1.log前一部分的数据内容，id主键数据有序<br>head sql2.log #linux 查看sql2.log前一部分的数据内容，主键数据无序</p>
<p>load data local infile ‘/root/sql1.log’ into table ‘tb_user_1’ fields terminated by ‘,’ lines terminated by ‘\n’;</p>
<h1 id="load-data-加载数据"><a href="#load-data-加载数据" class="headerlink" title="load data 加载数据"></a>load data 加载数据</h1><p>#local infile 从本地文件系统当中加载数据；<br>#’/root/sql1.log’ 数据文件在linux当中的位置</p>
<h1 id="into-table-‘tb-user-1’-加载数据到具体表tb-user-1当中"><a href="#into-table-‘tb-user-1’-加载数据到具体表tb-user-1当中" class="headerlink" title="into table ‘tb_user_1’ 加载数据到具体表tb_user_1当中"></a>into table ‘tb_user_1’ 加载数据到具体表tb_user_1当中</h1><h1 id="fields-terminated-by-‘-’-每一个域之间使用逗号-进行分隔"><a href="#fields-terminated-by-‘-’-每一个域之间使用逗号-进行分隔" class="headerlink" title="fields terminated by ‘,’ 每一个域之间使用逗号,进行分隔"></a>fields terminated by ‘,’ 每一个域之间使用逗号,进行分隔</h1><h1 id="lines-terminated-by-‘-n’-每一行之间使用-n进行分隔-也就是换行"><a href="#lines-terminated-by-‘-n’-每一行之间使用-n进行分隔-也就是换行" class="headerlink" title="lines terminated by ‘\n’ 每一行之间使用\n进行分隔,也就是换行"></a>lines terminated by ‘\n’ 每一行之间使用\n进行分隔,也就是换行</h1><h1 id="回车之后，在导入数据的过程当中，还需要去进行维护索引，维护唯一索引；unique；"><a href="#回车之后，在导入数据的过程当中，还需要去进行维护索引，维护唯一索引；unique；" class="headerlink" title="回车之后，在导入数据的过程当中，还需要去进行维护索引，维护唯一索引；unique；"></a>回车之后，在导入数据的过程当中，还需要去进行维护索引，维护唯一索引；unique；</h1><h1 id="sql1-log导入到tb-user-1表当中耗费时间为19-37-second"><a href="#sql1-log导入到tb-user-1表当中耗费时间为19-37-second" class="headerlink" title="sql1.log导入到tb_user_1表当中耗费时间为19.37 second"></a>sql1.log导入到tb_user_1表当中耗费时间为19.37 second</h1><p>select count(*) from tb_user_1;# 1000000</p>
<p>load data local infile ‘/root/sql2.log’ into table ‘tb_user_2’ fields terminated by ‘,’ lines terminated by ‘\n’;<br>#回车之后，耗费的时间为 1min 51.42 second；和sql1.log导入tb_user_1时差距很大；<br>#所以这样就验证了大批量导入数据时，有序数据导入表当中时耗费的时间小于无序数据导入表当中的时间；</p>
<p>select count(*) from tb_user_2;# 1000000</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">（2）**关闭唯一性校验**  </span><br><span class="line"></span><br><span class="line">在导入数据前执行 <span class="builtin-name">SET</span> <span class="attribute">UNIQUE_CHECKS</span>=0, 关闭唯一性校验，在导入结束后执行 <span class="builtin-name">SET</span> <span class="attribute">UNIQUE_CHECKS</span>=1，恢复唯一性校验，可以提高导入的效率。</span><br></pre></td></tr></table></figure>
<p>#在tb_user_1表结构当中存在username字段的唯一性索引；如果存在唯一性索引则在插入数据的时候是需要对唯一性字段数据的取值进行校验的；</p>
<p>SET UNIQUE_CHECKS=0;</p>
<p>load data local infiles ‘/root/sql1.log’ into table ‘tb_user_1’ fields terminated by ‘,’ lines terminated by ‘\n’;<br>#耗费时长为 19.39 second</p>
<p>SET UNIQUE_CHECKS=1;</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">（3）**手动提交事务**  </span><br><span class="line"></span><br><span class="line">如果应用使用自动提交的方式，建议在导入前执行 <span class="builtin-name">SET</span> <span class="attribute">AUTOCOMMIT</span>=0，关闭自动提交，导入结束后再执行 <span class="builtin-name">SET</span> <span class="attribute">AUTOCOMMIT</span>=1；打开自动提交，也可以提高导入的效率。</span><br></pre></td></tr></table></figure>
<p>SET AUTOCOMMIT=0;</p>
<p>load data local infiles ‘/root/sql1.log’ into table ‘tb_user_1’ fields terminated by ‘,’ lines terminated by ‘\n’;<br>#耗费时长为 19.58 second</p>
<p>select count(*) from tb_user_1;</p>
<p>SET AUTOCOMMIT=1;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## <span class="keyword">SQL</span>优化 - <span class="keyword">insert</span>优化</span><br><span class="line"></span><br><span class="line">**优化<span class="keyword">insert</span>语句**  </span><br><span class="line"></span><br><span class="line">当进行数据的<span class="keyword">insert</span>操作的时候，可以考虑采用以下几种优化方案。  </span><br><span class="line"></span><br><span class="line">* 如果需要同时对一张表插入很多行数据时，应该尽量使用多个值表的<span class="keyword">insert</span>语句，这种方式将大大的缩减客户端与数据库之间的连接、关闭等消耗。</span><br><span class="line">  使得效率比分开执行的单个<span class="keyword">insert</span>语句块。  </span><br><span class="line">  示例，原始方式为：</span><br></pre></td></tr></table></figure>
<p>  insert into tb_test values(1,’tom’);<br>  insert into tb_test values(2,’cat’);<br>  insert into tb_test values(3,’Jerry’);<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">优化后的方案为：</span><br></pre></td></tr></table></figure><br>  insert into tb_test values (1,’tom’),(2,’cat’),(3,’Jerry’);<br>  <figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">* </span>在事务中进行数据插入</span><br></pre></td></tr></table></figure><br>  start transaction;<br>  insert into tb_test values(1,’tom’);<br>  insert into tb_test values(2,’cat’);<br>  insert into tb_test values(3,’Jerry’);<br>  commit;<br>  <figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">* </span>数据有序插入</span><br></pre></td></tr></table></figure><br>  insert into tb_test values(4,’Tim’);<br>  insert into tb_test values(1,’tom’);<br>  insert into tb_test values(2,’cat’);<br>  insert into tb_test values(5,’Rose’);<br>  insert into tb_test values(3,’Jerry’);<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">优化后：</span><br></pre></td></tr></table></figure><br>  insert into tb_test values(1,’Tim’);<br>  insert into tb_test values(2,’tom’);<br>  insert into tb_test values(3,’cat’);<br>  insert into tb_test values(4,’Rose’);<br>  insert into tb_test values(5,’Jerry’);<br>  <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">## SQL优化 - orderby优化</span></span><br><span class="line"></span><br><span class="line">**优化 <span class="keyword">order</span> <span class="title">by</span> 语句**  </span><br><span class="line"></span><br><span class="line">**环境准备**</span><br></pre></td></tr></table></figure><br>CREATE TABLE ‘emp’(<br>  ‘id’ int(11) NOT NULL AUTO_INCREMENT,<br>  ‘name’ varchar(100) NOT NULL,<br>  ‘age’ int(3) NOT NULL,<br>  ‘salary’ int(11) DEFAULT NULL,<br>  PRIMARY KEY(‘id’)<br>)ENGINE=InnoDB DEAFULT CHARSET=utf8mb4;</p>
<p>#基础数据插入<br>…..</p>
<p>create index idx_emp_age_salary on emp(age,salary);#建立age、salary字段的复合索引</p>
<p>show index from emp;<br>#PRIMARY 主键索引<br>#idx_emp_age_salary age 复合索引<br>#idx_emp_age_salary salary 复合索引</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*<span class="strong">*两种排序方式*</span>*  </span><br><span class="line"></span><br><span class="line">（1）*<span class="strong">*第一种是通过对返回数据进行排序，也就是通常说的 filesort 排序，所有不是通过索引直接返回排序结果的排序都叫做 FileSort排序*</span><span class="strong">*。</span></span><br></pre></td></tr></table></figure>
<p>explain select * from emp order by age;#key:NULL；key_len:NULL；Extra：Using filesort;type:ALL 没有走索引，全表扫描（升序）<br>explain select * from emp order by age,salary;#key:NULL；key_len:NULL；Extra：Using filesort;type:ALL 没有走索引，全表扫描（升序）</p>
<p>explain select * from emp order by age desc;#key:NULL；key_len:NULL；Extra：Using filesort;type:ALL 没有走索引，全表扫描（降序）</p>
<p>explain select * from emp order by age desc,salary desc;#key:NULL；key_len:NULL；Extra：Using filesort;type:ALL 没有走索引，全表扫描（降序）</p>
<p>#通过file sort 文件系统进行排序，效率较低</p>
<p>explain select * from emp order by age desc;#type：ALL，key：NULL；key_len:NULL</p>
<p>explain select * from emp order by age asc;#type：ALL，key：NULL；key_len:NULL</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">（<span class="number">2</span>）**第二种通过有序索引顺序扫描直接返回有序数据，这种情况即为 <span class="keyword">using</span> <span class="keyword">index</span>，不需要额外排序，操作效率高**。</span><br></pre></td></tr></table></figure>
<p>explain select id from emp order by age asc;#走索引；key：idx_age_salary；key_len:9；Extra：Using index 走索引</p>
<p>explain select id,age from emp order by age asc;#走索引；key：idx_age_salary；key_len:9；Extra：Using index 走索引</p>
<p>explain select id,age,salary from emp order by age asc;#走索引；key：idx_age_salary；key_len:9；Extra：Using index 走索引<br>#覆盖索引的用法；查询select 的字段都是覆盖索引则这个时候使用的即为using index</p>
<p>explain select id,age,salary,name from emp order by age asc;#走索引；key：NULL；key_len:NULL；type:ALL；Extra：Using filesort 全表扫描；由于查询的字段当中包含了非索引字段；即并未覆盖索引；所以走全表扫描的方式；id、age、salary这三个字段都有索引；而name字段没有索引；</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*<span class="strong">*多字段排序*</span><span class="strong">*</span></span><br></pre></td></tr></table></figure>
<p>explain select id ,age,salary from emp order by age,salary;#key:idx_age_salary;key_len:9;Extra:Using index</p>
<p>explain select id ,age,salary from emp order by age asc,salary asc;#key:idx_age_salary;key_len:9;Extra:Using index(order by 如不标明desc或者asc;默认为asc升序排序)</p>
<p>explain select id,age,salary from emp order by age desc,salary desc;#key:idx_age_salary;key_len:9;Extra:Using index</p>
<p>explain select id,age,salary from emp order by age asc,salary desc;#key:idx_age_salary;key_len:9;Extra:Using index;Using filesort此时就会出现Filesort</p>
<h1 id="即在使用order-by进行多字段排序的时候，如果想要效率较高；那么此时最好这些多字段统一排序方式；要么都是升序要么都是降序；如果出现一升一降那么就会出现Filesort；文件系统排序造成效率低；"><a href="#即在使用order-by进行多字段排序的时候，如果想要效率较高；那么此时最好这些多字段统一排序方式；要么都是升序要么都是降序；如果出现一升一降那么就会出现Filesort；文件系统排序造成效率低；" class="headerlink" title="即在使用order by进行多字段排序的时候，如果想要效率较高；那么此时最好这些多字段统一排序方式；要么都是升序要么都是降序；如果出现一升一降那么就会出现Filesort；文件系统排序造成效率低；"></a>即在使用order by进行多字段排序的时候，如果想要效率较高；那么此时最好这些多字段统一排序方式；要么都是升序要么都是降序；如果出现一升一降那么就会出现Filesort；文件系统排序造成效率低；</h1><p>explain select id,age,salary from emp order by salary asc,age asc;#key:idx_age_salary;key_len:9;Extra:Using index;Using filesort；此时将age asc进行了调后处理；也出现了Filesort<br>#原因在于：<br>#按照多字段进行排序，要么统一进行升序asc要么统一进行降序排序；<br>#如果按照多字段进行排序，那么排序的顺序需要和复合索引当中的字段顺序要保持一致；<br>#复合索引为idx_emp_age_salary（age，salary）复合索引当中age字段的索引顺序先于salary字段的顺序；<br>#而此时SQL当中order by语句多字段排序salary字段先于age字段；所以此时Extra当中就出现了using index；也出现了using filesort;</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">了解了MySQL的排序方式，优化目标就清晰了：尽量减少额外的排序，通过索引直接返回有序数据。  </span><br><span class="line"></span><br><span class="line">where条件和<span class="keyword">Order</span> <span class="keyword">by</span> 使用相同的索引并且<span class="keyword">Order</span> <span class="keyword">by</span> 的顺序和索引顺序相同，并且<span class="keyword">Order</span> <span class="keyword">by</span>的字段都是升序，或者都是降序。  </span><br><span class="line"></span><br><span class="line">否则肯定需要额外的操作，这样就会出现FileSort排序；  </span><br><span class="line"></span><br><span class="line">### Filesort的优化</span><br><span class="line"></span><br><span class="line">尽可能避免Filesort的出现，但是无法完全避免Filesort的出现；  </span><br><span class="line"></span><br><span class="line">通过创建合适的索引，能够减少Filesort的出现。  </span><br><span class="line"></span><br><span class="line">但是在某些情况下，条件限制不能让Filesort小时，那就需要加快Filesort的排序操作，对于Filesort，MySQL有两种排序算法：  </span><br><span class="line"></span><br><span class="line">（1）两次扫描算法：MySQL4.1之前，使用该方式排序。  </span><br><span class="line">    首先，根据条件取出排序字段和行指针信息，然后在排序区 <span class="keyword">sort</span> buffer中排序；  </span><br><span class="line">    如果<span class="keyword">sort</span> buffer不够，则在临时表 temporary <span class="keyword">table</span>中存储排序结果。  </span><br><span class="line">    完成排序之后，再根据航指针回表读取记录，该操作可能会导致大量随机I/O操作。  </span><br><span class="line"></span><br><span class="line">（2）一次扫描算法：一次性取出满足条件的所有字段，然后在排序区<span class="keyword">sort</span> buffer中排序后直接输出结果集。  </span><br><span class="line">    排序时内存开销较大，但是排序效率比两次扫描算法要高；  </span><br><span class="line"></span><br><span class="line">MySQL 通过比较系统变量 max_length_for_sort_data 的大小和<span class="keyword">Query</span> 语句取出的字段总大小，来判定合适哪一种排序算法，如果max_length_for_sort_data 更大，那么使用第二种优化之后的算法；否则使用第一种；  </span><br><span class="line"></span><br><span class="line">可以适当提高 sort_buffer_size和 max_length_for_sort_data 系统变量，来增大排序区的大小，提高排序的效率。</span><br></pre></td></tr></table></figure>
<p>show variables like ‘max_length_for_sort_data’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>max_length_for_sort_data<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>show variables like ‘sort_buffer_size’;</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;table&gt;</span></span><br><span class="line">  <span class="tag">&lt;tr&gt;</span></span><br><span class="line">    <span class="tag">&lt;th&gt;</span>Variable_name<span class="tag">&lt;/th&gt;</span></span><br><span class="line">    <span class="tag">&lt;th&gt;</span>Value<span class="tag">&lt;/th&gt;</span></span><br><span class="line">  <span class="tag">&lt;/tr&gt;</span></span><br><span class="line">  <span class="tag">&lt;tr&gt;</span></span><br><span class="line">    <span class="tag">&lt;td&gt;</span>sort_buffer_size<span class="tag">&lt;/td&gt;</span></span><br><span class="line">    <span class="tag">&lt;td&gt;</span><span class="number">262144</span><span class="tag">&lt;/td&gt;</span></span><br><span class="line">  <span class="tag">&lt;/tr&gt;</span></span><br><span class="line"><span class="tag">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## SQL优化 - group by优化</span></span><br><span class="line"></span><br><span class="line">由于<span class="keyword">GROUP</span> <span class="title">BY</span> 实际上也同样会进行排序操作，而且与<span class="keyword">ORDER</span> <span class="title">BY</span>相比，<span class="keyword">GROUP</span> <span class="title">BY</span>主要只是多了排序字后的分组操作。  </span><br><span class="line"></span><br><span class="line">当然如果在分组的时候还是用了其他的一些聚合函数，那么还需要一些聚合函数的计算。  </span><br><span class="line"></span><br><span class="line">所以，在<span class="keyword">GROUP</span> <span class="title">BY</span>的实现过程中，与<span class="keyword">ORDER</span> <span class="title">BY</span>一样也可以利用到索引。  </span><br><span class="line"></span><br><span class="line">如果查询包含<span class="keyword">GROUP</span> <span class="title">BY</span>，但是用户想要避免排序结果的消耗，则可以执行<span class="keyword">order</span> <span class="title">by</span> null 禁止排序。  </span><br><span class="line"></span><br><span class="line">如下：</span><br></pre></td></tr></table></figure>
<p>show index from emp;</p>
<p>drop index idx_emp_age_salary on emp;</p>
<p>explain select age,count(*) from emp group by age;#key:NULL,key_len:NULL;type:ALL;Extra:Using temporary;Using filesort; 由此可以看出GROUP BY 底层进行了排序操作；Using filesort<br>#Using temporary与Using Filesort都是比较耗时的操作；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">优化后：</span><br></pre></td></tr></table></figure>
<p>explain select age,count(*) from emp group by age order by null;#key:null;key_len:null;type:All;Extra:Using temporary;此时就没有Using filesort了</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">从上面的例子可以看出，第一个<span class="keyword">SQL</span>语句需要进行“Filesort”，而第二个<span class="keyword">SQL</span>语句由于<span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">null</span>不需要进行“Filesort”，而上文提过FileSort往往非常耗费时间。  </span><br><span class="line"></span><br><span class="line"> 创建索引：</span><br></pre></td></tr></table></figure>
<p> create index idx_emp_age_salary  on emp(age,salary);</p>
<p> explain select age,count(*) from emp group by age order by null;#key:idx_emp_age_salary;key_len:9;extra:using index 此时走索引；<br> #group by语句也是可以通过索引来提高效率的；<br> <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## <span class="keyword">SQL</span>优化 - 子查询优化</span><br><span class="line"></span><br><span class="line">**优化嵌套查询**  </span><br><span class="line"></span><br><span class="line">MySQL4<span class="number">.1</span> 版本之后，开始支持<span class="keyword">SQL</span>的子查询。  </span><br><span class="line"></span><br><span class="line">这个技术可以使用<span class="keyword">select</span>语句来创建一个单列的查询结果，然后吧这个结果来作为过滤条件用在另一个查询当中。  </span><br><span class="line"></span><br><span class="line">使用子查询可以一次性的完成很多逻辑上需要多个步骤才能完成的<span class="keyword">SQL</span>操作，同时也可以避免事务或者表锁死，并且写起来也很容易。  </span><br><span class="line"></span><br><span class="line">但是，有些情况下，子查询是可以被更高效的连接（<span class="keyword">JOIN</span>）替代。(使用多表连接查询来替换子查询)  </span><br><span class="line"></span><br><span class="line">示例，查找有角色的所有用户信息：</span><br></pre></td></tr></table></figure><br>show tables;# t_user 用户表 , t_role 角色表 , user_role 用户角色中间表 ；<br>explain select * from t_user where id in ( select user_id from user_role);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">执行计划为：</span><br></pre></td></tr></table></figure>
<p>explain select * from t_user where id in (select user_id from user_role);</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>select_type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>table<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>possible_key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>key_len<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>ref<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>rows<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Extra<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>SIMPLE<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>t_user<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>ALL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>PRIMARY<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>6<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Using where<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>SIMPLE<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt; <span class="attr">subquery2</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>eq_ref<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt; <span class="attr">auto_key</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt; <span class="attr">auto_key</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>99<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>demo_02.t_user.id<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>MATERIALIZED<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>user_role<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>index<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>fk_ur_user_id<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>fk_ur_user_id<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>99<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>6<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Using index<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">优化后：</span><br></pre></td></tr></table></figure>
<p>explain select * from t_user u,user_role ur where u.id=ur.user_id;#多表联查替代子查询</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>id<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>select_type<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>table<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>type<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>possible_key<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>key<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>key_len<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>ref<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>rows<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Extra<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">1</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>SIMPLE<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>u<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>ALL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>PRIMARY<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">6</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">1</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>SIMPLE<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>ur<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>ref(ref的效率比index效率高)<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>fk_ur_user_id<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>fk_ur_user_id<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">99</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>demo_02.u.id<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">1</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">## SQL优化 - or优化</span></span><br><span class="line"></span><br><span class="line">**对于包含 OR的查询子句，如果要利用索引，则OR之间的每个条件列都必须用到索引，而且不能使用到复合索引；如果没有索引，则应该考虑增加索引**。  </span><br><span class="line"></span><br><span class="line">获取emp表中的所有的索引；</span><br></pre></td></tr></table></figure>
<p>show index from emp;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：</span><br></pre></td></tr></table></figure>
<p>show index from emp;<br>select * from emp;<br>explain select * from emp where id=1 or name=’Tom;#id为主键，即存在主键索引；而name字段没有设置索引；所以此时用or来连接两个条件时，当中包含有一个非索引字段；所以不会走索引,索引失效，采用的是全表扫描；key:NULL;key_len:NULL;type:ALL;extra:Using where；or关键字如果想要走索引则or连接的条件列字段需要是索引列；从而能够走索引否则全表扫描不走索引；</p>
<p>explain select * from emp where age=20 or salary=3500;#key:NULL,key_len:NULL;type;All;extra:Using where;此时未走索引；age与salary为复合索引当中的索引列；而or关键字所连接的条件列当中字段的索引不能为复合索引列；可以为主键索引列、唯一索引列、单列索引等；就是不能为复合索引列其他皆可；</p>
<p>explain select * from emp where id=1 or age=30;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>select_type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>table<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>possible_key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>key_len<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>ref<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>rows<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Extra<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>SIMPLE<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>t_user<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>ALL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>PRIMARY<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>6<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Using where<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>SIMPLE<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>emp<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>index_merge<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>PRIMARY,idx_emp_age_salary<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>PRIMARY,idx_emp_age_salary<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>4,4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Using sort_union(idx_emp_age_salary,PRIMARY);Using where<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>explain select * from emp where id=1 or id=10 \G;</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="xml"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>select_type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>table<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>possible_key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>key_len<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>ref<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>rows<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>Extra<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="xml"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>SIMPLE<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>emp<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>range<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>PRIMARY<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>PRIMARY<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>Using where<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">建议使用 <span class="keyword">union</span> 替换 <span class="keyword">or</span>；  </span><br><span class="line"></span><br><span class="line">优化：</span><br></pre></td></tr></table></figure>
<p>explain select * from emp where id =1 union select * from emp where id =10;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>select_type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>table<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>possible_key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>key_len<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>ref<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>rows<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Extra<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>PRIMARY<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>emp<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>const(const效率远高于range)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>PRIMARY<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>PRIMARY<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>const<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>UNION<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>emp<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>const<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>PRIMARY<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>PRIMARY<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>const<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>UNION RESULT<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt; <span class="attr">union1</span>,<span class="attr">2</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>ALL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Using temporary<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>explain select * from emp where id=1 or age=20;<br>#id 1<br>#select_type SIMPLE<br>#table emp<br>#possible_key PRIMARY,idx_emp_age_salary<br>#key idx_emp_age_salary,PRIMARY<br>#key_len 4,4<br>#ref NULL<br>#rows 2<br>#extra Using sort_union(idx_emp_age_salary,PRIMARY)<br>#type index_merge</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">优化：</span><br></pre></td></tr></table></figure>
<p>explain select * from emp where id=1 union select * from emp where age=20;<br>#union即为一个求并集的一个操作；</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="xml"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>select_type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>table<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>possible_key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>key_len<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>ref<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>rows<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">th</span>&gt;</span>Extra<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="xml"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>PRIMARY<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>emp<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>const(const效率远高于range)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>PRIMARY<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>PRIMARY<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>const<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="xml"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>UNION<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>emp<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>ref(ref比index_merge效率高)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>idx_emp_age_salary<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>idx_emp_age_salary<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>const<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="xml"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>UNION RESULT<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt; <span class="attr">union1</span>,<span class="attr">2</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>ALL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>NULL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>Using temporary<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">建议通过<span class="keyword">union</span>替换<span class="keyword">or</span>；  </span><br><span class="line">来比较下重要指标，发现主要差别是type和ref这两项；  </span><br><span class="line">type显示的是访问类型，是较为重要的一个指标，结果值从好到坏依次是：</span><br></pre></td></tr></table></figure>
<p>system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; uniqe_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">UNION</span>语句的<span class="keyword">type</span>值为<span class="keyword">ref</span>，<span class="keyword">OR</span>语句的<span class="keyword">type</span>值为range，可以看到这是一个很明显的差距  </span><br><span class="line"></span><br><span class="line"><span class="keyword">UNION</span>语句的<span class="keyword">ref</span>值为const，<span class="keyword">OR</span>语句的<span class="keyword">type</span>值为<span class="keyword">NULL</span>，const表示是常量值引用，非常快  </span><br><span class="line"></span><br><span class="line">这两项的差距就说明了<span class="keyword">UNION</span>要优于<span class="keyword">OR</span>；</span><br><span class="line"></span><br><span class="line">## <span class="keyword">SQL</span>优化 - <span class="keyword">limit</span>优化</span><br><span class="line"></span><br><span class="line">### 优化分页查询</span><br><span class="line"></span><br><span class="line">一般分页查询时，通过创建覆盖索引能够比较好的提高性能。  </span><br><span class="line"></span><br><span class="line">一个常见又非常头疼的问题就是 <span class="keyword">limit</span> <span class="number">2000000</span>,<span class="number">10</span>;   此时需要MySQL排序前<span class="number">2000010</span>记录，仅仅返回 <span class="number">2000000</span> - <span class="number">2000010</span> 的记录，其他记录丢弃，查询排序的代价非常大。</span><br></pre></td></tr></table></figure>
<p>explain select * from tb_item limit 2000000,10;</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>id<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>select_type<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>table<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>type<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>possible_key<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>key<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>key_len<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>ref<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>rows<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Extra<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">1</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>SIMPLE<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>tb_item<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>ALL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">9816098</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">### 优化思路一</span></span><br><span class="line"></span><br><span class="line">在索引上完成排序分页操作，最后根据主键关联回原表查询所需要的其他列内容。</span><br></pre></td></tr></table></figure>
<p>slect count(*) from tb_item;#3000000</p>
<p>select * from tb_item limit 10;<br>select * from tb_item limit 10,10;<br>select * from tb_item limit 20,10;<br>select * from tb_item limit 2000000,10;#查询效率低 此时为全表扫描没有使用得到索引；</p>
<p>explain select * from tb_item t, (select id from tb_item order by id limit 2000000,10) a where t.id=a.id;</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>id<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>select_type<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>table<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>type<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>possible_key<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>key<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>key_len<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>ref<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>rows<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Extra<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">1</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>PRIMARY<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="params">&lt; derived2&gt;</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>ALL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">2000010</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">1</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>PRIMARY<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>t<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>eq_ref<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>PRIMARY<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>PRIMARY<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">4</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>a.id<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">1</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">    <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">2</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>DERIVED<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>tb_item<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>index<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>PRIMARY<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">4</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">2903274</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>Using index<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">### 优化思路二</span></span><br><span class="line"></span><br><span class="line">该方案适用于**主键自增的表(且主键自增的列不能够出现断层)**，可以把limit 查询转换成某个位置的查询；  </span><br><span class="line"></span><br><span class="line">**断层**：即指的是当在查询数据时，id主键自增列当中可能会有出现修改或者删除的操作，那么这个时候数据就不一定准确了；</span><br></pre></td></tr></table></figure>
<p>explain select * from tb_item where id &gt; 1000000 limit 10;</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>id<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>select_type<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>table<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>type<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>possible_key<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>key<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>key_len<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>ref<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>rows<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Extra<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">1</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>SIMPLE<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>tb_item<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>range<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>PRIMARY<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>PRIMARY<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">4</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">4908049</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>Using where<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">## SQL优化 - 索引提示</span></span><br><span class="line"></span><br><span class="line">**使用SQL提示**  </span><br><span class="line"></span><br><span class="line">SQL提示，是优化数据库的一个重要手段，简单来说，就是在SQL语句中加入一些人为的提示来达到优化操作的目的。  </span><br><span class="line"></span><br><span class="line"><span class="meta">### USE INDEX</span></span><br><span class="line"></span><br><span class="line">在查询语句中 表名称的后面 ，添加 use index 来提供希望MySQL去**参考**的索引列表，就可以让MySQL不再考虑其他可用的索引。</span><br></pre></td></tr></table></figure>
<p>select * from tb_seller;<br>show index from tb_seller;</p>
<p>create index idx_seller_name on tb_seller(name);<br>create index idx_seller_status on tb_seller(status);<br>create index idx_seller_address on tb_seller(address);</p>
<p>create index idx_seller_name_sta_addr on tb_seller(name,status,address);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>explain select * from tb_seller where name=’小米科技’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>select_type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>table<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>possible_key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>key_len<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>ref<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>rows<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Extra<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>SIMPLE<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>tb_seller<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>ref<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>idx_seller_name_sta_address,idx_seller_name<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>idx_seller_name(数据库选择使用idx_seller_name索引)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>403<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>const<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Using index condition<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>explain select * from tb_seller use index(idx_seller_name_sta_address) where name =’小米科技’; </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>select_type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>table<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>possible_key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>key_len<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>ref<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>rows<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Extra<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>SIMPLE<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>tb_seller<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>ref<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>idx_seller_name_sta_address<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>idx_seller_name_sta_address<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>403<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>const<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Using index condition<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>explain select * from tb_seller use index(idx_seller_name) where name =’小米科技’; </p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>id<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>select_type<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>table<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>type<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>possible_key<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>key<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>key_len<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>ref<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>rows<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Extra<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">1</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>SIMPLE<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>tb_seller<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>ref<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>idx_seller_name<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>idx_seller_name<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">403</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>const<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">1</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>Using index condition<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">### IGNORE INDEX</span></span><br><span class="line"></span><br><span class="line">如果用户只是单纯的想让MySQL**忽略**一个或者多个索引，则可以使用 ignore index 作为 hint；</span><br></pre></td></tr></table></figure>
<p>explain select * from tb_seller ignore index(idx_seller_name) where name =’小米科技’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>select_type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>table<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>type<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>possible_key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>key<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>key_len<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>ref<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>rows<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Extra<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>SIMPLE<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>tb_seller<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>ref<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>idx_seller_name_sta_address<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>idx_seller_name_sta_address<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>403<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>const<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Using index condition<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>explain select * from tb_seller ignore index(idx_seller_name_sta_address) where name=’小米科技’;</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>id<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>select_type<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>table<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>type<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>possible_key<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>key<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>key_len<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>ref<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>rows<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Extra<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">1</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>SIMPLE<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>tb_seller<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>ref<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>idx_seller_name<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>idx_seller_name<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">403</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>const<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">1</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>Using index condition<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">### FORCE INDEX</span></span><br><span class="line"></span><br><span class="line">为了**强制**MySQL使用一个特定的索引，可在查询中使用 force index 来作为 hint;</span><br></pre></td></tr></table></figure>
<p>create index idx_seller_address on tb_seller(address);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>explain select * from tb_seller where address=’北京市’;#实际没有使用到索引；type:all;key:null;key_len:null;extra:using where使用的是全表扫描；原因在于address为北京市时在表当中占比较多所以由mysql底层判断决定不走索引即全表扫描会快于走索引；所以此处没有使用得到索引；</p>
<p>explain select * from tb_seller use index(idx_seller_address) where address=’北京市’;#此时则走索引</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>id<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>select_type<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>table<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>type<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>possible_key<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>key<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>key_len<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>ref<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>rows<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Extra<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">1</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>SIMPLE<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>tb_seller<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>ALL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>idx_seller_address<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>idx_seller_address<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>NULL<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">12</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>Using where<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">## 今日内容2</span></span><br><span class="line"></span><br><span class="line">* 应用优化</span><br><span class="line">* MySQL中查询缓存优化</span><br><span class="line">* MySQL内存管理以及优化</span><br><span class="line">* MySQL并发参数调整</span><br><span class="line">* MySQL锁问题</span><br><span class="line">* 常用SQL技巧</span><br><span class="line"></span><br><span class="line"><span class="meta">## 应用优化</span></span><br><span class="line"></span><br><span class="line">前面章节，介绍了很多数据库的优化措施，但是在实际生产环境中，由于数据库本身的性能局限，就必须对前台的应用进行一些优化，来降低数据库的访问压力。  </span><br><span class="line"></span><br><span class="line"><span class="meta">### 使用连接池</span></span><br><span class="line"></span><br><span class="line">对于访问数据库来说，建立连接的代价是比较昂贵的，因为频繁的创建关闭连接，是比较耗费资源的，有必要建立数据库连接池，以提高访问的性能。  </span><br><span class="line"></span><br><span class="line"><span class="meta">### 减少对MySQL的访问</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#### 减少对数据进行重复检索</span></span><br><span class="line"></span><br><span class="line">在编写应用代码时，需要能够理解对数据库的访问逻辑。  </span><br><span class="line"></span><br><span class="line">能够一次连接就获取得到结果的，就不用两次连接，这样可以大大减少对数据库无用的重复请求。  </span><br><span class="line"></span><br><span class="line">比如，需要获取书籍的id和name字段，则查询如下：</span><br></pre></td></tr></table></figure>
<p>select id, name from tb_book;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">之后，在业务逻辑中有需要获取得到书籍状态信息，则查询如下：</span><br></pre></td></tr></table></figure>
<p>select id ,status from tb_book;</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这样，就需要向数据库提交两次请求，数据库就要做两次查询操作。  </span><br><span class="line">其实完全可以用一条<span class="keyword">SQL</span>语句得到想要的结果。</span><br></pre></td></tr></table></figure>
<p>select id,name ,status from tb_book;</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 增加cache层</span><br><span class="line"></span><br><span class="line">在应用中，可以在应用中增加 缓存 层 来达到减轻数据库负担的目的。  </span><br><span class="line"></span><br><span class="line">缓存层有很多种，也有很多事先方式，只要达到降低数据库的负担又能满足应用需求就可以。  </span><br><span class="line"></span><br><span class="line">因此可以部分数据从数据库中抽取出来放到应用端以文本方式存储，或者使用框架（Mybatis，Hibernate）提供的一级缓存、二级缓存，或者使用redis数据库来缓存数据。  </span><br><span class="line"></span><br><span class="line">### 负载均衡</span><br><span class="line"></span><br><span class="line">负载均衡是应用中使用非常普遍的一种优化方式。  </span><br><span class="line"></span><br><span class="line">负载均衡的机制就是利用某种均衡算法，将固定的负载量分不到不同的服务器上，一次来降低单台服务器的负载，达到优化的效果。  </span><br><span class="line"></span><br><span class="line">#### 利用MySQL复制分流查询</span><br><span class="line"></span><br><span class="line">通过MySQL的主从复制，实现读写分离，使得增删改操作走主节点，查询操作走从结点，从而可以降低单台服务器的读写压力。  </span><br><span class="line"></span><br><span class="line">#### 采用分布式数据库架构</span><br><span class="line"></span><br><span class="line">分布式数据库架构适合大数据量、负载高的情况，它由良好的拓展性和高可用性。  </span><br><span class="line">通过在多台服务器之间分布数据，可以实现在多台服务器之间的负载均衡，提高访问效率。  </span><br><span class="line"></span><br><span class="line">## 查询缓存 - 概述及流程</span><br><span class="line"></span><br><span class="line">### Mysql中查询缓存优化-概述</span><br><span class="line"></span><br><span class="line">开启mysql的查询缓存，当执行完全相同的SQL语句的时候，服务器就会直接从缓存中读取结果；当数据被修改，之前的缓存就会失效，修改比较频繁的表不适合做查询缓存。  </span><br><span class="line"></span><br><span class="line">### 操作流程</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 客户端发送一条查询SQL给服务器</span><br><span class="line"><span class="number">2.</span> 服务器先会检查查询缓存，如果命中了缓存，则立即返回存储在缓存中的结果。否则进入下一阶段。</span><br><span class="line"><span class="number">3.</span> 服务器端进行SQL解析、预处理，再由优化器生成对应的执行计划；</span><br><span class="line"><span class="number">4.</span> MySQL根据优化器生成的执行计划，调用存储引擎的API来执行查询；</span><br><span class="line"><span class="number">5.</span> 将结果缓存并返回给客户端；</span><br><span class="line"></span><br><span class="line">## 查询缓存 - 配置参数</span><br><span class="line"></span><br><span class="line">### 查询缓存配置</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 查看当前的MySQL数据库是否支持查询缓存：</span><br></pre></td></tr></table></figure>
<p>mysql -u root -p  </p>
<p>SHOW VARIABLES LIKE ‘have_query_cache’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>have_query_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>YES<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">2. 查看当前MySQL是否开启了查询缓存：</span><br></pre></td></tr></table></figure>
<p>SHOW VARIABLES LIKE ‘query_cache_type’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>query_cache_type<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>OFF(关闭)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">3. 查看查询缓存的占用大小（建议按照1024倍数进行增大）：</span><br></pre></td></tr></table></figure>
<p>SHOW VARIABLES LIKE ‘query_cache_size’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>query_cache_size<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1048576（单位为字节，占用内存空间约为：1048576/1024/1024约为 1M的内存空间）<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">4. 查看查询缓存的状态变量</span><br></pre></td></tr></table></figure>
<p>SHOW STATUS LIKE ‘Qcache%’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1038344<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>13<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>6<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_not_cached(当前查询没有进行缓存)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>16<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queryies_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>use demo_02;#切换数据库也算是一次查询mysql底层当中<br>select count(<em>) from tb_item;#耗费时间2.76 second<br>select count(</em>) from tb_item;#耗费时间2.53 second</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks（可用的内存块的个数）<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory（可用的内存空间）<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1038344<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits（查询缓存的命中次数）<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>13<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts（添加到缓存当中的次数）<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>6<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes（如果内存空间不足，将内存中数据移出缓存空间次数）<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span>Qcache_not_cached(当前查询没有进行缓存次数)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span>19<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queryies_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>参数<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>含义<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>查询缓存中的可用内存块数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>查询缓存的可用内存量<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>查询缓存命中数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>添加到查询缓存的查询数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>由于内存不足而从查询缓存中删除的查询数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> &gt;</span>Qcache_not_cached<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>非缓存查询的数量（由于query_cache_type设置而无法缓存或者未缓存）<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queries_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>查询缓存中注册的查询数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>查询缓存中的块总数<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">## 查询缓存 - 开启查询缓存</span><br><span class="line"></span><br><span class="line">MySQL的查询缓存默认是关闭的，需要手动配置参数 query_cache_type，来开启查询缓存。  </span><br><span class="line"></span><br><span class="line">query_cache_type 该参数的可取值有三个：  </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>值<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>定义<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>OFF 或 0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>查询缓存功能关闭<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>ON 或 1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>查询缓存功能打开，SELECT的结果符合缓存条件即会缓存；否则不予缓存；显式指定SQL_NO_CACHE，则不予缓存<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span> DEMAND 或 2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>查询缓存功能按需进行，<span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span>显式指定 SQL_CACHE 的SELECT语句才会缓存<span class="tag">&lt;/<span class="name">span</span>&gt;</span>；其他均不予缓存<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">在 /usr/my.cnf配置中，增加以下配置：</span><br></pre></td></tr></table></figure>
<p>#在开启mysql的查询缓存<br>query_cache_type=1</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">配置完毕之后，重启服务即可生效；  </span><br><span class="line"></span><br><span class="line">然后就可以在命令行执行<span class="keyword">SQL</span>语句进行验证，执行一条比较耗时的<span class="keyword">SQL</span>语句，然后再执行多次，查看后面几次的执行时间；  </span><br><span class="line"></span><br><span class="line">获取通过查看查询缓存的缓存命中数，来判定是否走了查询缓存。</span><br></pre></td></tr></table></figure>
<p>vi /usr/my.cnf<br>query_cache_type:1</p>
<p>service mysql restart#重启mysql</p>
<p>mysql -u root -p</p>
<p>use demo_02;<br>select count(<em>) from tb_item;#耗时 2.58 second<br>select count(</em>) from tb_item;#耗时 0.00 second<br>select count(<em>) from tb_item;#耗时 0.00 second<br>select count(</em>) from tb_item;#耗时 0.00 second</p>
<p>show status ‘Qcache’%;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1038344<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_not_cached(当前查询没有进行缓存)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queryies_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>select count(*) from tb_item;#耗时 0.00 second</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1038344<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_not_cached(当前查询没有进行缓存)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queryies_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">## 查询缓存 - SELECT选项</span><br><span class="line"></span><br><span class="line">可以在SELECT语句中指定两个与查询缓存相关的选项：  </span><br><span class="line"></span><br><span class="line">* SQL_CACHE：如果查询结果是可缓存的，并且query_cache_type 系统变量的值为ON或者DEMAND，则缓存查询结果；  </span><br><span class="line">* SQL_NO_CACHE: 服务器不使用查询缓存，它既不检查查询缓存，也不检查结果是否已缓存，也不缓存查询结果。  </span><br><span class="line"></span><br><span class="line">例子：</span><br></pre></td></tr></table></figure>
<p>SELECT SQL_CACHE id, name FROM customer;<br>SELECT SQL_NO_CACHE id,name FROM customer;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>select * from tb_item  limit 2;</p>
<p>select title, sellerid from tb_item where id=1;</p>
<p>show status  like ‘Qcache%’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1038344<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>3<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_not_cached(当前查询没有进行缓存)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queryies_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>3<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>8<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>select SQL_NO_CACHE title, sellerid from tb_item where id=2;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1038344<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>6<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts（添加到缓存的数量）<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>3<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_not_cached(当前查询没有进行缓存)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queryies_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>3<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>8<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>select SQL_NO_CACHE title, sellerid from tb_item where id=2;<br>show status like ‘Qcache%’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1038344<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>6<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts（添加到缓存的数量）<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>3<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_not_cached(当前查询没有进行缓存)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>3<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queryies_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>3<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>8<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>select SQL_NO_CACHE title, sellerid from tb_item where id=2;<br>select SQL_NO_CACHE title, sellerid from tb_item where id=2;<br>show status like ‘Qcache%’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1035936<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>6<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts（添加到缓存的数量）<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>3<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_not_cached(当前查询没有进行缓存)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queryies_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>3<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>8<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>select SQL_CACHE title, sellerid from tb_item where id=3;<br>select SQL_CACHE title, sellerid from tb_item where id=3;<br>show status like ‘Qcache%’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1038344<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>7<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts（添加到缓存的数量）<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_not_cached(当前查询没有进行缓存)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queryies_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>10<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>select SQL_CACHE title, sellerid from tb_item where id=3;<br>select SQL_CACHE title, sellerid from tb_item where id=3;<br>show status like ‘Qcache%’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1038344<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>9<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts（添加到缓存的数量）<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_not_cached(当前查询没有进行缓存)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queryies_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>10<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">## 查询缓存 - 失效场景</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>值<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>定义<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>OFF 或 0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>查询缓存功能关闭<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>ON 或 1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>查询缓存功能打开，<span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span>SELECT的结果符合缓存条件即会缓存<span class="tag">&lt;/<span class="name">span</span>&gt;</span>；否则不予缓存；显式指定SQL_NO_CACHE，则不予缓存<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span> DEMAND 或 2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>查询缓存功能按需进行，显式指定 SQL_CACHE 的SELECT语句才会缓存；其他均不予缓存<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">开启mysql的查询缓存，当执行**完全相同的SQL语句**的时候，服务器就会直接从缓存中读取结果；当数据被修改，之前的缓存就会失效，修改比较频繁的表不适合做查询缓存。</span><br><span class="line"></span><br><span class="line">1. SQL语句不一致的情况，要想命中查询缓存，查询的SQL语句必须一致。</span><br></pre></td></tr></table></figure>
<p>#SQL1：<br>select count(*) from tb_item;#3000000 耗时0.00 second</p>
<p>#SQL2：<br>Select count(*) from tb_item;#3000000 耗时2.79 second</p>
<p>show status like ‘Qcache%’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1033888<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>11<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_not_cached(当前查询没有进行缓存)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queryies_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>12<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">2. 当查询语句中有一些不确定的时候，则不会缓存。如：now()、current_date()、curdate()、curtime()、rand()、uuid()、user()、database()；</span><br></pre></td></tr></table></figure>
<p>select now(); # 耗时 0.01 second<br>select now(); # 耗时 0.01 second；时间是发生了变化的；即不会走缓存<br>show status like ‘Qcache%’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1033888<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>11<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_not_cached(当前查询没有进行缓存)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>7<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queryies_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>12<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>#SQL1：<br>select * from tb_item where updatetime &lt; now() limit 1;</p>
<p>#SQL2：<br>select user();</p>
<p>#SQL3：<br>select databse();</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">3.</span> 不适用任何表查询语句。</span><br></pre></td></tr></table></figure>
<p>select ‘Hello’;<br>show status like ‘Qcache%’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1033888<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>11<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_not_cached(当前查询没有进行缓存)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>8<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queryies_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>12<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>select ‘A’;</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">4.</span> 查询mysql、information_schema 或者 performance_schema 数据库中的表时，不会走查询缓存。</span><br></pre></td></tr></table></figure>
<p>show databases;<br>#information_schema<br>#mysql<br>#performance_schema</p>
<p>select * from information_schema.engines;<br>show status like ‘Qcache%’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1033888<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>11<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_not_cached(当前查询没有进行缓存)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>9<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queryies_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>12<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>select * from information_schema.engines;<br>show status like ‘Qcache%’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_free_memory<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1033888<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>  <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_hits<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>11<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_inserts<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_lowmen_prunes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"color:red;font-weight:bolder;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_not_cached(当前查询没有进行缓存)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>10<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_queryies_in_cache<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Qcache_total_blocks<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>12<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">5. 在存储的函数，触发器或者时间的主体内执行的查询；</span><br><span class="line"></span><br><span class="line">6. 如果表更改，则使用该表的所有高速缓存查询都将变为无效并从高速缓存中删除。这包括使用**MERGE**映射到已更改表的查询。一个表可以被许多类型的语句，如被改变INSERT、UPDATE、DELETE、TRUNCATE TABLE、ALTER TABLE、DROP TABLE 或者 DROP DATABASE。</span><br></pre></td></tr></table></figure>
<p>select count(*) from tb_item;#耗时 0.00 second</p>
<p>update tb_item set title=’test1’ where id=5;</p>
<p>select count(*) from tb_item;#耗时 2.67 second；该SQL失效；但是失效的同时又去进行了缓存；当前查询时并未缓存</p>
<p>select count(*) from tb_item;#耗时 0.00 second；此时再去查询；即查询的缓存区内的内容</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 内存优化 - 优化原则</span><br><span class="line"></span><br><span class="line">### 内存优化原则</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 将尽量多的内存分配给MySQL做缓存(提高mysql的访问效率)，但要给操作系统和其他程序预留足够内存；</span><br><span class="line"><span class="number">2.</span> MyISAM存储引擎的数据文件读取依赖于操作系统自身的I/O缓存，因此，如果有MyISAM表，就要预留更多的内存给操作系统做I/O缓存。</span><br><span class="line"><span class="number">3.</span> 排序区、连接区等缓存是分配给每个数据库会话（session）专用的，其默认值的设置要根据最大连接数合理分配，如果设置太大，不但浪费资源，而且在并发连接较高时会导致物理内存耗尽。</span><br><span class="line"></span><br><span class="line">## 内存优化 - MyISAM内存优化</span><br><span class="line"></span><br><span class="line">MyISAM的缓存机制：  </span><br><span class="line"></span><br><span class="line">MyISAM存储引擎使用key_buffer缓存索引块（没有缓存数据块），加速MyISAM索引的读写速度，对于MyISAM表的数据块，mysql没有特别的缓存机制，完全依赖于操作系统的I/O缓存。  </span><br><span class="line"></span><br><span class="line">**key_buffer_size**  </span><br><span class="line"></span><br><span class="line">key_buffer_size决定MyISAM索引块缓存区的大小，直接影响到MyISAM表的存取效率。  </span><br><span class="line"></span><br><span class="line">可以在mysql参数文件中设置key_buffer_size的值，对于一般MyISAM数据库，建议至少将<span class="number">1</span>/<span class="number">4</span>可用内存分配给key_buffer_size。  </span><br><span class="line"></span><br><span class="line">在/usr/my.cnf 中做如下配置：</span><br></pre></td></tr></table></figure>
<p>key_buffer_size=512M</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>show variables like ‘key_buffer_size’;#mysql 命令行</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Variable_name<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Value<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>key_buffer_size<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">8388608</span>(单位为字节；默认大小)<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line">**read_buffer_size**  </span><br><span class="line"></span><br><span class="line">如果需要经常顺序扫描MyISAM表，可以通过增大read_buffer_size的值来改善性能。  </span><br><span class="line"></span><br><span class="line">但是需要注意的是read_buffer_size是每个session独占的，如果默认值设置太大，就会造成内存浪费。  </span><br><span class="line"></span><br><span class="line">**read_rnd_buffer_size**  </span><br><span class="line"></span><br><span class="line">对于需要做排序的MyISAM表的查询，如带有 order by 子句的SQL，适当增加read_rnd_buffer_size的值，可以改善此类的SQL性能。  </span><br><span class="line"></span><br><span class="line">但是需要注意的是read_rnd_buffer_size 是每个session独占的，如果默认值设置太大，就会造成内存浪费。  </span><br><span class="line"></span><br><span class="line"><span class="meta">## 内存优化 - InnoDB内存优化</span></span><br><span class="line"></span><br><span class="line">innodb的缓存机制：  </span><br><span class="line">InnoDB用一块内存区做IO缓存池，该缓存池不仅用来缓存InnoDB的索引块，而且也用来缓存InnoDB的数据块。  </span><br><span class="line"></span><br><span class="line">**innodb_buffer_pool_size**  </span><br><span class="line"></span><br><span class="line">该变量决定了innodb存储引擎表数据和索引数据的最大缓存区大小。  </span><br><span class="line">在保证操作系统以及其他程序有足够内存可用的情况下，innodb_buffer_pool_size的值越大，缓存命中率越高，访问innodb表的需要的磁盘I/O就越少，性能也就越高。</span><br></pre></td></tr></table></figure>
<p>show variables like ‘innodb_buffer_pool_size’;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Variable_name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Value<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>innodb_buffer_pool_size<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>134217728(单位为字节；默认大小128M；134217728/1024--&gt;131072（换算成B），134217728/1024/1024--&gt;128（换算成M）；)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>vi /usr/my.cnf</p>
<h1 id="innodb-buffer-pool-size-512M-修改内容"><a href="#innodb-buffer-pool-size-512M-修改内容" class="headerlink" title="innodb_buffer_pool_size=512M #修改内容"></a>innodb_buffer_pool_size=512M #修改内容</h1><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*<span class="strong">*innodb_log_buffer_size*</span>*  </span><br><span class="line"></span><br><span class="line">决定了innodb重做日志缓存的大小，对于避免产生大量更新记录的大事务，增加innodb<span class="emphasis">_log_</span>buffer<span class="emphasis">_size的大小，可以避免innodb在事务提交前就执行不必要的日志写入磁盘操作。</span></span><br></pre></td></tr></table></figure>
<p>vi /usr/my.cnf</p>
<h1 id="innodb-log-buffer-size-10M-修改内容"><a href="#innodb-log-buffer-size-10M-修改内容" class="headerlink" title="innodb_log_buffer_size=10M #修改内容"></a>innodb_log_buffer_size=10M #修改内容</h1><p>service mysql restart</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 并发参数调整</span><br><span class="line"></span><br><span class="line">### mysql并发参数调整</span><br><span class="line"></span><br><span class="line">从实现上来说，MySQL Server是多线程结构，包括后台线程和客户服务线程。  </span><br><span class="line"></span><br><span class="line">多线程可以有效利用服务器资源，提高数据库的并发性能。  </span><br><span class="line"></span><br><span class="line">在mysql中，控制并发连接和线程的主要参数包括 max_connections、back_log、thread_cache_size、table_open_size；  </span><br><span class="line"></span><br><span class="line">#### max_connections（最大连接数）</span><br><span class="line"></span><br><span class="line">采用max_connections 控制允许连接到MySQL数据库的最大数量，默认值是<span class="number">151</span>。  </span><br><span class="line"></span><br><span class="line">如果状态变量 connection_errors_max_connections 不为零，并且一直增长，则说明不断有连接请求因数据库连接数已经达到允许最大值而失败，这时可以考虑增大max_connections的值。  </span><br><span class="line"></span><br><span class="line">MySQL最大可支持的连接数，取决于很多因素，包括给定操作系统平台的线程库的质量、内存大小、每个连接的负荷、CPU的处理速度，期望的响应时间等。  </span><br><span class="line"></span><br><span class="line">在Linux平台下，性能好的服务器，支持<span class="number">500</span><span class="number">-1000</span>个连接都不是难事，需要根据服务器性能进行评估设定。  </span><br><span class="line"></span><br><span class="line">#### back_log</span><br><span class="line"></span><br><span class="line">back_log 参数控制MySQL监听TCP端口时设置的积压请求栈大小。  </span><br><span class="line"></span><br><span class="line">如果mysql的连接数达到max_connections时，新来的请求将会被存在堆栈中，以等待某一连接释放资源，该堆栈的数量即back_log，如果等待连接的数量超过back_log，将不被授予连接资源，将会报错。  </span><br><span class="line"></span><br><span class="line"><span class="number">5.6</span><span class="number">.6</span>版本之前默认值为<span class="number">50</span>，之后的版本默认为<span class="number">50</span>+（max_connections/<span class="number">5</span>），但最大不超过<span class="number">900</span>。  </span><br><span class="line"></span><br><span class="line">如果需要数据库在较短的时间内处理大量连接请求，可以考虑适当增大back_log的值。</span><br></pre></td></tr></table></figure>
<p>show variables like ‘back_log’;</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Variable_name<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Value<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>back_log<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">80</span>(默认个数)<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#### table_open_cache</span></span><br><span class="line"></span><br><span class="line">该参数用来控制所有SQL语句执行线程可打开表缓存的数量，而在执行SQL语句时，每一个SQL执行线程至少要打开一个表缓存，该参数的值应该根据设置的最大连接数max_connections 以及每个连接执行关联查询中涉及的白鸥的最大数量来决定。</span><br></pre></td></tr></table></figure>
<p>max_connections x N;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>show variables like ‘table_open_cache’;</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Variable_name<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Value<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>table_open_cache<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">2000</span>(默认大小)<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#### thread_cache_size（线程缓存大小）</span></span><br><span class="line"></span><br><span class="line">为了加快连接数据库的速度，MySQL会缓存一定数量的客户服务线程（线程池）以备重用，通过参数 thread_cache_size 可控制MySQL缓存客户服务线程的数量（线程池的大小）。</span><br></pre></td></tr></table></figure>
<p>show variables like ‘thread_cache_size’;</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Variable_name<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Value<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>thread_cache_size<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">9</span>(默认大小<span class="number">9</span>个线程)<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#### innodb_lock_wait_timeout（innodb行锁的等待时间）</span></span><br><span class="line"></span><br><span class="line">该参数是用来设置InnoDB事务等待行锁的时间，默认值时候<span class="number">50</span>ms。  </span><br><span class="line"></span><br><span class="line">可以根据需要进行动态设置。  </span><br><span class="line"></span><br><span class="line">对于需要快速反馈的业务系统来说，可以将行锁的等待时间调小，以避免事务长时间挂起；  </span><br><span class="line"></span><br><span class="line">对于后台运行的批量处理程序来说，可以将行锁的等待时间调大，以避免发生大的回滚操作。</span><br></pre></td></tr></table></figure>
<p>show variables like ‘innodb_lock_wait_timeout’;</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Variable_name<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Value<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>innodb_lock_wait_timeout<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">50</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">## 锁 - 锁的概述及分类</span></span><br><span class="line"></span><br><span class="line"><span class="meta">### 锁概述</span></span><br><span class="line"></span><br><span class="line">锁是计算机协调多个进程 或者 线程 并发访问某一资源的机制（避免争抢）。  </span><br><span class="line"></span><br><span class="line">在数据库中，除了传统的计算资源（如CPU、RAM、I/O等）的争用以外，数据也是一种供许多用户共享的资源。  </span><br><span class="line"></span><br><span class="line">如何保证数据并发访问的一致性、有效性是所有数据库必须解决的一个问题，锁冲突也是影响数据库并发访问性能的一个重要因素。  </span><br><span class="line"></span><br><span class="line">从这个角度来说，锁对数据库而言显得尤其重要，也更加复杂。  </span><br><span class="line"></span><br><span class="line"><span class="meta">### 锁分类</span></span><br><span class="line"></span><br><span class="line">从对数据操作的粒度分为：  </span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 表锁：操作时，会锁定整个表</span><br><span class="line"><span class="number">2.</span> 行锁：操作时，会锁定当前操作行</span><br><span class="line"></span><br><span class="line">从对数据操作的类型分：  </span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 读锁（共享锁）：针对同一份数据，多个读操作可以同时进行而不会互相影响</span><br><span class="line"><span class="number">2.</span> 写锁（排它锁）：当前操作没有完成之前，他会阻断其他写锁和读锁</span><br><span class="line"></span><br><span class="line"><span class="meta">## 锁 - MySQL对锁的支持</span></span><br><span class="line"></span><br><span class="line">相对其他数据库而言，MySQL的锁机制比较简单。  </span><br><span class="line"></span><br><span class="line">其最显著的特点是不同的存储引擎支持不同的锁机制。  </span><br><span class="line"></span><br><span class="line">下标罗列出了各个存储引擎对锁的支持情况。  </span><br><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>存储引擎<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>表级锁<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>行级锁<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>页面锁<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>MyISAM<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>支持<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>不支持<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>不支持<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">    <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>InnoDB<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>支持<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>支持<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>不支持<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">    <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>MEMORY<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>支持<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>不支持<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>不支持<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">    <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>BDB<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>支持<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>不支持<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>支持<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line">MySQL这三种锁的特性可大致归纳如下：  </span><br><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>锁类型<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>特定<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>表级锁<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>偏向MyISAM存储引擎，开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率最高，并发度最低。<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">    <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>行级锁<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>偏向InnoDB存储引擎，开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高。<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">    <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>页面锁<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>开销和加锁时间介于表锁和行锁之间；会出现死锁；锁定粒度介于表锁和行锁之间，并发度一般。<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line">从上述特点可见，很难笼统的说哪种锁更好，只能就具体应用的特点来说哪种锁更合适。  </span><br><span class="line"></span><br><span class="line">仅从锁的角度来说：  </span><br><span class="line">  表级锁更适合于以查询为主，只有少量按索引条件更新数据的应用，如Web应用；  </span><br><span class="line">  而行级锁则更适合于有大量按索引条件并发更新少量不同数据，同时又有并发查询的应用，如一些在线事务处理（OLTP）系统；  </span><br><span class="line"></span><br><span class="line"><span class="meta">## 锁 - MyISAM表锁 - 读锁</span></span><br><span class="line"></span><br><span class="line">读锁（共享锁）：针对同一份数据，多个读操作可以同时进行而不会互相影响。</span><br><span class="line"></span><br><span class="line">MyISAM存储引擎支持表锁，这也是MySQL开始几个版本中唯一支持的锁类型。  </span><br><span class="line"></span><br><span class="line"><span class="meta">### 如何加表锁  </span></span><br><span class="line"></span><br><span class="line">MyISAM在执行查询语句（SELECT）前，会自动给涉及的所有表加读锁，在执行更新操作（UPDATE、DELETE、INSERT等），会自动给涉及的表加写锁，这个过程并不需要用户干预。  </span><br><span class="line"></span><br><span class="line">因此，用户一般不需要直接用LOCK TABLE命令给MyISAM表显式加锁。  </span><br><span class="line"></span><br><span class="line">显示加表锁语法：</span><br></pre></td></tr></table></figure>
<p>#加读锁：<br>lock table table_name read;</p>
<p>#加写锁：<br>lock table table_name write;</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 读锁案例</span><br><span class="line"></span><br><span class="line">准备环境</span><br></pre></td></tr></table></figure>
<p>create database demo_03 default charset=utf8mb4;</p>
<p>use demo_03;</p>
<p>CREATE TABLE ‘tb_book’(<br>  ‘id’ INT(11) AUTO_INCREMENT,<br>  ‘name’ VARCHAR(50) DEFAULT NULL,<br>  ‘publish_name’ DATE DEFAULT NULL,<br>  ‘status’ CHAR(1) DEFAULT NULL,<br>  PRIMARY KEY (‘id’)<br>)ENGINE=myisam DEFAULT CHARSET=utf8;</p>
<h1 id="插入tb-book-基础数据"><a href="#插入tb-book-基础数据" class="headerlink" title="插入tb_book 基础数据"></a>插入tb_book 基础数据</h1><p>CREATE TABLE ‘tb_user’(<br>  ‘id’ INT(11) AUTO_INCREMENT,<br>  ‘name’ VARCHAR(50) DEFAULT NULL,<br>  PRIMARY KEY(‘id’)<br>)ENGINE=myisam DEFAULT CHARSET=utf8;</p>
<h1 id="插入tb-user-基础数据"><a href="#插入tb-user-基础数据" class="headerlink" title="插入tb_user 基础数据"></a>插入tb_user 基础数据</h1><p>show tables;</p>
<p>lock table tb_book read;</p>
<p>select * from tb_books;</p>
<p>select * from tb_user;# Table ‘tb_user’ was not locked with LOCK TABLES 锁定tb_book表途中无法去操作其他表；除非当前tb_book表锁释放；</p>
<p>update tb_book set name =’solr’ where id=2;#当前对tb_book表进行的锁是读锁，而不是写锁；所以当前无法进行更新；Table ‘tb_book’ was locked with a READ lock and can’t be updated.</p>
<p>unlock tables;#只有当当前的tb_book表当中的读锁进行解锁，其他客户端连接mysql的该表时才能够进行写锁；否则将一直等待当前该tb_book的读锁释放；</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如果对MyISAM表进行操作了读锁，其不会阻塞其他线程的读操作，但是会阻塞其他线程的写操作。  </span><br><span class="line"></span><br><span class="line">## 锁 - MyISAM表锁 - 写锁</span><br><span class="line"></span><br><span class="line">写锁（排它锁）：当前操作没有完成之前，它会阻断其他写锁和读锁。</span><br></pre></td></tr></table></figure>
<p>#当前客户端<br>lock table tb_book write;</p>
<p>select * from tb_book;</p>
<p>update tb_book set name =’solr’ where id=2;</p>
<p>insert into tb_book(id,name) values(null,’es’);</p>
<p>#其他客户端<br>select * from tb_book;#其他客户端将一直处于等待状态，除非当前客户端的写锁释放（即当前客户端的业务操作完成），否则其他客户端一直处于等待状态。</p>
<p>#当前客户端<br>unlock tables;</p>
<p>#其他客户端<br>select * from tb_book;#当 当前客户端释放锁之后，该其他客户端即立刻能查询到数据。</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">## 锁 - MyISAM表锁 - 小结</span></span><br><span class="line"></span><br><span class="line">锁模式的互相兼容性如表所示：  </span><br><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>当前锁模式/请求锁模式<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>None（理解为当前客户端获取得到的锁）<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>读锁（其他客户端对于读操作是否可行）<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>写锁（其他客户端对于写操作是否可行）<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>读锁<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>是（当前客户端获取得到的读锁）<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>是（其他客户端可以进行读操作）<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>否（其他客户端无法进行写操作）<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">    <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>写锁<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>是（当前客户端获取得到的写锁）<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>否（其他客户端无法进行读操作）<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>否（其他客户端无法进行写操作）<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line">由上表可见：  </span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 对MyISAM表的读操作，不会阻塞其他用户对同一张表的读请求，但是会阻塞对同一张表的写请求。</span><br><span class="line"><span class="number">2.</span> 对MyISAM表的写操作，则会阻塞其他用户对同一张表的读和写操作。</span><br><span class="line"></span><br><span class="line">简而言之，就是读锁会阻塞写，但是不会阻塞读；而写锁，则既会阻塞读，又会阻塞写。  </span><br><span class="line"></span><br><span class="line">此外，MyISAM的读写锁调度是写操作优先，这也是MyISAM不适合做写为主的表的存储引擎的原因。  </span><br><span class="line">因为写锁后，其他线程不能做任何操作，大量的更新会使查询很难得到锁，从而造成永远阻塞。</span><br><span class="line"></span><br><span class="line"><span class="meta">## 锁 - MyISAM表锁 - 查看锁争用情况</span></span><br></pre></td></tr></table></figure>
<p>show open tables;</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Database</span>: 数据库  </span><br><span class="line"></span><br><span class="line"><span class="attribute">Table</span>: 数据表  </span><br><span class="line"></span><br><span class="line"><span class="attribute">In_use</span>: 表当前被查询使用的次数。如果该数为零，则表是打开的，但是当前没有被使用。  </span><br><span class="line"></span><br><span class="line"><span class="attribute">Name_locked</span>: 表名称是否被锁定。名称锁定用于取消表或者对表进行重命名等操作。</span><br></pre></td></tr></table></figure>
<p>lock table tb_book write;<br>show open tables;#database: demo_03; table: tb_book ; In_use(正在使用):1；Name_locked:0<br>unlock tables;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>show status like ‘Table_locks%’;</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Variable_name<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Value<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>Table_lockes_immediate<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">70</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">    <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>Table_locks_waited<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="number">0</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">Table_locks_immediate:</span> 指的是能够立即获得表级锁的次数，每次立即获取锁，值加<span class="number">1</span>；  </span><br><span class="line"></span><br><span class="line"><span class="symbol">Table_locks_waited:</span> 指的是不能立即获取表级锁而需要等待的次数，每等待一次，该值加<span class="number">1</span>，此值高说明存在着较为严重的表级锁争用情况。</span><br><span class="line"></span><br><span class="line"><span class="meta">## 锁 - InnoDB行锁 - 介绍及背景知识</span></span><br><span class="line"></span><br><span class="line"><span class="meta">### 行锁介绍</span></span><br><span class="line"></span><br><span class="line">InnoDB默认支持行锁，也支持表锁；  </span><br><span class="line"></span><br><span class="line">行锁特点：偏向InnoDB存储迎请，开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高。  </span><br><span class="line">（由于锁定粒度最小，所以发生锁冲突的概率最低，二者存在关联）  </span><br><span class="line"></span><br><span class="line">InnoDB与MyISAM的最大不同有两点：一是支持事务；二是采用了行级锁；  </span><br><span class="line">(事务和行级锁之间存在关联，支持事务的原因即在于InnoDB采用的是行级锁)</span><br><span class="line"></span><br><span class="line"><span class="meta">### 背景知识</span></span><br><span class="line"></span><br><span class="line">**事务及其ACID属性**  </span><br><span class="line"></span><br><span class="line">事务是由一组SQL语句组成的逻辑处理单元。  </span><br><span class="line">事务具有以下<span class="number">4</span>个特性，简称为事务ACID属性。  </span><br><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>ACID属性<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>含义<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>原子性（Atomic）<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>事务是一个原子操作单元，其对数据的修改，要么全部成功，要么全部失败<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>一致性（Consistent）<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>在事务开始和完成时，数据都必须保持一致状态<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>隔离性（Isolation）<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>数据库系统提供一定的隔离机制，保证事务在不受外部并发操作影响的“独立”环境下运行<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>持久性（Durable）<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>事务完成之后，对于数据的修改是永久的<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line">**并发事务处理带来的问题**  </span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>问题<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>含义<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>丢失更新（Lost Update）<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>当两个或者多个事务选择同一行，最初的事务修改的值，会被后面的事务修改的值覆盖<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>脏读（Dirty Reads）<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>当一个事务正在访问数据，并且对数据进行了修改，而这种修改还没有提交到数据库中，这时，另外一个事务也访问这个数据，然后使用了这个数据（一个事务读取到了另外一个事务还未提交的数据）<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>不可重复度（Non_repeatable Reads）<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>一个事务在读取某些数据后的某个时间，再次读取以前读过的数据，却发现和以前独处的数据不一致<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>幻读（Phantom Reads）<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>一个事务按照相同的查询条件重新读取以前查询过的数据，却发现其他事务插入了满足其查询条件的新数据。<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line">**事务隔离级别**  </span><br><span class="line"></span><br><span class="line">为了解决上述提到的事务并发问题，数据库提供一定的事务隔离机制来解决这个问题。  </span><br><span class="line"></span><br><span class="line">数据库的事务隔离越严格，并发副作用越小，但付出的代价也就越大(性能越低)，因为事务隔离实质上就是使用事务在一定程度上“串行化”进行，这显然与“并发”是矛盾的。  </span><br><span class="line"></span><br><span class="line">数据库的隔离级别有<span class="number">4</span>个，由低到高依次为Read uncommitted、Read committed、Repeatable read、Serializable ，这四个界别可以逐个解决脏写、脏读、不可重复度、幻读这几类问题。  </span><br><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>隔离级别<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>丢失更新<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>脏读<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>不可重复读<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>幻读<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>Read uncommitted<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>x<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>√<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>√<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>√<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">    <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>Read committed<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>x<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>x<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>√<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>√<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">   <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>Repeatable read(默认)<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>x<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>x<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>x<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>√<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">    <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>Serializable<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>x<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>x<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>x<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>x<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line">备注： √ 代表可能出现， x 代表不会出现。  </span><br><span class="line"></span><br><span class="line">MySQL的数据库的默认隔离级别是 Repeatable read，查看方式：</span><br></pre></td></tr></table></figure>
<p>show variables like ‘tx_isolation’;</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Variable_name<span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Value<span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>tx_isolation<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>REPEATABLE-READ<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">## 锁 - InnoDB行锁 - 类型</span></span><br><span class="line"></span><br><span class="line"><span class="meta">### InnoDB的行锁模式</span></span><br><span class="line"></span><br><span class="line">InnoDB实现了以下两种类型的行锁：  </span><br><span class="line"></span><br><span class="line">* 共享锁（S）： 又称为读锁，简称S锁，共享锁就是多个事务对于统一数据可以共享一把锁，都能访问到数据，但是只能读不能修改。  </span><br><span class="line"></span><br><span class="line">* 排它锁（X）：又称为写锁，简称X锁，排它锁就是不能与其他锁并存。如果一个事务湖区了一个数据行的排它锁，其他事务就不能再获取该行的其他锁，包括共享锁和排它锁，但是获取排它锁的事务可以对数据进行读取和修改。  </span><br><span class="line"></span><br><span class="line">对于UPDATE、DELETE和INSERT语句，InnoDB会自动给涉及数据集加排它锁（X）；  </span><br><span class="line">对于普通SELECT语句，InnoDB不会加任何锁；  </span><br><span class="line"></span><br><span class="line">可以通过以下语句显式给记录集加共享锁或者排它锁：</span><br></pre></td></tr></table></figure>
<p>#共享锁（S）<br>SELECT * FROM table_name WHERE …… LOCK IN SHARE MODE</p>
<p>#排它锁（X）<br>SELECT * FROM table_name WHERE ……. FOR UPDATE</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 案例准备工作</span><br></pre></td></tr></table></figure>
<p>create table test_innodb_lock(<br>  id int(11),<br>  name varchar(16),<br>  sex varchar(1)<br>)engine=innodb default charset=utf8;</p>
<p>#插入基础数据</p>
<p>#创建单列索引<br>create index idx_test_innodb_lock_id on test_innodb_lock(id);<br>create index idx_test_innodb_lock_name on test_innodb_lock(name);</p>
<p>show tables;</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">### 行锁基本演示</span></span><br><span class="line"></span><br><span class="line"><span class="variable">&lt;table&gt;</span></span><br><span class="line">  <span class="variable">&lt;tr&gt;</span></span><br><span class="line">    <span class="variable">&lt;th&gt;</span>Session-1<span class="variable">&lt;/th&gt;</span></span><br><span class="line">    <span class="variable">&lt;th&gt;</span>Session-2<span class="variable">&lt;/th&gt;</span></span><br><span class="line">  <span class="variable">&lt;/tr&gt;</span></span><br><span class="line">  <span class="variable">&lt;tr&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>关闭自动提交功能（set autocommit=0;）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>关闭自动提交功能（set autocommit=0;）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">  <span class="variable">&lt;/tr&gt;</span></span><br><span class="line">  <span class="variable">&lt;tr&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>可以正常的查询出全部的数据（select <span class="symbol">*</span> from test_innodb_lock;）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>可以正常的查询出全部的数据（select <span class="symbol">*</span> from test_innodb_lock;）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">  <span class="variable">&lt;/tr&gt;</span></span><br><span class="line">  <span class="variable">&lt;tr&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>查询id为3的数据；（select <span class="symbol">*</span> from test_innodb_lock where id=3;）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>查询id为3的数据；（select <span class="symbol">*</span> from test_innodb_lock where id=3;）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">  <span class="variable">&lt;/tr&gt;</span></span><br><span class="line">   <span class="variable">&lt;tr&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>更新id为3的数据，但是不提交（update test_innodb_lock set name='AI' where id=3;）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>更新id为3的数据，在Session-1的更新提交完成之前一直处于等待状态；（update test_innodb_lock set name='AII' where id=3;）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">  <span class="variable">&lt;/tr&gt;</span></span><br><span class="line"><span class="variable">&lt;tr&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>通过commit，提交事务（commit;）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>接触阻塞，更新正常进行（update test_innodb_lock set name='AII' where id=3;）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">  <span class="variable">&lt;/tr&gt;</span></span><br><span class="line">  <span class="variable">&lt;tr&gt;</span></span><br><span class="line">    <span class="variable">&lt;td colspan="2"&gt;</span>以上，操作的都是同一行的数据，接下来，演示不同行的数据；<span class="variable">&lt;/td&gt;</span></span><br><span class="line">  <span class="variable">&lt;/tr&gt;</span></span><br><span class="line">  <span class="variable">&lt;tr&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>更新id为3的数据，正常的获取到行锁，执行更新；(update test_innodb_lock set name='a1' where id =3;)<span class="variable">&lt;/td&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>由于与Session-1操作不是同一行，获取当前行锁，执行更新；（update test_innodb_lock set name =<span class="string">"C1"</span> where id=5;）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">  <span class="variable">&lt;/tr&gt;</span></span><br><span class="line"><span class="variable">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 锁 - InnoDB行锁 - 行锁升级为表锁</span></span><br><span class="line"></span><br><span class="line">如果不通过索引条件检索数据，那么innodb将对表中的所有记录加锁，实际效果跟表锁一样。  </span><br><span class="line"></span><br><span class="line">查看当前表的索引：show index from test_innodb_lock;</span><br></pre></td></tr></table></figure>
<p>show index from test_innodb_lock\G;</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="params">&lt;table&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Session<span class="number">-1</span><span class="params">&lt;/th&gt;</span></span><br><span class="line">    <span class="params">&lt;th&gt;</span>Session<span class="number">-2</span><span class="params">&lt;/th&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>关闭事务的自动提交（set autocommit=<span class="number">0</span>;）<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>关闭事务的自动提交（set autocommit=<span class="number">0</span>;）<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>执行更新语句（update test_innodb_lock set sex=<span class="string">'2'</span> where <span class="params">&lt;span style='color:red;font-weight:bolder;'&gt;</span>name=<span class="number">400</span><span class="params">&lt;/span&gt;</span>; ）<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>执行更新语句，但是出于阻塞状态（update test_innodb_lock set sex=<span class="string">'2'</span> where id=<span class="number">9</span>;）<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">   <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>提交事务（commit;）<span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>解除阻塞，执行更新成功（update test_innodb_lock set sex=<span class="string">'2'</span> where id=<span class="number">9</span>;）<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line">  <span class="params">&lt;tr&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span><span class="params">&lt;/td&gt;</span></span><br><span class="line">    <span class="params">&lt;td&gt;</span>执行提交操作（commit;）<span class="params">&lt;/td&gt;</span></span><br><span class="line">  <span class="params">&lt;/tr&gt;</span></span><br><span class="line"><span class="params">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line">由于执行更新时，name字段本来为varchar类型，但是Session<span class="number">-1</span>当中name作为数字类型来使用，所以存在类型转换，索引失效，最终行锁变为表锁；</span><br></pre></td></tr></table></figure>
<p>desc test_innodb_lock;#查看表结构</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">索引失效：name字段本来的类型为varcahr类型；如果是varchar类型但是在使用的时候，没有给其name字段的取值加上单引号，那么这个时候索引就将失效；索引失效，行锁升级为表锁；</span><br><span class="line"></span><br><span class="line"><span class="comment">## 锁 - InnoDB行锁 - 间隙锁危害</span></span><br><span class="line"></span><br><span class="line">当用范围条件，而不是使用相等条件检索数据，并请求共享或者排它锁的时候，InnoDB会给符合条件的已有数据进行加锁；  </span><br><span class="line">对于键值在条件范围内但并不存在的记录，叫做“间隙（GAP）”，InnoDB也会对这个“间隙”加锁，这种锁机制就是所谓的 间隙锁（Next-Key锁）；  </span><br><span class="line"></span><br><span class="line">ID <span class="variable">&lt; 10 ：  </span></span><br><span class="line"><span class="variable"></span></span><br><span class="line"><span class="variable">* 1,2,3,4,5,6,7,8,9</span></span><br><span class="line"><span class="variable">* 1,2,3,4,6,9(此时当中的5 和 7、8 则称之为间隙)</span></span><br><span class="line"><span class="variable"></span></span><br><span class="line"><span class="variable">示例：  </span></span><br><span class="line"><span class="variable"></span></span><br><span class="line"><span class="variable">&lt;table&gt;</span></span><br><span class="line">  <span class="variable">&lt;tr&gt;</span></span><br><span class="line">    <span class="variable">&lt;th&gt;</span>Session-1<span class="variable">&lt;/th&gt;</span></span><br><span class="line">    <span class="variable">&lt;th&gt;</span>Session-2<span class="variable">&lt;/th&gt;</span></span><br><span class="line">  <span class="variable">&lt;/tr&gt;</span></span><br><span class="line">  <span class="variable">&lt;tr&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>关闭事务自动提交（set autocommit=0;）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>关闭事务自动提交（set autocommit=0;）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">  <span class="variable">&lt;/tr&gt;</span></span><br><span class="line">  <span class="variable">&lt;tr&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>根据id范围更新数据（update test_innodb_lock set name='332423' where id <span class="variable">&lt; 4 ;）&lt;/td&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>插入id为2的记录，处于阻塞状态（insert into test_innodb_lock values(2,'1001','1'); ）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">  <span class="variable">&lt;/tr&gt;</span></span><br><span class="line">    <span class="variable">&lt;tr&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>提交事务（commit;）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>解除阻塞，执行插入操作（insert into test_innodb_lock values(2,'1001','1'); ）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">  <span class="variable">&lt;/tr&gt;</span></span><br><span class="line">   <span class="variable">&lt;tr&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span><span class="variable">&lt;/td&gt;</span></span><br><span class="line">    <span class="variable">&lt;td&gt;</span>提交事务（commit;）<span class="variable">&lt;/td&gt;</span></span><br><span class="line">  <span class="variable">&lt;/tr&gt;</span></span><br><span class="line"><span class="variable">&lt;/table&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 锁 - InnoDB行锁 - 争用情况查看</span></span><br></pre></td></tr></table></figure>
<p>show status like ‘innodb_row_lock%’;</p>
<p>#Innodb_row_lock_current_waits: 当前正在等待锁定的数量；</p>
<p>#Innodb_row_lock_time： 从系统启动到现在锁定总时间长度</p>
<p>#Innodb_row_lock_time_avg: 每次等待所花平均时长</p>
<p>#Innodb_row_lock_time_max: 从系统启动到现在等待最长的一次所花时间</p>
<p>#Innodb_row_lock_waits： 系统启动后到现在总共等待的次数</p>
<p>#当等待的次数很高，而且每次等待的时长也不小的时候，就需要分析系统中为什么会有如此多的等待，然后根据分析结果着手制定优化计划。  </p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section">## 锁 - InnoDB行锁 - 总结</span></span><br><span class="line"></span><br><span class="line">Innodb存储引擎由于实现了行级锁定，虽然在锁定机制的实现方面带来了性能损耗可能比表锁会更高一些，但是在整体并发处理能力方面姚媛媛优于MyISAM的表锁的。  </span><br><span class="line"></span><br><span class="line">当系统并发量较高的时候，InnoDB的整体性能和MyISAM相比就会有比较明显的优势。  </span><br><span class="line"></span><br><span class="line">但是，InnoDB的行级锁同样也有其脆弱的一面，但使用不当的时候，可能会让InnoDB的整体性能不仅不能比MyISAM高，甚至可能会更差。  </span><br><span class="line"></span><br><span class="line">优化建议：  </span><br><span class="line"></span><br><span class="line"><span class="bullet">* </span>尽可能让所有数据检索都能通过索引来完成，避免无索引行锁升级为表锁</span><br><span class="line"><span class="bullet">* </span>合理设计索引，尽量缩小锁的范围</span><br><span class="line"><span class="bullet">* </span>尽可能减少索引条件，以及索引范围，避免间隙锁</span><br><span class="line"><span class="bullet">* </span>尽量控制事务大小，减少锁定资源量和时间长度</span><br><span class="line"><span class="bullet">* </span>尽可能使用低级别事务隔离（前提：但是需要业务层面满足需求）</span><br><span class="line"></span><br><span class="line"><span class="section">## SQL技巧 - SQL执行顺序及正则表达式</span></span><br><span class="line"></span><br><span class="line"><span class="section">### SQL执行顺序</span></span><br><span class="line"></span><br><span class="line">编写顺序</span><br></pre></td></tr></table></figure>
<p>SELECT DISTINCT<br>  <select list><br>FROM<br>  <left_table> <join_type><br>JOIN<br>  <right_table> ON <join_condition><br>WHERE<br>  <where_condition><br>GROUP BY<br>  <group_by_list><br>HAVING<br>  <having_condition><br>ORDER BY<br>  <order_by_condition><br>LIMIT<br>  <limit_params></limit_params></order_by_condition></having_condition></group_by_list></where_condition></join_condition></right_table></join_type></left_table></select></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">执行顺序</span><br></pre></td></tr></table></figure>
<p>FROM <left_table></left_table></p>
<p>ON <join_condition></join_condition></p>
<p><join_type> JOIN <right_table></right_table></join_type></p>
<p>WHERE <where_condition></where_condition></p>
<p>GROUP BY <group_by_list></group_by_list></p>
<p>HAVING <having_condition></having_condition></p>
<p>SELECT DISTINCT <select list></select></p>
<p>ORDER BY <order_by_condition></order_by_condition></p>
<p>LIMIT <limit_params></limit_params></p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 正则表达式使用</span><br></pre></td></tr></table></figure>
<p>show tables;</p>
<p>select * from tb_book;</p>
<h1 id="正则表达式-regexp"><a href="#正则表达式-regexp" class="headerlink" title="正则表达式 regexp"></a>正则表达式 regexp</h1><p>select * from tb_book where name regexp ‘^j’;#查询name字段取值以 “j” 字符开头的记录行</p>
<p>select * from tb_book where name regexp ‘S$’;#查询name字段取值以 “S” 字符结尾的记录行</p>
<p>select * from tb_book where name regexp ‘[uvw]’;#查询name字段取值包含 “u”、“v”、“w” 字符的记录行</p>
<pre><code>
&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;符号&lt;/th&gt;
    &lt;th&gt;含义&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;^&lt;/td&gt;
    &lt;td&gt;在字符串开始处进行匹配&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;$&lt;/td&gt;
    &lt;td&gt;在字符串末尾处进行匹配&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;.&lt;/td&gt;
    &lt;td&gt;匹配任意单个字符，包括换行符&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;[...]&lt;/td&gt;
    &lt;td&gt;匹配出括号内的任意字符&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;[^...]&lt;/td&gt;
    &lt;td&gt;匹配不出括号内的任意字符&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;a*&lt;/td&gt;
    &lt;td&gt;匹配零个或者多个a（包括空串）&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;a+&lt;/td&gt;
    &lt;td&gt;匹配一个或者多个a（不包括空串）&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;a?&lt;/td&gt;
    &lt;td&gt;匹配零个或者一个a&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;a1|a2&lt;/td&gt;
    &lt;td&gt;匹配a1或者a2&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;a(m)&lt;/td&gt;
    &lt;td&gt;匹配m个a&lt;/td&gt;
  &lt;/tr&gt;
      &lt;tr&gt;
    &lt;td&gt;a(m,)&lt;/td&gt;
    &lt;td&gt;至少匹配m个a&lt;/td&gt;
  &lt;/tr&gt;
      &lt;tr&gt;
    &lt;td&gt;a(m,n)&lt;/td&gt;
    &lt;td&gt;匹配m个a 到n个a&lt;/td&gt;
  &lt;/tr&gt;
      &lt;tr&gt;
    &lt;td&gt;a(,n)&lt;/td&gt;
    &lt;td&gt;匹配0到n个a&lt;/td&gt;
  &lt;/tr&gt;
      &lt;tr&gt;
    &lt;td&gt;(...)&lt;/td&gt;
    &lt;td&gt;将模式元素组成单一元素&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;

## SQL技巧 - 数字函数与字符串函数

### 数字函数

&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;函数名称&lt;/th&gt;
    &lt;th&gt;作用&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;ABS&lt;/td&gt;
    &lt;td&gt;求绝对值&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;SQRT&lt;/td&gt;
    &lt;td&gt;求二次方根&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;MOD&lt;/td&gt;
    &lt;td&gt;求余数&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;CEIL和CEILING&lt;/td&gt;
    &lt;td&gt;两个函数功能相同，都是返回不小于参数的最小整数，即向上取整&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;FLOOR&lt;/td&gt;
    &lt;td&gt;向下取整，返回值转化为一个BIGINT&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;RAND&lt;/td&gt;
    &lt;td&gt;生成一个0-1之间的随机数，传入整数参数是，用来产生重复序列&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;ROUND&lt;/td&gt;
    &lt;td&gt;对所传入参数进行四舍五入&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;SIGN&lt;/td&gt;
    &lt;td&gt;返回参数的符号&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;POW和POWER&lt;/td&gt;
    &lt;td&gt;两个函数的功能相同，都是所传参数的次方的结果值&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;SIN&lt;/td&gt;
    &lt;td&gt;求正弦值&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;COS&lt;/td&gt;
    &lt;td&gt;求余弦值&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;ACOS&lt;/td&gt;
    &lt;td&gt;求反余弦值，与函数COS互为反函数&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;TAN&lt;/td&gt;
    &lt;td&gt;求正切值&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;ATAN&lt;/td&gt;
    &lt;td&gt;求反正切值，与函数TAN互为反函数&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;COT&lt;/td&gt;
    &lt;td&gt;求余切值&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;

### 字符串函数

&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;函数名称&lt;/th&gt;
    &lt;th&gt;作用&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;LENGTH&lt;/td&gt;
    &lt;td&gt;计算字符串长度函数，返回字符串的字节长度&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;CONCAT&lt;/td&gt;
    &lt;td&gt;合并字符串函数，返回结果为连接参数产生的字符串，参数可以使用一个或者多个&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;INSERT&lt;/td&gt;
    &lt;td&gt;替换字符串函数&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;LOWER&lt;/td&gt;
    &lt;td&gt;将字符串中的字母转换为小写&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;UPPER&lt;/td&gt;
    &lt;td&gt;将字符串中的字母转换为大写&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;LEFT&lt;/td&gt;
    &lt;td&gt;从左侧截取字符串，返回字符串左边的若干个字符&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;RIGTH&lt;/td&gt;
    &lt;td&gt;从右侧截取字符串，返回字符串右边的若干个字符&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;TRIM&lt;/td&gt;
    &lt;td&gt;删除字符串左右两侧的空格&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;REPLACE&lt;/td&gt;
    &lt;td&gt;字符串替换函数，返回替换后的新字符串&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;SUBSTRING&lt;/td&gt;
    &lt;td&gt;截取字符串，返回从指定位置开始的指定长度的字符串&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;REVERSE&lt;/td&gt;
    &lt;td&gt;字符串反转（逆序）函数，返回与原始字符串顺序相反的字符串&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;

## SQL技巧 - 日期函数与聚合函数

### 日期函数

&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;函数名称&lt;/th&gt;
    &lt;th&gt;作用&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;CURDATE和CURRENT_DATE&lt;/td&gt;
    &lt;td&gt;两个函数作用相同，返回当前系统的日期值&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;CURTIME和CURRENT_TIME&lt;/td&gt;
    &lt;td&gt;两个函数作用相同，返回当前系统的时间值&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;NOW和SYSDATE&lt;/td&gt;
    &lt;td&gt;两个函数作用相同，返回当前系统的日期和时间值&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;MONTH&lt;/td&gt;
    &lt;td&gt;获取指定日期中的月份&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;MONTHNAME&lt;/td&gt;
    &lt;td&gt;获取指定日期中的月份英文名称&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;DAYNAE&lt;/td&gt;
    &lt;td&gt;获取指定日期对应的星期几的英文名称&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;DAYOFWEEK&lt;/td&gt;
    &lt;td&gt;获取指定日期对应的一周的索引位置值&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;WEEK&lt;/td&gt;
    &lt;td&gt;获取指定日期是一年中的第几周，返回值的范围是否为0~52或者1~53&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;DAYOFYEAR&lt;/td&gt;
    &lt;td&gt;获取指定日期是一年中的第几天，返回值范围是1~366&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;DAYOFMONTH&lt;/td&gt;
    &lt;td&gt;获取指定日期是一个月中的第几天，返回值是1~31&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;YEAR&lt;/td&gt;
    &lt;td&gt;获取年份，返回值范围是1970~2069&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;TIME_TO_SEC&lt;/td&gt;
    &lt;td&gt;将时间参数转换为秒数&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;SEC_TO_TIME&lt;/td&gt;
    &lt;td&gt;将秒数转换为时间，与TIME_TO_SEC互为反函数&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;DATE_ADD和ADDDATE&lt;/td&gt;
    &lt;td&gt;两个函数功能相同，都是向日期添加指定的时间间隔&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;DATE_SUB和SUBDATE&lt;/td&gt;
    &lt;td&gt;两个函数功能相同，都是向日期减去指定的时间间隔&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;ADDTIME&lt;/td&gt;
    &lt;td&gt;时间加法运算，在原始时间上添加指定的时间&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;SUBTIME&lt;/td&gt;
    &lt;td&gt;时间减法运算，在原始时间上减去指定时间&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;DATEDIFF&lt;/td&gt;
    &lt;td&gt;获取两个日期之间间隔，返回参数1减去参数2的值&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;DATE_FORMAT&lt;/td&gt;
    &lt;td&gt;格式化指定的日期，根据参数返回指定格式的值&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;WEEKDAY&lt;/td&gt;
    &lt;td&gt;获取指定日期在一周内的对应的工作日索引&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;

### 聚合函数

&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;函数名称&lt;/th&gt;
    &lt;th&gt;作用&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;MAX&lt;/td&gt;
    &lt;td&gt;查询指定列的最大值&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;MIN&lt;/td&gt;
    &lt;td&gt;查询指定列的最小值&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;COUNT&lt;/td&gt;
    &lt;td&gt;统计查询结果的行数&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;SUM&lt;/td&gt;
    &lt;td&gt;求和，返回指定列的总和&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;AVG&lt;/td&gt;
    &lt;td&gt;求平均值，返回指定列数据的平均值&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;

## 课程内容

## 常用工具 - mysql

## 常用工具 - mysqladmin

## 常用工具 - mysqlbinlog与mysqldump

## 常用工具 - mysqlimport与source

## 常用工具 - mysqlshow

## 日志 - 错误日志

## 日志 - 二进制日志（statement）

## 日志 - 二进制日志（row及日志删除）

## 日志 - 查询日志

## 日志 - 慢查询日志

## 复制 - 原理

## 案例 - 需求及环境准备

## 案例 - 基本工程导入

## 案例 - AOP记录日志

## 案例 - 日志查询后端 - mapper接口

## 案例 - 日志查询后端 - Service&amp;Controller

## 案例 - 日志查询 - 前端

## 案例 - 系统性能优化分析

## 案例 - 系统性能优化 - 分页优化

## 案例 - 系统性能优化 - 索引优化

## 案例 - 系统性能优化 - 读写分离概述

## 案例 - 系统性能优化 - 数据源配置

## 案例 - 系统性能优化 - AOP切换数据源

## 案例 - 系统性能优化 - AOP切换数据源 - 测试

## 案例 - 系统性能优化 - AOP切换数据源 - 原理解析

## 案例 - 系统性能优化 - 应用优化</code></pre>
      
    </div>
    
    
    



<div>
    
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script>
  <script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css">

  <p><span>本文标题:</span>全面深入讲解MySQL数据库优化</a></p>
  <p><span>文章作者:</span>Fsn</a></p>
  <p><span>发布时间:</span>2020年04月24日 - 10:40:04</p>
  <p><span>最后更新:</span>2020年05月06日 - 18:09:37</p>
  <p><span>原始链接:</span><a href="/2020/04/24/%E9%9D%A2%E8%AF%95/%E5%85%A8%E9%9D%A2%E6%B7%B1%E5%85%A5%E8%AE%B2%E8%A7%A3MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/" title="全面深入讲解MySQL数据库优化">https://fengshana.github.io/2020/04/24/%E9%9D%A2%E8%AF%95/%E5%85%A8%E9%9D%A2%E6%B7%B1%E5%85%A5%E8%AE%B2%E8%A7%A3MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://fengshana.github.io/2020/04/24/%E9%9D%A2%E8%AF%95/%E5%85%A8%E9%9D%A2%E6%B7%B1%E5%85%A5%E8%AE%B2%E8%A7%A3MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    clipboard.on('success', $(function(){
      $(".fa-clipboard").click(function(){
        swal({   
          title: "",   
          text: '复制成功',   
          html: false,
          timer: 500,   
          showConfirmButton: false
        });
      });
    }));  
</script>


    
</div>



    








<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
  
</div>












    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatreward.png" alt="Fsn 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipayreward.png" alt="Fsn 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    










    <footer class="post-footer">
      
        <div class="post-tags" style="text-align:center">
          
            <a href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag"><i class="fa fa-tag">笔记</i></a>
          
            <a href="/tags/MySQL/" rel="tag"><i class="fa fa-tag">MySQL</i></a>
          
            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/" rel="tag"><i class="fa fa-tag">数据库优化</i></a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/04/24/%E9%9D%A2%E8%AF%95/Mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" rel="next" title="Mybatis源码分析">
                <i class="fa fa-chevron-left"></i> Mybatis源码分析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/04/24/%E9%9D%A2%E8%AF%95/Redis%E7%9B%B8%E5%85%B3/" rel="prev" title="2020年redis面试全套视频教程笔记">
                2020年redis面试全套视频教程笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80ODk3My8yNTQ2Nw=="></div>
    </div>

  
  
  

  
  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/fsn.jpg"
                alt="Fsn" />
            
              <p class="site-author-name" itemprop="name">Fsn</p>
              <p class="site-description motion-element" itemprop="description">勿忘初心，方得始终</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <!--<a href="/archives/%7C%7Carchive">-->
                <a href="/archives/">
              
                  <span class="site-state-item-count">136</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">69</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/fengshana" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#课程内容介绍"><span class="nav-number">2.</span> <span class="nav-text">课程内容介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL高级课程简介"><span class="nav-number">2.1.</span> <span class="nav-text">MySQL高级课程简介</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Linux上安装MySQL"><span class="nav-number">3.</span> <span class="nav-text">Linux上安装MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#下载Linux安装包"><span class="nav-number">3.1.</span> <span class="nav-text">下载Linux安装包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装MySQL"><span class="nav-number">3.2.</span> <span class="nav-text">安装MySQL</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动及登录MySQL"><span class="nav-number">4.</span> <span class="nav-text">启动及登录MySQL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-概述"><span class="nav-number">5.</span> <span class="nav-text">索引 - 概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-优势和劣势"><span class="nav-number">6.</span> <span class="nav-text">索引 - 优势和劣势</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-索引结构"><span class="nav-number">7.</span> <span class="nav-text">索引 - 索引结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MyISAM、InnoDB、Memory三种存储引擎对各种索引类型的支持"><span class="nav-number">7.1.</span> <span class="nav-text">MyISAM、InnoDB、Memory三种存储引擎对各种索引类型的支持</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-索引结构-BTREE"><span class="nav-number">8.</span> <span class="nav-text">索引 - 索引结构 - BTREE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-索引结构-B-TREE"><span class="nav-number">9.</span> <span class="nav-text">索引 - 索引结构 - B+TREE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-索引结构-MySQL中的B-Tree"><span class="nav-number">10.</span> <span class="nav-text">索引 - 索引结构 - MySQL中的B+Tree</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-索引分类"><span class="nav-number">11.</span> <span class="nav-text">索引 - 索引分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-索引语法"><span class="nav-number">12.</span> <span class="nav-text">索引 - 索引语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建索引"><span class="nav-number">12.1.</span> <span class="nav-text">创建索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看索引"><span class="nav-number">12.2.</span> <span class="nav-text">查看索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除索引"><span class="nav-number">12.3.</span> <span class="nav-text">删除索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ALTER指令"><span class="nav-number">12.4.</span> <span class="nav-text">ALTER指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引-索引设计原则"><span class="nav-number">13.</span> <span class="nav-text">索引 - 索引设计原则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#视图-创建及修改视图"><span class="nav-number">14.</span> <span class="nav-text">视图 - 创建及修改视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建或者修改视图"><span class="nav-number">14.1.</span> <span class="nav-text">创建或者修改视图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#视图-查看及删除视图"><span class="nav-number">15.</span> <span class="nav-text">视图 - 查看及删除视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#查看视图"><span class="nav-number">15.1.</span> <span class="nav-text">查看视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除视图"><span class="nav-number">15.2.</span> <span class="nav-text">删除视图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程-概述"><span class="nav-number">16.</span> <span class="nav-text">存储过程 - 概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程-创建调用查询删除语法"><span class="nav-number">17.</span> <span class="nav-text">存储过程 - 创建调用查询删除语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建存储过程"><span class="nav-number">17.1.</span> <span class="nav-text">创建存储过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#知识小贴士"><span class="nav-number">17.1.1.</span> <span class="nav-text">知识小贴士</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调用存储过程"><span class="nav-number">17.2.</span> <span class="nav-text">调用存储过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看存储过程"><span class="nav-number">17.3.</span> <span class="nav-text">查看存储过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除存储过程"><span class="nav-number">17.4.</span> <span class="nav-text">删除存储过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程-语法-变量"><span class="nav-number">18.</span> <span class="nav-text">存储过程 - 语法 - 变量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#变量"><span class="nav-number">18.1.</span> <span class="nav-text">变量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程-语法-if判断"><span class="nav-number">19.</span> <span class="nav-text">存储过程 - 语法 - if判断</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#if条件判断"><span class="nav-number">19.1.</span> <span class="nav-text">if条件判断</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程-语法-输入参数"><span class="nav-number">20.</span> <span class="nav-text">存储过程 - 语法 - 输入参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程-语法-输出参数"><span class="nav-number">21.</span> <span class="nav-text">存储过程 - 语法 - 输出参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程-语法-case结构"><span class="nav-number">22.</span> <span class="nav-text">存储过程 - 语法 - case结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程-语法-while循环"><span class="nav-number">23.</span> <span class="nav-text">存储过程 - 语法 - while循环</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程-语法-repeat循环"><span class="nav-number">24.</span> <span class="nav-text">存储过程 - 语法 - repeat循环</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程-语法-loop循环"><span class="nav-number">25.</span> <span class="nav-text">存储过程 - 语法 - loop循环</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#loop语句"><span class="nav-number">25.1.</span> <span class="nav-text">loop语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#leave语句"><span class="nav-number">25.2.</span> <span class="nav-text">leave语句</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程-语法-游标介绍"><span class="nav-number">26.</span> <span class="nav-text">存储过程 - 语法 - 游标介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程-语法-游标基本操作"><span class="nav-number">27.</span> <span class="nav-text">存储过程 - 语法 - 游标基本操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程-语法-循环获取游标"><span class="nav-number">28.</span> <span class="nav-text">存储过程 - 语法 - 循环获取游标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储函数"><span class="nav-number">29.</span> <span class="nav-text">存储函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#触发器-介绍"><span class="nav-number">30.</span> <span class="nav-text">触发器 - 介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#触发器-创建及应用"><span class="nav-number">31.</span> <span class="nav-text">触发器 - 创建及应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建触发器"><span class="nav-number">31.1.</span> <span class="nav-text">创建触发器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#触发器-查看及删除"><span class="nav-number">32.</span> <span class="nav-text">触发器 - 查看及删除</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#删除触发器"><span class="nav-number">32.1.</span> <span class="nav-text">删除触发器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看触发器"><span class="nav-number">32.2.</span> <span class="nav-text">查看触发器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#今日内容"><span class="nav-number">33.</span> <span class="nav-text">今日内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#体系结构"><span class="nav-number">34.</span> <span class="nav-text">体系结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL的体系结构概览"><span class="nav-number">34.1.</span> <span class="nav-text">MySQL的体系结构概览</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储引擎-概述"><span class="nav-number">35.</span> <span class="nav-text">存储引擎 - 概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储引擎-特性"><span class="nav-number">36.</span> <span class="nav-text">存储引擎 - 特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储引擎-InnoDB特性"><span class="nav-number">37.</span> <span class="nav-text">存储引擎 - InnoDB特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储引擎-MyISAM特性"><span class="nav-number">38.</span> <span class="nav-text">存储引擎 - MyISAM特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储引擎-Memory与Merge特性"><span class="nav-number">39.</span> <span class="nav-text">存储引擎 - Memory与Merge特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储引擎-选择原则"><span class="nav-number">40.</span> <span class="nav-text">存储引擎 - 选择原则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优化SQL步骤-SQL执行频率"><span class="nav-number">41.</span> <span class="nav-text">优化SQL步骤 - SQL执行频率</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#查看SQL执行频率"><span class="nav-number">41.1.</span> <span class="nav-text">查看SQL执行频率</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优化SQL步骤-定位低效SQL"><span class="nav-number">42.</span> <span class="nav-text">优化SQL步骤 - 定位低效SQL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优化SQL步骤-explain指令介绍"><span class="nav-number">43.</span> <span class="nav-text">优化SQL步骤 - explain指令介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优化SQL步骤-explain之id"><span class="nav-number">44.</span> <span class="nav-text">优化SQL步骤 - explain之id</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优化SQL步骤-explain之select-type"><span class="nav-number">45.</span> <span class="nav-text">优化SQL步骤 - explain之select_type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优化SQL步骤-explain之table-、type"><span class="nav-number">46.</span> <span class="nav-text">优化SQL步骤 - explain之table 、type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优化SQL步骤-explain之key-rows-extra"><span class="nav-number">47.</span> <span class="nav-text">优化SQL步骤 - explain之key rows extra</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优化SQL步骤-show-profile"><span class="nav-number">48.</span> <span class="nav-text">优化SQL步骤 - show profile</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优化SQL步骤-trace工具"><span class="nav-number">49.</span> <span class="nav-text">优化SQL步骤 - trace工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引的使用-验证索引提升查询效率"><span class="nav-number">50.</span> <span class="nav-text">索引的使用 - 验证索引提升查询效率</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引的使用-全值匹配"><span class="nav-number">51.</span> <span class="nav-text">索引的使用 - 全值匹配</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引的使用-最左前缀法则"><span class="nav-number">52.</span> <span class="nav-text">索引的使用 - 最左前缀法则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引的使用-索引失效情况（范围查询、字段运算）"><span class="nav-number">53.</span> <span class="nav-text">索引的使用 - 索引失效情况（范围查询、字段运算）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#or之后的字段如果没有索引的话；那么整个where列表当中即便有索引字段也将都失效，不再走索引；"><span class="nav-number"></span> <span class="nav-text">or之后的字段如果没有索引的话；那么整个where列表当中即便有索引字段也将都失效，不再走索引；</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#也就是说is-null与is-not-null；有时是会走索引的有时又不会走索引；这要分情况而定；这个根据数据库当中的数据量来决定的；如果查询的字段在数据量当中的null值占比较多-那么这个时候is-null将会走全表扫描而is-not-null则走索引；如果查询的字段在数据量当中绝大部分都是存在有值的也就是说is-not-null占据较多；则此时is-null就会走索引；而is-not-null则走全表扫描；"><span class="nav-number"></span> <span class="nav-text">也就是说is null与is not null；有时是会走索引的有时又不会走索引；这要分情况而定；这个根据数据库当中的数据量来决定的；如果查询的字段在数据量当中的null值占比较多,那么这个时候is null将会走全表扫描而is not null则走索引；如果查询的字段在数据量当中绝大部分都是存在有值的也就是说is not null占据较多；则此时is null就会走索引；而is not null则走全表扫描；</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PRIMARY-主键索引"><span class="nav-number"></span> <span class="nav-text">PRIMARY 主键索引</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#idx-name-sta-address-name"><span class="nav-number"></span> <span class="nav-text">idx_name_sta_address name</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#idx-name-sta-address-status"><span class="nav-number"></span> <span class="nav-text">idx_name_sta_address status</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#idx-name-sta-address-address"><span class="nav-number"></span> <span class="nav-text">idx_name_sta_address address</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#idx-seller-address-address"><span class="nav-number"></span> <span class="nav-text">idx_seller_address address</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#idx-seller-name-单列索引name字段"><span class="nav-number"></span> <span class="nav-text">idx_seller_name 单列索引name字段</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#idx-seller-status-单列索引status字段"><span class="nav-number"></span> <span class="nav-text">idx_seller_status 单列索引status字段</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#idx-seller-address-单列索引address字段"><span class="nav-number"></span> <span class="nav-text">idx_seller_address 单列索引address字段</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#possible-key-idx-seller-status-idx-seller-address；key-idx-seller-status-key-len-7；"><span class="nav-number"></span> <span class="nav-text">possible_key:idx_seller_status,idx_seller_address；key:idx_seller_status;key_len:7；</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#耗费时长：20-58-second"><span class="nav-number"></span> <span class="nav-text">耗费时长：20.58 second</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#load-data-加载数据"><span class="nav-number"></span> <span class="nav-text">load data 加载数据</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#into-table-‘tb-user-1’-加载数据到具体表tb-user-1当中"><span class="nav-number"></span> <span class="nav-text">into table ‘tb_user_1’ 加载数据到具体表tb_user_1当中</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#fields-terminated-by-‘-’-每一个域之间使用逗号-进行分隔"><span class="nav-number"></span> <span class="nav-text">fields terminated by ‘,’ 每一个域之间使用逗号,进行分隔</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#lines-terminated-by-‘-n’-每一行之间使用-n进行分隔-也就是换行"><span class="nav-number"></span> <span class="nav-text">lines terminated by ‘\n’ 每一行之间使用\n进行分隔,也就是换行</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#回车之后，在导入数据的过程当中，还需要去进行维护索引，维护唯一索引；unique；"><span class="nav-number"></span> <span class="nav-text">回车之后，在导入数据的过程当中，还需要去进行维护索引，维护唯一索引；unique；</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sql1-log导入到tb-user-1表当中耗费时间为19-37-second"><span class="nav-number"></span> <span class="nav-text">sql1.log导入到tb_user_1表当中耗费时间为19.37 second</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#即在使用order-by进行多字段排序的时候，如果想要效率较高；那么此时最好这些多字段统一排序方式；要么都是升序要么都是降序；如果出现一升一降那么就会出现Filesort；文件系统排序造成效率低；"><span class="nav-number"></span> <span class="nav-text">即在使用order by进行多字段排序的时候，如果想要效率较高；那么此时最好这些多字段统一排序方式；要么都是升序要么都是降序；如果出现一升一降那么就会出现Filesort；文件系统排序造成效率低；</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#innodb-buffer-pool-size-512M-修改内容"><span class="nav-number"></span> <span class="nav-text">innodb_buffer_pool_size&#x3D;512M #修改内容</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#innodb-log-buffer-size-10M-修改内容"><span class="nav-number"></span> <span class="nav-text">innodb_log_buffer_size&#x3D;10M #修改内容</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#插入tb-book-基础数据"><span class="nav-number"></span> <span class="nav-text">插入tb_book 基础数据</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#插入tb-user-基础数据"><span class="nav-number"></span> <span class="nav-text">插入tb_user 基础数据</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#正则表达式-regexp"><span class="nav-number"></span> <span class="nav-text">正则表达式 regexp</span></a></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; 

<span itemprop="copyrightYear">2020</span>
  <span class="with-love">
  <!--user-->
    <i class="fa fa-heart"></i>
  </span>
 
 <span class="author" itemprop="copyrightHolder">Fsn</span>

  





  <script async src="http://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
 
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
	<span title="Site words total count">
     456k字 </span>
    <!--<span title="symbols_count_time.count_total">885k</span>-->
  
</div>



  <!-- <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>-->






<!--



 -->
 






        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazyload@2.0.0-beta.2/lazyload.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  













  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  
  <script type="text/javascript" src="/js/src/exturl.js?v=5.1.4"></script>


  
  
  
  <!-- 
  
  -->
  <link rel="stylesheet" href="/dist/APlayer.min.css">
<div id="aplayer"></div>
<script type="text/javascript" src="/dist/APlayer.min.js"></script>
<script type="text/javascript" src="/dist/music.js"></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":100,"vOffset":-10},"mobile":{"show":false},"log":false,"tagMode":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>

<!--崩溃欺骗 <script type="text/javascript" src="/js/src/crash_cheat.js"></script> -->





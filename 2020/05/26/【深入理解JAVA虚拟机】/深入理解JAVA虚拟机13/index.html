<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
<script data-ad-client="ca-pub-3892229323208960" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script data-ad-client="ca-pub-8318014576592877" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<script>
	(function(){
		if(''){
			if (prompt('è¯·è¾“å…¥æ–‡ç« å¯†ç ','') !== ''){
				alert('å¯†ç é”™è¯¯ï¼');
				history.back();
			}
		}
	})();
</script>









<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #A0A0A0; /*è¿›åº¦æ¡é¢œè‰²*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #A0A0A0, 0 0 5px     #A0A0A0; /*é˜´å½±é¢œè‰²*/
    }
    .pace .pace-activity {
        border-top-color: #A0A0A0;    /*ä¸Šè¾¹æ¡†é¢œè‰²*/
        border-left-color: #A0A0A0;    /*å·¦è¾¹æ¡†é¢œè‰²*/
    }
</style>

<meta name="theme-color" content="#222">










<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
    
  
  <link href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/fsn-16x16.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/fsn-32x32.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/fsn-16x16.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/fsn-16x16.ico?v=5.1.4" color="#222">





  <meta name="keywords" content="é¢è¯•,è™šæ‹Ÿæœº," />





  <link rel="alternate" href="/atom.xml" title="âœ¨Fsnâœ¨" type="application/atom+xml" />






<meta name="description" content="æ·±å…¥javaè™šæ‹Ÿæœº-ç¬¬äº”éƒ¨åˆ†-é«˜æ•ˆå¹¶å‘ç¬¬13ç«  çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–å¹¶å‘å¤„ç† çš„ å¹¿æ³›åº”ç”¨ æ˜¯ä½¿å¾— Amdah1å®šå¾‹ ä»£æ›¿ æ‘©å°”å®šå¾‹ æˆä¸º è®¡ç®—æœºæ€§èƒ½å‘å±•æºåŠ¨åŠ› çš„æ ¹æœ¬åŸå› ï¼Œä¹Ÿæ˜¯äººç±» â€œå‹æ¦¨â€ è®¡ç®—æœºè¿ç®—èƒ½åŠ› çš„ æœ€æœ‰åŠ›æ­¦å™¨ã€‚ æ¦‚è¿°åœ¨ è½¯ä»¶ä¸šå‘å±• çš„ åˆæœŸï¼Œç¨‹åºç¼–å†™ éƒ½æ˜¯ä»¥ ç®—æ³• ä¸ºæ ¸å¿ƒçš„ï¼Œç¨‹åºå‘˜ä¼šæŠŠ æ•°æ® å’Œ è¿‡ç¨‹ åˆ†åˆ«ä½œä¸º ç‹¬ç«‹çš„éƒ¨åˆ† æ¥è€ƒè™‘ï¼Œæ•°æ® ä»£è¡¨ é—®é¢˜ç©ºé—´ ä¸­çš„ å®¢ä½“ï¼Œç¨‹åºä»£ç  åˆ™ç”¨äº å¤„">
<meta property="og:type" content="article">
<meta property="og:title" content="æ·±å…¥ç†è§£javaè™šæ‹Ÿæœº-çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–">
<meta property="og:url" content="https://fengshana.github.io/2020/05/26/%E3%80%90%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA%E3%80%91/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA13/index.html">
<meta property="og:site_name" content="âœ¨Fsnâœ¨">
<meta property="og:description" content="æ·±å…¥javaè™šæ‹Ÿæœº-ç¬¬äº”éƒ¨åˆ†-é«˜æ•ˆå¹¶å‘ç¬¬13ç«  çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–å¹¶å‘å¤„ç† çš„ å¹¿æ³›åº”ç”¨ æ˜¯ä½¿å¾— Amdah1å®šå¾‹ ä»£æ›¿ æ‘©å°”å®šå¾‹ æˆä¸º è®¡ç®—æœºæ€§èƒ½å‘å±•æºåŠ¨åŠ› çš„æ ¹æœ¬åŸå› ï¼Œä¹Ÿæ˜¯äººç±» â€œå‹æ¦¨â€ è®¡ç®—æœºè¿ç®—èƒ½åŠ› çš„ æœ€æœ‰åŠ›æ­¦å™¨ã€‚ æ¦‚è¿°åœ¨ è½¯ä»¶ä¸šå‘å±• çš„ åˆæœŸï¼Œç¨‹åºç¼–å†™ éƒ½æ˜¯ä»¥ ç®—æ³• ä¸ºæ ¸å¿ƒçš„ï¼Œç¨‹åºå‘˜ä¼šæŠŠ æ•°æ® å’Œ è¿‡ç¨‹ åˆ†åˆ«ä½œä¸º ç‹¬ç«‹çš„éƒ¨åˆ† æ¥è€ƒè™‘ï¼Œæ•°æ® ä»£è¡¨ é—®é¢˜ç©ºé—´ ä¸­çš„ å®¢ä½“ï¼Œç¨‹åºä»£ç  åˆ™ç”¨äº å¤„">
<meta property="og:image" content="http://r.photo.store.qq.com/psc?/V13IdniL4CDhqM/TCfiP1YaPeRT4Jil9RANX5cJ*1aQOmt2pvBJcyIUBYjo6zX.1Ohy5JABE2Jl1QoYYaGey.wh1Sxp4od.aXADq8X6GO1fm1.7GXSuxVxc7Ig!/r">
<meta property="article:published_time" content="2020-05-26T14:41:37.497Z">
<meta property="article:modified_time" content="2020-06-05T18:26:39.099Z">
<meta property="article:author" content="âœ¨ğŸ§™â€â™€ï¸âœ¨">
<meta property="article:tag" content="é¢è¯•">
<meta property="article:tag" content="è™šæ‹Ÿæœº">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://r.photo.store.qq.com/psc?/V13IdniL4CDhqM/TCfiP1YaPeRT4Jil9RANX5cJ*1aQOmt2pvBJcyIUBYjo6zX.1Ohy5JABE2Jl1QoYYaGey.wh1Sxp4od.aXADq8X6GO1fm1.7GXSuxVxc7Ig!/r">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://fengshana.github.io/2020/05/26/ã€æ·±å…¥ç†è§£JAVAè™šæ‹Ÿæœºã€‘/æ·±å…¥ç†è§£JAVAè™šæ‹Ÿæœº13/"/>









  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "07d52b28"
    });
  daovoice('update');
  </script>

  <title>æ·±å…¥ç†è§£javaè™šæ‹Ÿæœº-çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ– | âœ¨Fsnâœ¨</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2a839053bb6194637483460a0f428730";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  
  <!-- Google AdSense start -->
  <script data-ad-client="ca-pub-3892229323208960" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- Google AdSense end -->

<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.js"></script>
<script src="https://unpkg.com/minigrid@3.1.1/dist/minigrid.min.js"></script>
<link rel="stylesheet" href="/photos/photos.css">
<script type="text/javascript" src="/photos/photo.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/mermaid/0.2.4/mermaid.full.min.js"></script>


<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">âœ¨Fsnâœ¨</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sentence">
          <a href="/shuoshuo" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-commenting"></i> <br />
            
            å°å¿ƒæƒ…
          </a>
        </li>
      

      
    </ul>
  

  
</nav>


<!--Â FsnÂ -->
<script type="text/javascript">
WIDGET = {FID: 'o6km9Rzhmn'}
</script>
<script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>




 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="poem-wrap">
  <div class="poem-border poem-left"></div>
  <div class="poem-border poem-right"></div>
    <h1>[ğŸŒ¿è¯—é…’å¹´åğŸŒ»]</h1>
    <p id="poem">æŒ‘é€‰ä¸­ğŸŒº...ğŸƒğŸ‚</p>
    <p id="info">

  <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
  <script type="text/javascript">
    jinrishici.load(function(result) {
      poem.innerHTML = result.data.content
      info.innerHTML = 'ã€' + result.data.origin.dynasty + 'ã€‘' + result.data.origin.author + 'ğŸƒã€Š' + result.data.origin.title + 'ã€‹ğŸ‚'
      document.getElementById("poem").value(poem);
      document.getElementById("info").value(info);  
  });
  </script>
</div>

        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fengshana.github.io/2020/05/26/%E3%80%90%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA%E3%80%91/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA13/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="âœ¨ğŸ§™â€â™€ï¸âœ¨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/fsn.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="âœ¨Fsnâœ¨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">æ·±å…¥ç†è§£javaè™šæ‹Ÿæœº-çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–</h1>
        

        <div class="post-meta">
		

          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text"></span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-05-26T22:41:37+08:00">
                2020-05-26
              </time>
            

            
              
            

            
              <span class="post-meta-item-icon">
                
              </span>
              
                <span class="post-meta-item-text"></span>
              
              <time title="æ›´æ–°äº" itemprop="dateModified" datetime="2020-06-06T02:26:39+08:00">
                
              </time>
            
          </span>

          
            <span class="post-category" >
            
              
              
              
                <span class="post-meta-item-text"></span>
              
              
                

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="http://r.photo.store.qq.com/psc?/V13IdniL4CDhqM/TCfiP1YaPeRT4Jil9RANX5cJ*1aQOmt2pvBJcyIUBYjo6zX.1Ohy5JABE2Jl1QoYYaGey.wh1Sxp4od.aXADq8X6GO1fm1.7GXSuxVxc7Ig!/r" rel="gallery_ckcgavpyz00fptcum8l81514z"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="http://r.photo.store.qq.com/psc?/V13IdniL4CDhqM/TCfiP1YaPeRT4Jil9RANX5cJ*1aQOmt2pvBJcyIUBYjo6zX.1Ohy5JABE2Jl1QoYYaGey.wh1Sxp4od.aXADq8X6GO1fm1.7GXSuxVxc7Ig!/r" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        <h2 id="æ·±å…¥javaè™šæ‹Ÿæœº-ç¬¬äº”éƒ¨åˆ†-é«˜æ•ˆå¹¶å‘"><a href="#æ·±å…¥javaè™šæ‹Ÿæœº-ç¬¬äº”éƒ¨åˆ†-é«˜æ•ˆå¹¶å‘" class="headerlink" title="æ·±å…¥javaè™šæ‹Ÿæœº-ç¬¬äº”éƒ¨åˆ†-é«˜æ•ˆå¹¶å‘"></a>æ·±å…¥javaè™šæ‹Ÿæœº-ç¬¬äº”éƒ¨åˆ†-é«˜æ•ˆå¹¶å‘</h2><h3 id="ç¬¬13ç« -çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–"><a href="#ç¬¬13ç« -çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–" class="headerlink" title="ç¬¬13ç«  çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–"></a>ç¬¬13ç«  çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–</h3><p>å¹¶å‘å¤„ç† çš„ å¹¿æ³›åº”ç”¨ æ˜¯ä½¿å¾— Amdah1å®šå¾‹ ä»£æ›¿ æ‘©å°”å®šå¾‹ æˆä¸º è®¡ç®—æœºæ€§èƒ½å‘å±•æºåŠ¨åŠ› çš„æ ¹æœ¬åŸå› ï¼Œä¹Ÿæ˜¯äººç±» â€œå‹æ¦¨â€ è®¡ç®—æœºè¿ç®—èƒ½åŠ› çš„ æœ€æœ‰åŠ›æ­¦å™¨ã€‚</p>
<h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>åœ¨ è½¯ä»¶ä¸šå‘å±• çš„ åˆæœŸï¼Œç¨‹åºç¼–å†™ éƒ½æ˜¯ä»¥ ç®—æ³• ä¸ºæ ¸å¿ƒçš„ï¼Œ<br>ç¨‹åºå‘˜ä¼šæŠŠ æ•°æ® å’Œ è¿‡ç¨‹ åˆ†åˆ«ä½œä¸º ç‹¬ç«‹çš„éƒ¨åˆ† æ¥è€ƒè™‘ï¼Œ<br>æ•°æ® ä»£è¡¨ é—®é¢˜ç©ºé—´ ä¸­çš„ å®¢ä½“ï¼Œç¨‹åºä»£ç  åˆ™ç”¨äº å¤„ç†è¿™äº›æ•°æ®ï¼Œ<br>è¿™ç§ æ€ç»´æ–¹å¼ ç›´æ¥ç«™åœ¨ è®¡ç®—æœºçš„è§’åº¦ å» æŠ½è±¡é—®é¢˜å’Œè§£å†³é—®é¢˜ï¼Œ<br>ç§°ä¸º é¢å‘è¿‡ç¨‹ çš„ ç¼–ç¨‹æ€æƒ³ã€‚</p>
<p>ä¸æ­¤åŒæ—¶ï¼Œ<br>é¢å‘å¯¹è±¡ çš„ ç¼–ç¨‹æ€æƒ³ æ˜¯ç«™åœ¨ ç°å®ä¸–ç•Œçš„è§’åº¦ å» æŠ½è±¡å’Œè§£å†³é—®é¢˜ï¼Œ<br>å®ƒæŠŠ æ•°æ®å’Œè¡Œä¸º éƒ½çœ‹åšæ˜¯ å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œ<br>è¿™æ ·å¯ä»¥è®©ç¨‹åºå‘˜èƒ½ä»¥ ç¬¦åˆç°å®ä¸–ç•Œçš„ æ€ç»´æ–¹å¼ æ¥ ç¼–å†™å’Œç»„ç»‡ç¨‹åºã€‚</p>
<p>é¢å‘è¿‡ç¨‹ çš„ ç¼–ç¨‹æ€æƒ³ æå¤§åœ° æå‡äº† ç°ä»£è½¯ä»¶å¼€å‘ çš„ ç”Ÿäº§æ•ˆç‡ å’Œ è½¯ä»¶å¯ä»¥è¾¾åˆ°çš„è§„æ¨¡ï¼Œ<br>ä½†æ˜¯ ç°å®ä¸–ç•Œä¸è®¡ç®—æœºä¸–ç•Œ ä¹‹é—´ä¸å¯é¿å…åœ° å­˜åœ¨ä¸€äº›å·®å¼‚ã€‚</p>
<p>ä¾‹å¦‚ï¼Œäººä»¬å¾ˆéš¾æƒ³è±¡ç°å®ä¸­çš„ å¯¹è±¡ åœ¨ä¸€é¡¹å·¥ä½œè¿›è¡ŒæœŸé—´ï¼Œä¼šè¢«ä¸åœåœ°ä¸­æ–­å’Œåˆ‡æ¢ï¼Œå¯¹è±¡çš„å±æ€§ï¼ˆæ•°æ®ï¼‰å¯èƒ½ä¼šåœ¨ ä¸­æ–­æœŸé—´ è¢«ä¿®æ”¹å’Œå˜â€œè„â€ï¼Œ<br>è€Œè¿™äº›äº‹ä»¶ åœ¨è®¡ç®—æœºä¸–ç•Œä¸­ åˆ™æ˜¯å¾ˆæ­£å¸¸çš„äº‹æƒ…ã€‚</p>
<p>æœ‰æ—¶å€™ï¼Œè‰¯å¥½çš„è®¾è®¡åŸåˆ™ ä¸å¾—ä¸å‘ç°å®åšå‡ºä¸€äº›è®©æ­¥ï¼Œæˆ‘ä»¬å¿…é¡»è®© ç¨‹åº åœ¨è®¡ç®—æœºä¸­ æ­£ç¡®æ— è¯¯åœ°è¿è¡Œï¼Œ<br>ç„¶åå†è€ƒè™‘å¦‚ä½•å°† ä»£ç ç»„ç»‡å¾—æ›´å¥½ï¼Œè®© ç¨‹åº è¿è¡Œå¾— æ›´å¿«ã€‚</p>
<p>å¯¹äºè¿™éƒ¨åˆ†çš„ä¸»é¢˜â€œé«˜æ•ˆå¹¶å‘â€æ¥è®²ï¼Œé¦–å…ˆéœ€è¦ä¿è¯ å¹¶å‘çš„æ­£ç¡®æ€§ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šå®ç° é«˜æ•ˆã€‚</p>
<p>æœ¬ç« å…ˆä» å¦‚ä½•ä¿è¯å¹¶å‘çš„æ­£ç¡®æ€§ å’Œ å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨è®²èµ·ã€‚</p>
<h4 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h4><p>â€œçº¿ç¨‹å®‰å…¨â€  è¿™ä¸ªåç§°ï¼Œç›¸ä¿¡ç¨æœ‰ç»éªŒçš„ç¨‹åºå‘˜éƒ½ä¼šå¬è¯´è¿‡ï¼Œç”šè‡³åœ¨ ä»£ç ç¼–å†™ å’Œ èµ°æŸ¥çš„æ—¶å€™ å¯èƒ½è¿˜ä¼šå°†ä¼šæŒ‚åœ¨å˜´è¾¹ï¼Œ<br>ä½†æ˜¯å¦‚ä½•æ‰¾åˆ°ä¸€ä¸ªä¸å¤ªæ‹—å£çš„æ¦‚å¿µ æ¥å®šä¹‰ çº¿ç¨‹å®‰å…¨ å´ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œ<br>ç¬”è€…å°è¯•åœ¨Googleä¸­æœç´¢å®ƒçš„æ¦‚å¿µï¼Œæ‰¾åˆ°çš„æ˜¯ç±»ä¼¼äº â€œå¦‚æœä¸€ä¸ªå¯¹è±¡å¯ä»¥å®‰å…¨åœ°è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨ï¼Œé‚£å®ƒå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„â€è¿™æ ·çš„å®šä¹‰â€”â€”å¹¶ä¸èƒ½è¯´å®ƒä¸æ­£ç¡®ï¼Œä½†æ˜¯äººä»¬æ— æ³•ä»ä¸­è·å–åˆ°ä»»ä½•æœ‰ç”¨çš„ä¿¡æ¯ã€‚</p>
<p>ï¼ˆåƒæˆ‘è¿™ç§å°ç™½ï¼Œä¹Ÿåªæ˜¯ï¼Œå¬è¿‡ï¼Œæˆ‘å¯æ²¡æœ‰è¯´è¿‡ğŸ˜¶ğŸ˜¶ğŸ˜¶ï¼‰</p>
<p>ç¬”è€…è®¤ä¸ºã€ŠJava Concurrency In Practiceã€‹ çš„ä½œè€… Brian Goetz å¯¹ â€œçº¿ç¨‹å®‰å…¨â€ æœ‰ä¸€ä¸ªæ¯”è¾ƒæ°å½“çš„å®šä¹‰ï¼š<br>â€œå½“ å¤šä¸ªçº¿ç¨‹ è®¿é—® ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœä¸ç”¨è€ƒè™‘è¿™äº› çº¿ç¨‹ åœ¨ è¿è¡Œæ—¶ç¯å¢ƒ ä¸‹çš„ è°ƒåº¦ å’Œ äº¤æ›¿æ‰§è¡Œï¼Œä¹Ÿä¸éœ€è¦è¿›è¡Œ é¢å¤–çš„åŒæ­¥ï¼Œæˆ–è€…åœ¨ è°ƒç”¨æ–¹ è¿›è¡Œä»»ä½•å…¶ä»–çš„ åè°ƒæ“ä½œï¼Œè°ƒç”¨è¿™ä¸ª å¯¹è±¡çš„è¡Œä¸º éƒ½å¯ä»¥è·å¾— æ­£ç¡®çš„ç»“æœï¼Œé‚£ è¿™ä¸ªå¯¹è±¡ æ˜¯ çº¿ç¨‹å®‰å…¨ çš„â€ã€‚</p>
<p>è¿™ä¸ªå®šä¹‰æ¯”è¾ƒ ä¸¥è°¨ï¼Œå®ƒè¦æ±‚ çº¿ç¨‹å®‰å…¨ çš„ä»£ç  éƒ½å¿…é¡»å…·å¤‡ä¸€ä¸ªç‰¹å¾ï¼š<br>ä»£ç æœ¬èº« å°è£… äº†æ‰€æœ‰å¿…è¦çš„ æ­£ç¡®æ€§ä¿éšœæ‰‹æ®µï¼ˆå¦‚äº’æ–¥åŒæ­¥ç­‰ï¼‰ï¼Œ<br>ä»¤ è°ƒç”¨è€… æ— éœ€å…³å¿ƒ å¤šçº¿ç¨‹ çš„é—®é¢˜ï¼Œæ›´æ— é¡»è‡ªå·±é‡‡å– ä»»ä½•æªæ–½ æ¥ ä¿è¯å¤šçº¿ç¨‹çš„æ­£ç¡®è°ƒç”¨ã€‚</p>
<p>è¿™ç‚¹å¬èµ·æ¥ç®€å•ï¼Œä½†å…¶å®å¹¶ä¸å®¹æ˜“åšåˆ°ï¼Œåœ¨å¤§å¤šæ•°åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šå°†è¿™ä¸ªå®šä¹‰å¼±åŒ–ä¸€äº›ï¼Œå¦‚æœæŠŠâ€è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºâ€œé™å®šä¸ºâ€å•æ¬¡è°ƒç”¨â€œï¼Œ<br>è¿™ä¸ªå®šä¹‰çš„å…¶ä»–æè¿°ä¹Ÿèƒ½å¤Ÿæˆç«‹çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç§°å®ƒæ˜¯ çº¿ç¨‹å®‰å…¨ äº†ï¼Œä¸ºä»€ä¹ˆè¦ å¼±åŒ– è¿™ä¸ªå®šä¹‰ï¼Œç°åœ¨æš‚ä¸”æ”¾ä¸‹ï¼Œç¨åå†è¯¦ç»†æ¢è®¨ã€‚</p>
<h5 id="Javaè¯­è¨€ä¸­çš„çº¿ç¨‹å®‰å…¨"><a href="#Javaè¯­è¨€ä¸­çš„çº¿ç¨‹å®‰å…¨" class="headerlink" title="Javaè¯­è¨€ä¸­çš„çº¿ç¨‹å®‰å…¨"></a>Javaè¯­è¨€ä¸­çš„çº¿ç¨‹å®‰å…¨</h5><p>æˆ‘ä»¬å·²ç»æœ‰äº† çº¿ç¨‹å®‰å…¨ çš„ä¸€ä¸ª æŠ½è±¡å®šä¹‰ï¼Œ<br>é‚£æ¥ä¸‹æ¥å°±è®¨è®ºä¸€ä¸‹åœ¨ javaè¯­è¨€ ä¸­ï¼Œçº¿ç¨‹å®‰å…¨ å…·ä½“æ˜¯å¦‚ä½•ä½“ç°çš„ï¼Ÿ<br>æœ‰å“ªäº›æ“ä½œæ˜¯ çº¿ç¨‹å®‰å…¨ çš„ï¼Ÿ<br>æˆ‘ä»¬è¿™é‡Œè®¨è®ºçš„ çº¿ç¨‹å®‰å…¨ï¼Œå°± é™å®šä¸ å¤šä¸ªçº¿ç¨‹ä¹‹é—´ å­˜åœ¨ å…±äº«æ•°æ®è®¿é—® è¿™ä¸ª å‰æï¼Œ<br>å› ä¸ºå¦‚æœä¸€æ®µä»£ç  æ ¹æœ¬ä¸ä¼š ä¸å…¶ä»–çº¿ç¨‹å…±äº«æ•°æ®ï¼Œé‚£ä¹ˆä» çº¿ç¨‹å®‰å…¨ çš„ è§’åº¦ æ¥çœ‹ï¼Œç¨‹åºæ˜¯ ä¸²è¡Œæ‰§è¡Œ è¿˜æ˜¯ å¤šçº¿ç¨‹æ‰§è¡Œ å¯¹å®ƒæ¥è¯´æ˜¯å®Œå…¨æ²¡æœ‰åŒºåˆ«çš„ã€‚</p>
<p>ä¸ºäº†æ›´åŠ  æ·±å…¥åœ° ç†è§£ çº¿ç¨‹å®‰å…¨ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä¸æŠŠ çº¿ç¨‹å®‰å…¨ å½“åšä¸€ä¸ªéçœŸå³å‡ çš„ äºŒå…ƒæ’ä»–é¡¹ æ¥çœ‹å¾…ï¼Œ<br>æŒ‰ç…§ çº¿ç¨‹å®‰å…¨ çš„ â€œå®‰å…¨ç¨‹åº¦â€ ç”±å¼ºè‡³å¼±æ¥æ’åºï¼Œæˆ‘ä»¬å¯ä»¥å°†Javaè¯­è¨€ä¸­å„ç§æ“ä½œå…±äº«çš„æ•°æ®åˆ†ä¸ºä»¥ä¸‹5ç±»ï¼š<br>ä¸å¯å˜ã€ç»å¯¹çº¿ç¨‹å®‰å…¨ã€ç›¸å¯¹çº¿ç¨‹å®‰å…¨ã€çº¿ç¨‹å…¼å®¹å’Œçº¿ç¨‹å¯¹ç«‹ã€‚</p>
<blockquote>
<p>è¿™ç§åˆ’åˆ†æ–¹æ³•ä¹Ÿæ˜¯ Brian Goetzåœ¨IBM developWorkersä¸Šå‘è¡¨çš„ä¸€ç¯‡è®ºæ–‡ä¸­æå‡ºçš„ï¼Œ<br>è¿™é‡Œå†™ â€œæˆ‘ä»¬â€  çº¯ç²¹æ˜¯ç¬”è€…ä¸‹ç¬”è¡Œæ–‡ä¸­çš„è¯­è¨€ç”¨æ³•ã€‚</p>
</blockquote>
<h6 id="1-ä¸å¯å˜"><a href="#1-ä¸å¯å˜" class="headerlink" title="1.ä¸å¯å˜"></a>1.ä¸å¯å˜</h6><p>åœ¨Javaè¯­è¨€ä¸­ï¼ˆç‰¹æŒ‡JDK1.5ä»¥åï¼Œå³ Javaå†…å­˜æ¨¡å‹ è¢« ä¿®æ­£ä»¥åçš„ Javaè¯­è¨€ï¼‰ï¼Œ<br>ä¸å¯å˜ï¼ˆImmutableï¼‰ çš„ å¯¹è±¡ ä¸€å®šæ˜¯ çº¿ç¨‹å®‰å…¨çš„ï¼Œ<br>æ— è®ºæ˜¯ å¯¹è±¡çš„æ–¹æ³• è¿˜æ˜¯ æ–¹æ³•çš„è°ƒç”¨è€…ï¼Œéƒ½ä¸éœ€è¦å†é‡‡å– ä»»ä½•çš„çº¿ç¨‹å®‰å…¨ä¿éšœæªæ–½ï¼Œ</p>
<p>åœ¨12ç« æˆ‘ä»¬è°ˆåˆ° finalå…³é”®å­— å¸¦æ¥çš„ å¯è§æ€§ æ—¶æ›¾ç»æåˆ°è¿‡è¿™ä¸€ç‚¹ï¼Œ<br>åªè¦ä¸€ä¸ª ä¸å¯å˜çš„å¯¹è±¡ è¢«æ­£ç¡®åœ° æ„å»ºå‡ºæ¥ï¼ˆæ²¡æœ‰å‘ç”Ÿ this å¼•ç”¨é€ƒé€¸ çš„æƒ…å†µï¼‰ï¼Œ<br>é‚£å…¶å¤–éƒ¨çš„ å¯è§çŠ¶æ€ æ°¸è¿œä¹Ÿä¸ä¼šæ”¹å˜ï¼Œ<br>æ°¸è¿œä¹Ÿä¸ä¼šçœ‹åˆ°å®ƒåœ¨ å¤šä¸ªçº¿ç¨‹ä¹‹ä¸­ å¤„äº ä¸ä¸€è‡´ çš„çŠ¶æ€ã€‚</p>
<p>â€œä¸å¯å˜â€ å¸¦æ¥çš„ å®‰å…¨æ€§ æ˜¯ æœ€ç®€å•å’Œæœ€çº¯ç²¹çš„ã€‚</p>
<p>Javaè¯­è¨€ä¸­ï¼Œå¦‚æœ å…±äº«æ•°æ® æ˜¯ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆåªè¦åœ¨ å®šä¹‰æ—¶ ä½¿ç”¨ finalå…³é”®å­— ä¿®é¥°å®ƒ å°±å¯ä»¥ä¿è¯å®ƒæ˜¯ ä¸å¯å˜çš„ã€‚</p>
<p>å¦‚æœ å…±äº«æ•°æ® æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£å°±éœ€è¦ä¿è¯ å¯¹è±¡çš„è¡Œä¸º ä¸ä¼šå¯¹å…¶ çŠ¶æ€ äº§ç”Ÿä»»ä½•å½±å“ æ‰è¡Œï¼Œ</p>
<p>å¦‚æœè¯»è€…è¿˜æ²¡æƒ³æ˜ç™½è¿™å¥è¯ï¼Œä¸å¦¨æƒ³ä¸€æƒ³ java.lang.String ç±»çš„å¯¹è±¡ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…¸å‹çš„ ä¸å¯å˜å¯¹è±¡ï¼Œ<br>æˆ‘ä»¬è°ƒç”¨å®ƒçš„ substring()ã€replace()å’Œconcat() è¿™äº›æ–¹æ³•éƒ½ ä¸ä¼šå½±å“å®ƒ åŸæ¥çš„å€¼ï¼Œåªä¼šè¿”å›ä¸€ä¸ªæ–°æ„é€ çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚</p>
<p>ä¿è¯å¯¹è±¡è¡Œä¸º ä¸å½±å“ è‡ªå·±çŠ¶æ€çš„é€”å¾„ æœ‰å¾ˆå¤šç§ï¼Œ<br>å…¶ä¸­æœ€ç®€å•çš„å°±æ˜¯æŠŠå¯¹è±¡ä¸­ å¸¦æœ‰çŠ¶æ€çš„å˜é‡ éƒ½å£°æ˜ä¸º finalï¼Œ<br>è¿™æ ·åœ¨ æ„é€ å‡½æ•° ç»“æŸä¹‹åï¼Œå®ƒå°±æ˜¯ ä¸å¯å˜çš„ï¼Œ<br>ä¾‹å¦‚ä»£ç æ¸…å•13-1ä¸­java.lang.Integer æ„é€ å‡½æ•°æ‰€ç¤ºçš„ï¼Œ<br>å®ƒé€šè¿‡å°† å†…éƒ¨çŠ¶æ€å˜é‡ value å®šä¹‰ä¸º final æ¥ä¿éšœ çŠ¶æ€ä¸å˜ã€‚</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">                                ä»£ç æ¸…å• 13-1 JDKä¸­Integerç±»çš„æ„é€ å‡½æ•°</span></span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line">/*<span class="strong">*</span></span><br><span class="line"><span class="strong">  *</span> The value of the &lt;code&gt;Integer&lt;/code&gt;.</span><br><span class="line"><span class="code">  * @serial</span></span><br><span class="line"><span class="code">  */</span></span><br><span class="line"><span class="code">  private final int value;</span></span><br><span class="line"></span><br><span class="line"><span class="code">  /**</span></span><br><span class="line"><span class="code">    * Constructs newly allocated &lt;code&gt;Integer&lt;/code&gt; object that</span></span><br><span class="line"><span class="code">    * represents the specified &lt;code&gt;int&lt;/code&gt; value.</span></span><br><span class="line"><span class="code">    *</span></span><br><span class="line"><span class="code">    * @param value the value to be represented by the &lt;code&gt;Integer&lt;/code&gt; object.</span></span><br><span class="line"><span class="code">    *</span></span><br><span class="line"><span class="code">    */</span></span><br><span class="line"><span class="code">    public Integer(int value)&#123;</span></span><br><span class="line"><span class="code">      this.value=value;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line">----------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>åœ¨ Java API ä¸­ ç¬¦åˆ ä¸å¯å˜è¦æ±‚ çš„ç±»å‹ï¼Œ<br>é™¤äº†ä¸Šé¢æåˆ°çš„ String ä¹‹å¤–ï¼Œ<br>å¸¸ç”¨çš„è¿˜æœ‰ æšä¸¾ç±»å‹ï¼Œä»¥åŠ java.lang.Numberçš„éƒ¨åˆ†å­ç±»ï¼Œ<br>å¦‚Longå’ŒDoubleç­‰æ•°å€¼åŒ…è£…ç±»å‹ï¼ŒBigIntegerå’ŒBigDecimalç­‰å¤§æ•°æ®ç±»å‹ï¼›</p>
<p>ä½†åŒä¸º Number çš„ å­ç±»å‹ çš„ åŸå­ç±» AtomicInteger å’Œ AtomicLong åˆ™å¹¶éä¸å¯å˜çš„ï¼Œ<br>è¯»è€…ä¸å¦¨çœ‹çœ‹è¿™ä¸¤ä¸ªåŸå­ç±»çš„æºç ï¼Œæƒ³ä¸€æƒ³ä¸ºä»€ä¹ˆã€‚</p>
<p>(emmï¼ŒåŸå› æ˜¯ä¸æ˜¯é‚£ä¸ªvalueæ²¡æœ‰è¢«æ ‡ä¸ºfinalï¼ŸIntegerç±»å½“ä¸­çš„valueè¢«æ ‡è®°ä¸ºfinaläº†ï¼Œè€ŒAtomicIntegerä»¥åŠAtomicLongé‡Œé¢çš„valueéƒ½æ²¡æœ‰è¢«æ ‡è®°ä¸ºfinal)</p>
<p>AtomicIntegerç±»ä»£ç ï¼š</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br></pre></td><td class="code"><pre><span class="line">                                ä»£ç æ¸…å• AtomicIntegerç±»</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Written by Doug Lea with assistance from members of JCP JSR-166</span></span><br><span class="line"><span class="comment"> * Expert Group and released to the public domain, as explained at</span></span><br><span class="line"><span class="comment"> * http://creativecommons.org/publicdomain/zero/1.0/</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">package java.util.concurrent.atomic;</span><br><span class="line"><span class="keyword">import</span> java.util.function.IntUnaryOperator;</span><br><span class="line"><span class="keyword">import</span> java.util.function.IntBinaryOperator;</span><br><span class="line"><span class="keyword">import</span> sun.misc.Unsafe;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>An &#123;@code int&#125; value that may be updated atomically.  See </span>the</span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>&#123;@link java.util.concurrent.atomic&#125; package specification for</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>description of </span>the<span class="markdown"> properties of atomic variables. An</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>&#123;@code AtomicInteger&#125; is used in applications </span>such<span class="markdown"> as atomically</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>incremented counters, and cannot be used as </span>a<span class="markdown"> replacement for </span>an</span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>&#123;@link java.lang.Integer&#125;. However, this class does extend</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>&#123;@code Number&#125; to allow uniform access by tools and utilities that</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>deal with numerically-based classes.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"> *</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>@since 1.5</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet"> * </span>@author Doug Lea</span></span></span><br><span class="line"><span class="comment"><span class="markdown">*/</span></span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">AtomicInteger</span> <span class="keyword">extends</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    private <span class="keyword">static</span> <span class="keyword">final</span> long serialVersionUID = <span class="number">6214790243416807050</span>L;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// setup to use Unsafe.compareAndSwapInt for updates</span></span><br><span class="line">    private <span class="keyword">static</span> <span class="keyword">final</span> Unsafe unsafe = Unsafe.getUnsafe();</span><br><span class="line">    private <span class="keyword">static</span> <span class="keyword">final</span> long valueOffset;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            valueOffset = unsafe.objectFieldOffset</span><br><span class="line">                (AtomicInteger<span class="class">.<span class="keyword">class</span>.<span class="title">getDeclaredField</span>("<span class="title">value</span>"));</span></span><br><span class="line"><span class="class">        &#125; <span class="title">catch</span> (<span class="title">Exception</span> <span class="title">ex</span>) </span>&#123; <span class="keyword">throw</span> <span class="keyword">new</span> Error(ex); &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private volatile <span class="built_in">int</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Creates </span>a<span class="markdown"> new AtomicInteger with </span>the<span class="markdown"> given initial value.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param initialValue </span>the<span class="markdown"> initial value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public AtomicInteger(<span class="built_in">int</span> initialValue) &#123;</span><br><span class="line">        value = initialValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Creates </span>a<span class="markdown"> new AtomicInteger with initial value &#123;@code 0&#125;.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public AtomicInteger() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Gets </span>the<span class="markdown"> current value.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return </span>the<span class="markdown"> current value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> <span class="built_in">int</span> <span class="keyword">get</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Sets to </span>the<span class="markdown"> given value.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param newValue </span>the<span class="markdown"> new value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> <span class="keyword">void</span> <span class="keyword">set</span>(<span class="built_in">int</span> newValue) &#123;</span><br><span class="line">        value = newValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Eventually sets to </span>the<span class="markdown"> given value.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param newValue </span>the<span class="markdown"> new value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@since 1.6</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> <span class="keyword">void</span> lazySet(<span class="built_in">int</span> newValue) &#123;</span><br><span class="line">        unsafe.putOrderedInt(<span class="keyword">this</span>, valueOffset, newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Atomically sets to </span>the<span class="markdown"> given value and returns </span>the<span class="markdown"> old value.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param newValue </span>the<span class="markdown"> new value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return </span>the<span class="markdown"> previous value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> <span class="built_in">int</span> getAndSet(<span class="built_in">int</span> newValue) &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndSetInt(<span class="keyword">this</span>, valueOffset, newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Atomically sets </span>the<span class="markdown"> value to </span>the<span class="markdown"> given updated value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>if </span>the<span class="markdown"> current value &#123;@code ==&#125; </span>the<span class="markdown"> expected value.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param expect </span>the<span class="markdown"> expected value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param update </span>the<span class="markdown"> new value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return &#123;@code true&#125; if successful. False return indicates that</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span></span>the<span class="markdown"> actual value was not equal to </span>the<span class="markdown"> expected value.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> boolean compareAndSet(<span class="built_in">int</span> expect, <span class="built_in">int</span> update) &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="keyword">this</span>, valueOffset, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Atomically sets </span>the<span class="markdown"> value to </span>the<span class="markdown"> given updated value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>if </span>the<span class="markdown"> current value &#123;@code ==&#125; </span>the<span class="markdown"> expected value.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="xml"><span class="tag">&lt;</span></span></span>a<span class="markdown"><span class="xml"> href="package-summary.html#weakCompareAndSet"&gt;</span>May fail</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>spuriously and does not provide ordering guarantees<span class="xml"><span class="tag">&lt;/</span></span></span>a<span class="markdown"><span class="xml">&gt;</span>, </span>so<span class="markdown"> is</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>only rarely </span>an<span class="markdown"> appropriate alternative to &#123;@code compareAndSet&#125;.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param expect </span>the<span class="markdown"> expected value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param update </span>the<span class="markdown"> new value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return &#123;@code true&#125; if successful</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> boolean weakCompareAndSet(<span class="built_in">int</span> expect, <span class="built_in">int</span> update) &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="keyword">this</span>, valueOffset, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Atomically increments by one </span>the<span class="markdown"> current value.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return </span>the<span class="markdown"> previous value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> <span class="built_in">int</span> getAndIncrement() &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="keyword">this</span>, valueOffset, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Atomically decrements by one </span>the<span class="markdown"> current value.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return </span>the<span class="markdown"> previous value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> <span class="built_in">int</span> getAndDecrement() &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="keyword">this</span>, valueOffset, <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Atomically adds </span>the<span class="markdown"> given value to </span>the<span class="markdown"> current value.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param delta </span>the<span class="markdown"> value to add</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return </span>the<span class="markdown"> previous value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> <span class="built_in">int</span> getAndAdd(<span class="built_in">int</span> delta) &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="keyword">this</span>, valueOffset, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Atomically increments by one </span>the<span class="markdown"> current value.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return </span>the<span class="markdown"> updated value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> <span class="built_in">int</span> incrementAndGet() &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="keyword">this</span>, valueOffset, <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Atomically decrements by one </span>the<span class="markdown"> current value.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return </span>the<span class="markdown"> updated value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> <span class="built_in">int</span> decrementAndGet() &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="keyword">this</span>, valueOffset, <span class="number">-1</span>) - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Atomically adds </span>the<span class="markdown"> given value to </span>the<span class="markdown"> current value.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param delta </span>the<span class="markdown"> value to add</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return </span>the<span class="markdown"> updated value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> <span class="built_in">int</span> addAndGet(<span class="built_in">int</span> delta) &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="keyword">this</span>, valueOffset, delta) + delta;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Atomically updates </span>the<span class="markdown"> current value with </span>the<span class="markdown"> results of</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>applying </span>the<span class="markdown"> given function, returning </span>the<span class="markdown"> previous value. The</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>function </span>should<span class="markdown"> be side-effect-free, since it may be re-applied</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>when attempted updates fail due to contention among threads.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param updateFunction </span>a<span class="markdown"> side-effect-free function</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return </span>the<span class="markdown"> previous value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@since 1.8</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> <span class="built_in">int</span> getAndUpdate(IntUnaryOperator updateFunction) &#123;</span><br><span class="line">        <span class="built_in">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = <span class="keyword">get</span>();</span><br><span class="line">            next = updateFunction.applyAsInt(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Atomically updates </span>the<span class="markdown"> current value with </span>the<span class="markdown"> results of</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>applying </span>the<span class="markdown"> given function, returning </span>the<span class="markdown"> updated value. The</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>function </span>should<span class="markdown"> be side-effect-free, since it may be re-applied</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>when attempted updates fail due to contention among threads.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param updateFunction </span>a<span class="markdown"> side-effect-free function</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return </span>the<span class="markdown"> updated value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@since 1.8</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> <span class="built_in">int</span> updateAndGet(IntUnaryOperator updateFunction) &#123;</span><br><span class="line">        <span class="built_in">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = <span class="keyword">get</span>();</span><br><span class="line">            next = updateFunction.applyAsInt(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Atomically updates </span>the<span class="markdown"> current value with </span>the<span class="markdown"> results of</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>applying </span>the<span class="markdown"> given function to </span>the<span class="markdown"> current and given values,</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>returning </span>the<span class="markdown"> previous value. The function </span>should<span class="markdown"> be</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>side-effect-free, since it may be re-applied when attempted</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>updates fail due to contention among threads.  The function</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>is applied with </span>the<span class="markdown"> current value as its first argument,</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>and </span>the<span class="markdown"> given update as </span>the<span class="markdown"> second argument.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param x </span>the<span class="markdown"> update value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param accumulatorFunction </span>a<span class="markdown"> side-effect-free function of two arguments</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return </span>the<span class="markdown"> previous value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@since 1.8</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> <span class="built_in">int</span> getAndAccumulate(<span class="built_in">int</span> x,</span><br><span class="line">                                      IntBinaryOperator accumulatorFunction) &#123;</span><br><span class="line">        <span class="built_in">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = <span class="keyword">get</span>();</span><br><span class="line">            next = accumulatorFunction.applyAsInt(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Atomically updates </span>the<span class="markdown"> current value with </span>the<span class="markdown"> results of</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>applying </span>the<span class="markdown"> given function to </span>the<span class="markdown"> current and given values,</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>returning </span>the<span class="markdown"> updated value. The function </span>should<span class="markdown"> be</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>side-effect-free, since it may be re-applied when attempted</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>updates fail due to contention among threads.  The function</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>is applied with </span>the<span class="markdown"> current value as its first argument,</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>and </span>the<span class="markdown"> given update as </span>the<span class="markdown"> second argument.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     *</span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param x </span>the<span class="markdown"> update value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@param accumulatorFunction </span>a<span class="markdown"> side-effect-free function of two arguments</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return </span>the<span class="markdown"> updated value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@since 1.8</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">final</span> <span class="built_in">int</span> accumulateAndGet(<span class="built_in">int</span> x,</span><br><span class="line">                                      IntBinaryOperator accumulatorFunction) &#123;</span><br><span class="line">        <span class="built_in">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = <span class="keyword">get</span>();</span><br><span class="line">            next = accumulatorFunction.applyAsInt(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Returns </span>the<span class="markdown"> String representation of </span>the<span class="markdown"> current value.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@return </span>the<span class="markdown"> String representation of </span>the<span class="markdown"> current value</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="built_in">String</span> toString() &#123;</span><br><span class="line">        <span class="keyword">return</span> Integer.toString(<span class="keyword">get</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Returns </span>the<span class="markdown"> value of this &#123;@code AtomicInteger&#125; as </span>an<span class="markdown"> &#123;@code int&#125;.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="built_in">int</span> intValue() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">get</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Returns </span>the<span class="markdown"> value of this &#123;@code AtomicInteger&#125; as </span>a<span class="markdown"> &#123;@code long&#125;</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>after </span>a<span class="markdown"> widening primitive conversion.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@jls 5.1.2 Widening Primitive Conversions</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public long longValue() &#123;</span><br><span class="line">        <span class="keyword">return</span> (long)<span class="keyword">get</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Returns </span>the<span class="markdown"> value of this &#123;@code AtomicInteger&#125; as </span>a<span class="markdown"> &#123;@code float&#125;</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>after </span>a<span class="markdown"> widening primitive conversion.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@jls 5.1.2 Widening Primitive Conversions</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public float floatValue() &#123;</span><br><span class="line">        <span class="keyword">return</span> (float)<span class="keyword">get</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>Returns </span>the<span class="markdown"> value of this &#123;@code AtomicInteger&#125; as </span>a<span class="markdown"> &#123;@code double&#125;</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>after </span>a<span class="markdown"> widening primitive conversion.</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">     * </span>@jls 5.1.2 Widening Primitive Conversions</span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="built_in">double</span> doubleValue() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">double</span>)<span class="keyword">get</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>AtomicLongç±»ä»£ç ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br></pre></td><td class="code"><pre><span class="line">                                ä»£ç æ¸…å• AtomicLongç±»</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Written by Doug Lea with assistance from members of JCP JSR-166</span></span><br><span class="line"><span class="comment"> * Expert Group and released to the public domain, as explained at</span></span><br><span class="line"><span class="comment"> * http://creativecommons.org/publicdomain/zero/1.0/</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> java.util.concurrent.atomic;</span><br><span class="line"><span class="keyword">import</span> java.util.function.LongUnaryOperator;</span><br><span class="line"><span class="keyword">import</span> java.util.function.LongBinaryOperator;</span><br><span class="line"><span class="keyword">import</span> sun.misc.Unsafe;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A &#123;<span class="doctag">@code</span> long&#125; value that may be updated atomically.  See the</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> java.util.concurrent.atomic&#125; package specification for</span></span><br><span class="line"><span class="comment"> * description of the properties of atomic variables. An</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> AtomicLong&#125; is used in applications such as atomically</span></span><br><span class="line"><span class="comment"> * incremented sequence numbers, and cannot be used as a replacement</span></span><br><span class="line"><span class="comment"> * for a &#123;<span class="doctag">@link</span> java.lang.Long&#125;. However, this class does extend</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> Number&#125; to allow uniform access by tools and utilities that</span></span><br><span class="line"><span class="comment"> * deal with numerically-based classes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Doug Lea</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicLong</span> <span class="keyword">extends</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1927816293512124184</span>L;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// setup to use Unsafe.compareAndSwapLong for updates</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Unsafe unsafe = Unsafe.getUnsafe();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> valueOffset;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Records whether the underlying JVM supports lockless</span></span><br><span class="line"><span class="comment">     * compareAndSwap for longs. While the Unsafe.compareAndSwapLong</span></span><br><span class="line"><span class="comment">     * method works in either case, some constructions should be</span></span><br><span class="line"><span class="comment">     * handled at Java level to avoid locking user-visible locks.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> VM_SUPPORTS_LONG_CAS = VMSupportsCS8();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns whether underlying JVM supports lockless CompareAndSet</span></span><br><span class="line"><span class="comment">     * for longs. Called only once and cached in VM_SUPPORTS_LONG_CAS.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> native <span class="keyword">boolean</span> VMSupportsCS8();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            valueOffset = unsafe.objectFieldOffset</span><br><span class="line">                (AtomicLong<span class="class">.<span class="keyword">class</span>.<span class="title">getDeclaredField</span>("<span class="title">value</span>"));</span></span><br><span class="line"><span class="class">        &#125; <span class="title">catch</span> (<span class="title">Exception</span> <span class="title">ex</span>) &#123;</span> <span class="keyword">throw</span> <span class="keyword">new</span> Error(ex); &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">long</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a new AtomicLong with the given initial value.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> initialValue the initial value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> AtomicLong(<span class="keyword">long</span> initialValue) &#123;</span><br><span class="line">        value = initialValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a new AtomicLong with initial value &#123;<span class="doctag">@code</span> 0&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> AtomicLong() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Gets the current value.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the current value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> get() &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets to the given value.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newValue the new value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> set(<span class="keyword">long</span> newValue) &#123;</span><br><span class="line">        value = newValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Eventually sets to the given value.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newValue the new value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.6</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> lazySet(<span class="keyword">long</span> newValue) &#123;</span><br><span class="line">        unsafe.putOrderedLong(<span class="keyword">this</span>, valueOffset, newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Atomically sets to the given value and returns the old value.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newValue the new value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the previous value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> getAndSet(<span class="keyword">long</span> newValue) &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndSetLong(<span class="keyword">this</span>, valueOffset, newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Atomically sets the value to the given updated value</span></span><br><span class="line"><span class="comment">     * if the current value &#123;<span class="doctag">@code</span> ==&#125; the expected value.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expect the expected value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> update the new value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if successful. False return indicates that</span></span><br><span class="line"><span class="comment">     * the actual value was not equal to the expected value.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> compareAndSet(<span class="keyword">long</span> expect, <span class="keyword">long</span> update) &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapLong(<span class="keyword">this</span>, valueOffset, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Atomically sets the value to the given updated value</span></span><br><span class="line"><span class="comment">     * if the current value &#123;<span class="doctag">@code</span> ==&#125; the expected value.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;&lt;a href="package-summary.html#weakCompareAndSet"&gt;May fail</span></span><br><span class="line"><span class="comment">     * spuriously and does not provide ordering guarantees&lt;/a&gt;, so is</span></span><br><span class="line"><span class="comment">     * only rarely an appropriate alternative to &#123;<span class="doctag">@code</span> compareAndSet&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expect the expected value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> update the new value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if successful</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> weakCompareAndSet(<span class="keyword">long</span> expect, <span class="keyword">long</span> update) &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapLong(<span class="keyword">this</span>, valueOffset, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Atomically increments by one the current value.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the previous value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> getAndIncrement() &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddLong(<span class="keyword">this</span>, valueOffset, <span class="number">1</span>L);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Atomically decrements by one the current value.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the previous value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> getAndDecrement() &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddLong(<span class="keyword">this</span>, valueOffset, <span class="number">-1</span>L);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Atomically adds the given value to the current value.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta the value to add</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the previous value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> getAndAdd(<span class="keyword">long</span> delta) &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddLong(<span class="keyword">this</span>, valueOffset, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Atomically increments by one the current value.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the updated value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> incrementAndGet() &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddLong(<span class="keyword">this</span>, valueOffset, <span class="number">1</span>L) + <span class="number">1</span>L;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Atomically decrements by one the current value.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the updated value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> decrementAndGet() &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddLong(<span class="keyword">this</span>, valueOffset, <span class="number">-1</span>L) - <span class="number">1</span>L;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Atomically adds the given value to the current value.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta the value to add</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the updated value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> addAndGet(<span class="keyword">long</span> delta) &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddLong(<span class="keyword">this</span>, valueOffset, delta) + delta;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Atomically updates the current value with the results of</span></span><br><span class="line"><span class="comment">     * applying the given function, returning the previous value. The</span></span><br><span class="line"><span class="comment">     * function should be side-effect-free, since it may be re-applied</span></span><br><span class="line"><span class="comment">     * when attempted updates fail due to contention among threads.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> updateFunction a side-effect-free function</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the previous value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> getAndUpdate(LongUnaryOperator updateFunction) &#123;</span><br><span class="line">        <span class="keyword">long</span> prev, next;</span><br><span class="line">        do &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = updateFunction.applyAsLong(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Atomically updates the current value with the results of</span></span><br><span class="line"><span class="comment">     * applying the given function, returning the updated value. The</span></span><br><span class="line"><span class="comment">     * function should be side-effect-free, since it may be re-applied</span></span><br><span class="line"><span class="comment">     * when attempted updates fail due to contention among threads.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> updateFunction a side-effect-free function</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the updated value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> updateAndGet(LongUnaryOperator updateFunction) &#123;</span><br><span class="line">        <span class="keyword">long</span> prev, next;</span><br><span class="line">        do &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = updateFunction.applyAsLong(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Atomically updates the current value with the results of</span></span><br><span class="line"><span class="comment">     * applying the given function to the current and given values,</span></span><br><span class="line"><span class="comment">     * returning the previous value. The function should be</span></span><br><span class="line"><span class="comment">     * side-effect-free, since it may be re-applied when attempted</span></span><br><span class="line"><span class="comment">     * updates fail due to contention among threads.  The function</span></span><br><span class="line"><span class="comment">     * is applied with the current value as its first argument,</span></span><br><span class="line"><span class="comment">     * and the given update as the second argument.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x the update value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> accumulatorFunction a side-effect-free function of two arguments</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the previous value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> getAndAccumulate(<span class="keyword">long</span> x,</span><br><span class="line">                                       LongBinaryOperator accumulatorFunction) &#123;</span><br><span class="line">        <span class="keyword">long</span> prev, next;</span><br><span class="line">        do &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = accumulatorFunction.applyAsLong(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Atomically updates the current value with the results of</span></span><br><span class="line"><span class="comment">     * applying the given function to the current and given values,</span></span><br><span class="line"><span class="comment">     * returning the updated value. The function should be</span></span><br><span class="line"><span class="comment">     * side-effect-free, since it may be re-applied when attempted</span></span><br><span class="line"><span class="comment">     * updates fail due to contention among threads.  The function</span></span><br><span class="line"><span class="comment">     * is applied with the current value as its first argument,</span></span><br><span class="line"><span class="comment">     * and the given update as the second argument.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x the update value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> accumulatorFunction a side-effect-free function of two arguments</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the updated value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> accumulateAndGet(<span class="keyword">long</span> x,</span><br><span class="line">                                       LongBinaryOperator accumulatorFunction) &#123;</span><br><span class="line">        <span class="keyword">long</span> prev, next;</span><br><span class="line">        do &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = accumulatorFunction.applyAsLong(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the String representation of the current value.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the String representation of the current value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String toString() &#123;</span><br><span class="line">        <span class="keyword">return</span> Long.toString(get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the value of this &#123;<span class="doctag">@code</span> AtomicLong&#125; as an &#123;<span class="doctag">@code</span> int&#125;</span></span><br><span class="line"><span class="comment">     * after a narrowing primitive conversion.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@jls</span> 5.1.3 Narrowing Primitive Conversions</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> intValue() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>)get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the value of this &#123;<span class="doctag">@code</span> AtomicLong&#125; as a &#123;<span class="doctag">@code</span> long&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">long</span> longValue() &#123;</span><br><span class="line">        <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the value of this &#123;<span class="doctag">@code</span> AtomicLong&#125; as a &#123;<span class="doctag">@code</span> float&#125;</span></span><br><span class="line"><span class="comment">     * after a widening primitive conversion.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@jls</span> 5.1.2 Widening Primitive Conversions</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> floatValue() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">float</span>)get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the value of this &#123;<span class="doctag">@code</span> AtomicLong&#125; as a &#123;<span class="doctag">@code</span> double&#125;</span></span><br><span class="line"><span class="comment">     * after a widening primitive conversion.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@jls</span> 5.1.2 Widening Primitive Conversions</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span> doubleValue() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">double</span>)get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<h6 id="2-ç»å¯¹çº¿ç¨‹å®‰å…¨"><a href="#2-ç»å¯¹çº¿ç¨‹å®‰å…¨" class="headerlink" title="2.ç»å¯¹çº¿ç¨‹å®‰å…¨"></a>2.ç»å¯¹çº¿ç¨‹å®‰å…¨</h6><p>ç»å¯¹çš„ çº¿ç¨‹å®‰å…¨ å®Œå…¨æ»¡è¶³ Brian Goetz ç»™å‡ºçš„ çº¿ç¨‹å®‰å…¨ çš„å®šä¹‰ï¼Œ<br>è¿™ä¸ª å®šä¹‰ å…¶å®æ˜¯å¾ˆ ä¸¥æ ¼çš„ï¼Œ<br>ä¸€ä¸ªç±» è¦è¾¾åˆ° â€œä¸ç®¡ è¿è¡Œæ—¶ç¯å¢ƒ å¦‚ä½•ï¼Œ è°ƒç”¨è€… éƒ½ä¸éœ€è¦ ä»»ä½•é¢å¤–çš„ åŒæ­¥æªæ–½â€ é€šå¸¸éœ€è¦ä»˜å‡ºå¾ˆå¤§çš„ï¼Œç”šè‡³æœ‰æ—¶å€™æ˜¯ä¸åˆ‡å®é™…çš„ä»£ä»·ã€‚</p>
<p>åœ¨ Java APIä¸­ æ ‡æ³¨è‡ªå·±æ˜¯ çº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œå¤§å¤šæ•°éƒ½ä¸æ˜¯ ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ Java APIä¸­ ä¸€ä¸ªä¸æ˜¯ â€œç»å¯¹çº¿ç¨‹å®‰å…¨â€ çš„çº¿ç¨‹å®‰å…¨ç±» æ¥çœ‹çœ‹è¿™é‡Œçš„ â€œç»å¯¹â€ æ˜¯ä»€ä¹ˆæ„æ€ã€‚</p>
<p>å¦‚æœè¯´ java.util.Vector æ˜¯ä¸€ä¸ª çº¿ç¨‹å®‰å…¨ çš„ å®¹å™¨ï¼Œ<br>ç›¸ä¿¡æ‰€æœ‰çš„Javaç¨‹åºå‘˜å¯¹æ­¤éƒ½ä¸ä¼šæœ‰å¼‚è®®ï¼Œå› ä¸ºå®ƒçš„ add()ã€get()å’Œsize() è¿™ç±»æ–¹æ³•éƒ½æ˜¯è¢« synchronized ä¿®é¥°çš„ï¼Œ<br>å°½ç®¡è¿™æ · æ•ˆç‡å¾ˆä½ï¼Œä½†ç¡®å®æ˜¯ å®‰å…¨çš„ã€‚</p>
<p>ä½†æ˜¯ï¼Œå³ä½¿å®ƒ æ‰€æœ‰çš„æ–¹æ³• éƒ½è¢« ä¿®é¥°æˆ åŒæ­¥ï¼Œä¹Ÿä¸æ„å‘³ç€ è°ƒç”¨å®ƒçš„æ—¶å€™æ°¸è¿œéƒ½ä¸éœ€è¦ åŒæ­¥æ‰‹æ®µäº†ï¼Œ<br>è¯·çœ‹ä¸€ä¸‹ä»£ç æ¸…å•13-2ä¸­çš„æµ‹è¯•ä»£ç ã€‚</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">                                ä»£ç æ¸…å• <span class="number">13</span><span class="number">-2</span> å¯¹Vectorçº¿ç¨‹å®‰å…¨çš„æµ‹è¯•</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Vector&lt;Integer&gt; <span class="built_in">vector</span> = <span class="keyword">new</span> Vector&lt;Integer&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span></span>&#123;</span><br><span class="line">  <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">      <span class="built_in">vector</span>.add(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Thread removeThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable()&#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="built_in">run</span>()&#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">vector</span>.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="built_in">vector</span>.<span class="built_in">remove</span>(i);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  Thread printThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable()&#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="built_in">run</span>()&#123;</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">vector</span>.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>((<span class="built_in">vector</span>.<span class="built_in">get</span>(i)));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  removeThread.start();</span><br><span class="line">  printThread.start();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//ä¸è¦åŒæ—¶äº§ç”Ÿè¿‡å¤šçš„çº¿ç¨‹ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ“ä½œç³»ç»Ÿå‡æ­»</span></span><br><span class="line">  <span class="keyword">while</span>(Thread.activeCount() &gt; <span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"Thread-132"</span> java.lang.ArrayIndexOutOfBoundsException:</span><br><span class="line">Array index out <span class="keyword">of</span> range:<span class="number">17</span></span><br><span class="line">  at java.util.<span class="module-access"><span class="module"><span class="identifier">Vector</span>.</span></span>remove(<span class="module-access"><span class="module"><span class="identifier">Vector</span>.</span></span>java:<span class="number">777</span>)</span><br><span class="line">  at org.fenixsoft.mulithread.<span class="module-access"><span class="module"><span class="identifier">VectorTest$1</span>.</span></span>run(<span class="module-access"><span class="module"><span class="identifier">VectorTest</span>.</span></span>java:<span class="number">21</span>)</span><br><span class="line">  at java.lang.<span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>run(<span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>java:<span class="number">662</span>)</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾ï¼Œå°½ç®¡è¿™é‡Œä½¿ç”¨åˆ°çš„ Vectorçš„get()ã€remove()å’Œsize() æ–¹æ³•éƒ½æ˜¯ åŒæ­¥çš„ï¼Œ<br>ä½†æ˜¯åœ¨ å¤šçº¿ç¨‹ çš„ç¯å¢ƒä¸‹ï¼Œå¦‚æœä¸åœ¨ æ–¹æ³•è°ƒç”¨ç«¯ åšé¢å¤–çš„åŒæ­¥æªæ–½ çš„è¯ï¼Œ<br>ä½¿ç”¨è¿™æ®µä»£ç  ä»ç„¶æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºå¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹ æ°å¥½åœ¨é”™è¯¯çš„æ—¶é—´é‡Œ åˆ é™¤äº†ä¸€ä¸ªå…ƒç´ ï¼Œ<br>å¯¼è‡´åºå· i å·²ç»ä¸å†å¯ç”¨çš„è¯ï¼Œ<br>å†ç”¨ i è®¿é—®æ•°ç»„å°±ä¼š æŠ›å‡ºä¸€ä¸ªArrayIndexOutOfBoundsException</p>
<p>å¦‚æœè¦ä¿è¯è¿™æ®µä»£ç èƒ½æ­£ç¡®æ‰§è¡Œä¸‹å»ï¼Œæˆ‘ä»¬ä¸å¾—ä¸æŠŠ removeThreadå’ŒprintThread çš„å®šä¹‰æ”¹æˆå¦‚ä»£ç æ¸…å•13-3æ‰€ç¤ºçš„æ ·å­ã€‚</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">                                ä»£ç æ¸…å• <span class="number">13</span><span class="number">-3</span> å¿…é¡»åŠ å…¥åŒæ­¥ ä»¥ä¿è¯Vectorè®¿é—®çš„çº¿ç¨‹å®‰å…¨æ€§</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line">Thread removeThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable()&#123;</span><br><span class="line">  @Override</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="built_in">run</span>()&#123;</span><br><span class="line">    synchronized(<span class="built_in">vector</span>)&#123;</span><br><span class="line">      <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">vector</span>.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="built_in">vector</span>.<span class="built_in">remove</span>(i);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Thread printThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable()&#123;</span><br><span class="line">  @Override</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="built_in">run</span>()&#123;</span><br><span class="line">    synchronized(<span class="built_in">vector</span>)&#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">vector</span>.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>((<span class="built_in">vector</span>.<span class="built_in">get</span>(i)));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<h6 id="3-ç›¸å¯¹çº¿ç¨‹å®‰å…¨"><a href="#3-ç›¸å¯¹çº¿ç¨‹å®‰å…¨" class="headerlink" title="3.ç›¸å¯¹çº¿ç¨‹å®‰å…¨"></a>3.ç›¸å¯¹çº¿ç¨‹å®‰å…¨</h6><p>ç›¸å¯¹çš„ çº¿ç¨‹å®‰å…¨ å°±æ˜¯æˆ‘ä»¬ é€šå¸¸æ„ä¹‰ä¸Š æ‰€è®²çš„ çº¿ç¨‹å®‰å…¨ï¼Œ<br>å®ƒéœ€è¦ ä¿è¯ å¯¹è¿™ä¸ªå¯¹è±¡ å•ç‹¬çš„æ“ä½œ æ˜¯ çº¿ç¨‹å®‰å…¨çš„ï¼Œ<br>æˆ‘ä»¬åœ¨ è°ƒç”¨çš„æ—¶å€™ ä¸éœ€è¦åš é¢å¤–çš„ä¿éšœæªæ–½ï¼Œä½†æ˜¯å¯¹äºä¸€äº› ç‰¹å®šé¡ºåº çš„ è¿ç»­è°ƒç”¨ï¼Œ<br>å°±å¯èƒ½éœ€è¦åœ¨ è°ƒç”¨ç«¯ ä½¿ç”¨ é¢å¤–çš„åŒæ­¥æ‰‹æ®µ æ¥ä¿è¯ è°ƒç”¨çš„æ­£ç¡®æ€§ã€‚</p>
<p>ä¸Šé¢ä»£ç æ¸…å•13-2å’Œä»£ç æ¸…å•13-3å°±æ˜¯ ç›¸å¯¹çº¿ç¨‹å®‰å…¨çš„ æ˜æ˜¾çš„ æ¡ˆä¾‹ã€‚</p>
<p>åœ¨Javaè¯­è¨€ä¸­ï¼Œå¤§éƒ¨åˆ†çš„ çº¿ç¨‹å®‰å…¨ç±» éƒ½å±äºè¿™ç§ç±»å‹ï¼Œä¾‹å¦‚ Vectorã€HashTableã€Collectionsçš„synchronizedCollection() æ–¹æ³•åŒ…è£…çš„é›†åˆ ç­‰ã€‚</p>
<h6 id="4-çº¿ç¨‹å…¼å®¹"><a href="#4-çº¿ç¨‹å…¼å®¹" class="headerlink" title="4.çº¿ç¨‹å…¼å®¹"></a>4.çº¿ç¨‹å…¼å®¹</h6><p>çº¿ç¨‹å…¼å®¹ æ˜¯æŒ‡ å¯¹è±¡æœ¬èº« å¹¶ä¸æ˜¯ çº¿ç¨‹å®‰å…¨çš„ï¼Œ<br>ä½†æ˜¯å¯ä»¥é€šè¿‡åœ¨ è°ƒç”¨ç«¯ æ­£ç¡®åœ° ä½¿ç”¨ åŒæ­¥æ‰‹æ®µ æ¥ä¿è¯å¯¹è±¡ åœ¨å¹¶å‘ç¯å¢ƒä¸­ å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ï¼Œ<br>æˆ‘ä»¬å¹³å¸¸è¯´ ä¸€ä¸ªç±»ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œç»å¤§å¤šæ•°æ—¶å€™æŒ‡çš„æ˜¯è¿™ä¸€ç§æƒ…å†µã€‚</p>
<p>Java APIä¸­å¤§éƒ¨åˆ†çš„ç±» éƒ½æ˜¯å±äº çº¿ç¨‹å…¼å®¹çš„ï¼Œå¦‚ä¸å‰é¢çš„ Vectorå’ŒHashTable ç›¸å¯¹åº”çš„é›†åˆç±» ArrayListå’ŒHashMap ç­‰ã€‚</p>
<h6 id="5-çº¿ç¨‹å¯¹ç«‹"><a href="#5-çº¿ç¨‹å¯¹ç«‹" class="headerlink" title="5.çº¿ç¨‹å¯¹ç«‹"></a>5.çº¿ç¨‹å¯¹ç«‹</h6><p>çº¿ç¨‹å¯¹ç«‹ æ˜¯æŒ‡æ— è®º è°ƒç”¨ç«¯ æ˜¯å¦é‡‡å–äº† åŒæ­¥æªæ–½ï¼Œ<br>éƒ½æ— æ³•åœ¨ å¤šçº¿ç¨‹ç¯å¢ƒä¸­ å¹¶å‘ä½¿ç”¨çš„ä»£ç ã€‚</p>
<p>ç”±äºJavaè¯­è¨€å¤©ç”Ÿå°±å…·å¤‡ å¤šçº¿ç¨‹ç‰¹æ€§ï¼Œçº¿ç¨‹å¯¹ç«‹ è¿™ç§ æ’æ–¥å¤šçº¿ç¨‹çš„ä»£ç  æ—¶å¾ˆå°‘å‡ºç°çš„ï¼Œè€Œä¸”é€šå¸¸éƒ½æ˜¯ æœ‰å®³çš„ï¼Œåº”å½“å°½é‡é¿å…ã€‚</p>
<p>ä¸€ä¸ªçº¿ç¨‹å¯¹ç«‹ çš„ä¾‹å­æ˜¯ Thread ç±»çš„ suspend() å’Œ resume() æ–¹æ³•ï¼Œ<br>å¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹ åŒæ—¶æŒæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œä¸€ä¸ªå°è¯•å»ä¸­æ–­çº¿ç¨‹ï¼Œå¦ä¸€ä¸ªå°è¯•å»æ¢å¤çº¿ç¨‹ï¼Œ<br>å¦‚æœå¹¶å‘è¿›è¡Œçš„è¯ï¼Œæ— è®ºè°ƒç”¨æ—¶ æ˜¯å¦è¿›è¡Œäº†åŒæ­¥ï¼Œç›®æ ‡çº¿ç¨‹éƒ½æ˜¯å­˜åœ¨ æ­»é”é£é™© çš„ï¼Œ<br>å¦‚æœ suspend() ä¸­æ–­çš„çº¿ç¨‹ å°±æ˜¯ å³å°†è¦æ‰§è¡Œ resume() çš„é‚£ä¸ªçº¿ç¨‹ï¼Œé‚£å°±è‚¯å®šè¦äº§ç”Ÿ æ­»é” äº†ã€‚</p>
<p>ä¹Ÿæ­£æ˜¯ç”±äºè¿™ä¸ªåŸå› ï¼Œ suspend() å’Œ resume() æ–¹æ³•å·²ç»è¢« JDK å£°æ˜åºŸå¼ƒï¼ˆ@Deprecatedï¼‰äº†ã€‚</p>
<p>å¸¸è§çš„ çº¿ç¨‹å¯¹ç«‹ çš„æ“ä½œè¿˜æœ‰ System.setIn()ã€System.setOut() å’Œ System.runFinalizersOnExit()ç­‰ã€‚</p>
<h5 id="çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•"><a href="#çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•" class="headerlink" title="çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•"></a>çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•</h5><p>äº†è§£äº† ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ ä¹‹åï¼Œç´§æ¥ç€çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯æˆ‘ä»¬åº”è¯¥ å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨ï¼Œ<br>è¿™å¬èµ·æ¥ä¼¼ä¹æ˜¯ä¸€ä»¶ç”±ä»£ç å¦‚ä½•ç¼–å†™æ¥å†³å®šçš„äº‹æƒ…ï¼Œç¡®å®ï¼Œå¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨ ä¸ ä»£ç ç¼–å†™ æœ‰å¾ˆå¤§çš„å…³ç³»ï¼Œ<br>ä½† è™šæ‹Ÿæœº æä¾›çš„ åŒæ­¥å’Œé”æœºåˆ¶ ä¹Ÿèµ·åˆ°äº†éå¸¸é‡è¦çš„ä½œç”¨ã€‚</p>
<p>æœ¬èŠ‚ä¸­ï¼Œä»£ç ç¼–å†™å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨ å’Œ è™šæ‹Ÿæœºå¦‚ä½•å®ç°åŒæ­¥ä¸é” è¿™ä¸¤è€…éƒ½ä¼šæœ‰æ‰€æ¶‰åŠï¼Œç›¸å¯¹è€Œè¨€æ›´åé‡åè€…ä¸€äº›ï¼Œ<br>åªè¦è¯»è€…äº†è§£äº† è™šæ‹Ÿæœºçº¿ç¨‹å®‰å…¨æ‰‹æ®µ çš„è¿ä½œè¿‡ç¨‹ï¼Œè‡ªå·±å»æ€è€ƒä»£ç å¦‚ä½•ç¼–å†™å¹¶ä¸æ˜¯ä¸€ä»¶å›°éš¾çš„äº‹æƒ…ã€‚</p>
<p>ï¼ˆå‘¨å¤§å¤§ï¼Œä½ æ˜¯è®¤çœŸçš„å—ï¼ŸğŸ˜­ğŸ˜­ğŸ˜­ è¯´å‡ºè¿™å¥è¯çš„æ—¶å€™ï¼Œè€ƒè™‘è¿‡åƒæˆ‘è¿™ç§å°ç™½çš„æ„Ÿå—å—ï¼ŸğŸ™ƒğŸ™ƒğŸ™ƒï¼‰</p>
<h6 id="1-äº’æ–¥åŒæ­¥"><a href="#1-äº’æ–¥åŒæ­¥" class="headerlink" title="1.äº’æ–¥åŒæ­¥"></a>1.äº’æ–¥åŒæ­¥</h6><p>äº’æ–¥åŒæ­¥ï¼ˆMutual Exclusion &amp; Synchronizationï¼‰ æ˜¯å¸¸è§çš„ä¸€ç§ å¹¶å‘æ­£ç¡®æ€§ä¿éšœæ‰‹æ®µã€‚</p>
<p>åŒæ­¥ æ˜¯æŒ‡åœ¨ å¤šä¸ªçº¿ç¨‹ å¹¶å‘è®¿é—® å…±äº«æ•°æ®æ—¶ï¼Œä¿è¯ å…±äº«æ•°æ® åœ¨åŒä¸€ä¸ªæ—¶åˆ» åªè¢«ä¸€ä¸ªï¼ˆæˆ–è€…æ˜¯ä¸€äº›ï¼Œä½¿ç”¨ä¿¡å·é‡çš„æ—¶å€™ï¼‰çº¿ç¨‹ä½¿ç”¨ã€‚</p>
<p>è€Œ äº’æ–¥ æ˜¯ å®ç°åŒæ­¥ çš„ ä¸€ç§æ‰‹æ®µï¼Œ<br>ä¸´ç•ŒåŒºï¼ˆCritical Sectionï¼‰ã€äº’æ–¥é‡ï¼ˆMutexï¼‰å’Œä¿¡å·é‡ï¼ˆSemaphoreï¼‰éƒ½æ˜¯ä¸»è¦çš„ äº’æ–¥å®ç°æ–¹å¼ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨è¿™4ä¸ªå­—é‡Œé¢ï¼Œäº’æ–¥ æ˜¯ å› ï¼Œ åŒæ­¥ æ˜¯ æœï¼›äº’æ–¥ æ˜¯ æ–¹æ³•ï¼ŒåŒæ­¥ æ˜¯ ç›®çš„ã€‚</p>
<p>åœ¨ Java ä¸­ï¼Œæœ€åŸºæœ¬çš„ åŒæ­¥äº’æ–¥ æ‰‹æ®µå°±æ˜¯ synchronizedå…³é”®å­—ï¼Œ<br>synchronizedå…³é”®å­— ç»è¿‡ ç¼–è¯‘ ä¹‹åï¼Œ ä¼šåœ¨ åŒæ­¥å— çš„å‰å åˆ†åˆ«å½¢æˆ monitorenterå’Œmonitorexit è¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ï¼Œ<br>è¿™ä¸¤ä¸ªå­—èŠ‚ç  éƒ½éœ€è¦ä¸€ä¸ª reference ç±»å‹çš„å‚æ•°æ¥æŒ‡æ˜è¦ é”å®šå’Œè§£é” çš„å¯¹è±¡ã€‚</p>
<p>å¦‚æœJavaç¨‹åºä¸­çš„ synchronizedæ˜ç¡®æŒ‡å®šäº† å¯¹è±¡å‚æ•°ï¼Œé‚£å°±æ˜¯ è¿™ä¸ªå¯¹è±¡çš„referenceï¼›<br>å¦‚æœæ²¡æœ‰æ˜ç¡®æŒ‡å®šï¼Œé‚£å°±æ ¹æ® synchronized ä¿®é¥°çš„æ˜¯å®ä¾‹æ–¹æ³•è¿˜æ˜¯ç±»æ–¹æ³•ï¼Œå»å–å¯¹åº”çš„ å¯¹è±¡å®ä¾‹ æˆ– Classå¯¹è±¡ æ¥ä½œä¸º é”å¯¹è±¡ã€‚</p>
<p>æ ¹æ® è™šæ‹Ÿæœºè§„èŒƒ çš„è¦æ±‚ï¼Œ<br>åœ¨ æ‰§è¡Œ monitorenter æŒ‡ä»¤æ—¶ï¼Œ<br>é¦–å…ˆ è¦å°è¯• è·å– å¯¹è±¡çš„é”ã€‚</p>
<p>å¦‚æœ è¿™ä¸ªå¯¹è±¡ æ²¡è¢« é”å®šï¼Œ<br>æˆ–è€… å½“å‰çº¿ç¨‹ å·²ç»æ‹¥æœ‰äº† é‚£ä¸ªå¯¹è±¡çš„é”ï¼Œ<br>æŠŠ é” çš„ è®¡æ•°å™¨ åŠ 1ï¼Œ<br>ç›¸åº”çš„ï¼Œ<br>åœ¨ æ‰§è¡Œ monitorexit æŒ‡ä»¤æ—¶ ä¼šå°† é”è®¡æ•°å™¨ å‡1ï¼Œ<br>å½“è®¡æ•°å™¨ä¸º0æ—¶ï¼Œé” å°± é‡Šæ”¾ã€‚</p>
<p>å¦‚æœ è·å– å¯¹è±¡é” å¤±è´¥ï¼Œé‚£ å½“å‰çº¿ç¨‹ å°±è¦ é˜»å¡ç­‰å¾…ï¼Œç›´åˆ° å¯¹è±¡é” è¢« å¦å¤–ä¸€ä¸ªçº¿ç¨‹ é‡Šæ”¾ä¸ºæ­¢ã€‚</p>
<p>åœ¨ è™šæ‹Ÿæœºè§„èŒƒ å¯¹ monitorenterå’Œmonitorexit çš„è¡Œä¸ºæè¿°ä¸­ï¼Œæœ‰ä¸¤ç‚¹æ˜¯éœ€è¦ç‰¹åˆ«æ³¨æ„çš„ã€‚</p>
<p>é¦–å…ˆï¼ŒsynchronizedåŒæ­¥å— å¯¹ åŒä¸€æ¡çº¿ç¨‹ æ¥è¯´ æ˜¯å¯é‡å…¥çš„ï¼Œä¸ä¼šå‡ºç° è‡ªå·±æŠŠè‡ªå·± é”æ­»çš„é—®é¢˜ã€‚</p>
<p>å…¶æ¬¡ï¼ŒåŒæ­¥å— åœ¨ å·²è¿›å…¥çš„çº¿ç¨‹ æ‰§è¡Œå®Œä¹‹å‰ï¼Œä¼š é˜»å¡ åé¢å…¶ä»–çº¿ç¨‹çš„è¿›å…¥ã€‚</p>
<p>ç¬¬12ç« è®²è¿‡ï¼ŒJavaçš„çº¿ç¨‹ æ˜¯æ˜ å°„åˆ° æ“ä½œç³»ç»Ÿ çš„ åŸç”Ÿçº¿ç¨‹ ä¹‹ä¸Šçš„ï¼Œå¦‚æœè¦ é˜»å¡æˆ–å”¤é†’ ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½éœ€è¦ æ“ä½œç³»ç»Ÿæ¥å¸®å¿™å®Œæˆï¼Œ<br>è¿™å°±éœ€è¦ä» ç”¨æˆ·æ€ è½¬æ¢åˆ° æ ¸å¿ƒæ€ ä¸­ï¼Œå› æ­¤ çŠ¶æ€è½¬æ¢ éœ€è¦è€—è´¹ å¾ˆå¤šçš„å¤„ç†å™¨æ—¶é—´ã€‚</p>
<p>å¯¹äº ä»£ç ç®€å•çš„ åŒæ­¥å—ï¼ˆå¦‚è¢« synchronizedä¿®é¥°çš„ getter() æˆ– setter() æ–¹æ³•ï¼‰ï¼Œ<br>çŠ¶æ€è½¬æ¢ æ¶ˆè€—çš„æ—¶é—´ æœ‰å¯èƒ½æ¯” ç”¨æˆ·ä»£ç  æ‰§è¡Œçš„æ—¶é—´ è¿˜è¦é•¿ã€‚</p>
<p>æ‰€ä»¥ synchronized æ˜¯Javaè¯­è¨€ä¸­ä¸€ä¸ª é‡é‡çº§ï¼ˆHeavyweightï¼‰çš„æ“ä½œï¼Œæœ‰ç»éªŒçš„ç¨‹åºå‘˜éƒ½ä¼šåœ¨ ç¡®å®å¿…è¦ çš„æƒ…å†µä¸‹ æ‰ä½¿ç”¨è¿™ç§æ“ä½œã€‚</p>
<p>è€Œ è™šæ‹Ÿæœºæœ¬èº« ä¹Ÿä¼šè¿›è¡Œä¸€äº› ä¼˜åŒ–ï¼Œ<br>è­¬å¦‚åœ¨é€šçŸ¥ æ“ä½œç³»ç»Ÿé˜»å¡çº¿ç¨‹ ä¹‹å‰ åŠ å…¥ä¸€æ®µ è‡ªæ—‹ç­‰å¾…è¿‡ç¨‹ï¼Œé¿å…é¢‘ç¹åœ° åˆ‡å…¥åˆ° æ ¸å¿ƒæ€ ä¹‹ä¸­ã€‚</p>
<p>é™¤äº† synchronized ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ java.util.concurrent(ä¸‹æ–‡ç§°J.U.C) åŒ…ä¸­çš„ é‡å…¥é”ï¼ˆReentrantLockï¼‰ æ¥ å®ç°åŒæ­¥ï¼Œ<br>åœ¨åŸºæœ¬ç”¨æ³•ä¸Šï¼Œ ReentrantLockä¸synchronized å¾ˆç›¸ä¼¼ï¼Œ<br>å®ƒä»¬éƒ½å…·å¤‡ä¸€æ ·çš„ çº¿ç¨‹é‡å…¥ç‰¹æ€§ï¼Œåªæ˜¯ä»£ç å†™æ³•ä¸Šæœ‰ç‚¹åŒºåˆ«ï¼Œ<br>ä¸€ä¸ªè¡¨ç°ä¸º APIå±‚é¢çš„ äº’æ–¥é”ï¼ˆ lock()å’Œunlock()æ–¹æ³• é…åˆ try/finallyè¯­å¥å— æ¥å®Œæˆï¼‰ï¼Œ<br>å¦ä¸€ä¸ªè¡¨ç°ä¸º åŸç”Ÿè¯­æ³•å±‚é¢çš„äº’æ–¥é”ã€‚</p>
<p>ä¸è¿‡ï¼Œç›¸æ¯” synchronizedï¼ŒReentrantLock å¢åŠ äº†ä¸€äº› é«˜çº§åŠŸèƒ½ï¼Œ<br>ä¸»è¦æœ‰ä»¥ä¸‹3é¡¹ï¼š<br>ç­‰å¾…å¯ä¸­æ–­ã€å¯å®ç°å…¬å¹³é”ã€ä»¥åŠ é”å¯ä»¥ç»‘å®šå¤šä¸ªæ¡ä»¶ã€‚</p>
<p>ç­‰å¾…å¯ä¸­æ–­ æ˜¯æŒ‡ å½“æŒæœ‰é”çš„çº¿ç¨‹ é•¿æœŸä¸é‡Šæ”¾é” çš„æ—¶å€™ï¼Œæ­£åœ¨ ç­‰å¾…çš„çº¿ç¨‹ å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œæ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…ï¼Œå¯ä¸­æ–­ç‰¹æ€§ å¯¹å¤„ç†æ‰§è¡Œæ—¶é—´éå¸¸é•¿çš„ åŒæ­¥å— å¾ˆæœ‰å¸®åŠ©ã€‚</p>
<p>å…¬å¹³é” æ˜¯æŒ‡ å¤šä¸ªçº¿ç¨‹ åœ¨ç­‰å¾… åŒä¸€ä¸ªé” æ—¶ï¼Œå¿…é¡»æŒ‰ç…§ ç”³è¯·é” çš„æ—¶é—´é¡ºåº æ¥ä¾æ¬¡ è·å¾—é”ï¼›<br>è€Œ éå…¬å¹³é” åˆ™ä¸ä¿è¯ è¿™ä¸€ç‚¹ï¼Œ<br>åœ¨ é” è¢«é‡Šæ”¾æ—¶ï¼Œä»»ä½•ä¸€ä¸ª ç­‰å¾…é”çš„çº¿ç¨‹ éƒ½æœ‰æœºä¼š è·å¾—é”ã€‚<br>synchronized ä¸­ çš„ é” æ˜¯éå…¬å¹³çš„ï¼ŒReentrantLock é»˜è®¤æƒ…å†µä¸‹  ä¹Ÿæ˜¯éå…¬å¹³çš„ï¼Œä½†å¯ä»¥é€šè¿‡ å¸¦å¸ƒå°”å€¼ çš„ æ„é€ å‡½æ•° è¦æ±‚ä½¿ç”¨ å…¬å¹³é”ã€‚</p>
<p>é”ç»‘å®šå¤šä¸ªæ¡ä»¶ æ˜¯æŒ‡ ä¸€ä¸ªReentrantLockå¯¹è±¡ å¯ä»¥åŒæ—¶ ç»‘å®šå¤šä¸ªConditionå¯¹è±¡ï¼Œ<br>è€Œåœ¨ synchronizedä¸­ï¼Œ é”å¯¹è±¡ çš„ wait()å’Œnotify()æˆ–notifyAll()æ–¹æ³• å¯ä»¥å®ç°ä¸€ä¸ª éšå«çš„æ¡ä»¶ï¼Œ<br>å¦‚æœè¦å’Œ å¤šäºä¸€ä¸ªçš„æ¡ä»¶å…³è”çš„æ—¶å€™ï¼Œ å°±ä¸å¾—ä¸ é¢å¤–åœ°æ·»åŠ ä¸€ä¸ªé”ï¼Œ<br>è€Œ ReentrantLock åˆ™æ— éœ€è¿™æ ·åšï¼Œåªéœ€è¦ å¤šæ¬¡è°ƒç”¨ newCondition()æ–¹æ³• å³å¯ã€‚</p>
<p>å¦‚æœéœ€è¦ä½¿ç”¨ä¸Šè¿°åŠŸèƒ½ï¼Œé€‰ç”¨ ReentrantLock æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œ<br>é‚£å¦‚æœ æ˜¯åŸºäº æ€§èƒ½è€ƒè™‘å‘¢ï¼Ÿ<br>å…³äº synchronizedå’ŒReentrantLock çš„ æ€§èƒ½é—®é¢˜ï¼Œ<br>Brian Goetzå¯¹è¿™ä¸¤ç§é”åœ¨ JDK1.5ä¸å•æ ¸å¤„ç†å™¨ï¼Œä»¥åŠ JDK1.5ä¸åŒXeonå¤„ç†å™¨ ç¯å¢ƒä¸‹åšäº†ä¸€ç»„ ååé‡å¯¹æ¯”çš„å®éªŒï¼Œå®éªŒç»“æœå¦‚å›¾13-1å’Œå›¾13-2æ‰€ç¤ºã€‚</p>
<blockquote>
<p>æœ¬ä¾‹ä¸­çš„æ•°æ®åŠå›¾ç‰‡æ¥æºäº Brian Goetz ä¸º IBM developerWorks æ’°å†™çš„è®ºæ–‡ï¼šã€ŠJava theory and practice:More flexible, scalable locking in JDK5.0ã€‹ï¼Œ<br>åŸæ–‡åœ°å€æ˜¯ï¼š<code>http://www.ibm.com/developerworks/java/library/j-jtp10264/?S_TACT= 105AGX53&amp;S_CMP=cn-a-j</code>ã€‚</p>
</blockquote>
<p>ï¼ˆè¯¥é“¾æ¥æœ‰æ•ˆï¼Œä½†æ˜¯ï¼Œæˆ‘çœ‹çš„å¾ˆæ˜¯è‰°éš¾ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­æ•‘æ•‘è¿™è‹¦å‘½çš„å­©å­å§ï¼Œå°±åƒå½“åˆæ¥å…¥paypalæ”¯ä»˜ğŸ™ƒğŸ™ƒğŸ™ƒğŸ™ƒï¼‰</p>
<p>ä»å›¾13-1å’Œå›¾13-2å¯ä»¥çœ‹å‡ºï¼Œ<br>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ synchronizedçš„ååé‡ä¸‹é™å¾— éå¸¸ä¸¥é‡ï¼Œ<br>è€Œ ReentrantLock åˆ™èƒ½åŸºæœ¬ä¿æŒåœ¨åŒä¸€ä¸ª æ¯”è¾ƒç¨³å®šçš„æ°´å¹³ ä¸Šã€‚</p>
<p>ä¸å…¶è¯´ ReentrantLock æ€§èƒ½å¥½ï¼Œè¿˜ä¸å¦‚è¯´ synchronized è¿˜æœ‰éå¸¸å¤§çš„ä¼˜åŒ–ä½™åœ°ã€‚</p>
<p>åç»­çš„æŠ€æœ¯å‘å±•ä¹Ÿè¯æ˜äº†è¿™ä¸€ç‚¹ï¼ŒJDK1.6ä¸­åŠ å…¥äº†å¾ˆå¤šé’ˆå¯¹ é”çš„ä¼˜åŒ–æªæ–½ï¼ˆ13.3èŠ‚æˆ‘ä»¬å°±ä¼šè®²è§£è¿™äº› ä¼˜åŒ–æªæ–½ï¼‰ï¼Œ<br>JDK1.6å‘å¸ƒä¹‹åï¼Œäººä»¬å°±å‘ç° synchronizedä¸ReentrantLock çš„ æ€§èƒ½ åŸºæœ¬ä¸Šæ˜¯ å®Œå…¨æŒå¹³ äº†ã€‚</p>
<p>å› æ­¤ï¼Œå¦‚æœè¯»è€…çš„ç¨‹åº æ˜¯ä½¿ç”¨ JDK1.6 æˆ–ä»¥ä¸Š éƒ¨ç½² çš„è¯ï¼Œ<br>æ€§èƒ½å› ç´  å°±ä¸å†æ˜¯ é€‰æ‹©ReentrantLock çš„ç†ç”±äº†ï¼Œ<br>è™šæ‹Ÿæœº åœ¨ æœªæ¥çš„æ€§èƒ½æ”¹è¿›ä¸­ è‚¯å®šä¹Ÿä¼šæ›´åŠ åå‘äº åŸç”Ÿçš„synchronizedï¼Œ<br>æ‰€ä»¥è¿˜æ˜¯æå€¡åœ¨ synchronized èƒ½å®ç°éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ synchronized æ¥è¿›è¡Œ åŒæ­¥ã€‚</p>
<h6 id="2-éé˜»å¡åŒæ­¥"><a href="#2-éé˜»å¡åŒæ­¥" class="headerlink" title="2.éé˜»å¡åŒæ­¥"></a>2.éé˜»å¡åŒæ­¥</h6><p>äº’æ–¥åŒæ­¥ æœ€ä¸»è¦çš„é—®é¢˜ å°±æ˜¯ è¿›è¡Œçº¿ç¨‹ é˜»å¡å’Œå”¤é†’ æ‰€å¸¦æ¥çš„çš„ æ€§èƒ½é—®é¢˜ï¼Œ<br>å› æ­¤è¿™ç§ åŒæ­¥ä¹Ÿç§°ä¸º é˜»å¡åŒæ­¥ï¼ˆBlocking Synchronizationï¼‰ã€‚</p>
<p>ä» å¤„ç†é—®é¢˜çš„æ–¹å¼ ä¸Šè¯´ï¼Œ<br>äº’æ–¥åŒæ­¥ å±äºä¸€ç§ æ‚²è§‚çš„ å¹¶å‘ç­–ç•¥ï¼Œæ€»æ˜¯è®¤ä¸º åªè¦ä¸å»åš æ­£ç¡®çš„ åŒæ­¥æªæ–½ï¼ˆä¾‹å¦‚åŠ é”ï¼‰ï¼Œé‚£å°±è‚¯å®šä¼šå‡ºç°é—®é¢˜ï¼Œ<br>æ— è®º å…±äº«æ•°æ® æ˜¯å¦çœŸçš„ä¼šå‡ºç°ç«äº‰ï¼Œå®ƒéƒ½è¦ è¿›è¡ŒåŠ é”<br>ï¼ˆè¿™é‡Œè®¨è®ºçš„æ˜¯ æ¦‚å¿µæ¨¡å‹ï¼Œå®é™…ä¸Š è™šæ‹Ÿæœº ä¼šä¼˜åŒ–å¾ˆå¤§ä¸€éƒ¨åˆ† ä¸å¿…è¦çš„ åŠ é”ï¼‰ã€<br>ç”¨æˆ·æ€å’Œå¿ƒæ€è½¬æ¢ã€ç»´æŠ¤é”è®¡æ•°å™¨ å’Œ æ£€æŸ¥ æ˜¯å¦æœ‰ è¢«é˜»å¡çš„çº¿ç¨‹ éœ€è¦å”¤é†’ ç­‰æ“ä½œã€‚</p>
<p>ï¼ˆè¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„ æ€»æœ‰åˆæ°‘æƒ³å®³æœ• äº†ï¼‰</p>
<p>éšç€ ç¡¬ä»¶æŒ‡ä»¤é›† çš„å‘å±•ï¼Œæˆ‘ä»¬æœ‰äº†å¦å¤–ä¸€ä¸ªé€‰æ‹©ï¼šåŸºäº å†²çªæ£€æµ‹ çš„ ä¹è§‚å¹¶å‘ç­–ç•¥ï¼Œ<br>é€šä¿—åœ°è¯´ï¼Œå°±æ˜¯å…ˆè¿›è¡Œæ“ä½œï¼Œ<br>å¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹ äº‰ç”¨å…±äº«æ•°æ®ï¼Œé‚£æ“ä½œå°±æˆåŠŸäº†ï¼›<br>å¦‚æœ å…±äº«æ•°æ® æœ‰äº‰ç”¨ï¼Œäº§ç”Ÿäº† å†²çªï¼Œé‚£å°±å†é‡‡å–å…¶ä»–çš„ è¡¥å¿æªæ–½ï¼ˆæœ€å¸¸è§çš„è¡¥å¿æªæ–½å°±æ˜¯ ä¸æ–­åœ°é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ï¼‰ï¼Œ<br>è¿™ç§ ä¹è§‚çš„å¹¶å‘ç­–ç•¥ çš„è®¸å¤šå®ç° éƒ½ä¸éœ€è¦æŠŠ çº¿ç¨‹æŒ‚èµ·ï¼Œå› æ­¤è¿™ç§ åŒæ­¥æ“ä½œ ç§°ä¸º éé˜»å¡åŒæ­¥ï¼ˆNon-Blocking Synchronizationï¼‰ã€‚</p>
<p>ä¸ºä»€ä¹ˆç¬”è€…è¯´ä½¿ç”¨ ä¹è§‚å¹¶å‘ç­–ç•¥ éœ€è¦ â€œç¡¬ä»¶æŒ‡ä»¤é›†çš„å‘å±•â€ æ‰èƒ½è¿›è¡Œå‘¢ï¼Ÿ</p>
<p>å› ä¸ºæˆ‘ä»¬éœ€è¦ æ“ä½œå’Œå†²çªæ£€æµ‹ è¿™ä¸¤ä¸ªæ­¥éª¤ å…·å¤‡ åŸå­æ€§ï¼Œé ä»€ä¹ˆæ¥ä¿è¯å‘¢ï¼Ÿ</p>
<p>å¦‚æœè¿™é‡Œ å†ä½¿ç”¨ äº’æ–¥åŒæ­¥ æ¥ä¿è¯å°±å¤±å»æ„ä¹‰äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½é  ç¡¬ä»¶ æ¥å®Œæˆè¿™ä»¶äº‹æƒ…ï¼Œ<br>ç¡¬ä»¶ ä¿è¯ä¸€ä¸ªä» è¯­ä¹‰ ä¸Šçœ‹èµ·æ¥éœ€è¦å¤šæ¬¡æ“ä½œçš„æ€§èƒ½ åªé€šè¿‡ ä¸€æ¡å¤„ç†å™¨æŒ‡ä»¤ å°±èƒ½å®Œæˆï¼Œè¿™ç±»æŒ‡ä»¤å¸¸ç”¨çš„æœ‰ï¼š</p>
<p>(æˆ‘å¤§æ¦‚ä¸€è¾ˆå­ä¹Ÿç”¨ä¸åˆ°è¿™äº›ä¸ªä¸œè¥¿)</p>
<ul>
<li>æµ‹è¯•å¹¶è®¾ç½®ï¼ˆTest-and-Setï¼‰</li>
<li>è·å–å¹¶å¢åŠ ï¼ˆFetch-and-Incrementï¼‰</li>
<li>äº¤æ¢ï¼ˆSwapï¼‰</li>
<li>æ¯”è¾ƒå¹¶äº¤æ¢ï¼ˆCompare-and-Swapï¼Œä¸‹æ–‡ç§° CASï¼‰</li>
<li>åŠ è½½é“¾æ¥/æ¡ä»¶å­˜å‚¨ï¼ˆLoad-Linked/Store-Conditionalï¼Œä¸‹æ–‡ç§°LL/SCï¼‰</li>
</ul>
<p>(ä½†æ˜¯è¿˜æ˜¯å¾—åŠªåŠ›å»è¯•è¯•ã€‚ä¸æ€•ä¸€ä¸‡å°±æ€•ä¸‡ä¸€ã€‚)</p>
<p>å…¶ä¸­ï¼Œå‰é¢çš„3æ¡ æ˜¯20ä¸–çºªå°±å·²ç»å­˜åœ¨äº å¤§å¤šæ•°æŒ‡ä»¤é›†ä¹‹ä¸­çš„ å¤„ç†å™¨æŒ‡ä»¤ï¼Œ</p>
<p>åé¢çš„ä¸¤æ¡æ˜¯ ç°ä»£å¤„ç†å™¨ æ–°å¢çš„ï¼Œè€Œä¸”è¿™ä¸¤æ¡æŒ‡ä»¤çš„ ç›®çš„å’ŒåŠŸèƒ½ æ˜¯ç±»ä¼¼çš„ã€‚</p>
<p>åœ¨ IA64ã€x86 æŒ‡ä»¤é›† ä¸­æœ‰ cmpxchgæŒ‡ä»¤ å®Œæˆ CASåŠŸèƒ½ï¼Œ<br>åœ¨ sparc-TSO ä¹Ÿæœ‰ casaæŒ‡ä»¤ å®ç°ï¼Œè€Œåœ¨ ARM å’Œ PowerPC æ¶æ„ä¸‹ï¼Œåˆ™éœ€è¦ä½¿ç”¨ ä¸€å¯¹ ldrex/strex æŒ‡ä»¤ æ¥å®Œæˆ LL/SC çš„åŠŸèƒ½ã€‚</p>
<p>CASæŒ‡ä»¤ éœ€è¦æœ‰3ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«æ˜¯ å†…å­˜ä½ç½®ï¼ˆåœ¨Javaä¸­å¯ä»¥ç®€å•ç†è§£ä¸º å˜é‡çš„å†…å­˜åœ°å€ï¼Œç”¨Vè¡¨ç¤ºï¼‰ã€æ—§çš„é¢„æœŸå€¼ï¼ˆç”¨Aè¡¨ç¤ºï¼‰å’Œæ–°å€¼ï¼ˆç”¨Bè¡¨ç¤ºï¼‰ã€‚</p>
<p>CASæŒ‡ä»¤ æ‰§è¡Œæ—¶ï¼Œå½“ä¸”ä»…å½“ V ç¬¦åˆ æ—§é¢„æœŸå€¼A æ—¶ï¼Œå¤„ç†å™¨ ç”¨ æ–°å€¼B æ›´æ–° Vçš„å€¼ï¼Œå¦åˆ™å®ƒå°±ä¸æ‰§è¡Œæ›´æ–°ï¼Œ<br>ä½†æ˜¯æ— è®º æ˜¯å¦æ›´æ–°äº† Vçš„å€¼ï¼Œéƒ½ä¼šè¿”å› Vçš„æ—§å€¼ï¼Œä¸Šè¿°çš„å¤„ç†è¿‡ç¨‹æ˜¯ä¸€ä¸ª åŸå­æ“ä½œã€‚</p>
<p>åœ¨ JDK1.5 ä¹‹åï¼ŒJavaç¨‹åº ä¸­æ‰å¯ä»¥ä½¿ç”¨ CAS æ“ä½œï¼Œ<br>è¯¥æ“ä½œç”± sun.misc.Unsafeç±» é‡Œé¢çš„ compareAndSwapInt() å’Œ compareAndSwapLong() ç­‰å‡ ä¸ªæ–¹æ³•åŒ…è£…æä¾›ï¼Œ<br>è™šæ‹Ÿæœº åœ¨ å†…éƒ¨ å¯¹è¿™äº›æ–¹æ³•åšäº†ç‰¹æ®Šå¤„ç†ï¼Œ<br>å³æ—¶ç¼–è¯‘å‡ºæ¥çš„ç»“æœ å°±æ˜¯ä¸€æ¡ å¹³å°ç›¸å…³çš„ å¤„ç†å™¨CASæŒ‡ä»¤ï¼Œæ²¡æœ‰æ–¹æ³•è°ƒç”¨çš„è¿‡ç¨‹ï¼Œæˆ–è€…å¯ä»¥è®¤ä¸ºæ˜¯æ— æ¡ä»¶ å†…è” è¿›å»äº†ã€‚</p>
<blockquote>
<p>è¿™ç§è¢« è™šæ‹Ÿæœº ç‰¹æ®Šå¤„ç† çš„æ–¹æ³•ç§°ä¸º å›ºæœ‰å‡½æ•°ï¼ˆIntrinsicsï¼‰ï¼Œç±»ä¼¼çš„ å›ºæœ‰å‡½æ•° è¿˜æœ‰Math.sin()ç­‰ã€‚</p>
</blockquote>
<p>ç”±äº Unsafeç±» ä¸æ˜¯æä¾›ç»™ ç”¨æˆ·ç¨‹åº è°ƒç”¨çš„ç±»ï¼ˆUnsafe.getUnsafe()çš„ä»£ç ä¸­ é™åˆ¶äº†åªæœ‰ å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ åŠ è½½çš„Class æ‰èƒ½è®¿é—®å®ƒï¼‰ï¼Œ<br>å› æ­¤ï¼Œå¦‚æœä¸é‡‡ç”¨ åå°„æ‰‹æ®µ ï¼Œ æˆ‘ä»¬åªèƒ½é€šè¿‡å…¶ä»–çš„ Java APIæ¥é—´æ¥ä½¿ç”¨å®ƒï¼Œå¦‚ J.U.CåŒ… é‡Œé¢çš„ æ•´æ•°åŸå­ç±»ï¼Œå…¶ä¸­çš„ compareAndSet()å’ŒgetAndIncrement() ç­‰æ–¹æ³•éƒ½æ˜¯ç”¨äº† Unsafeç±» çš„ CASæ“ä½œã€‚</p>
<p>æˆ‘ä»¬ä¸å¦¨æ‹¿ä¸€æ®µåœ¨ç¬¬12ç« ä¸­æ²¡æœ‰è§£å†³çš„é—®é¢˜ä»£ç æ¥çœ‹çœ‹ å¦‚ä½•ä½¿ç”¨CASæ“ä½œæ¥é¿å…é˜»å¡åŒæ­¥ ï¼Œä»£ç å¦‚ä»£ç æ¸…å•12-1æ‰€ç¤ºã€‚</p>
<p>æˆ‘ä»¬æ›¾ç»é€šè¿‡è¿™æ®µ20ä¸ªçº¿ç¨‹ è‡ªå¢10000æ¬¡ çš„ä»£ç æ¥è¯æ˜ volatileå˜é‡ä¸å…·å¤‡åŸå­æ€§ï¼Œé‚£ä¹ˆå¦‚ä½•æ‰èƒ½è®©å®ƒ å…·å¤‡åŸå­æ€§ å‘¢ï¼Ÿ</p>
<p>æŠŠ â€œrace++â€æ“ä½œæˆ–increase() æ–¹æ³•ç”¨ åŒæ­¥å— åŒ…è£¹èµ·æ¥å½“ç„¶æ˜¯ä¸€ä¸ªåŠæ³•ï¼Œä½†æ˜¯å¦‚æœæ”¹æˆå¦‚ä»£ç æ¸…å•13-4æ‰€ç¤ºçš„ä»£ç ï¼Œé‚£æ•ˆç‡å°†ä¼šæé«˜è®¸å¤šã€‚</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">                                ä»£ç æ¸…å• <span class="number">13</span><span class="number">-4</span> Atomicçš„åŸå­è‡ªå¢è¿ç®—</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Atomic å˜é‡è‡ªå¢è¿ç®—æµ‹è¯•</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * @author zzm</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicTest</span>&#123;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AtomicInteger race = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">increase</span><span class="params">()</span></span>&#123;</span><br><span class="line">      race.incrementAndGet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> THREADS_COUNT = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> throws Exception</span>&#123;</span><br><span class="line">      Thread[] threads = <span class="keyword">new</span> Thread[THREADS_COUNT];</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; THREADS_COUNT; i++)&#123;</span><br><span class="line">        threads[i] = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable()&#123;</span><br><span class="line">          @Override</span><br><span class="line">          <span class="keyword">public</span> <span class="keyword">void</span> <span class="built_in">run</span>()&#123;</span><br><span class="line">            <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; THREADS_COUNT; i++)&#123;</span><br><span class="line">              increase();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        threads[i].start();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">while</span>(Thread.activeCount() &gt; <span class="number">1</span>)</span><br><span class="line">          thread.<span class="built_in">yield</span>();</span><br><span class="line"></span><br><span class="line">      System.out.<span class="built_in">println</span>(race);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p>200000</p>
<p>ä½¿ç”¨ AtomicInteger ä»£æ›¿ int åï¼Œç¨‹åºè¾“å‡ºäº†æ­£ç¡®çš„ç»“æœï¼Œ<br>ä¸€åˆ‡éƒ½è¦å½’åŠŸäº incrementAndGet()æ–¹æ³• çš„ åŸå­æ€§ã€‚<br>å®ƒçš„å®ç° å…¶å®éå¸¸ ç®€å•ï¼Œå¦‚ä»£ç æ¸…å•13-5æ‰€ç¤ºã€‚</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">                                ä»£ç æ¸…å• 13-5 incrementAndGet()æ–¹æ³•çš„JDKæºç </span></span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line">/*<span class="strong">*</span></span><br><span class="line"><span class="strong">  *</span> Atomically  increment by one the current value.</span><br><span class="line"><span class="code">  * @return the updated value</span></span><br><span class="line"><span class="code">  */</span></span><br><span class="line"><span class="code">  public final int incrementAndGet()&#123;</span></span><br><span class="line"><span class="code">    for(;;)&#123;</span></span><br><span class="line"><span class="code">      int current = get();</span></span><br><span class="line"><span class="code">      int next = current + 1;</span></span><br><span class="line"><span class="code">      if(compareAndSet(current, next))&#123;</span></span><br><span class="line"><span class="code">        return next;</span></span><br><span class="line"><span class="code">      &#125;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">  &#125;</span></span><br><span class="line">----------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>incrementAndGet()æ–¹æ³• åœ¨ä¸€ä¸ª æ— é™å¾ªç¯ ä¸­ï¼Œ<br>ä¸æ–­å°è¯• å°†ä¸€ä¸ªæ¯”å½“å‰å€¼ å¤§1çš„æ–°å€¼ èµ‹å€¼ç»™è‡ªå·±ã€‚<br>å¦‚æœå¤±è´¥äº†ï¼Œé‚£è¯´æ˜åœ¨æ‰§è¡Œ â€œè·å–-è®¾ç½®â€ æ“ä½œçš„æ—¶å€™ å€¼å·²ç»æœ‰äº†ä¿®æ”¹ï¼Œ<br>äºæ˜¯ å†æ¬¡å¾ªç¯ è¿›è¡Œä¸‹ä¸€æ¬¡æ“ä½œï¼Œç›´åˆ°è®¾ç½®æˆåŠŸä¸ºæ­¢ã€‚</p>
<p>å°½ç®¡ CAS çœ‹èµ·æ¥å¾ˆç¾ï¼Œä½†æ˜¾ç„¶è¿™ç§æ“ä½œæ— æ³•æ¶µç›– äº’æ–¥åŒæ­¥çš„æ‰€æœ‰ä½¿ç”¨åœºæ™¯ï¼Œ<br>å¹¶ä¸” CAS ä»è¯­ä¹‰ä¸Šæ¥è¯´ å¹¶ä¸æ˜¯å®Œç¾çš„ï¼Œå­˜åœ¨è¿™æ ·ä¸€ä¸ª é€»è¾‘æ¼æ´ï¼š<br>å¦‚æœä¸€ä¸ª å˜é‡V åˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯ Aå€¼ï¼Œ<br>å¹¶ä¸”åœ¨å‡†å¤‡èµ‹å€¼çš„æ—¶å€™ æ£€æŸ¥åˆ°å®ƒä»ç„¶ä¸ºAå€¼ï¼Œ<br>é‚£æˆ‘ä»¬å°±èƒ½è¯´å®ƒçš„å€¼ æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹æ”¹å˜è¿‡äº†å—ï¼Ÿ<br>å¦‚æœåœ¨è¿™æ®µæœŸé—´ å®ƒçš„å€¼æ›¾ç»è¢«æ”¹æˆäº†Bï¼Œ åæ¥åˆè¢«æ”¹å›Aï¼Œ<br>é‚£ CASæ“ä½œ å°±ä¼šè¯¯è®¤ä¸ºå®ƒ ä»æ¥æ²¡æœ‰è¢«æ”¹å˜è¿‡ã€‚</p>
<p>è¿™ä¸ª æ¼æ´ ç§°ä¸º CASæ“ä½œ çš„ â€œABAé—®é¢˜â€ã€‚</p>
<p>J.U.CåŒ… ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæä¾›äº†ä¸€ä¸ªå¸¦æœ‰æ ‡è®°çš„ åŸå­å¼•ç”¨ç±»â€œAtomicStampedReferenceâ€ï¼Œ<br>å®ƒå¯ä»¥é€šè¿‡æ§åˆ¶ å˜é‡å€¼çš„ç‰ˆæœ¬ æ¥ä¿è¯ CASçš„æ­£ç¡®æ€§ã€‚</p>
<p>ä¸è¿‡ç›®å‰æ¥è¯´è¿™ä¸ªç±» æ¯”è¾ƒâ€œé¸¡è‚‹â€ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ ABAé—®é¢˜ ä¸ä¼šå½±å“ ç¨‹åºå¹¶å‘çš„æ­£ç¡®æ€§ï¼Œ<br>å¦‚æœéœ€è¦ è§£å†³ABAé—®é¢˜ï¼Œæ”¹ç”¨ä¼ ç»Ÿçš„ äº’æ–¥åŒæ­¥ å¯èƒ½ä¼šæ¯” åŸå­ç±»æ›´é«˜æ•ˆã€‚</p>
<h6 id="3-æ— åŒæ­¥æ–¹æ¡ˆ"><a href="#3-æ— åŒæ­¥æ–¹æ¡ˆ" class="headerlink" title="3.æ— åŒæ­¥æ–¹æ¡ˆ"></a>3.æ— åŒæ­¥æ–¹æ¡ˆ</h6><p>è¦ä¿è¯ çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸æ˜¯ä¸€å®šå°±è¦è¿›è¡Œ åŒæ­¥ï¼Œä¸¤è€…æ²¡æœ‰ å› æœå…³ç³»ã€‚</p>
<p>åŒæ­¥ åªæ˜¯ä¿è¯ å…±äº«æ•°æ®äº‰ç”¨æ—¶çš„æ­£ç¡®æ€§ çš„æ‰‹æ®µï¼Œ<br>å¦‚æœä¸€ä¸ªæ–¹æ³• æœ¬æ¥å°±ä¸æ¶‰åŠ å…±äº«æ•°æ®ï¼Œ<br>é‚£å®ƒè‡ªç„¶å°±æ— éœ€ ä»»ä½•åŒæ­¥æªæ–½ å»ä¿è¯ æ­£ç¡®æ€§ï¼Œ<br>å› æ­¤ä¼šæœ‰ä¸€äº›ä»£ç å¤©ç”Ÿå°±æ˜¯ çº¿ç¨‹å®‰å…¨çš„ï¼Œç¬”è€…ç®€å•åœ°ä»‹ç»å…¶ä¸­çš„ä¸¤ç±»ã€‚</p>
<p><strong>å¯é‡å…¥ä»£ç ï¼ˆReentrant Codeï¼‰</strong>:<br>è¿™ç§ä»£ç ä¹Ÿå«åš çº¯ä»£ç ï¼ˆPure Codeï¼‰ï¼Œ<br>å¯ä»¥åœ¨ ä»£ç æ‰§è¡Œçš„ä»»ä½•æ—¶åˆ» ä¸­æ–­å®ƒï¼Œ<br>è½¬è€Œå» æ‰§è¡Œå¦å¤–ä¸€æ®µä»£ç ï¼ˆåŒ…æ‹¬ é€’å½’è°ƒç”¨å®ƒæœ¬èº«ï¼‰ï¼Œ<br>è€Œåœ¨ æ§åˆ¶æƒ è¿”å›åï¼Œ<br>åŸæ¥çš„ç¨‹åº ä¸ä¼šå‡ºç°ä»»ä½•é”™è¯¯ã€‚</p>
<p>ç›¸å¯¹ çº¿ç¨‹å®‰å…¨ æ¥è¯´ï¼Œ<br>å¯é‡å…¥æ€§ æ˜¯æ›´åŸºæœ¬çš„ç‰¹æ€§ï¼Œ<br>å®ƒå¯ä»¥ä¿è¯ çº¿ç¨‹å®‰å…¨ï¼Œ<br>å³æ‰€æœ‰çš„ å¯é‡å…¥ çš„ä»£ç éƒ½æ˜¯ çº¿ç¨‹å®‰å…¨çš„ï¼Œ<br>ä½†æ˜¯å¹¶éæ‰€æœ‰çš„ çº¿ç¨‹å®‰å…¨ çš„ä»£ç éƒ½æ˜¯ å¯é‡å…¥çš„ã€‚</p>
<p>å¯é‡å…¥ä»£ç  æœ‰ä¸€äº› å…±åŒçš„ç‰¹å¾ï¼Œ<br>ä¾‹å¦‚ ä¸ä¾èµ–å­˜å‚¨åœ¨å †ä¸Šçš„æ•°æ® å’Œ å…¬ç”¨çš„ç³»ç»Ÿèµ„æºã€ç”¨åˆ°çš„çŠ¶æ€é‡ éƒ½ç”±å‚æ•°ä¸­ä¼ å…¥ã€ä¸è°ƒç”¨éå¯é‡å…¥çš„æ–¹æ³•ç­‰ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„åŸåˆ™æ¥åˆ¤æ–­ ä»£ç æ˜¯å¦å…·å¤‡å¯é‡å…¥æ€§ï¼š<br>å¦‚æœä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„è¿”å›ç»“æœæ˜¯å¯ä»¥ é¢„æµ‹çš„ï¼Œåªè¦è¾“å…¥äº†ç›¸åŒçš„æ•°æ®ï¼Œå°±éƒ½èƒ½è¿”å›ç›¸åŒçš„ç»“æœï¼Œé‚£å®ƒå°±æ»¡è¶³ å¯é‡å…¥æ€§ çš„è¦æ±‚ï¼Œå½“ç„¶ä¹Ÿå°±æ˜¯ çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p><strong>çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread Local Storageï¼‰</strong>:<br>å¦‚æœä¸€æ®µä»£ç ä¸­ æ‰€éœ€è¦çš„æ•°æ® å¿…é¡»ä¸ å…¶ä»–ä»£ç  å…±äº«ï¼Œ<br>é‚£å°±çœ‹çœ‹è¿™äº› å…±äº«æ•°æ®çš„ä»£ç  æ˜¯å¦èƒ½ä¿è¯ åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ æ‰§è¡Œï¼Ÿ<br>å¦‚æœèƒ½ä¿è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠ å…±äº«æ•°æ®çš„å¯è§èŒƒå›´ é™åˆ¶åœ¨ åŒä¸€ä¸ªçº¿ç¨‹ä¹‹å†…ï¼Œ<br>è¿™æ ·ï¼Œæ— é¡» åŒæ­¥  ä¹Ÿèƒ½ä¿è¯ çº¿ç¨‹ä¹‹é—´ ä¸å‡ºç° æ•°æ®äº‰ç”¨ çš„é—®é¢˜ã€‚</p>
<p>ç¬¦åˆè¿™ç§ç‰¹ç‚¹çš„åº”ç”¨å¹¶ä¸å°‘è§ï¼Œ<br>å¤§éƒ¨åˆ†ä½¿ç”¨ æ¶ˆè´¹é˜Ÿåˆ—çš„æ¶æ„æ¨¡å¼ï¼ˆå¦‚â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å¼ï¼‰éƒ½ä¼šå°† äº§å“çš„æ¶ˆè´¹è¿‡ç¨‹ å°½é‡åœ¨ ä¸€ä¸ªçº¿ç¨‹ä¸­ æ¶ˆè´¹å®Œï¼Œ<br>å…¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªåº”ç”¨å®ä¾‹å°±æ˜¯ ç»å…¸Webäº¤äº’æ¨¡å‹ ä¸­çš„ â€œä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªæœåŠ¡å™¨çº¿ç¨‹â€ï¼ˆThread-per-Requestï¼‰ çš„å¤„ç†æ–¹å¼ï¼Œ<br>è¿™ç§ å¤„ç†æ–¹å¼çš„å¹¿æ³›åº”ç”¨ ä½¿å¾—å¾ˆå¤š WebæœåŠ¡ç«¯åº”ç”¨ éƒ½å¯ä»¥ä½¿ç”¨ çº¿ç¨‹æœ¬åœ°å­˜å‚¨ æ¥è§£å†³ çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<p>Javaè¯­è¨€ä¸­ï¼Œ<br>å¦‚æœ ä¸€ä¸ªå˜é‡ è¦è¢« å¤šçº¿ç¨‹ è®¿é—®ï¼Œå¯ä»¥ä½¿ç”¨ volatileå…³é”®å­— å£°æ˜å®ƒä¸º â€œæ˜“å˜çš„â€ï¼›<br>å¦‚æœ ä¸€ä¸ªå˜é‡ è¦è¢« æŸä¸ªçº¿ç¨‹ ç‹¬äº«ï¼ŒJavaä¸­å°±æ²¡æœ‰ç±»ä¼¼C++ä¸­ __declspec(thread)è¿™æ ·çš„å…³é”®å­—ï¼Œ<br>ä¸è¿‡è¿˜æ˜¯å¯ä»¥é€šè¿‡ java.lang.ThreadLocalç±» æ¥å®ç° çº¿ç¨‹æœ¬åœ°å­˜å‚¨ çš„åŠŸèƒ½ã€‚</p>
<blockquote>
<p>åœ¨ Visual C++ ä¸­æ˜¯ â€œ<strong>declspec(thread)â€å…³é”®å­—ï¼Œè€Œåœ¨ GCC ä¸­æ˜¯â€œ</strong>threadâ€ã€‚</p>
</blockquote>
<p>æ¯ä¸€ä¸ªçº¿ç¨‹çš„ Threadå¯¹è±¡ä¸­éƒ½æœ‰ä¸€ä¸ª ThreadLocalMapå¯¹è±¡ï¼Œ<br>è¿™ä¸ªå¯¹è±¡ å­˜å‚¨äº†ä¸€ç»„ ä»¥ ThreadLocal.threadLocalHashCode ä¸º é”® ï¼Œä»¥ æœ¬åœ°çº¿ç¨‹å˜é‡ ä¸º å€¼ çš„ K-Vå€¼å¯¹ï¼Œ<br>ThreadLocalå¯¹è±¡ å°±æ˜¯ å½“å‰çº¿ç¨‹çš„ThreadLocalMapçš„ è®¿é—®å…¥å£ï¼Œ<br>æ¯ä¸€ä¸ª ThreadLocalå¯¹è±¡ éƒ½åŒ…å«äº† ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ threadLocalHashCodeå€¼ï¼Œ<br>ä½¿ç”¨è¿™ä¸ªå€¼ å°±å¯ä»¥åœ¨çº¿ç¨‹ K-Vå€¼å¯¹ ä¸­æ‰¾å› å¯¹åº”çš„æœ¬åœ°çº¿ç¨‹å˜é‡ã€‚</p>
<h4 id="é”ä¼˜åŒ–"><a href="#é”ä¼˜åŒ–" class="headerlink" title="é”ä¼˜åŒ–"></a>é”ä¼˜åŒ–</h4><p>é«˜æ•ˆå¹¶å‘ æ˜¯ä» JDK1.5åˆ°JDK1.6çš„ä¸€ä¸ª é‡è¦æ”¹è¿›ï¼Œ<br>HotSpotè™šæ‹Ÿæœº å¼€å‘å›¢é˜Ÿåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸ŠèŠ±è´¹äº†å¤§é‡çš„ç²¾åŠ›å»å®ç° å„ç§é”ä¼˜åŒ–æŠ€æœ¯ï¼Œ<br>å¦‚ é€‚åº”æ€§è‡ªæ—‹ï¼ˆAdaptive Spinningï¼‰ã€é”æ¶ˆé™¤ï¼ˆLock Eliminationï¼‰ã€é”ç²—åŒ–ï¼ˆLock Coarseningï¼‰ã€è½»é‡çº§é”ï¼ˆLightweight Lockingï¼‰å’Œåå‘é”ï¼ˆBiased Lockingï¼‰ç­‰ï¼Œ<br>è¿™äº›æŠ€æœ¯éƒ½æ˜¯ä¸ºäº† åœ¨çº¿ç¨‹ä¹‹é—´ æ›´é«˜æ•ˆåœ° å…±äº«æ•°æ®ï¼Œ<br>ä»¥åŠ è§£å†³ç«äº‰é—®é¢˜ï¼Œ<br>ä»è€Œ æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</p>
<h5 id="è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹"><a href="#è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹" class="headerlink" title="è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹"></a>è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹</h5><p>å‰é¢æˆ‘ä»¬è®¨è®º äº’æ–¥åŒæ­¥ çš„æ—¶å€™ï¼Œ<br>æåˆ°äº† äº’æ–¥åŒæ­¥ å¯¹æ€§èƒ½æœ€å¤§çš„å½±å“ æ˜¯é˜»å¡çš„å®ç°ï¼Œ<br>æŒ‚èµ·çº¿ç¨‹ å’Œ æ¢å¤çº¿ç¨‹ çš„æ“ä½œéƒ½éœ€è¦ è½¬å…¥å†…æ ¸æ€ ä¸­å®Œæˆï¼Œ<br>è¿™äº›æ“ä½œç»™ç³»ç»Ÿçš„ å¹¶å‘æ€§èƒ½ å¸¦æ¥äº†å¾ˆå¤§çš„å‹åŠ›ã€‚</p>
<p>åŒæ—¶ï¼Œè™šæ‹Ÿæœº çš„å¼€å‘å›¢é˜Ÿä¹Ÿæ³¨æ„åˆ°åœ¨è®¸å¤šåº”ç”¨ä¸Šï¼Œ<br>å…±äº«æ•°æ®çš„é”å®šçŠ¶æ€ åªä¼šæŒç»­å¾ˆçŸ­çš„ä¸€æ®µæ—¶é—´ï¼Œ<br>ä¸ºäº†è¿™æ®µæ—¶é—´ å»æŒ‚èµ·å’Œæ¢å¤çº¿ç¨‹ å¹¶ä¸å€¼å¾—ã€‚</p>
<p>å¦‚æœ ç‰©ç†æœºå™¨ æœ‰ä¸€ä¸ªä»¥ä¸Šçš„ å¤„ç†å™¨ï¼Œ<br>èƒ½è®© ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„çº¿ç¨‹ åŒæ—¶å¹¶è¡Œæ‰§è¡Œï¼Œ<br>æˆ‘ä»¬å°±å¯ä»¥è®©  åé¢è¯·æ±‚é”çš„é‚£ä¸ªçº¿ç¨‹ â€œç¨ç­‰ä¸€ä¸‹â€ï¼Œ<br>ä½†ä¸æ”¾å¼ƒ å¤„ç†å™¨çš„æ‰§è¡Œæ—¶é—´ï¼Œ<br>çœ‹çœ‹ æŒæœ‰é”çš„çº¿ç¨‹ æ˜¯å¦å¾ˆå¿«å°±ä¼šé‡Šæ”¾é”ã€‚</p>
<p>ä¸ºäº†è®©çº¿ç¨‹ç­‰å¾…ï¼Œæˆ‘ä»¬åªéœ€è®© çº¿ç¨‹æ‰§è¡Œä¸€ä¸ªå¿™å¾ªç¯ï¼ˆè‡ªæ—‹ï¼‰ï¼Œè¿™é¡¹æŠ€æœ¯å°±æ˜¯æ‰€è°“çš„ è‡ªæ—‹é”ã€‚</p>
<p>è‡ªæ—‹é” åœ¨ JDK1.4.2 ä¸­å°±å·²ç»å¼•å…¥ï¼Œ<br>åªä¸è¿‡ é»˜è®¤ æ˜¯ å…³é—­çš„ï¼Œ<br>å¯ä»¥ä½¿ç”¨ -XX:+UseSpinning å‚æ•°æ¥å¼€å¯ï¼Œ<br>åœ¨ JDK1.6 ä¸­å°±å·²ç»æ”¹ä¸º é»˜è®¤å¼€å¯äº†ã€‚</p>
<p>è‡ªæ—‹ç­‰å¾… ä¸èƒ½ä»£æ›¿ é˜»å¡ï¼Œ<br>ä¸”å…ˆä¸è¯´å¯¹ å¤„ç†å™¨æ•°é‡çš„è¦æ±‚ï¼Œ<br>è‡ªæ—‹ç­‰å¾… æœ¬èº«è™½ç„¶ é¿å…äº†çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ï¼Œ<br>ä½†å®ƒæ˜¯è¦ å ç”¨å¤„ç†å™¨æ—¶é—´çš„ï¼Œ<br>å› æ­¤ï¼Œå¦‚æœ é” è¢«å ç”¨çš„æ—¶é—´ å¾ˆçŸ­ï¼Œè‡ªæ—‹ç­‰å¾… çš„ æ•ˆæœå°±ä¼šéå¸¸å¥½ï¼Œ<br>åä¹‹ï¼Œå¦‚æœ é” è¢«å ç”¨çš„æ—¶é—´ å¾ˆé•¿ï¼Œé‚£ä¹ˆ è‡ªæ—‹çš„çº¿ç¨‹ åªä¼š ç™½ç™½æ¶ˆè€—å¤„ç†å™¨èµ„æºï¼Œ<br>è€Œä¸ä¼šåš ä»»ä½•æœ‰ç”¨çš„å·¥ä½œï¼Œ<br>åè€Œä¼šå¸¦æ¥ æ€§èƒ½ä¸Šçš„æµªè´¹ã€‚</p>
<p>å› æ­¤ï¼Œè‡ªæ—‹ç­‰å¾…çš„æ—¶é—´ å¿…é¡»è¦æœ‰ ä¸€å®šçš„é™åº¦ï¼Œ<br>å¦‚æœ è‡ªæ—‹è¶…è¿‡äº†é™å®šçš„æ¬¡æ•° ä»ç„¶æ²¡æœ‰ æˆåŠŸè·å¾—é”ï¼Œ<br>å°±åº”å½“ä½¿ç”¨ ä¼ ç»Ÿçš„æ–¹å¼ å»æŒ‚èµ·çº¿ç¨‹äº†ã€‚</p>
<p>è‡ªæ—‹æ¬¡æ•° çš„ é»˜è®¤å€¼ æ˜¯ 10æ¬¡ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å‚æ•°-XX:PreBlockSpin æ¥æ›´æ”¹ã€‚</p>
<p>åœ¨ JDK1.6 ä¸­å¼•å…¥äº† è‡ªé€‚åº”çš„è‡ªæ—‹é”ã€‚</p>
<p>è‡ªé€‚åº” æ„å‘³ç€ è‡ªæ—‹çš„æ—¶é—´ ä¸å†å›ºå®šäº†ï¼Œ<br>è€Œæ˜¯ç”± å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´ åŠ é”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€ æ¥å†³å®šã€‚</p>
<p>å¦‚æœåœ¨ åŒä¸€ä¸ªé”å¯¹è±¡ä¸Šï¼Œ<br>è‡ªæ—‹ç­‰å¾… åˆšåˆšæˆåŠŸè·å¾—è¿‡é”ï¼Œå¹¶ä¸” æŒæœ‰é”çš„çº¿ç¨‹ æ­£åœ¨è¿è¡Œä¸­ï¼Œ<br>é‚£ä¹ˆ è™šæ‹Ÿæœº å°±ä¼šè®¤ä¸º è¿™æ¬¡è‡ªæ—‹ ä¹Ÿå¾ˆæœ‰å¯èƒ½å†æ¬¡æˆåŠŸï¼Œ<br>è¿›è€Œå®ƒå°† å…è®¸ è‡ªæ—‹ç­‰å¾… æŒç»­ç›¸å¯¹æ›´é•¿çš„æ—¶é—´ï¼Œæ¯”å¦‚100ä¸ªå¾ªç¯ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœ å¯¹äºæŸä¸ªé”ï¼Œè‡ªæ—‹ å¾ˆå°‘æˆåŠŸè·å¾—è¿‡ï¼Œ<br>éšç€ ç¨‹åºè¿è¡Œå’Œæ€§èƒ½ç›‘æ§ä¿¡æ¯ çš„ ä¸æ–­å®Œå–„ï¼Œ<br>è™šæ‹Ÿæœº å¯¹ ç¨‹åºé” çš„ çŠ¶å†µé¢„æµ‹ å°±ä¼šè¶Šæ¥è¶Šå‡†ç¡®ï¼Œ<br>è™šæ‹Ÿæœº å°±ä¼šå˜å¾— è¶Šæ¥è¶Šâ€œèªæ˜â€äº†ã€‚</p>
<h5 id="é”æ¶ˆé™¤"><a href="#é”æ¶ˆé™¤" class="headerlink" title="é”æ¶ˆé™¤"></a>é”æ¶ˆé™¤</h5><p>é”æ¶ˆé™¤ æ˜¯æŒ‡ è™šæ‹Ÿæœº å³æ—¶ç¼–è¯‘å™¨ åœ¨è¿è¡Œæ—¶ï¼Œ<br>å¯¹ä¸€äº›ä»£ç ä¸Š è¦æ±‚ åŒæ­¥ï¼Œä½†æ˜¯è¢«æ£€æµ‹åˆ° ä¸å¯èƒ½å­˜åœ¨å…±äº«æ•°æ®ç«äº‰çš„é” è¿›è¡Œ æ¶ˆé™¤ã€‚</p>
<p>é”æ¶ˆé™¤ çš„ ä¸»è¦åˆ¤å®šä¾æ® æ¥æºäº é€ƒé€¸åˆ†æ çš„ æ•°æ®æ”¯æŒï¼ˆç¬¬11ç« å·²ç»è®²è§£è¿‡ é€ƒé€¸åˆ†ææŠ€æœ¯ï¼‰ï¼Œ<br>å¦‚æœåˆ¤æ–­ åœ¨ä¸€æ®µä»£ç ä¸­ï¼Œå † ä¸Šçš„æ‰€æœ‰ æ•°æ® éƒ½ä¸ä¼š é€ƒé€¸å‡ºå» ä»è€Œè¢« å…¶ä»–çš„çº¿ç¨‹è®¿é—®åˆ°ï¼Œ<br>é‚£å°±å¯ä»¥æŠŠå®ƒä»¬å½“åš å †ä¸Šæ•°æ®å¯¹å¾…ï¼Œ<br>è®¤ä¸ºå®ƒä»¬æ˜¯ çº¿ç¨‹ç§æœ‰çš„ï¼ŒåŒæ­¥åŠ é” è‡ªç„¶ä¹Ÿå°±æ— é¡»è¿è¡Œã€‚</p>
<p>ä¹Ÿè®¸è¯»è€…ä¼šæœ‰ç–‘é—®ï¼Œ å˜é‡ æ˜¯å¦é€ƒé€¸ï¼Œ<br>å¯¹äº è™šæ‹Ÿæœº æ¥è¯´éœ€è¦ä½¿ç”¨ æ•°æ®æµåˆ†æ æ¥ç¡®å®šï¼Œ<br>ä½†æ˜¯ç¨‹åºå‘˜è‡ªå·±åº”è¯¥æ—¶å¾ˆæ¸…æ¥šçš„ï¼Œæ€ä¹ˆä¼šåœ¨ æ˜çŸ¥é“ä¸å­˜åœ¨æ•°æ®äº‰ç”¨çš„æƒ…å†µä¸‹ è¦æ±‚åŒæ­¥å‘¢ï¼Ÿ<br>ç­”æ¡ˆæ˜¯æœ‰è®¸å¤š åŒæ­¥æªæ–½ å¹¶ä¸æ˜¯ç¨‹åºå‘˜è‡ªå·±åŠ çš„ï¼Œ<br>åŒæ­¥çš„ä»£ç  åœ¨javaç¨‹åºä¸­çš„ æ™®éç¨‹åº¦ ä¹Ÿè®¸è¶…è¿‡äº†å¤§éƒ¨åˆ†è¯»è€…çš„æƒ³è±¡ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç æ¸…å•13-6ä¸­çš„ä¾‹å­ï¼Œè¿™æ®µéå¸¸ç®€å•çš„ä»£ç  ä»…ä»…æ˜¯è¾“å‡º3ä¸ªå­—ç¬¦ä¸²ç›¸åŠ çš„ç»“æœï¼Œ<br>æ— è®ºæ˜¯ æºç å­—é¢ä¸Š è¿˜æ˜¯ ç¨‹åºè¯­ä¹‰ä¸Š éƒ½æ²¡æœ‰åŒæ­¥ã€‚</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">                                ä»£ç æ¸…å• 13-6 ä¸€æ®µçœ‹èµ·æ¥æ²¡æœ‰åŒæ­¥çš„ä»£ç </span></span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line">public String concatString(String s1,String s2,String s3)&#123;</span><br><span class="line"><span class="code">  return s1+s2+s3;</span></span><br><span class="line">&#125;</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¹ŸçŸ¥é“ï¼Œ<br>ç”±äº Stringæ˜¯ä¸€ä¸ªä¸å¯å˜çš„ç±»ï¼Œå¯¹å­—ç¬¦ä¸²çš„è¿æ¥æ“ä½œ æ€»æ˜¯é€šè¿‡ç”Ÿæˆ æ–°çš„Stringå¯¹è±¡ æ¥è¿›è¡Œçš„ï¼Œ<br>å› æ­¤ Javacç¼–è¯‘å™¨ ä¼šå¯¹ Stringè¿æ¥ åš è‡ªåŠ¨ä¼˜åŒ–ã€‚</p>
<p>åœ¨ JDK1.5 ä¹‹å‰ï¼Œä¼šè½¬åŒ–ä¸º StringBufferå¯¹è±¡çš„è¿ç»­append()æ“ä½œï¼Œ<br>åœ¨ JDK1.5åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œä¼šè½¬ä¸º StringBuilderå¯¹è±¡çš„è¿ç»­append()æ“ä½œï¼Œ<br>å³ä»£ç æ¸…å•13-6ä¸­çš„ä»£ç  å¯èƒ½ä¼šå˜æˆä»£ç æ¸…å• 13-7çš„æ ·å­ã€‚</p>
<blockquote>
<p>å®¢è§‚åœ°è¯´ï¼Œæ—¢ç„¶è°ˆåˆ° é”æ¶ˆé™¤ä¸é€ƒé€¸åˆ†æï¼Œé‚£ è™šæ‹Ÿæœº å°±ä¸å¯èƒ½æ˜¯ JDK1.5ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå®é™…ä¸Šä¼šè½¬åŒ–ä¸º éçº¿ç¨‹å®‰å…¨çš„StringBuilder æ¥å®Œæˆå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¹¶ä¸ä¼šåŠ é”ï¼Œ ä½†è¿™ä¹Ÿä¸å½±å“ç¬”è€…ç”¨è¿™ä¸ªä¾‹å­è¯æ˜ Javaå¯¹è±¡ä¸­åŒæ­¥çš„æ™®éæ€§ã€‚</p>
</blockquote>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">                                ä»£ç æ¸…å• 13-7 Javacè½¬åŒ–åçš„å­—ç¬¦ä¸²è¿æ¥æ“ä½œ</span></span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line">public String concatString(String s1,String s2,String s3)&#123;</span><br><span class="line"><span class="code">  StringBuffer sb = new StringBuffer();</span></span><br><span class="line"><span class="code">  sb.append(s1);</span></span><br><span class="line"><span class="code">  sb.append(s2);</span></span><br><span class="line"><span class="code">  sb.append(s3);</span></span><br><span class="line"><span class="code">  return sb.toString();</span></span><br><span class="line">&#125;</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å¤§å®¶è¿˜è®¤ä¸ºè¿™æ®µä»£ç æ²¡æœ‰æ¶‰åŠåŒæ­¥å—ï¼Ÿ<br>æ¯ä¸ª StringBuffer.append() æ–¹æ³•ä¸­éƒ½æœ‰ä¸€ä¸ª åŒæ­¥å—ï¼Œé”å°±æ˜¯sbå¯¹è±¡ã€‚<br>è™šæ‹Ÿæœº è§‚å¯Ÿ å˜é‡sbï¼Œå¾ˆå¿«å°±ä¼šå‘ç°å®ƒçš„ åŠ¨æ€ä½œç”¨åŸŸ è¢«é™åˆ¶åœ¨ concatString()æ–¹æ³•å†…éƒ¨ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œsbçš„æ‰€æœ‰å¼•ç”¨ æ°¸è¿œä¸ä¼š â€œé€ƒé€¸â€ åˆ° concatString() æ–¹æ³•ä¹‹å¤–ï¼Œ<br>å…¶ä»–çº¿ç¨‹ æ— æ³•è®¿é—® åˆ° å®ƒï¼Œ<br>å› æ­¤ï¼Œè™½ç„¶è¿™é‡Œæœ‰é”ï¼Œä½†æ˜¯å¯ä»¥è¢« å®‰å…¨åœ°æ¶ˆé™¤æ‰ï¼Œ<br>åœ¨ å³æ—¶ç¼–è¯‘ ä¹‹åï¼Œè¿™æ®µä»£ç å°±ä¼šå¿½ç•¥æ‰ æ‰€æœ‰çš„åŒæ­¥å— è€Œç›´æ¥æ‰§è¡Œäº†ã€‚</p>
<h5 id="é”ç²—åŒ–"><a href="#é”ç²—åŒ–" class="headerlink" title="é”ç²—åŒ–"></a>é”ç²—åŒ–</h5><p>åŸåˆ™ä¸Šï¼Œæˆ‘ä»¬åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œæ€»æ˜¯æ¨èå°† åŒæ­¥å—çš„ä½œç”¨èŒƒå›´ é™åˆ¶å¾— å°½é‡å°â€”â€”åªåœ¨ å…±äº«æ•°æ®çš„å®é™…ä½œç”¨åŸŸ ä¸­æ‰è¿›è¡ŒåŒæ­¥ï¼Œ<br>è¿™æ ·æ˜¯ä¸ºäº† ä½¿å¾—éœ€è¦ åŒæ­¥çš„æ“ä½œæ•°é‡ å°½å¯èƒ½ å˜å°ï¼Œ<br>å¦‚æœå­˜åœ¨ é”ç«äº‰ï¼Œé‚£ç­‰å¾… é”çš„çº¿ç¨‹ ä¹Ÿèƒ½å°½å¿«æ‹¿åˆ°é”ã€‚</p>
<p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¸Šé¢çš„åŸåˆ™éƒ½æ˜¯æ­£ç¡®çš„ï¼Œ<br>ä½†æ˜¯å¦‚æœ ä¸€ç³»åˆ—çš„è¿ç»­çš„åŠ¨ä½œ éƒ½å¯¹ åŒä¸€ä¸ªå¯¹è±¡ åå¤åŠ é”å’Œè§£é”ï¼Œ<br>ç”šè‡³ åŠ é”æ“ä½œ æ˜¯å‡ºç°åœ¨ å¾ªç¯ä½“ä¸­çš„ï¼Œ<br>é‚£å³æ˜¯æ²¡æœ‰ çº¿ç¨‹ç«äº‰ï¼Œé¢‘ç¹åœ°è¿›è¡Œäº’æ–¥åŒæ­¥æ“ä½œ ä¹Ÿä¼šå¯¼è‡´ ä¸å¿…è¦çš„æ€§èƒ½æŸè€—ã€‚</p>
<p>ä»£ç æ¸…å•13-7ä¸­ è¿ç»­çš„append()æ–¹æ³•å°±å±äºè¿™ç±»æƒ…å†µã€‚</p>
<p>å¦‚æœ è™šæ‹Ÿæœº æ¢æµ‹åˆ°æœ‰è¿™æ · ä¸€ä¸²é›¶ç¢çš„æ“ä½œ éƒ½å¯¹ åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œ<br>å°†ä¼šæŠŠ åŠ é”åŒæ­¥çš„èŒƒå›´ æ‰©å±•ï¼ˆç²—åŒ–ï¼‰åˆ° æ•´ä¸ªæ“ä½œåºåˆ—çš„å¤–éƒ¨ï¼Œ<br>ä»¥ä»£ç æ¸…å•13-7ä¸ºä¾‹ï¼Œå°±æ˜¯æ‰©å±•åˆ°ç¬¬ä¸€ä¸ªappend()æ“ä½œä¹‹å‰ ç›´è‡³ æœ€åä¸€ä¸ªappend()æ“ä½œä¹‹åï¼Œ<br>è¿™æ ·åªéœ€è¦ åŠ é”ä¸€æ¬¡ å°±å¯ä»¥äº†ã€‚</p>
<h5 id="è½»é‡çº§é”"><a href="#è½»é‡çº§é”" class="headerlink" title="è½»é‡çº§é”"></a>è½»é‡çº§é”</h5><p>è½»é‡çº§é” æ˜¯ JDK1.6ä¹‹ä¸­ åŠ å…¥çš„ æ–°å‹é”æœºåˆ¶ï¼Œ<br>å®ƒåå­—ä¸­çš„ â€œè½»é‡çº§â€ æ˜¯ ç›¸å¯¹äº ä½¿ç”¨ æ“ä½œç³»ç»Ÿäº’æ–¥é‡æ¥å®ç°çš„ä¼ ç»Ÿé” è€Œè¨€çš„ï¼Œ<br>å› æ­¤ ä¼ ç»Ÿçš„é”æœºåˆ¶ å°±ç§°ä¸º â€œé‡é‡çº§â€é”ã€‚</p>
<p>é¦–å…ˆéœ€è¦å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯ï¼Œ è½»é‡çº§é” å¹¶ä¸æ˜¯ç”¨æ¥ ä»£æ›¿ é‡é‡çº§é” çš„ï¼Œ<br>å®ƒçš„æœ¬æ„ æ˜¯åœ¨ æ²¡æœ‰å¤šçº¿ç¨‹ç«äº‰çš„å‰æä¸‹ï¼Œ<br>å‡å°‘ ä¼ ç»Ÿçš„é‡é‡çº§é” ä½¿ç”¨ æ“ä½œç³»ç»Ÿäº’æ–¥é‡ äº§ç”Ÿçš„æ€§èƒ½æ¶ˆè€—ã€‚</p>
<p>è¦ç†è§£ è½»é‡çº§é”ï¼Œ<br>ä»¥åŠåé¢ä¼šè®²åˆ°çš„ åå‘é”çš„åŸç†å’Œè¿ä½œè¿‡ç¨‹ï¼Œ<br>å¿…é¡»ä» HotSpotè™šæ‹Ÿæœºçš„å¯¹è±¡ï¼ˆå¯¹è±¡å¤´éƒ¨åˆ†ï¼‰çš„å†…å­˜å¸ƒå±€å¼€å§‹ä»‹ç»ã€‚</p>
<p>HotSpotè™šæ‹Ÿæœºçš„å¯¹è±¡å¤´ï¼ˆObject Headerï¼‰åˆ†ä¸ºä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼Œ<br>ç¬¬ä¸€éƒ¨åˆ† ç”¨äºå­˜å‚¨ å¯¹è±¡è‡ªèº«çš„ è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GCåˆ†ä»£å¹´é¾„ï¼ˆGenerational GC Ageï¼‰ç­‰ï¼Œ<br>è¿™éƒ¨åˆ†æ•°æ®çš„é•¿åº¦ åœ¨32ä½å’Œ64ä½çš„ è™šæ‹Ÿæœºä¸­ åˆ†åˆ«ä¸º 32bitå’Œ64bitï¼Œå®˜æ–¹ç§°å®ƒä¸º â€œMark Wordâ€ï¼Œ<br>å®ƒæ˜¯ å®ç°è½»é‡çº§é” å’Œ åå‘é” çš„ å…³é”®ã€‚</p>
<p>å¦ä¸€éƒ¨åˆ† ç”¨äºå­˜å‚¨ æŒ‡å‘æ–¹æ³•åŒºå¯¹è±¡ ç±»å‹æ•°æ®çš„æŒ‡é’ˆï¼Œ<br>å¦‚æœæ˜¯æ•°ç»„å¯¹è±¡çš„è¯ï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªé¢å¤–çš„éƒ¨åˆ† ç”¨äºå­˜å‚¨ æ•°ç»„é•¿åº¦ã€‚</p>
<p>å¯¹è±¡å¤´ä¿¡æ¯ æ˜¯ä¸ å¯¹è±¡è‡ªèº«å®šä¹‰çš„ æ•°æ®æ— å…³çš„ é¢å¤–å­˜å‚¨æˆæœ¬ï¼Œ<br>è€ƒè™‘åˆ° è™šæ‹Ÿæœºçš„ç©ºé—´æ•ˆç‡ï¼Œ<br>Mark Word è¢«è®¾è®¡æˆä¸€ä¸ª éå›ºå®šçš„æ•°æ®ç»“æ„ ä»¥ä¾¿åœ¨ æå°çš„ç©ºé—´å†… å­˜å‚¨å°½é‡å¤šçš„ä¿¡æ¯ï¼Œ<br>å®ƒä¼šæ ¹æ®å¯¹è±¡çš„çŠ¶æ€ å¤ç”¨ è‡ªå·±çš„ å­˜å‚¨ç©ºé—´ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨32ä½çš„HotSpotè™šæ‹Ÿæœºä¸­ å¯¹è±¡æœªè¢«é”å®šçš„çŠ¶æ€ä¸‹ï¼Œ<br>Mark Wordçš„ 32bitç©ºé—´çš„ 25bit ç”¨äºå­˜å‚¨ å¯¹è±¡å“ˆå¸Œç ï¼ˆHashCodeï¼‰ï¼Œ<br>4bit ç”¨äºå­˜å‚¨ å¯¹è±¡åˆ†ä»£å¹´é¾„ï¼Œ<br>2bit ç”¨äºå­˜å‚¨ é”æ ‡å¿—ä½ï¼Œ<br>1bit å›ºå®šä¸º 0ï¼Œ<br>åœ¨å…¶ä»–çŠ¶æ€ï¼ˆè½»é‡çº§é”å®šã€é‡é‡çº§é”å®šã€GCæ ‡è®°ã€å¯åå‘ï¼‰ä¸‹ å¯¹è±¡çš„å­˜å‚¨å†…å®¹ è§è¡¨13-1ã€‚</p>
<table>
  <thead>
    <tr>
      <th colspan="2">è¡¨ 13-1 HotSpotè™šæ‹Ÿæœºå¯¹è±¡å¤´ Mark Word</th>
    </tr>
  </thead>
  <tr>
    <th>å­˜å‚¨å†…å®¹</th>
    <th>æ ‡å¿—ä½</th>
    <th>çŠ¶æ€</th>
  </tr>
  <tr>
    <td>å¯¹è±¡å“ˆå¸Œç ã€å¯¹è±¡åˆ†ä»£å¹´é¾„</td>
    <td>01</td>
    <td>æœªé”å®š</td>
  </tr>
    <tr>
    <td>æŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆ</td>
    <td>00</td>
    <td>è½»é‡çº§é”å®š</td>
  </tr>
    <tr>
    <td>æŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆ</td>
    <td>10</td>
    <td>è†¨èƒ€ï¼ˆé‡é‡çº§é”å®šï¼‰</td>
  </tr>
   <tr>
    <td>ç©ºï¼Œä¸éœ€è¦è®°å½•ä¿¡æ¯</td>
    <td>11</td>
    <td>GCæ ‡è®°</td>
  </tr>
   <tr>
    <td>åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ã€å¯¹è±¡åˆ†ä»£å¹´é¾„</td>
    <td>01</td>
    <td>å¯åå‘</td>
  </tr>
</table>

<p>ç®€å•åœ°ä»‹ç»äº† å¯¹è±¡çš„å†…å­˜å¸ƒå±€ åï¼Œ<br>æˆ‘ä»¬æŠŠè¯é¢˜è¿”å›åˆ° è½»é‡çº§é”çš„æ‰§è¡Œè¿‡ç¨‹ä¸Šã€‚</p>
<p>åœ¨ä»£ç è¿›å…¥ åŒæ­¥å— çš„æ—¶å€™ï¼Œ<br>å¦‚æœæ­¤ åŒæ­¥å¯¹è±¡ æ²¡æœ‰è¢« é”å®šï¼ˆé”æ ‡å¿—ä½ ä¸ºâ€œ01â€çŠ¶æ€ï¼‰ï¼Œ<br>è™šæ‹Ÿæœº é¦–å…ˆå°† åœ¨å½“å‰çº¿ç¨‹çš„ æ ˆå¸§ ä¸­ å»ºç«‹ä¸€ä¸ªåä¸º é”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œ<br>ç”¨äºå­˜å‚¨ é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´<br>ï¼ˆå®˜æ–¹æŠŠè¿™ä»½æ‹·è´åŠ äº†ä¸€ä¸ª Displacedå‰ç¼€ï¼Œå³ Displaced Mark Wordï¼‰ï¼Œ<br>è¿™æ—¶å€™ çº¿ç¨‹å †æ ˆ ä¸ å¯¹è±¡å¤´çš„çŠ¶æ€ å¦‚å›¾13-3æ‰€ç¤ºã€‚</p>
<p>ç„¶åï¼Œ<br>è™šæ‹Ÿæœº å°†ä½¿ç”¨ CASæ“ä½œ å°è¯•å°† å¯¹è±¡çš„Mark Word æ›´æ–°ä¸ºæŒ‡å‘ Lock Recordçš„æŒ‡é’ˆã€‚</p>
<p>å¦‚æœè¿™ä¸ªæ›´æ–°åŠ¨ä½œ æˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹ å°±æ‹¥æœ‰äº† è¯¥å¯¹è±¡çš„é”ï¼Œ<br>å¹¶ä¸” å¯¹è±¡Mark Word çš„ é”æ ‡å¿—ä½ï¼ˆMark Wordçš„æœ€å2bitï¼‰å°†è½¬å˜ä¸ºâ€œ00â€ï¼Œ<br>å³è¡¨ç¤ºæ­¤å¯¹è±¡å¤„äº è½»é‡çº§é”å®šçŠ¶æ€ï¼Œ<br>è¿™æ—¶å€™ çº¿ç¨‹å †æ ˆä¸å¯¹è±¡å¤´çš„çŠ¶æ€ å¦‚å›¾13-4æ‰€ç¤ºã€‚</p>
<blockquote>
<p>å›¾13-3å’Œå›¾13-4æ¥æºäº HotSpotè™šæ‹Ÿæœºçš„ä¸€ä½Senior Staff Engineerâ€”â€”Paul Hohenseeæ‰€å†™çš„PPT â€œThe Hotspot Java Virtual Machineâ€ã€‚</p>
</blockquote>
<p>å¦‚æœè¿™ä¸ªæ›´æ–°åŠ¨ä½œ å¤±è´¥äº†ï¼Œè™šæ‹Ÿæœº é¦–å…ˆä¼šæ£€æŸ¥ å¯¹è±¡çš„Mark Word æ˜¯å¦æŒ‡å‘ å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œ<br>å¦‚æœåªè¯´æ˜ å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œé‚£å°±å¯ä»¥ç›´æ¥ è¿›å…¥åŒæ­¥å— ç»§ç»­æ‰§è¡Œï¼Œ<br>å¦åˆ™è¯´æ˜ è¿™ä¸ªé”å¯¹è±¡ å·²ç»è¢«å…¶ä»–çº¿ç¨‹ æŠ¢å äº†ã€‚</p>
<p>å¦‚æœæœ‰ä¸¤æ¡ä»¥ä¸Šçš„ çº¿ç¨‹ äº‰ç”¨åŒä¸€ä¸ªé”ï¼Œ<br>é‚£ è½»é‡çº§é” å°±ä¸å†æœ‰æ•ˆï¼Œè¦ è†¨èƒ€ ä¸º é‡é‡çº§é”ï¼Œ<br>é”æ ‡å¿— çš„ çŠ¶æ€å€¼ å˜ä¸º â€œ10â€œï¼Œ<br>Mark Wordä¸­å­˜å‚¨çš„ å°±æ˜¯æŒ‡å‘ é‡é‡çº§é”ï¼ˆäº’æ–¥é‡ï¼‰çš„æŒ‡é’ˆï¼Œ<br>åé¢ ç­‰å¾…é”çš„çº¿ç¨‹ ä¹Ÿè¦è¿›å…¥ é˜»å¡çŠ¶æ€ã€‚</p>
<p>ä¸Šé¢æè¿°çš„æ˜¯ è½»é‡çº§é”çš„æ·é”è¿‡ç¨‹ï¼Œ<br>å®ƒçš„ è§£é”è¿‡ç¨‹ ä¹Ÿæ˜¯é€šè¿‡ CASæ“ä½œæ¥è¿›è¡Œçš„ï¼Œ<br>å¦‚æœ å¯¹è±¡çš„Mark Word ä»ç„¶æŒ‡å‘è¿™ çº¿ç¨‹çš„é”è®°å½•ï¼Œ<br>é‚£å°±ç”¨ CASæ“ä½œ æŠŠ å¯¹è±¡çš„Mark Word å’Œ çº¿ç¨‹ä¸­å¤åˆ¶çš„Displaced Mark Wordæ›¿æ¢å›æ¥ï¼Œ<br>å¦‚æœæ›¿æ¢æˆåŠŸï¼Œæ•´ä¸ªåŒæ­¥è¿‡ç¨‹å°±å®Œæˆäº†ã€‚<br>å¦‚æœæ›¿æ¢å¤±è´¥ï¼Œè¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹ å°è¯•è¿‡è·å–è¯¥é”ï¼Œé‚£å°±è¦åœ¨é‡Šæ”¾é”çš„åŒæ—¶ï¼Œå”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚</p>
<p>è½»é‡çº§é” èƒ½æå‡ ç¨‹åºåŒæ­¥æ€§èƒ½ çš„ä¾æ®æ˜¯ â€œå¯¹äºç»å¤§éƒ¨åˆ†çš„é”ï¼Œåœ¨æ•´ä¸ªåŒæ­¥å‘¨æœŸå†…éƒ½æ˜¯ä¸å­˜åœ¨ç«äº‰çš„â€ï¼Œ<br>è¿™æ˜¯ä¸€ä¸ªç»éªŒæ•°æ®ã€‚</p>
<p>å¦‚æœæ²¡æœ‰ç«äº‰ï¼Œè½»é‡çº§é”ä½¿ç”¨ CASæ“ä½œ é¿å…äº†ä½¿ç”¨ äº’æ–¥é‡çš„å¼€é”€ï¼Œ<br>ä½†å¦‚æœå­˜åœ¨ é”ç«äº‰ï¼Œé™¤äº†äº’æ–¥é‡çš„å¼€é”€ä»¥å¤–ï¼Œè¿˜é¢å¤–å‘ç”Ÿäº† CASæ“ä½œï¼Œ<br>å› æ­¤åœ¨ æœ‰ç«äº‰çš„æƒ…å†µä¸‹ï¼Œ è½»é‡çº§é” ä¼šæ¯” ä¼ ç»Ÿçš„é‡é‡çº§é” æ›´æ…¢ã€‚</p>
<h5 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h5><p>åå‘é” ä¹Ÿæ˜¯ JDK1.6 ä¸­å¼•å…¥çš„ä¸€é¡¹ é”ä¼˜åŒ–ï¼Œ<br>å®ƒçš„ç›®çš„æ˜¯ æ¶ˆé™¤æ•°æ®åœ¨æ— ç«äº‰æƒ…å†µä¸‹çš„åŒæ­¥åŸè¯­ï¼Œè¿›ä¸€æ­¥æé«˜ç¨‹åºçš„è¿è¡Œæ€§èƒ½ã€‚</p>
<p>å¦‚æœè¯´ è½»é‡çº§é” æ˜¯åœ¨ æ— ç«äº‰çš„æƒ…å†µä¸‹ ä½¿ç”¨ CASæ“ä½œ å» æ¶ˆé™¤åŒæ­¥ä½¿ç”¨çš„äº’æ–¥é‡ï¼Œ<br>é‚£ åå‘é” å°±æ˜¯åœ¨ æ— ç«äº‰çš„æƒ…å†µä¸‹ æƒ³æŠŠ æ•´ä¸ªåŒæ­¥éƒ½æ¶ˆé™¤æ‰ï¼Œè¿CASæ“ä½œéƒ½ä¸åšäº†ã€‚</p>
<p>åå‘é”çš„ â€œåâ€ï¼Œå°±æ˜¯åå¿ƒçš„â€œåâ€ã€åè¢’çš„â€œåâ€ï¼Œ<br>å®ƒçš„æ„æ€æ˜¯ è¿™ä¸ªé” ä¼šåå‘äº ç¬¬ä¸€ä¸ª è·å¾—å®ƒçš„çº¿ç¨‹ï¼Œ<br>å¦‚æœåœ¨æ¥ä¸‹æ¥çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯¥é” æ²¡æœ‰è¢«å…¶ä»–çš„ çº¿ç¨‹è·å–ï¼Œåˆ™æŒæœ‰ åå‘é”çš„ çº¿ç¨‹ å°†æ°¸è¿œä¸éœ€è¦å†è¿›è¡Œ åŒæ­¥ã€‚</p>
<p>å¦‚æœè¯»è€…è¯»æ‡‚äº†å‰é¢ è½»é‡çº§é” ä¸­ å…³äºå¯¹è±¡å¤´Mark Wordä¸çº¿ç¨‹ä¹‹é—´ çš„ æ“ä½œè¿‡ç¨‹ï¼Œ<br>é‚£ åå‘é”çš„åŸç† ç†è§£èµ·æ¥å°±ä¼šå¾ˆç®€å•ã€‚</p>
<p>å‡è®¾å½“å‰ è™šæ‹Ÿæœº å¯ç”¨äº† åå‘é”ï¼ˆå¯ç”¨å‚æ•° -XX:+UseBiasedLockingï¼Œè¿™æ˜¯ JDK1.6çš„é»˜è®¤å€¼ï¼‰ï¼Œ<br>é‚£ä¹ˆï¼Œå½“ é”å¯¹è±¡ ç¬¬ä¸€æ¬¡ è¢«çº¿ç¨‹è·å–çš„æ—¶å€™ï¼Œè™šæ‹Ÿæœº å°†ä¼šæŠŠ å¯¹è±¡å¤´ä¸­çš„ æ ‡å¿—ä½ è®¾ä¸º â€œ01â€ï¼Œå³åå‘æ¨¡å¼ã€‚</p>
<p>å¦‚æœä½¿ç”¨ CASæ“ä½œ æŠŠ è·å–åˆ°è¿™ä¸ªé”çš„çº¿ç¨‹çš„ID è®°å½•åœ¨ å¯¹è±¡çš„Mark Wordä¹‹ä¸­ï¼Œ<br>å¦‚æœ CASæ“ä½œ æˆåŠŸ<br>æŒæœ‰ åå‘é”çš„çº¿ç¨‹ ä»¥åæ¯æ¬¡è¿›å…¥è¿™ä¸ªé” ç›¸å…³çš„åŒæ­¥å—æ—¶ï¼Œè™šæ‹Ÿæœºéƒ½å¯ä»¥ä¸å†è¿›è¡Œ ä»»ä½•åŒæ­¥æ“ä½œ<br>ï¼ˆä¾‹å¦‚ LOckingã€Unlocking åŠå¯¹ Mark Wordçš„Update ç­‰ï¼‰ã€‚</p>
<p>å½“æœ‰ å¦å¤–ä¸€ä¸ªçº¿ç¨‹ å»å°è¯• è·å–è¿™ä¸ªé”æ—¶ï¼Œ<br>åå‘æ¨¡å¼ å°± å®£å‘Šç»“æŸã€‚</p>
<p>æ ¹æ® é”å¯¹è±¡ ç›®å‰æ˜¯å¦å¤„äº è¢«é”å®š çš„çŠ¶æ€ï¼Œ<br>æ’¤é”€ åå‘ï¼ˆRevoke Biasï¼‰å æ¢å¤åˆ° æœªé”å®šï¼ˆæ ‡å¿—ä½ä¸º â€œ01â€ï¼‰ æˆ– è½»é‡çº§é”å®šï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰çš„çŠ¶æ€ï¼Œ<br>åç»­çš„åŒæ­¥æ“ä½œ å°±å¦‚ä¸Šé¢ä»‹ç»çš„ è½»é‡çº§é”é‚£æ ·æ‰§è¡Œã€‚</p>
<p>åå‘é”ã€è½»é‡çº§é”çš„çŠ¶æ€è½¬åŒ– åŠ å¯¹è±¡çš„Mark Wordçš„å…³ç³»å¦‚å›¾13-5 æ‰€ç¤ºã€‚</p>
<p>åå‘é” å¯ä»¥æé«˜ å¸¦æœ‰ åŒæ­¥ ä½† æ— ç«äº‰çš„ ç¨‹åºæ€§èƒ½ã€‚</p>
<p>å®ƒåŒæ ·æ˜¯ä¸€ä¸ªå¸¦æœ‰ æ•ˆç›Šæƒè¡¡ï¼ˆTrade Offï¼‰æ€§è´¨çš„ä¼˜åŒ–ï¼Œ<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¹¶ä¸ä¸€å®šæ€»æ˜¯å¯¹ ç¨‹åºè¿è¡Œ æœ‰åˆ©ï¼Œ<br>å¦‚æœ ç¨‹åºä¸­å¤§å¤šæ•°çš„é” æ€»æ˜¯è¢« å¤šä¸ªä¸åŒçš„çº¿ç¨‹ è®¿é—®ï¼Œ<br>é‚£ åå‘æ¨¡å¼å°±æ˜¯å¤šä½™çš„ã€‚</p>
<p>åœ¨å…·ä½“é—®é¢˜å…·ä½“åˆ†æçš„å‰æä¸‹ï¼Œæœ‰æ—¶å€™ä½¿ç”¨å‚æ•° -XX:-UseBiasedLocking æ¥ ç¦æ­¢åå‘é”ä¼˜åŒ– åè€Œå¯ä»¥ æå‡æ€§èƒ½ã€‚</p>
<h4 id="æœ¬ç« å°ç»“"><a href="#æœ¬ç« å°ç»“" class="headerlink" title="æœ¬ç« å°ç»“"></a>æœ¬ç« å°ç»“</h4><p>æœ¬ç« ä»‹ç»äº† çº¿ç¨‹å®‰å…¨ æ‰€æ¶‰åŠçš„ æ¦‚å¿µå’Œåˆ†ç±»ã€åŒæ­¥å®ç°çš„æ–¹å¼ åŠ è™šæ‹Ÿæœºçš„åº•å±‚è¿ä½œåŸç†ï¼Œ<br>å¹¶ä¸”ä»‹ç»äº† è™šæ‹Ÿæœº ä¸ºäº†å®ç°é«˜æ•ˆå¹¶å‘ æ‰€é‡‡å–çš„çš„ ä¸€ç³»åˆ— é”ä¼˜åŒ–æªæ–½ã€‚</p>
<p>è®¸å¤šèµ„æ·±çš„ç¨‹åºå‘˜éƒ½è¯´è¿‡ï¼Œèƒ½å¤Ÿå†™å‡º é«˜ä¼¸ç¼©æ€§çš„å¹¶å‘ç¨‹åº æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œ<br>è€Œ äº†è§£å¹¶å‘ åœ¨ç³»ç»Ÿåº•å±‚ æ˜¯å¦‚ä½•å®ç°çš„ï¼Œåˆ™æ˜¯ æŒæ¡è¿™é—¨è‰ºæœ¯çš„ å‰ææ¡ä»¶ï¼Œ<br>ä¹Ÿæ˜¯æˆé•¿ä¸º é«˜çº§ç¨‹åºå‘˜çš„å¿…å¤‡çŸ¥è¯†ä¹‹ä¸€ã€‚</p>

      
    </div>
    
    
    



<div>
    
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JSåº“ sweetalert å¯ä¿®æ”¹è·¯å¾„ -->
  <script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script>
  <script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css">

  <p><span>æœ¬æ–‡æ ‡é¢˜:</span>æ·±å…¥ç†è§£javaè™šæ‹Ÿæœº-çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–ğŸ“</a></p>
  <p><span>æ–‡ç« ä½œè€…:</span>âœ¨ğŸ§™â€â™€ï¸âœ¨</a></p>
  <p><span>å‘å¸ƒæ—¶é—´:</span>2020å¹´05æœˆ26æ—¥ - 22:41:37ğŸŒ</p>
  <p><span>æœ€åæ›´æ–°:</span>2020å¹´06æœˆ06æ—¥ - 02:26:39ğŸŒœ</p>
  <p><span>åŸå§‹é“¾æ¥:</span><a href="/2020/05/26/%E3%80%90%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA%E3%80%91/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA13/" title="æ·±å…¥ç†è§£javaè™šæ‹Ÿæœº-çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–">https://fengshana.github.io/2020/05/26/%E3%80%90%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA%E3%80%91/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA13/</a>
    <span class="copy-path"  title="ç‚¹å‡»å¤åˆ¶æ–‡ç« é“¾æ¥"><i class="fa fa-clipboard" data-clipboard-text="https://fengshana.github.io/2020/05/26/%E3%80%90%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA%E3%80%91/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA13/"  aria-label="å¤åˆ¶æˆåŠŸï¼"></i></span>
  </p>
  <p><span>è®¸å¯åè®®:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…</a> è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥åŠä½œè€…ã€‚ğŸ„	</p>  
</div>
<style>
</style>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    clipboard.on('success', $(function(){
      $(".fa-clipboard").click(function(){
        //swal({   
          //title: "",   
         // text: '<div style="width:300px;height:100px;font-size:14px;">é“å‹ï¼Œå¤åˆ¶æˆåŠŸäº†å“Ÿ(ï¼¾ï¼µï¼¾)ãƒ~</div>',   
          //html: true,
          //timer: 500,   
        //showConfirmButton: false
        //});
      });
      new ClipboardJS('.fa-clipboard', {
          target: function(trigger) {
              $('<div>').appendTo('body').addClass('alert alert-success').html('ğŸ¤ é“å‹á•¦(ï½¥ã…‚ï½¥)á•¤ï¼ŒğŸ¥­å¤åˆ¶æˆåŠŸäº†å“Ÿ(^_âˆ’)â˜†').show().delay(1500).fadeOut();
              return trigger.nextElementSibling;
            }
      });
    }));  
</script>


    
</div>



    








<div>
  
    <div>
    
        <br/>
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------ğŸ“ğŸ‡æœ¬æ–‡ç»“æŸğŸ¤æ„Ÿè°¢é“å‹çš„é˜…è¯»ğŸğŸ’-------------</div>
    
</div>
  
</div>












    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>ğŸ¥•ğŸ†åšæŒåŸåˆ›æŠ€æœ¯åˆ†äº«ğŸ³ï¼ŒğŸŒ½ğŸ¥¬æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œï¼ğŸ¬</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>æ‰“èµ</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatreward.png" alt="âœ¨ğŸ§™â€â™€ï¸âœ¨ å¾®ä¿¡æ”¯ä»˜"/>
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipayreward.png" alt="âœ¨ğŸ§™â€â™€ï¸âœ¨ æ”¯ä»˜å®"/>
        <p>æ”¯ä»˜å®</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    










    <footer class="post-footer">
      
        <div class="post-tags" style="text-align:center">
          
            <a href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">ğŸŒŸé¢è¯•</i></a>
          
            <a href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" rel="tag">ğŸŒŸè™šæ‹Ÿæœº</i></a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/05/26/%E3%80%90%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA%E3%80%91/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3JAVA%E8%99%9A%E6%8B%9F%E6%9C%BA12/" rel="next" title="æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº-Javaå†…å­˜æ¨¡å‹ä¸çº¿ç¨‹">
                ğŸ‘ˆ æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº-Javaå†…å­˜æ¨¡å‹ä¸çº¿ç¨‹
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/05/27/%E3%80%90%E5%91%A8%E5%BD%A4%E5%BD%A4%E3%80%91/%E3%80%90%E5%91%A8%E5%BD%A4%E5%BD%A4%E3%80%91%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E6%94%B9%E8%BF%9B3/" rel="prev" title="å‰ç«¯é¡µé¢åŒè‰²çƒ3">
                å‰ç«¯é¡µé¢åŒè‰²çƒ3 ğŸ‘‰
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80ODk3My8yNTQ2Nw=="></div>
    </div>

  
  
  

  
  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/fsn.jpg"
                alt="âœ¨ğŸ§™â€â™€ï¸âœ¨" />
            
              <p class="site-author-name" itemprop="name">âœ¨ğŸ§™â€â™€ï¸âœ¨</p>
              <p class="site-description motion-element" itemprop="description">ğŸŒˆå‹¿å¿˜åˆå¿ƒğŸ’« ğŸŒï¼ŒğŸŒœæ–¹å¾—å§‹ç»ˆâ­</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <!--<a href="/archives/%7C%7Carchive">-->
                <a href="/archives/">
              
                  <span class="site-state-item-count">155</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">84</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/fengshana" target="_blank" title="GitHub">
                      
                        <i 
                          
                          class="fa fa-fw fa-github">
                           
                        </i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://space.bilibili.com/475144966" target="_blank" title="Bilibili">
                      
                        <i 
                          
                            class="">ğŸ’œ
                           
                        </i>Bilibili</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://user.qzone.qq.com/2915324940" target="_blank" title="QQ">
                      
                        <i 
                          
                            class="">ğŸ§¡
                           
                        </i>QQ</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://user.qzone.qq.com/198866436" target="_blank" title="QQ2">
                      
                        <i 
                          
                            class="">ğŸ’™
                           
                        </i>QQ2</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://gracg.com/user/user15472vJMQiV" target="_blank" title="Gracg">
                      
                        <i 
                          
                            class="">ğŸ’š
                           
                        </i>Gracg</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://gongzifengyue.gitee.io/fengshana.io" target="_blank" title="Gitee">
                      
                        <i 
                          
                            class="">ğŸ’›
                           
                        </i>Gitee</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title" style="color:white;">
                <i class="fa  fa-fw fa-link"></i>
                å‹æƒ…é“¾æ¥ğŸ’¦
              </div>
			  
			  
			  
			  
			  
			  
			  
			  
                

				  <span class="links-of-blogroll-item">
                    <a href="http://ruiyeclub.cn" title="chenrui" target="_blank">chenrui</a>
					 </span>
                

                
				
				
			  
			  
			  
			  
			  
			  
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#æ·±å…¥javaè™šæ‹Ÿæœº-ç¬¬äº”éƒ¨åˆ†-é«˜æ•ˆå¹¶å‘"><span class="nav-number">1.</span> <span class="nav-text">æ·±å…¥javaè™šæ‹Ÿæœº-ç¬¬äº”éƒ¨åˆ†-é«˜æ•ˆå¹¶å‘</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ç¬¬13ç« -çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–"><span class="nav-number">1.1.</span> <span class="nav-text">ç¬¬13ç«  çº¿ç¨‹å®‰å…¨ä¸é”ä¼˜åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#æ¦‚è¿°"><span class="nav-number">1.1.1.</span> <span class="nav-text">æ¦‚è¿°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#çº¿ç¨‹å®‰å…¨"><span class="nav-number">1.1.2.</span> <span class="nav-text">çº¿ç¨‹å®‰å…¨</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Javaè¯­è¨€ä¸­çš„çº¿ç¨‹å®‰å…¨"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">Javaè¯­è¨€ä¸­çš„çº¿ç¨‹å®‰å…¨</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-ä¸å¯å˜"><span class="nav-number">1.1.2.1.1.</span> <span class="nav-text">1.ä¸å¯å˜</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-ç»å¯¹çº¿ç¨‹å®‰å…¨"><span class="nav-number">1.1.2.1.2.</span> <span class="nav-text">2.ç»å¯¹çº¿ç¨‹å®‰å…¨</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-ç›¸å¯¹çº¿ç¨‹å®‰å…¨"><span class="nav-number">1.1.2.1.3.</span> <span class="nav-text">3.ç›¸å¯¹çº¿ç¨‹å®‰å…¨</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#4-çº¿ç¨‹å…¼å®¹"><span class="nav-number">1.1.2.1.4.</span> <span class="nav-text">4.çº¿ç¨‹å…¼å®¹</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#5-çº¿ç¨‹å¯¹ç«‹"><span class="nav-number">1.1.2.1.5.</span> <span class="nav-text">5.çº¿ç¨‹å¯¹ç«‹</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-äº’æ–¥åŒæ­¥"><span class="nav-number">1.1.2.2.1.</span> <span class="nav-text">1.äº’æ–¥åŒæ­¥</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-éé˜»å¡åŒæ­¥"><span class="nav-number">1.1.2.2.2.</span> <span class="nav-text">2.éé˜»å¡åŒæ­¥</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-æ— åŒæ­¥æ–¹æ¡ˆ"><span class="nav-number">1.1.2.2.3.</span> <span class="nav-text">3.æ— åŒæ­¥æ–¹æ¡ˆ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#é”ä¼˜åŒ–"><span class="nav-number">1.1.3.</span> <span class="nav-text">é”ä¼˜åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#é”æ¶ˆé™¤"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">é”æ¶ˆé™¤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#é”ç²—åŒ–"><span class="nav-number">1.1.3.3.</span> <span class="nav-text">é”ç²—åŒ–</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#è½»é‡çº§é”"><span class="nav-number">1.1.3.4.</span> <span class="nav-text">è½»é‡çº§é”</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#åå‘é”"><span class="nav-number">1.1.3.5.</span> <span class="nav-text">åå‘é”</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æœ¬ç« å°ç»“"><span class="nav-number">1.1.4.</span> <span class="nav-text">æœ¬ç« å°ç»“</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      


      


    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">ğŸŒ±2019 ğŸ„ ğŸŒ³

<span itemprop="copyrightYear">2020</span>
  <span class="with-love">
  <!--user-->
    ğŸ‰
  </span>
 
 <span class="author" itemprop="copyrightHolder">Fsnâœ¨ğŸ§™â€â™€ï¸âœ¨</span>

  





  <script async src="http://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
 
     ğŸƒâ€â™‚ï¸ 
    <span class="post-meta-item-icon">
      ğŸ“ˆ
    </span>
    
      <span class="post-meta-item-text">å°å±‹ğŸ’’æ€»å­—æ•°ï¼š</span>
    
	<span title="Site words total count">
     606.2kğŸŒŸ </span>
    <!--<span title="symbols_count_time.count_total">1.2m</span>-->
  
</div>



  <!-- <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>-->






<!--



 -->
 






        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazyload@2.0.0-beta.2/lazyload.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  













  





  

  

  

  
  

  

  

  
  <script type="text/javascript" src="/js/src/exturl.js?v=5.1.4"></script>


  
  
  
  <!-- 
  
  -->
  <link rel="stylesheet" href="/dist/APlayer.min.css">
<div id="aplayer"></div>
<script type="text/javascript" src="/dist/APlayer.min.js"></script>
<script type="text/javascript" src="/dist/music.js"></script>

  <!-- ä»£ç å—å¤åˆ¶åŠŸèƒ½    <script src="dist/clipboard.min.js"></script>-->
  <script type="text/javascript" src="/js/src/clipboard.min.js"></script>
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
  


</body>
</html>
<!-- é¡µé¢ç‚¹å‡»å°çº¢å¿ƒ -->
<script type="text/javascript" src="/js/src/love.js"></script>

<!--å´©æºƒæ¬ºéª— <script type="text/javascript" src="/js/src/crash_cheat.js"></script> -->




